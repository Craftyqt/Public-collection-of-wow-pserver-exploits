<?xml version="1.0" encoding="utf-8" ?><ROGUE><Ability><Name>---Racials---</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local Troll, Orc, Goblin, BloodElf, TrollCD, OrcCD, BloodElfCD, GoblinCD, RP, Pillar = 
Troll, Orc, Goblin, BloodElf, TrollCD, OrcCD, BloodElfCD, GoblinCD, RP, Pillar
if Nova_Cooldowns ~= 1 then return false end

---Orc Blood Fury---
if IsSpellKnown(20572) then
	if PQR_SpellAvailable(20572) then
		if Vendetta 
		or SD then
		CastSpellByName(GetSpellInfo(20572),&amp;quot;player&amp;quot;)
		return true
		end
	end
end

--Blood Elf Arcane Torrent--
if BloodElf == true then 
	if BloodElfCD &amp;lt; 1 
	and Energy &amp;lt; 40 then
	CastSpellByName(GetSpellInfo(28730),&amp;quot;player&amp;quot;)
	return true
	end
end

--Goblin Rocket Barrage--
if Goblin == true then 
	if GoblinCD &amp;lt; 1 then
	CastSpellByName(GetSpellInfo(69041),&amp;quot;target&amp;quot;)
	return true
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>---Initialize---</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if IsMounted()
or IsMouseButtonDown(3)
or UnitChannelInfo(&amp;quot;player&amp;quot;) 
or UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) == nil
or UnitIsDeadOrGhost(&amp;quot;player&amp;quot;) 
or UnitIsDeadOrGhost(&amp;quot;target&amp;quot;) 
or UnitAffectingCombat(&amp;quot;player&amp;quot;) == nil
or UnitBuffID(&amp;quot;player&amp;quot;,5384) ~= nil
or UnitDebuffID(&amp;quot;target&amp;quot;,1499)
or (UnitBuffID(&amp;quot;target&amp;quot;,123250) and UnitBuffID(&amp;quot;target&amp;quot;,123181))
or UnitDebuffID(&amp;quot;target&amp;quot;,19503)
or UnitBuffID(&amp;quot;Player&amp;quot;,80169)
or UnitBuffID(&amp;quot;Player&amp;quot;,87959)
or UnitBuffID(&amp;quot;Player&amp;quot;,1856)
or UnitBuffID(&amp;quot;Player&amp;quot;,1784)
then return true 
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>!!!GET IN MELEE RANGE!!!</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if IsSpellInRange(tostring(GetSpellInfo(1943)), &amp;quot;target&amp;quot;) == 0 then
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Assassination- Shadow Blades</Name><Default>false</Default><SpellID>121471</SpellID><Actions>/cast Blood Fury|/cast Berserking|/use 13|/use 14|/use 10|/script UIErrorsFrame:Clear()</Actions><Lua>if not PQI_SoapboxAssassination_ShadowBlades_enable then return false end
if Nova_AOE == 1 or Nova_Cooldowns ~= 1 then return false end

if PQI_SoapboxAssassination_BossCooldowns_enable then
	if not SpecialUnit() then 
	return false
	end
end
 
 
local SnD, SnDtimer, Rupture, Vendetta, Rupturetimer, Bloodlust = SnD, SnDtimer, Rupture, Vendetta, Rupturetimer, Bloodlust
if VenCD &amp;gt; 1 and VenCD &amp;lt; 30 and not Vendetta then
	if not Bloodlust then
	return false
	elseif T2D(&amp;quot;target&amp;quot;) &amp;gt; 15 then
	return false
	end
end


if UnitExists(&amp;quot;boss&amp;quot;..1) then
		local BossID = tonumber(UnitGUID(&amp;quot;boss&amp;quot;..1):sub(6,10), 16)
		if BossID == 69465	
		or BossID == 69712 then
   			if BossID == 69465 then -- Jin&amp;apos;Rokh
			local Fluidity = UnitDebuffID(&amp;quot;player&amp;quot;, 138002)	
				if Fluidity then
					if cTime &amp;lt; 10 or (((Rupture and Rupturetimer - GetTime() &amp;gt; 2) and (SnD and SnDtimer - GetTime() &amp;gt; 2)) and Bloodlust or cTime &amp;gt; 60 or Vendetta) then  
					return true
					end
				end				
    		elseif BossID == 69712 then -- Ji-Kun
  			local TargetID = tonumber(UnitGUID(&amp;quot;target&amp;quot;):sub(6,10), 16)
  			local Feed = UnitBuffID(&amp;quot;player&amp;quot;, 140741)
   				if TargetID == BossID then
   					if not UnitBuffID(&amp;quot;player&amp;quot;, 133755) then 
						if cTime &amp;lt; 10 or (((Rupture and Rupturetimer - GetTime() &amp;gt; 2) and (SnD and SnDtimer - GetTime() &amp;gt; 2)) and Bloodlust or cTime &amp;gt; 60 or Vendetta) then  
						return true
						end
					elseif Feed then
						if cTime &amp;lt; 10 or (((Rupture and Rupturetimer - GetTime() &amp;gt; 2) and (SnD and SnDtimer - GetTime() &amp;gt; 2)) and Bloodlust or cTime &amp;gt; 60 or Vendetta) then  
						return true
						end
					end
				end
			end
		elseif cTime &amp;lt; 10 or (((Rupture and Rupturetimer - GetTime() &amp;gt; 2) and (SnD and SnDtimer - GetTime() &amp;gt; 2)) and Bloodlust or cTime &amp;gt; 60 or Vendetta) then  
		return true
		end
	elseif cTime &amp;lt; 10 or (((Rupture and Rupturetimer - GetTime() &amp;gt; 2) and (SnD and SnDtimer - GetTime() &amp;gt; 2)) and Bloodlust or cTime &amp;gt; 60 or Vendetta) then  
	return true
	end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-All Spec- Tricks of the Trade</Name><Default>false</Default><SpellID>57934</SpellID><Actions></Actions><Lua>local Rup, RupTimeLeft 	= Debuff_Check( 1943, &amp;quot;target&amp;quot;, &amp;quot;PLAYER&amp;quot; )
if UnitExists(&amp;quot;focus&amp;quot;) and UnitInParty(&amp;quot;focus&amp;quot;) and not UnitIsDead(&amp;quot;focus&amp;quot;) and IsLineOfSight(&amp;quot;focus&amp;quot;, 3) and IsSpellInRange(GetSpellInfo(57934), &amp;quot;focus&amp;quot;) == 1 then

	PQR_CustomTarget = &amp;quot;focus&amp;quot;
	return true

end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Assassination- Dispatch</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if Nova_AOE == 1 then 	
	if Blindside then
	CastSpellByName(GetSpellInfo(111240))
	return true
	else
	return false 
	end
end




local CP, Blindside, Anticipation = CP, Blindside, Anticipation
local Targethealth = 100 * UnitHealth(&amp;quot;target&amp;quot;) / UnitHealthMax(&amp;quot;target&amp;quot;)
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )

if Targethealth &amp;lt; 75 and T2D(&amp;quot;target&amp;quot;) &amp;lt; 7 and CP &amp;gt; 4 then return false end

if Blindside or Targethealth &amp;lt; 35 then
	if Anticipation == true then
		if CP &amp;lt; 5 then
		CastSpellByName(GetSpellInfo(111240))
		elseif not Anti or AntiCharges &amp;lt; 4 then
		CastSpellByName(GetSpellInfo(111240))
		return true
		end
	elseif CP &amp;lt; 5 then
	CastSpellByName(GetSpellInfo(111240))
	return true
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-All Spec- Crippling Poison</Name><Default>false</Default><SpellID>3408</SpellID><Actions></Actions><Lua>if Leeching == true or Paralytic == true then return false end
if UnitAffectingCombat(&amp;quot;player&amp;quot;) == nil then
	if UnitBuffID(&amp;quot;player&amp;quot; ,5761)
	or UnitBuffID(&amp;quot;player&amp;quot;,3408) 
	or UnitBuffID(&amp;quot;player&amp;quot;,108211) 
	or UnitBuffID(&amp;quot;player&amp;quot;,108215) then
	return false
	else
	return true
	end
end</Lua><RecastDelay>1000</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-All Spec- Deadly Poison</Name><Default>false</Default><SpellID>2823</SpellID><Actions></Actions><Lua>if UnitBuffID(&amp;quot;player&amp;quot; ,2823)
or UnitBuffID(&amp;quot;player&amp;quot; ,8679) then
return false
else 
return true end</Lua><RecastDelay>1000</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Assassination- Dispatch -High-</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if Nova_AOE == 1 then 
	if Blindside then
	CastSpellByName(GetSpellInfo(111240))
	return true
	else
	return false 
	end
end

local Rupture, Rupturetimer, Energy, CP, Anticipation, Blindside = Rupture, Rupturetimer, Energy, CP, Anticipation, Blindside
local Targethealth = 100 * UnitHealth(&amp;quot;target&amp;quot;) / UnitHealthMax(&amp;quot;target&amp;quot;)
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )

if Targethealth &amp;lt; 75 and T2D(&amp;quot;target&amp;quot;) &amp;lt; 7 and CP &amp;gt; 4 then return false end

if Blindside or Targethealth &amp;lt; 35 then
	if Anticipation == true then
		if CP &amp;lt; 5 then
		CastSpellByName(GetSpellInfo(111240))
		elseif not Anti or AntiCharges &amp;lt; 4 then
		CastSpellByName(GetSpellInfo(111240))
		return true 
		elseif Anti and Energy &amp;gt; 90 and AntiCharges == 4 then
			if Rupture and Rupturetimer - GetTime() &amp;lt; 4 then
			CastSpellByName(GetSpellInfo(111240))
			return true
			end
		end
	elseif CP &amp;lt; 5 then
	CastSpellByName(GetSpellInfo(111240))
	return true
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Assassination- Env</Name><Default>false</Default><SpellID>2098</SpellID><Actions></Actions><Lua>if PQI_SoapboxAssassination_PooledEnvenoms_enable then return false end
if Vanish then return false end
local CP = GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; )
local Envenom, EnvenomTimeLeft = Buff_Check( 32645, &amp;quot;player&amp;quot; )
local Rupture, RuptureTimeLeft 	= Debuff_Check( 1943, &amp;quot;target&amp;quot;, &amp;quot;PLAYER&amp;quot; )
local Vendetta, VendettaTimeLeft 	= Debuff_Check( 79140, &amp;quot;target&amp;quot;, &amp;quot;PLAYER&amp;quot; )
local CurrentEnergy		= UnitPower(&amp;quot;player&amp;quot;)
local SB, SBTimeLeft	= Buff_Check( 121471, &amp;quot;player&amp;quot; )
local EnergyRegen = select(2, GetPowerRegen(&amp;quot;player&amp;quot;))
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )
local EnergyAfterEnvenom = CurrentEnergy + (EnergyRegen * 1.5)

if CP &amp;gt; 4 and Rupture and not SB and (not Anti or AntiCharges &amp;lt; 4) then

	if RuptureTimeLeft &amp;lt; 6 and RuptureTimeLeft &amp;gt; 3 and (CurrentEnergy + (EnergyRegen * (RuptureTimeLeft - 2)) + 25) &amp;lt; 110 then
		return true
	end
	
	if RuptureTimeLeft &amp;lt; 3 or (RuptureTimeLeft &amp;gt; 3 and CurrentEnergy &amp;lt; 60 and not Vendetta) then
		return true
	end
	
end

if CP &amp;gt; 4 and (not Envenom or EnvenomTimeLeft &amp;lt; 1 or (EnergyAfterEnvenom &amp;gt; 100 and ((Anti and AntiCharges &amp;gt; 2) or Anticipation == false)) or (SB and SBTimeLeft &amp;gt; 1 and EnergyAfterEnvenom &amp;gt; 30 and (Anti and AntiCharges &amp;gt; 2)))  then
	return true
	
end</Lua><RecastDelay>1000</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Assassination- Fan of Knives</Name><Default>false</Default><SpellID>51723</SpellID><Actions></Actions><Lua>if Nova_AOE ~= 1 then return false end

local CP, Blindside, Anticipation = CP, Blindside, Anticipation
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )



if CP &amp;lt; 5 then
return true
elseif Anticipation == true then
	if not Anti or AntiCharges &amp;lt; 4 then
	return true
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Assassination- Fan of Knives -High-</Name><Default>false</Default><SpellID>51723</SpellID><Actions></Actions><Lua>if Nova_AOE ~= 1 then return false end

local Rupture, Rupturetimer, Energy, CP, Anticipation, Blindside = Rupture, Rupturetimer, Energy, CP, Anticipation, Blindside
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )


if Rupture then
	if ((Anticipation == true and (not Anti or AntiCharges &amp;lt; 4)) or (Anticipation == false and CP &amp;lt; 4))
	or (((Anticipation == true and (not Anti or AntiCharges &amp;lt; 5)) or (Anticipation == false and CP &amp;lt; 5))
	and Energy &amp;gt; 90 and (Rupture and Rupturetimer - GetTime() &amp;lt; 4))
	then
	return true
	end
elseif CP &amp;gt; 2 then
return false
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-All Spec- Kidney Shot</Name><Default>false</Default><SpellID>408</SpellID><Actions></Actions><Lua>if Nova_Kidney == 1 then 
	if CP &amp;gt;= 3 then
	return true
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-All Spec- Leeching Poison</Name><Default>false</Default><SpellID>108211</SpellID><Actions></Actions><Lua>if Paralytic == true then return false end
if UnitAffectingCombat(&amp;quot;player&amp;quot;) == nil then
	if UnitBuffID(&amp;quot;player&amp;quot; ,5761)
	or UnitBuffID(&amp;quot;player&amp;quot;,3408) 
	or UnitBuffID(&amp;quot;player&amp;quot;,108211) 
	or UnitBuffID(&amp;quot;player&amp;quot;,108215) then
	return false
	else
	return true
	end
end</Lua><RecastDelay>1000</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-All Spec- Marked for Death</Name><Default>false</Default><SpellID>137619</SpellID><Actions></Actions><Lua>local CP = CP

if CP == 0 then
if Nova_Marked == 1 then 
return true
elseif Subtlety == true then
	if PQI_SoapboxSubtlety_AutoMarkedforDeath_enable then 
	return true
	end
elseif Assassination == true then
	if PQI_SoapboxAssassination_AutoMarkedforDeath_enable then 
	return true
	end
elseif Combat == true then
	if PQI_SoapboxCombat_AutoMarkedforDeath_enable then 
	return true
	end
end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Assassination- Mutilate</Name><Default>false</Default><SpellID>1329</SpellID><Actions></Actions><Lua>if Nova_AOE == 1 then return false end

local Envenom, Energy, Rupture, Rupturetimer, SnD, CP, Anticipation = Envenom, Energy, Rupture, Rupturetimer, SnD, CP, Anticipation
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )

local Targethealth = 100 * UnitHealth(&amp;quot;target&amp;quot;) / UnitHealthMax(&amp;quot;target&amp;quot;)

if Targethealth &amp;gt; 34 then
if Envenom or Energy &amp;gt; 71 or not Rupture or (Rupture and Rupturetimer - GetTime() &amp;lt; 3 and CP &amp;lt; 5) or not SnD then
	if Anticipation == true then
		if CP &amp;lt; 5 then
		return true
		elseif not Anti or AntiCharges &amp;lt; 3 then
		return true
		end
	elseif CP &amp;lt; 5 then
	return true
	end
end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Assassination- Mutilate -High-</Name><Default>false</Default><SpellID>1329</SpellID><Actions></Actions><Lua>if Nova_AOE == 1 then return false end

local Envenom, SnD, CP, Anticipation, Rupture, Rupturetimer, Energy = Envenom, SnD, CP, Anticipation, Rupture, Rupturetimer, Energy
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )
local Targethealth = 100 * UnitHealth(&amp;quot;target&amp;quot;) / UnitHealthMax(&amp;quot;target&amp;quot;)

if Targethealth &amp;gt; 34 then
if Envenom or Energy &amp;gt; 71 or not Rupture or (Rupture and Rupturetimer - GetTime() &amp;lt; 3 and CP &amp;lt; 5) or not SnD then
	if Anticipation == true then
		if CP &amp;lt; 5 then
			if Energy &amp;gt; 90 then
				if Rupture then
					if Rupturetimer - GetTime() &amp;lt; 4 then
					return true
					end
				end
			end
		elseif not Anti or AntiCharges &amp;lt; 3 then
			if Energy &amp;gt; 90 then
				if Rupture then
					if Rupturetimer - GetTime() &amp;lt; 4 then
					return true
					end
				end
			end
		end
	elseif CP &amp;lt; 5 then
		if Energy &amp;gt; 90 then
			if Rupture then
				if Rupturetimer - GetTime() &amp;lt; 4 then
				return true
				end
			end
		end
	end
end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-All Spec- Paralytic Poison</Name><Default>false</Default><SpellID>108215</SpellID><Actions></Actions><Lua>if UnitAffectingCombat(&amp;quot;player&amp;quot;) == nil then
	if UnitBuffID(&amp;quot;player&amp;quot; ,5761)
	or UnitBuffID(&amp;quot;player&amp;quot;,3408) 
	or UnitBuffID(&amp;quot;player&amp;quot;,108211) 
	or UnitBuffID(&amp;quot;player&amp;quot;,108215) then
	return false
	else
	return true
	end
end</Lua><RecastDelay>1000</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-All Spec- Redirect</Name><Default>false</Default><SpellID>73981</SpellID><Actions></Actions><Lua>if not Redirect then 
   Redirect = CreateFrame(&amp;quot;Frame&amp;quot;)
end
local Reframe = Redirect
Reframe:RegisterEvent(&amp;quot;UNIT_COMBO_POINTS&amp;quot;)
Reframe:SetScript(&amp;quot;OnEvent&amp;quot;, function(self, event, ...)

if event == &amp;quot;UNIT_COMBO_POINTS&amp;quot; then 
       Combo = GetComboPoints(&amp;quot;player&amp;quot;)    
end
end)
if Combo == nil then
	Combo = 0
end
if UnitAffectingCombat(&amp;quot;player&amp;quot;) == nil then
	Combo = 0
end
local ComboPoints = GetComboPoints(&amp;quot;player&amp;quot;, &amp;quot;target&amp;quot;)
if UnitExists(&amp;quot;Target&amp;quot;) and ComboPoints ~= Combo and Combo~=0 then
    return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Assassination- Rupture</Name><Default>false</Default><SpellID>1943</SpellID><Actions></Actions><Lua>local Vanish, Rupture, Rupturetimer, CP, Anticipation = Vanish, Rupture, Rupturetimer, CP, Anticipation

local Targethealth = 100 * UnitHealth(&amp;quot;target&amp;quot;) / UnitHealthMax(&amp;quot;target&amp;quot;)
if Vanish then return false
end

if Nova_AOE ~= 1 then
	if Targethealth &amp;gt; 90 or T2D(&amp;quot;target&amp;quot;) &amp;gt; 3 then
		if Rupture then
			if ((Rupturetimer - GetTime() &amp;lt; 2 and CP == 5) or (Rupturetimer - GetTime() &amp;lt; 1))
			or (Anticipation == false and (CP == 5 and Rupturetimer - GetTime() &amp;lt; 4) or (Rupturetimer - GetTime() &amp;lt; 2)) then
			return true
			end
		else
		return true
		end
	end
end

if Nova_AOE == 1 and not Rupture and CP &amp;gt; 2 then
return true
end</Lua><RecastDelay>2000</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Assassination- Slice and Dice</Name><Default>false</Default><SpellID>5171</SpellID><Actions></Actions><Lua>local Rupture, SnD, SnDtimer = Rupture, SnD, SnDtimer

local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )

if Anti then return false end

if SnD then
	if SnDtimer - GetTime() &amp;lt; 2 then
	return true
	end
else
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-All Spec- Stealth</Name><Default>false</Default><SpellID>1784</SpellID><Actions></Actions><Lua>--if UnitBuffID(&amp;quot;Player&amp;quot;,1856) then return false end

--if restealth and (GetTime() - restealth) &amp;gt; 0 and 0 == GetNumLootItems() and PQR_SpellAvailable(1784) then
--	ClearTarget()
--	return true
--end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Assassination- Vanish</Name><Default>false</Default><SpellID>1856</SpellID><Actions></Actions><Lua>if not PQI_SoapboxAssassination_Vanish_enable then return false end

if UnitBuffID(&amp;quot;Player&amp;quot;,115192) then return false end

local SB, VanishCD, Anticipation, CP, Energy, Focus, Subterfuge = SB, VanishCD, Anticipation, CP, Energy, Focus, Subterfuge
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )
if (cTime &amp;gt; 10 and SB) or Nova_AOE == 1 or Nova_Cooldowns ~= 1 then return false end

if PQI_SoapboxAssassination_BossCooldowns_enable then
	if not SpecialUnit() then 
	return false
	end
end

 
 if UnitExists(&amp;quot;boss&amp;quot;..1) then
		local BossID = tonumber(UnitGUID(&amp;quot;boss&amp;quot;..1):sub(6,10), 16)
		if BossID == 69465	
		or BossID == 69712 then
   			if BossID == 69465 then -- Jin&amp;apos;Rokh
			local Fluidity = UnitDebuffID(&amp;quot;player&amp;quot;, 138002)	
				if Fluidity then
					if VanishCD &amp;lt; 1 then 
						if (CP &amp;lt; 3 or (CP &amp;gt; 2 and Anticipation == true and (not Anti or AntiCharges &amp;lt; 3))
						or (CP &amp;lt; 4 or (Anticipation == true and (not Anti or AntiCharges &amp;lt; 4))))
						and ((Focus == true and Energy &amp;gt; 14) 
						or (Subterfuge == true and Energy &amp;gt; 89) 
						or (Focus == false and Subterfuge == false and Energy &amp;gt; 59)) then
	 					return true
	 					end
					 end
				end				
    		elseif BossID == 69712 then -- Ji-Kun
  			local TargetID = tonumber(UnitGUID(&amp;quot;target&amp;quot;):sub(6,10), 16)
  			local Feed = UnitBuffID(&amp;quot;player&amp;quot;, 140741)
   				if TargetID == BossID then
   					if not UnitBuffID(&amp;quot;player&amp;quot;, 133755) then 
						if VanishCD &amp;lt; 1 then 
						if (CP &amp;lt; 3 or (CP &amp;gt; 2 and Anticipation == true and (not Anti or AntiCharges &amp;lt; 3))
						or (CP &amp;lt; 4 or (Anticipation == true and (not Anti or AntiCharges &amp;lt; 4))))
						and ((Focus == true and Energy &amp;gt; 14) 
						or (Subterfuge == true and Energy &amp;gt; 89) 
						or (Focus == false and Subterfuge == false and Energy &amp;gt; 59)) then
	 					return true
	 					end
					 end
					elseif Feed then
						if VanishCD &amp;lt; 1 then 
							if (CP &amp;lt; 3 or (CP &amp;gt; 2 and Anticipation == true and (not Anti or AntiCharges &amp;lt; 3))
							or (CP &amp;lt; 4 or (Anticipation == true and (not Anti or AntiCharges &amp;lt; 4))))
							and ((Focus == true and Energy &amp;gt; 14) 
							or (Subterfuge == true and Energy &amp;gt; 89) 
							or (Focus == false and Subterfuge == false and Energy &amp;gt; 59)) then
	 						return true
	 						end
						end
					end
				end
			end
		elseif VanishCD &amp;lt; 1 then 
			if (CP &amp;lt; 3 or (CP &amp;gt; 2 and Anticipation == true and (not Anti or AntiCharges &amp;lt; 3))
			or (CP &amp;lt; 4 or (Anticipation == true and (not Anti or AntiCharges &amp;lt; 4))))
			and ((Focus == true and Energy &amp;gt; 14) 
			or (Subterfuge == true and Energy &amp;gt; 89) 
			or (Focus == false and Subterfuge == false and Energy &amp;gt; 59)) then
	 		return true
	 		end
		end
	elseif VanishCD &amp;lt; 1 then 
		if (CP &amp;lt; 3 or (CP &amp;gt; 2 and Anticipation == true and (not Anti or AntiCharges &amp;lt; 3))
		or (CP &amp;lt; 4 or (Anticipation == true and (not Anti or AntiCharges &amp;lt; 4))))
		and ((Focus == true and Energy &amp;gt; 14) 
		or (Subterfuge == true and Energy &amp;gt; 89) 
		or (Focus == false and Subterfuge == false and Energy &amp;gt; 59)) then
	 	return true
	 	end
	end</Lua><RecastDelay>10000</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Assassination- Vendetta</Name><Default>false</Default><SpellID>79140</SpellID><Actions>/cast Blood Fury|/cast Berserking|/use 13|/use 14</Actions><Lua>if not PQI_SoapboxAssassination_Vendetta_enable then return false end
if Nova_AOE == 1 or Nova_Cooldowns ~= 1 then return false end

if PQI_SoapboxAssassination_BossCooldowns_enable then
	if not SpecialUnit() then 
	return false
	end
end
 
local Rupture, Rupturetimer, SnD, SnDtimer = Rupture, Rupturetimer, SnD, SnDtimer 



 if UnitExists(&amp;quot;boss&amp;quot;..1) then
		local BossID = tonumber(UnitGUID(&amp;quot;boss&amp;quot;..1):sub(6,10), 16)
		if BossID == 69465	
		or BossID == 69712 then
   			if BossID == 69465 then -- Jin&amp;apos;Rokh
			local Fluidity = UnitDebuffID(&amp;quot;player&amp;quot;, 138002)	
				if Fluidity then
					if ((Rupture and Rupturetimer - GetTime() &amp;gt; 2) and (SnD and SnDtimer - GetTime() &amp;gt; 2)) or SB then 
					return true
					end
				end				
    		elseif BossID == 69712 then -- Ji-Kun
  			local TargetID = tonumber(UnitGUID(&amp;quot;target&amp;quot;):sub(6,10), 16)
  			local Feed = UnitBuffID(&amp;quot;player&amp;quot;, 140741)
   				if TargetID == BossID then
   					if not UnitBuffID(&amp;quot;player&amp;quot;, 133755) then 
						if ((Rupture and Rupturetimer - GetTime() &amp;gt; 2) and (SnD and SnDtimer - GetTime() &amp;gt; 2)) or SB then 
						return true
						end
					elseif Feed then
						if ((Rupture and Rupturetimer - GetTime() &amp;gt; 2) and (SnD and SnDtimer - GetTime() &amp;gt; 2)) or SB then 
						return true
						end
					end
				end
			end
		elseif ((Rupture and Rupturetimer - GetTime() &amp;gt; 2) and (SnD and SnDtimer - GetTime() &amp;gt; 2)) or SB then 
		return true
		end
	elseif ((Rupture and Rupturetimer - GetTime() &amp;gt; 2) and (SnD and SnDtimer - GetTime() &amp;gt; 2)) or SB then 
	return true
	end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Assassination- Env Energy</Name><Default>false</Default><SpellID>2098</SpellID><Actions></Actions><Lua>if not PQI_SoapboxAssassination_PooledEnvenoms_enable then return false end
if Vanish then return false end
local CP = GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; )
local Envenom, EnvenomTimeLeft = Buff_Check( 32645, &amp;quot;player&amp;quot; )
local Rupture, RuptureTimeLeft 	= Debuff_Check( 1943, &amp;quot;target&amp;quot;, &amp;quot;PLAYER&amp;quot; )
local Vendetta, VendettaTimeLeft 	= Debuff_Check( 79140, &amp;quot;target&amp;quot;, &amp;quot;PLAYER&amp;quot; )
local CurrentEnergy		= UnitPower(&amp;quot;player&amp;quot;)
local SB, SBTimeLeft	= Buff_Check( 121471, &amp;quot;player&amp;quot; )
local EnergyRegen = select(2, GetPowerRegen(&amp;quot;player&amp;quot;))
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )
local EnergyAfterEnvenom = CurrentEnergy + (EnergyRegen * 1.5)
local Targethealth = 100 * UnitHealth(&amp;quot;target&amp;quot;) / UnitHealthMax(&amp;quot;target&amp;quot;)


if Energy &amp;gt; 70 or SB or Nova_AOE == 1 then
	if CP &amp;gt; 4 and Rupture and not SB and (not Anti or AntiCharges &amp;lt; 4) then

		if RuptureTimeLeft &amp;lt; 6 and RuptureTimeLeft &amp;gt; 3 and (CurrentEnergy + (EnergyRegen * (RuptureTimeLeft - 2)) + 25) &amp;lt; 110 then
			return true
		end
	
		if RuptureTimeLeft &amp;lt; 3 or (RuptureTimeLeft &amp;gt; 3 and CurrentEnergy &amp;lt; 60 and not Vendetta) then
			return true
		end
	
	end

	if CP &amp;gt; 4 and (not Envenom or EnvenomTimeLeft &amp;lt; 1 or (EnergyAfterEnvenom &amp;gt; 100 and ((Anti and AntiCharges &amp;gt; 2) or Anticipation == false)) or (SB and SBTimeLeft &amp;gt; 1 and EnergyAfterEnvenom &amp;gt; 30 and (Anti and AntiCharges &amp;gt; 2)))  then
		return true
	
	end

end

if Targethealth &amp;lt; 75 and T2D(&amp;quot;target&amp;quot;) &amp;lt; 7 and CP &amp;gt; 4 then return true end</Lua><RecastDelay>1000</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Assassination- Envenom -Low-</Name><Default>false</Default><SpellID>2098</SpellID><Actions></Actions><Lua>local SnD, SnDtimer, CP = SnD, SnDtimer, CP
if Vanish then return false end
if CP &amp;gt;= 2 and SnD and SnDtimer - GetTime() &amp;lt; 4 then
return true
end</Lua><RecastDelay>1000</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Subtlety- Ambush</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>BehindFunc()
if Nova_Hemo == 1 then return false end

local SD, SDtimer = SD, SDtimer
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )

if SD then
if behind == false then
	if CP &amp;lt; 4 then
	CastSpellByName(GetSpellInfo(16511))
	return true
	elseif Anticipation == true then
		if not Anti or AntiCharges &amp;lt; 4 and SD and SDtimer - GetTime() &amp;lt;= 2 then
		CastSpellByName(GetSpellInfo(16511))
		return true
		end
	end
elseif behind == true then
	if CP &amp;lt; 3 then
	CastSpellByName(GetSpellInfo(8676))
	return true
	elseif Anticipation == true then
		if not Anti or AntiCharges &amp;lt; 3 and SD and SDtimer - GetTime() &amp;lt;= 2 then
		CastSpellByName(GetSpellInfo(8676))
		return true
		end
	end
end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Subtlety- Ambush -High-</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>BehindFunc()
if Nova_Hemo == 1 then return false end
 
local CP, Anticipation = CP, Anticipation
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )

if SD then
	if behind == false then
		if CP &amp;lt; 5 then
		CastSpellByName(GetSpellInfo(16511))
		return true
		elseif Anticipation == true then
			if not Anti or AntiCharges &amp;lt; 5 then
			CastSpellByName(GetSpellInfo(16511))
			return true
			end
		end
	elseif behind == true then 
		if CP &amp;lt; 5 then
		CastSpellByName(GetSpellInfo(8676))
		return true
		elseif Anticipation == true then
			if not Anti or AntiCharges &amp;lt; 4 then
			CastSpellByName(GetSpellInfo(8676))
			return true
			end
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Subtlety- Ambush -Subterfuge-</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>BehindFunc() 
if Nova_Hemo == 1 then return false end

if UnitBuffID(&amp;quot;Player&amp;quot;,115192) then
	if behind == false then
	CastSpellByName(GetSpellInfo(16511))
	return true
	elseif behind == true then
	CastSpellByName(GetSpellInfo(8676))
	return true
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Subtlety- Backstab</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>BehindFunc()


local Energy, SD, SDCD, CP, Anticipation = Energy, SD, SDCD, CP, Anticipation
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )

if Nova_Hemo == 1 or Nova_AOE == 1 or SD or UnitBuffID(&amp;quot;Player&amp;quot;,115192) or Vanish then return false end

if behind == false then
	if Energy &amp;gt; 80 then
		if CP &amp;lt; 5 then
			if SDCD &amp;gt;= 2  or Energy &amp;gt; 90 then 
			CastSpellByName(GetSpellInfo(16511))
			return true
			end
		elseif CP == 5 and Anticipation == true then
			if not Anti or AntiCharges &amp;lt; 4 then
				if SDCD &amp;gt;= 2 then
				CastSpellByName(GetSpellInfo(16511))
				return true
				end
			end
		end
	end
elseif behind == true then
	if Energy &amp;gt; 80 then
		if CP &amp;lt; 5 then
			if SDCD &amp;gt;= 2  or Energy &amp;gt; 90 then 
			CastSpellByName(GetSpellInfo(53))
			return true
			end
		elseif CP == 5 and Anticipation == true then
			if not Anti or AntiCharges &amp;lt; 4 then
				if SDCD &amp;gt;= 2 then
				CastSpellByName(GetSpellInfo(53))
				return true
				end
			end
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Subtlety- Backstab -High-</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>BehindFunc()


local SD, SDCD, CP, CrimsonTempest, CrimsonTempesttimer, Anticipation, Rupture, Garrote, Rupturetimer, Garrotetimer = SD, SDCD, CP, CrimsonTempest, CrimsonTempesttimer, Anticipation, Rupture, Garrote, Rupturetimer, Garrotetimer
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )


if Nova_Hemo == 1 or Nova_AOE == 1 or SD or UnitBuffID(&amp;quot;Player&amp;quot;,115192) or Vanish then return false end

if behind == false then
	if CP &amp;lt; 4 then
	CastSpellByName(GetSpellInfo(16511))
	return true
	elseif CP &amp;gt;= 4 and Anticipation == true then
		if not Anti or AntiCharges &amp;lt; 4 then
			if SDCD &amp;gt; 7 then
			CastSpellByName(GetSpellInfo(16511))
			return true
			elseif SDCD &amp;lt; 1 and ((CrimsonTempest and CrimsonTempesttimer - GetTime() &amp;lt; 9) or (Garrote and Garrotetimer - GetTime() &amp;lt; 9) or (SnD and SnDtimer - GetTime() &amp;lt; 9) or (Rupture and Rupturetimer - GetTime() &amp;lt; 9)
			or (SBCD &amp;gt; 1 and SBCD &amp;lt;= 30) or cTime &amp;lt;= 9) then
			CastSpellByName(GetSpellInfo(16511))
			return true
			end
		end
	end
elseif behind == true then
if CP &amp;lt; 4 then
CastSpellByName(GetSpellInfo(53))
return true
elseif CP &amp;gt;= 4 and Anticipation == true then
	if not Anti or AntiCharges &amp;lt; 4 then
		if SDCD &amp;gt; 7 then
		CastSpellByName(GetSpellInfo(53))
		return true
		elseif SDCD &amp;lt; 1 and ((CrimsonTempest and CrimsonTempesttimer - GetTime() &amp;lt; 9) or (Garrote and Garrotetimer - GetTime() &amp;lt; 9) or (SnD and SnDtimer - GetTime() &amp;lt; 9) or (Rupture and Rupturetimer - GetTime() &amp;lt; 9)
		or (SBCD &amp;gt; 1 and SBCD &amp;lt;= 30) or cTime &amp;lt;= 9) then
		CastSpellByName(GetSpellInfo(53))
		return true
		end
	end
end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Subtlety- Crimson Tempest</Name><Default>false</Default><SpellID>121411</SpellID><Actions></Actions><Lua>local SD, Vanish, Rupture, Garrote, CrimsonTempest, Rupturetimer, Garrotetimer, CrimsonTempesttimer, CP, Anticipation = SD, Vanish, Rupture, Garrote, CrimsonTempest, Rupturetimer, Garrotetimer, CrimsonTempesttimer, CP, Anticipation

if Vanish then return false end

if Nova_Cleave == 1 then
	if CP == 5 then
		if CrimsonTempest then
			if CrimsonTempesttimer - GetTime() &amp;lt; 4 or (SD and CrimsonTempesttimer - GetTime() &amp;lt; 2) then
			return true
			end
		end
		if not CrimsonTempest and ((Rupture and Rupturetimer - GetTime() &amp;lt; 4) or (Garrote and Garrotetimer - GetTime() &amp;lt; 4)) then
		return true
		end
	end
	if not  UnitDebuffID(&amp;quot;target&amp;quot;, 703, &amp;quot;PLAYER&amp;quot;) and not UnitDebuffID(&amp;quot;target&amp;quot;, 1943, &amp;quot;PLAYER&amp;quot;) and not UnitDebuffID(&amp;quot;target&amp;quot;, 121411, &amp;quot;PLAYER&amp;quot;) then
	return true
	end
end


if Nova_AOE == 1 then
	if CP == 5 then
		if Anticipation == true then
			if SnD and SnDtimer - GetTime() &amp;lt; 6 then
				if Anti and AntiCharges &amp;gt;= 3 then
				return true
				end
			elseif SnD and SnDtimer - GetTime() &amp;gt;= 6 then
			return true
			end
		elseif SnD and SnDtimer - GetTime() &amp;gt; 5 then
		return true
		end
	elseif not  UnitDebuffID(&amp;quot;target&amp;quot;, 703, &amp;quot;PLAYER&amp;quot;) and not UnitDebuffID(&amp;quot;target&amp;quot;, 1943, &amp;quot;PLAYER&amp;quot;) and not UnitDebuffID(&amp;quot;target&amp;quot;, 121411, &amp;quot;PLAYER&amp;quot;) then
	return true
	end
end</Lua><RecastDelay>1000</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Subtlety- Eviscerate</Name><Default>false</Default><SpellID>2098</SpellID><Actions></Actions><Lua>if Nova_AOE == 1 then return false end

local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )
local FindWeakness, Energy, CP, Rupture, Rupturetimer, Garrote, Garrotetimer, CrimsonTempest, CrimsonTempesttimer, Anticipation = FindWeakness, Energy, CP, Rupture, Rupturetimer, Garrote, Garrotetimer, CrimsonTempest, CrimsonTempesttimer, Anticipation


if Anticipation == false then
	if CP &amp;gt; 4 then
		if (SnD and SnDtimer - GetTime() &amp;gt; 12) and (Energy &amp;gt;= 45 or HATCD &amp;lt; 0.5) then 
			if Rupture then
				if	Rupturetimer - GetTime() &amp;gt; 6 then
				return true
				end
			elseif Garrote then
				if Garrotetimer - GetTime() &amp;gt; 6 then
				return true
				end
			elseif CrimsonTempest then
				if CrimsonTempesttimer - GetTime() &amp;gt; 6 then
				return true
				end
			end
		elseif (SnD and SnDtimer - GetTime() &amp;gt; 6 and SnDtimer - GetTime() &amp;lt;= 12) and (Energy &amp;gt;= 45 or HATCD &amp;lt; 0.5) then
			if Rupture then
				if	Rupturetimer - GetTime() &amp;gt; 12 then
				return true
				end
			elseif Garrote then
				if Garrotetimer - GetTime() &amp;gt; 12 then
				return true
				end
			elseif CrimsonTempest then
				if CrimsonTempesttimer - GetTime() &amp;gt; 12 then
				return true
				end
			end
		end
	end
end

if Anticipation == true then
	if CP &amp;gt; 4 then
		if Anti and (AntiCharges &amp;gt; 4 and (HATCD &amp;lt; 1 or Energy &amp;gt; 90)) or (AntiCharges == 4 and ((Energy &amp;gt; 90 and HATCD &amp;lt; 0.25) or Energy &amp;gt; 94)) then
		return true		
		elseif FindWeakness then
			if Rupture then
				if (Rupturetimer - GetTime() &amp;lt; 4 and Anti and AntiCharges &amp;gt;= 3 and Energy &amp;gt;= 45)
				or Rupturetimer - GetTime() &amp;gt;= 7 then
				return true
				end
			elseif Garrote then
				if (Garrotetimer - GetTime() &amp;lt; 4 and Anti and AntiCharges &amp;gt;= 3 and Energy &amp;gt;= 45)
				or Garrotetimer - GetTime() &amp;gt;= 7 then
				return true
				end
			elseif CrimsonTempest then
				if (CrimsonTempesttimer - GetTime() &amp;lt; 4 and Anti and AntiCharges &amp;gt;= 3 and Energy &amp;gt;= 45)
				or CrimsonTempesttimer - GetTime() &amp;gt;= 7 then
				return true
				end 
			end
			if Energy &amp;gt; 90 then
			return true
			end
		end
	end
end</Lua><RecastDelay>1000</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Subtlety- Eviscerate -Subterfuge-</Name><Default>false</Default><SpellID>2098</SpellID><Actions></Actions><Lua>local CP, Vein = CP, Vein

if UnitBuffID(&amp;quot;Player&amp;quot;,115192) then
	if CP &amp;gt; 4 then
		if SnD and Vein then
		return true
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Subtlety- Fan of Knives</Name><Default>false</Default><SpellID>51723</SpellID><Actions></Actions><Lua>if Nova_AOE ~= 1 then return false end

local CP, Anticipation = CP, Anticipation
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )


if CP &amp;lt; 4 then
return true
elseif Anticipation == true then
	if not Anti or AntiCharges &amp;lt; 4 then
	return true
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Subtlety- Hemorrhage</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if Nova_AOE == 1 then return false end
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )
local SD, Energy, CP, Anticipation = SD, Energy, CP, Anticipation
if UnitBuffID(&amp;quot;Player&amp;quot;,115192) or Vanish then return false end

if SD then return false end
if Energy &amp;gt; 80 then
	if CP &amp;lt; 5 then
		-- Check if Hemorrhage is on target
		if not UnitDebuffID(&amp;quot;target&amp;quot;, 89775, &amp;quot;player&amp;quot;) then
			CastSpellByName(GetSpellInfo(16511), &amp;quot;target&amp;quot;)
		-- If Hemorrhage exists on target then refresh
		elseif UnitDebuffID(&amp;quot;target&amp;quot;, 89775, &amp;quot;player&amp;quot;) then
			if select(7, UnitDebuffID(&amp;quot;target&amp;quot;, 89775, &amp;quot;player&amp;quot;)) - GetTime() &amp;lt; 4 then
				CastSpellByName(GetSpellInfo(16511), &amp;quot;target&amp;quot;)
			end
		end
	
	
	
		if Nova_Hemo == 1 then
			CastSpellByName(GetSpellInfo(16511), &amp;quot;target&amp;quot;)
		end
	end
	
	if CP == 5 and Anticipation == true then
		if not Anti or AntiCharges &amp;lt; 5 then
			-- Check if Hemorrhage is on target
			if not UnitDebuffID(&amp;quot;target&amp;quot;, 89775, &amp;quot;player&amp;quot;) then
				CastSpellByName(GetSpellInfo(16511), &amp;quot;target&amp;quot;)
			-- If Hemorrhage exists on target then refresh
			elseif UnitDebuffID(&amp;quot;target&amp;quot;, 89775, &amp;quot;player&amp;quot;) then
				if select(7, UnitDebuffID(&amp;quot;target&amp;quot;, 89775, &amp;quot;player&amp;quot;)) - GetTime() &amp;lt; 4 then
					CastSpellByName(GetSpellInfo(16511), &amp;quot;target&amp;quot;)
				end
			end
			if Nova_Hemo == 1 then
			CastSpellByName(GetSpellInfo(16511), &amp;quot;target&amp;quot;)
			end
		end	
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Subtlety- Hemorrhage -High-</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if Nova_AOE == 1 then return false end
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )
local SD, Energy, CP, Anticipation = SD, Energy, CP, Anticipation
if UnitBuffID(&amp;quot;Player&amp;quot;,115192) or Vanish then return false end

if SD then return false end
if Energy &amp;gt;= 30 then
if CP &amp;lt; 4 then
	-- Check if Hemorrhage is on target
	if not UnitDebuffID(&amp;quot;target&amp;quot;, 89775, &amp;quot;player&amp;quot;) then
		CastSpellByName(GetSpellInfo(16511), &amp;quot;target&amp;quot;)
	-- If Hemorrhage exists on target then refresh
	elseif UnitDebuffID(&amp;quot;target&amp;quot;, 89775, &amp;quot;player&amp;quot;) then
		if select(7, UnitDebuffID(&amp;quot;target&amp;quot;, 89775, &amp;quot;player&amp;quot;)) - GetTime() &amp;lt; 4 then
			CastSpellByName(GetSpellInfo(16511), &amp;quot;target&amp;quot;)
		end
	end
	
	
	
	if Nova_Hemo == 1 then
		CastSpellByName(GetSpellInfo(16511), &amp;quot;target&amp;quot;)
	end
	
	
	
end

if CP &amp;gt;= 4 and Anticipation == true then
	if not Anti or AntiCharges &amp;lt; 4 then
	-- Check if Hemorrhage is on target
		if not UnitDebuffID(&amp;quot;target&amp;quot;, 89775, &amp;quot;player&amp;quot;) then
		CastSpellByName(GetSpellInfo(16511), &amp;quot;target&amp;quot;)
		-- If Hemorrhage exists on target then refresh
		elseif UnitDebuffID(&amp;quot;target&amp;quot;, 89775, &amp;quot;player&amp;quot;) then
			if select(7, UnitDebuffID(&amp;quot;target&amp;quot;, 89775, &amp;quot;player&amp;quot;)) - GetTime() &amp;lt; 4 then
			CastSpellByName(GetSpellInfo(16511), &amp;quot;target&amp;quot;)
			end
		end
		if Nova_Hemo == 1 then
		CastSpellByName(GetSpellInfo(16511), &amp;quot;target&amp;quot;)
		end
	end
end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Subtlety- SDance Pooling</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if Nova_Hemo == 1 then return false end

if not PQI_SoapboxSubtlety_ShadowDance_enable then return false end

if Nova_AOE == 1 or Nova_Cooldowns ~= 1 then return false end
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )


local SDCD, CP, SnD, SnDtimer, Garrote, Rupture, CrimsonTempest, Garrotetimer, Rupturetimer, CrimsonTempesttimer, SB, SBCD, Energy, Stealth, FindWeakness = SDCD, CP, SnD, SnDtimer, Garrote, Rupture, CrimsonTempest, Garrotetimer, Rupturetimer, CrimsonTempesttimer, SB, SBCD, Energy, Stealth, FindWeakness

if (Anticipation == true and (CP &amp;lt; 4 or (CP &amp;gt; 4 and Anti and AntiCharges &amp;gt; 2))) or (Anticipation == false and (CP &amp;lt; 2 or CP == 5)) then return false end

if not SnD or (SnD and SnDtimer - GetTime() &amp;lt; 10) then return false end



if Garrote then
	if Garrotetimer - GetTime() &amp;gt; 9 then
		if SDCD &amp;lt; 1 and not Stealth and not FindWeakness and Energy &amp;lt; 75 and (SBCD &amp;lt; 1 or SBCD &amp;gt; 15) then return true
		end
	end
elseif Rupture then
	if Rupturetimer - GetTime() &amp;gt; 9 then
		if SDCD &amp;lt; 1 and not Stealth and not FindWeakness and Energy &amp;lt; 75 and (SBCD &amp;lt; 1 or SBCD &amp;gt; 15) then return true
		end
	end
elseif CrimsonTempest then
	if CrimsonTempesttimer - GetTime() &amp;gt; 9 then
		if SDCD &amp;lt; 1 and not Stealth and not FindWeakness and Energy &amp;lt; 75 and (SBCD &amp;lt; 1 or SBCD &amp;gt; 15) then return true
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Subtlety- Vanish Pooling</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not PQI_SoapboxSubtlety_Vanish_enable then return false end
if Nova_Hemo == 1 and Focus == false then return false end
if Nova_AOE == 1 then return false end
if Nova_Cooldowns ~= 1 then return false end

local SD, SDCD, VanishCD, Focus, MasterOfSub, CP, SnD, SnDtimer, Garrote, Rupture, CrimsonTempest, Garrotetimer, Rupturetimer, CrimsonTempesttimer, SB, SBCD, Energy, Stealth, FindWeakness = SD, SDCD, VanishCD, Focus, MasterOfSub, CP, SnD, SnDtimer, Garrote, Rupture, CrimsonTempest, Garrotetimer, Rupturetimer, CrimsonTempesttimer, SB, SBCD, Energy, Stealth, FindWeakness

if not SnD or (SnD and SnDtimer - GetTime() &amp;lt; 5) then return false end

if Garrote then
	if Garrotetimer - GetTime() &amp;gt; 5 then
		if SDCD &amp;gt; 1 or (SDCD &amp;lt; 1 and SBCD &amp;gt; 3 and SBCD &amp;lt; 30) then
			if VanishCD &amp;lt; 1 and ((Focus == true and Energy &amp;lt; 30) or (Focus == false and Energy &amp;lt; 85)) and cTime &amp;gt; 10 and not SD and not MasterOfSub and not FindWeakness then
				if Anticipation == true	then
					if CP &amp;gt; 2 and (not Anti or AntiCharges &amp;lt; 4) then 
					return true
					end
				elseif CP &amp;lt; 3 then
				return true
				end
			end
		end
	end
elseif Rupture then
	if Rupturetimer - GetTime() &amp;gt; 5 then
		if SDCD &amp;gt; 1 or (SDCD &amp;lt; 1 and SBCD &amp;gt; 3 and SBCD &amp;lt; 30) then
			if VanishCD &amp;lt; 1 and ((Focus == true and Energy &amp;lt; 30) or (Focus == false and Energy &amp;lt; 85)) and cTime &amp;gt; 10 and not SD and not MasterOfSub and not FindWeakness then
				if Anticipation == true	then
					if CP &amp;gt; 2 and (not Anti or AntiCharges &amp;lt; 4) then 
					return true
					end
				elseif CP &amp;lt; 3 then
				return true
				end
			end
		end	
	end
elseif CrimsonTempest then
	if CrimsonTempesttimer - GetTime() &amp;gt; 3 then
		if SDCD &amp;gt; 1 or (SDCD &amp;lt; 1 and SBCD &amp;gt; 3 and SBCD &amp;lt; 30) then
			if VanishCD &amp;lt; 1 and ((Focus == true and Energy &amp;lt; 30) or (Focus == false and Energy &amp;lt; 85)) and cTime &amp;gt; 10 and not SD and not MasterOfSub and not FindWeakness then
				if Anticipation == true	then
					if CP &amp;gt; 2 and (not Anti or AntiCharges &amp;lt; 4) then 
					return true
					end
				elseif CP &amp;lt; 3 then
				return true
				end
			end
		end	
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Subtlety- Premeditation</Name><Default>false</Default><SpellID>14183</SpellID><Actions></Actions><Lua>local HATCD, Anticipation, CP, PremedCD = HATCD, Anticipation, CP, PremedCD
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )

if CP &amp;lt;= 3 then
	if HATCD &amp;gt; 1.75 or CP &amp;lt;= 2 then 
	return true
	end
elseif CP &amp;gt;= 4 and Anticipation == true then
	if not Anti or (AntiCharges &amp;lt;= 3 and HATCD &amp;gt; 1.75) or AntiCharges &amp;lt;= 2 then
	return true
	end	
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Subtlety- Premeditation -Subterfuge-</Name><Default>false</Default><SpellID>14183</SpellID><Actions></Actions><Lua>local Anticipation, CP, HATCD = Anticipation, CP, HATCD
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )

if UnitBuffID(&amp;quot;Player&amp;quot;,115192) then
	if CP &amp;lt;= 3 then
		if HATCD &amp;gt; 1.75 or CP &amp;lt;= 2 then 
		return true
		end
	elseif CP &amp;gt;= 4 and Anticipation == true then
		if not Anti or (AntiCharges &amp;lt;= 3 and HATCD &amp;gt; 1.75) or AntiCharges &amp;lt;= 2 then
		return true
		end	
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Subtlety- Rupture</Name><Default>false</Default><SpellID>1943</SpellID><Actions></Actions><Lua>if Nova_AOE == 1 or Nova_Cleave == 1 then return false end

local Vein, CrimsonTempest, CrimsonTempesttimer, Vanish, Rupture, Garrote, Rupturetimer, Garrotetimer, CP, Anticipation = Vein, CrimsonTempest, CrimsonTempesttimer, Vanish, Rupture, Garrote, Rupturetimer, Garrotetimer, CP, Anticipation

if Vanish then return false
end

if CP == 5 then
	if Rupture and not Garrote and not CrimsonTempest then
		if Rupturetimer - GetTime() &amp;lt; 4 or (SD and Rupturetimer - GetTime() &amp;lt; 2) then
			return true
		end
	elseif Garrote and not Rupture and not CrimsonTempest then
		if Garrotetimer - GetTime() &amp;lt; 4 or (SD and Garrotetimer - GetTime() &amp;lt; 2) then
			return true
		end
	elseif CrimsonTempest and not Rupture and not Garrote then
		if CrimsonTempesttimer - GetTime() &amp;lt; 4 or (SD and CrimsonTempesttimer - GetTime() &amp;lt; 2) then	
			return true
		end
	end
end

if not  UnitDebuffID(&amp;quot;target&amp;quot;, 703, &amp;quot;PLAYER&amp;quot;) and not UnitDebuffID(&amp;quot;target&amp;quot;, 1943, &amp;quot;PLAYER&amp;quot;) and not UnitDebuffID(&amp;quot;target&amp;quot;, 121411, &amp;quot;PLAYER&amp;quot;) then
return true
end</Lua><RecastDelay>4000</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Subtlety- Shadow Blades</Name><Default>false</Default><SpellID>121471</SpellID><Actions>/cast Blood Fury|/cast Berserking|/use 13|/use 14|/use 10|/script UIErrorsFrame:Clear()</Actions><Lua>if not PQI_SoapboxSubtlety_ShadowBlades_enable then return false end
if Nova_Cooldowns ~= 1 then return false end


local Rupture, Rupturetimer, Garrote, Garrotetimer, CrimsonTempest, CrimsonTempesttimer, SD = Rupture, Rupturetimer, Garrote, Garrotetimer, CrimsonTempest, CrimsonTempesttimer, SD

if (Rupture and Rupturetimer - GetTime() &amp;gt; 2) or (Garrote and Garrotetimer - GetTime() &amp;gt; 2) or (CrimsonTempest and CrimsonTempesttimer - GetTime() &amp;gt; 2) then  
	if Tier15 &amp;gt; 3 then
		if SD then
	    return true 
	    end
	elseif not SD then
	return true
	end
	if Nova_AOE == 1 then
	return true
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Subtlety- Shadow Dance</Name><Default>false</Default><SpellID>51713</SpellID><Actions>/cast Blood Fury|/cast Berserking</Actions><Lua>if Nova_AOE == 1 or Nova_Hemo == 1 or Nova_Cooldowns ~= 1 or not PQI_SoapboxSubtlety_ShadowDance_enable  then return false end


local Rupture, Rupturetimer, Garrote, Garrotetimer, CrimsonTempest, CrimsonTempesttimer, SB, SBCD, Energy, Stealth, FindWeakness = Rupture, Rupturetimer, Garrote, Garrotetimer, CrimsonTempest, CrimsonTempesttimer, SB, SBCD, Energy, Stealth, FindWeaknes

if (Anticipation == true and (CP &amp;lt; 4 or (CP &amp;gt; 4 and Anti and AntiCharges &amp;gt; 2))) or (Anticipation == false and (CP &amp;lt; 2 or CP == 5)) then return false end

if not SnD or (SnD and SnDtimer - GetTime() &amp;lt; 10) then return false end



if Garrote then
	if Garrotetimer - GetTime() &amp;gt; 9 then
		if cTime &amp;gt; 2 and Energy &amp;gt;= 75 and not Stealth and not FindWeakness then
			if Tier15 &amp;gt; 3 then
				if SBCD &amp;lt; 1 or SBCD &amp;gt; 15 or not PQI_SoapboxSubtlety_ShadowBlades_enable or Nova_Cooldowns ~= 1 then
				UseInventoryItem(10)
				return true
				end
			elseif not SB then
			UseInventoryItem(10)
			return true
			end
		end
	end
elseif Rupture then
	if Rupturetimer - GetTime() &amp;gt; 9 then
		if cTime &amp;gt; 2 and Energy &amp;gt;= 75 and not Stealth and not FindWeakness then
			if Tier15 &amp;gt; 3 then
				if SBCD &amp;lt; 1 or SBCD &amp;gt; 15 or not PQI_SoapboxSubtlety_ShadowBlades_enable or Nova_Cooldowns ~= 1 then
				UseInventoryItem(10)
				return true
				end
			elseif not SB then
			UseInventoryItem(10)
			return true
			end
		end
	end
elseif CrimsonTempest then
	if CrimsonTempesttimer - GetTime() &amp;gt; 9 then
		if cTime &amp;gt; 2 and Energy &amp;gt;= 75 and not Stealth and not FindWeakness then
			if Tier15 &amp;gt; 3 then
				if SBCD &amp;lt; 1 or SBCD &amp;gt; 15 or not PQI_SoapboxSubtlety_ShadowBlades_enable or Nova_Cooldowns ~= 1 then
				UseInventoryItem(10)
				return true
				end
			elseif not SB then
			UseInventoryItem(10)
			return true
			end
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Subtlety- Slice and Dice</Name><Default>false</Default><SpellID>5171</SpellID><Actions></Actions><Lua>local CP, SnD, SnDtimer = CP, SnD, SnDtimer

if CP == 5 then
	if (SnD and SnDtimer - GetTime() &amp;lt; 4) then
	return true
	end
end
if not SnD or (SnD and SnDtimer - GetTime() &amp;lt; 1 and CP &amp;gt;= 3) then
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Subtlety- SnD -Subterfuge-</Name><Default>false</Default><SpellID>5171</SpellID><Actions></Actions><Lua>local CP, SnD = CP, SnD

if UnitBuffID(&amp;quot;Player&amp;quot;,115192) then
	if CP &amp;gt; 4 then
		if not SnD then
		return true
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Subtlety- Vanish</Name><Default>false</Default><SpellID>1856</SpellID><Actions></Actions><Lua>if Nova_Hemo == 1 and Focus == false then return false end

if UnitBuffID(&amp;quot;Player&amp;quot;,115192) then return false end

if not PQI_SoapboxSubtlety_Vanish_enable then return false end
if Nova_Cooldowns ~= 1 then return false end
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )
local SBCD, SB, Rupture, Rupturetimer, Garrote, Garrotetimer, CrimsonTempest, CrimsonTempesttimer, Energy, CP, SD, MasterOfSub, FindWeakness = SBCD, SB, Rupture, Rupturetimer, Garrote, Garrotetimer, CrimsonTempest, CrimsonTempesttimer, Energy, CP, SD, MasterOfSub, FindWeakness

if not SnD or (SnD and SnDtimer - GetTime() &amp;lt; 5) then return false end

if Garrote then
	if Garrotetimer - GetTime() &amp;gt; 5 then
		if SDCD &amp;gt; 1 or (SDCD &amp;lt; 1 and SBCD &amp;gt; 3 and SBCD &amp;lt; 30) then
			if cTime &amp;gt; 10 and ((Focus == true and Energy &amp;gt; 29) or (Focus == false and Energy &amp;gt; 84)) and not SD and not MasterOfSub and not FindWeakness then
				if Anticipation == true then
					if CP &amp;gt; 2 then
						if not Anti or AntiCharges &amp;lt; 4 then
						return true
						end
					end
				elseif CP &amp;lt; 4 then
				return true
				end
			end
		end
	end
elseif Rupture then
	if Rupturetimer - GetTime() &amp;gt; 5 then
		if SDCD &amp;gt; 1 or (SDCD &amp;lt; 1 and SBCD &amp;gt; 3 and SBCD &amp;lt; 30) then
			if cTime &amp;gt; 10 and ((Focus == true and Energy &amp;gt; 29) or (Focus == false and Energy &amp;gt; 84)) and not SD and not MasterOfSub and not FindWeakness then
				if Anticipation == true then
					if CP &amp;gt; 2 then
						if not Anti or AntiCharges &amp;lt; 4 then
						return true
						end
					end
				elseif CP &amp;lt; 4 then
				return true
				end
			end
		end
	end
elseif CrimsonTempest then
	if CrimsonTempesttimer - GetTime() &amp;gt; 3 then
		if SDCD &amp;gt; 1 or (SDCD &amp;lt; 1 and SBCD &amp;gt; 3 and SBCD &amp;lt; 30) then
			if cTime &amp;gt; 10 and ((Focus == true and Energy &amp;gt; 29) or (Focus == false and Energy &amp;gt; 84)) and not SD and not MasterOfSub and not FindWeakness then
				if Anticipation == true then
					if CP &amp;gt; 2 then
						if not Anti or AntiCharges &amp;lt; 4 then
						return true
						end
					end
				elseif CP &amp;lt; 4 then
				return true
				end
			end
		end
	end
end</Lua><RecastDelay>10000</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Ambush -Vanish-</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local Vanish = Vanish
BehindFunc()

if UnitBuffID(&amp;quot;Player&amp;quot;,115192) then return false end

if Vanish then
	if Combat == true then
		if behind == false or NOT2D == true then
		CastSpellByName(GetSpellInfo(1752))
		elseif behind == true then
		CastSpellByName(GetSpellInfo(8676))
		end
	elseif Assassination == true then
		CastSpellByName(GetSpellInfo(1329),nil) 
	elseif Subtlety == true then
		if behind == false or NOT2D == true then
		CastSpellByName(GetSpellInfo(16511))
		elseif behind == true then
		CastSpellByName(GetSpellInfo(8676))
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Combat- Revealing Strike</Name><Default>false</Default><SpellID>84617</SpellID><Actions></Actions><Lua>if Nova_AOE == 1 then return false end

local CP, Reveal, Revealtimer = CP, Reveal, Revealtimer
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )


if CP &amp;lt; 5 then
	if not Reveal then
	return true
	end
elseif Anticipation == true then
	if not Anti or AntiCharges &amp;lt; 5 then
		if not Reveal then
		return true
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Combat- Sinister Strike</Name><Default>false</Default><SpellID>1752</SpellID><Actions></Actions><Lua>if Nova_AOE == 1 then return false end

local Reveal, Anticipation, SB, CP = Reveal, Anticipation, SB, CP
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )

if Energy &amp;gt; 60 or (DeepInsight and DeepInsighttimer - GetTime() &amp;gt; 5) or not DeepInsight then

if Energy &amp;lt; 90 then 
	if Reveal then
		if Revealtimer - GetTime() &amp;lt; 2 then
		return false
		end
	else
	return false
	end
end

if Anticipation == true then
	if SB then
		if CP &amp;lt; 5 or (not Anti or AntiCharges &amp;lt; 3) then
		return true
		end
	elseif CP &amp;lt; 5 or (not Anti or AntiCharges &amp;lt; 4) then
	return true
	end
elseif CP &amp;lt; 5 then
return true
end

end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Combat- Slice and Dice</Name><Default>false</Default><SpellID>5171</SpellID><Actions></Actions><Lua>--slice_and_dice,if=buff.slice_and_dice.remains&amp;lt;2|(buff.slice_and_dice.remains&amp;lt;15&amp;buff.bandits_guile.stack=11&amp;combo_points&amp;gt;=4)

local CP, SnD, SnDtimer = CP, SnD, SnDtimer

if not SnD and CP &amp;gt; 1 and not ShadowBlades and not AdrenalineRush then
return true
end

if CP &amp;gt; 4 then
	if SnD then
		if SnDtimer - GetTime() &amp;lt; 2
		or UnitBuffID(&amp;quot;player&amp;quot;, 84746) and Guile &amp;gt; 2 then
		return true
		end
	else
	return true
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Combat- Eviscerate</Name><Default>false</Default><SpellID>2098</SpellID><Actions></Actions><Lua>if Nova_AOE == 1 then return false end


local Energy, CP, Rupture, Rupturetimer, Anticipation = Energy, CP, Rupture, Rupturetimer, Anticipation
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )

if Anticipation == true then
	if not Reveal or (Reveal and Revealtimer - GetTime() &amp;lt; 2) then
		if CP &amp;lt; 5 or (CP &amp;gt; 4 and (not Anti or AntiCharges &amp;lt; 5)) then
		return false
		end
	end
end


if Anticipation == true then
	if CP &amp;gt; 4 then
		if DeepInsight or (SBCD &amp;gt; 0 and SBCD &amp;lt; 12) or (Anti and (AntiCharges &amp;gt; 3 or (SB and AntiCharges &amp;gt; 2))) then
			if Bloodlust or AdrenalineRush then
				if Tier15 &amp;gt; 1 then
					if Nova_Cleave ~= 1 and Nova_Cleave4To6 ~= 1 then
						if Rupture then
							if Rupturetimer - GetTime() &amp;gt; 5 then
							return true
							elseif Rupturetimer - GetTime() &amp;lt; 6 and Anti and AntiCharges &amp;gt; 2 then
							end
						end
					else
					return true
					end
				else
				return true
				end
			elseif Nova_Cleave ~= 1 and Nova_Cleave4To6 ~= 1 then
				if Rupture then
					if Rupturetimer - GetTime() &amp;gt; 5 then
					return true
					elseif Rupturetimer - GetTime() &amp;lt; 6 and Anti and AntiCharges &amp;gt; 2 then
					end
				end
			else
			return true
			end
		end
	end
elseif Anticipation == false then
	if CP &amp;gt; 4 then
		if ((SnD and SnDtimer - GetTime() &amp;gt; 12) and (Energy &amp;gt; 44)) or DeepInsight then 
			if Nova_Cleave ~= 1 and Nova_Cleave4To6 ~= 1 then
				if Rupture then
					if	Rupturetimer - GetTime() &amp;gt; 6 or Energy &amp;gt; 95 or (Tier15 &amp;lt; 2 and (Bloodlust or AdrenalineRush)) then
					return true
					end
				elseif Tier15 &amp;lt; 2 then
				return true
				end
			else
			return true
			end
		elseif (SnD and SnDtimer - GetTime() &amp;gt; 4 and SnDtimer - GetTime() &amp;lt; 13) and (Energy &amp;gt; 44) then
			if Nova_Cleave ~= 1 and Nova_Cleave4To6 ~= 1 then
				if Rupture then
					if	Rupturetimer - GetTime() &amp;gt; 12 or Energy &amp;gt; 90  or (Tier15 &amp;lt; 2 and (Bloodlust or AdrenalineRush)) then
					return true
					end
				elseif Tier15 &amp;lt; 2 then
				return true
				end
			else 
			return true
			end
		end
	end
end</Lua><RecastDelay>1000</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Combat- Rupture</Name><Default>false</Default><SpellID>1943</SpellID><Actions></Actions><Lua>if Nova_AOE ==1 or Nova_Cleave == 1 or Nova_Cleave4To6 == 1 then return false end


local FindWeakness, Energy, CP, Rupture, Rupturetimer, Garrote, Garrotetimer, CrimsonTempest, CrimsonTempesttimer, Anticipation = FindWeakness, Energy, CP, Rupture, Rupturetimer, Garrote, Garrotetimer, CrimsonTempest, CrimsonTempesttimer, Anticipation
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )

if (Bloodlust or AdrenalineRush) and Tier15 &amp;lt; 2 then return false end

if CP &amp;gt; 4 then
	if Anticipation == true then
		if DeepInsight or (Anti and (AntiCharges &amp;gt; 3 or (SB and AntiCharges &amp;gt; 2))) or (SBCD &amp;gt; 0 and SBCD &amp;lt; 12) then
			if Rupture then
				if Rupturetimer - GetTime() &amp;lt; 4 then
				return true
				end
			else
			return true
			end	
		end
	elseif Rupture then
		if Rupturetimer - GetTime() &amp;lt; 4 then
		return true
		end
	elseif not Rupture then
	return true
	end
end</Lua><RecastDelay>1000</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Combat- Adrenaline Rush</Name><Default>false</Default><SpellID>13750</SpellID><Actions></Actions><Lua>local KSCD, Energy, SB = KSCD, Energy, SB

if Nova_Cooldowns ~= 1 or not PQI_SoapboxCombat_AdrenalineRush_enable or Bloodlust then return false end

if (((not PQI_SoapboxCombat_KillingSpree_enable or (PQI_SoapboxCombat_KillingSpree_enable and KSCD &amp;gt; 10)) and Nova_AOE ~= 1) or Nova_AOE == 1) and (Energy &amp;lt; 35 or SB) then
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Combat- Killing Spree</Name><Default>false</Default><SpellID>51690</SpellID><Actions></Actions><Lua>if Nova_AOE == 1 or Nova_Cooldowns ~= 1 or not PQI_SoapboxCombat_KillingSpree_enable then return false end

local DeepInsight, SBCD, ARCD, ShallowInsight, Insight, Energy, AdrenalineRush = DeepInsight, SBCD, ARCD, ShallowInsight, Insight, Energy, AdrenalineRush

if cTime &amp;lt; 30 or DeepInsight or (SBCD &amp;lt; 1 and ARCD &amp;lt; 1 and (ShallowInsight or not Insight)) then
	if Energy &amp;lt; 45 and not AdrenalineRush then
	return true
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Combat- Shadow Blades</Name><Default>false</Default><SpellID>121471</SpellID><Actions>/cast Blood Fury|/cast Berserking|/use 13|/use 14|/use 10|/script UIErrorsFrame:Clear()</Actions><Lua>local AdrenalineRush = AdrenalineRush

if Nova_Cooldowns ~= 1 then return false end

if PQI_SoapboxCombat_AdrenalineRush_enable then
	if AdrenalineRush then
	return true
	end
else
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Combat- Vanish</Name><Default>false</Default><SpellID>1856</SpellID><Actions></Actions><Lua>local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )

if not PQI_SoapboxCombat_Vanish_enable then return false end

local CP, Anticipation, SB, Focus, AdrenalineRush, Energy, Subterfuge = CP, Anticipation, SB, Focus, AdrenalineRush, Energy, Subterfuge
if Nova_AOE == 1 or Nova_Cooldowns ~= 1 then return false end

if UnitBuffID(&amp;quot;Player&amp;quot;,115192) or ARCD &amp;lt; 1 then return false end

if cTime &amp;gt; 10 then 
if (CP &amp;lt; 3 or (CP &amp;gt; 2 and Anticipation == true and (not Anti or AntiCharges &amp;lt; 3))
or (not SB and (CP &amp;lt; 4 or (Anticipation == true and (not Anti or AntiCharges &amp;lt; 4)))))

 and ((Focus == true and not AdrenalineRush and Energy &amp;lt; 20) 
 or (Subterfuge == true and Energy &amp;gt;= 90) 
 or (Focus == false and Subterfuge == false and Energy &amp;gt;= 60)) then
 return true
 end
 end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Combat- Vanish Pooling</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not PQI_SoapboxCombat_Vanish_enable then return false end

local SB, AdrenalineRush, VanishCD, Anticipation, CP, Energy, Focus, Subterfuge = SB, AdrenalineRush, VanishCD, Anticipation, CP, Energy, Focus, Subterfuge
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )
if SB or AdrenalineRush or Nova_AOE == 1 or ARCD &amp;lt; 1 or Nova_Cooldowns ~= 1 then return false end

if cTime &amp;gt; 10 and VanishCD &amp;lt; 1 then 
	if (CP &amp;lt; 3 or (CP &amp;gt; 2 and Anticipation == true and (not Anti or AntiCharges &amp;lt; 3))
	or (not SB and (CP &amp;lt; 4 or (Anticipation == true and (not Anti or AntiCharges &amp;lt; 4)))))
	 and ((Focus == true and not AdrenalineRush and Energy &amp;lt; 20) 
	 or (Subterfuge == true and Energy &amp;lt; 90) 
	 or (Focus == false and Subterfuge == false and Energy &amp;lt; 60)) then
 return true
 end
 end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Combat- Ambush -Subterfuge-</Name><Default>false</Default><SpellID>8676</SpellID><Actions></Actions><Lua>if Ambush then
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Combat- SnD -Subterfuge-</Name><Default>false</Default><SpellID>5171</SpellID><Actions></Actions><Lua>local CP, SnD = CP, SnD
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )

if UnitBuffID(&amp;quot;Player&amp;quot;,115192) then
	if not SnD then
		if not Anti then
		return true
		end
	end
end</Lua><RecastDelay>2000</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Combat- Eviscerate -Subterfuge-</Name><Default>false</Default><SpellID>2098</SpellID><Actions></Actions><Lua>if Nova_AOE == 1 then return false end


local Energy, CP, Rupture, Rupturetimer, Anticipation = Energy, CP, Rupture, Rupturetimer, Anticipation
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )

if not UnitBuffID(&amp;quot;Player&amp;quot;,115192) then return false end

if Anticipation == true then
	if CP &amp;gt; 4 then
		if DeepInsight or (SBCD &amp;gt; 0 and SBCD &amp;lt; 12) or (Anti and (AntiCharges &amp;gt; 3 or (SB and AntiCharges &amp;gt; 2))) then
			if Bloodlust or AdrenalineRush then
				if Tier15 &amp;gt; 1 then
					if Nova_Cleave ~= 1 and Nova_Cleave4To6 ~= 1 then
						if Rupture then
							if Rupturetimer - GetTime() &amp;gt; 5 then
							return true
							elseif Rupturetimer - GetTime() &amp;lt; 6 and Anti and AntiCharges &amp;gt; 2 then
							end
						end
					else
					return true
					end
				else
				return true
				end
			elseif Nova_Cleave ~= 1 and Nova_Cleave4To6 ~= 1 then
				if Rupture then
					if Rupturetimer - GetTime() &amp;gt; 5 then
					return true
					elseif Rupturetimer - GetTime() &amp;lt; 6 and Anti and AntiCharges &amp;gt; 2 then
					end
				end
			else
			return true
			end
		end
	end
elseif Anticipation == false then
	if CP &amp;gt; 4 then
		if ((SnD and SnDtimer - GetTime() &amp;gt; 12) and (Energy &amp;gt; 44)) or DeepInsight then 
			if Nova_Cleave ~= 1 and Nova_Cleave4To6 ~= 1 then
				if Rupture then
					if	Rupturetimer - GetTime() &amp;gt; 6 or Energy &amp;gt; 95 or (Tier15 &amp;lt; 2 and (Bloodlust or AdrenalineRush)) then
					return true
					end
				elseif Tier15 &amp;lt; 2 then
				return true
				end
			else
			return true
			end
		elseif (SnD and SnDtimer - GetTime() &amp;gt; 4 and SnDtimer - GetTime() &amp;lt; 13) and (Energy &amp;gt; 44) then
			if Nova_Cleave ~= 1 and Nova_Cleave4To6 ~= 1 then
				if Rupture then
					if	Rupturetimer - GetTime() &amp;gt; 12 or Energy &amp;gt; 90  or (Tier15 &amp;lt; 2 and (Bloodlust or AdrenalineRush)) then
					return true
					end
				elseif Tier15 &amp;lt; 2 then
				return true
				end
			else 
			return true
			end
		end
	end
end</Lua><RecastDelay>1000</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Combat- Rupture -Subterfuge-</Name><Default>false</Default><SpellID>1943</SpellID><Actions></Actions><Lua>if Nova_AOE ==1 or Nova_Cleave == 1 or Nova_Cleave4To6 == 1 then return false end


local FindWeakness, Energy, CP, Rupture, Rupturetimer, Garrote, Garrotetimer, CrimsonTempest, CrimsonTempesttimer, Anticipation = FindWeakness, Energy, CP, Rupture, Rupturetimer, Garrote, Garrotetimer, CrimsonTempest, CrimsonTempesttimer, Anticipation
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )

if (Bloodlust or AdrenalineRush) and Tier15 &amp;lt; 2 then return false end

if not UnitBuffID(&amp;quot;Player&amp;quot;,115192) then return false end

if CP &amp;gt; 4 then
	if Anticipation == true then
		if DeepInsight or (SBCD &amp;gt; 0 and SBCD &amp;lt;= 11) or (Anti and (AntiCharges &amp;gt;= 4 or (SB and AntiCharges &amp;gt;= 3))) then
			if Rupture then
				if Rupturetimer - GetTime() &amp;lt; 4 then
				return true
				end
			else
			return true
			end	
		end
	elseif Rupture then
		if Rupturetimer - GetTime() &amp;lt; 4 then
		return true
		end
	elseif not Rupture then
	return true
	end
end</Lua><RecastDelay>1000</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Combat- Cancel Blade Flurry</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local BladeFlurry = BladeFlurry

if BladeFlurry then
	if Nova_Cleave ~= 1 and Nova_Cleave4To6 ~= 1 then
	CastSpellByName( GetSpellInfo(13877), nil )
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Combat- FoK*5-8*</Name><Default>false</Default><SpellID>51723</SpellID><Actions></Actions><Lua>local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )

if Nova_Cleave4To6 ~= 1 then return false end


local CP = CP

	if CP &amp;lt; 5 then
	return true
	elseif not Anti or AntiCharges &amp;lt; 5 then
	return true
	end</Lua><RecastDelay>12000</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Combat- Crimson Tempest</Name><Default>false</Default><SpellID>121411</SpellID><Actions></Actions><Lua>if Nova_AOE ~= 1 then return false end

local CP, Anticipation, SnD, SnDtimer, AdrenalineRush, Energy = CP, Anticipation, SnD, SnDtimer, AdrenalineRush, Energy
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )

	if CP &amp;gt; 4 then
		if Anticipation == true then
			if SnD and SnDtimer - GetTime() &amp;lt; 6 then
				if Anti and AntiCharges &amp;gt;= 3 then
				return true
				end
			elseif SnD and SnDtimer - GetTime() &amp;gt;= 6 then
			return true
			end
		elseif SnD and SnDtimer - GetTime() &amp;gt; 5 or AdrenalineRush or Energy &amp;gt; 90 then
		return true
		end
	end</Lua><RecastDelay>1000</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Combat- FoK AoE</Name><Default>false</Default><SpellID>51723</SpellID><Actions></Actions><Lua>local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )

if Nova_AOE ~= 1 then return false end


local CP = CP

	if CP &amp;lt; 5 then
	return true
	elseif Anticipation == true then
		if not Anti or AntiCharges &amp;lt; 5 then
		return true
		end
	end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-All Spec- Recuperate</Name><Default>false</Default><SpellID>73651</SpellID><Actions></Actions><Lua>local Playerhealth = 100 * UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;)
local Recuperate = Recuperate
	


if Subtlety == true then
	if not PQI_SoapboxSubtlety_Recuperate_enable then return false end

	local value = tonumber(PQI_SoapboxSubtlety_Recuperate_value)


	if  Playerhealth &amp;lt;= value
	and not Recuperate then
	return true
	end
elseif Assassination == true then
	if not PQI_SoapboxAssassination_Recuperate_enable then return false end

	local value = tonumber(PQI_SoapboxAssassination_Recuperate_value)


	if  Playerhealth &amp;lt;= value
	and not Recuperate then
	return true
	end
elseif Combat == true then
	if not PQI_SoapboxCombat_Recuperate_enable then return false end

	local value = tonumber(PQI_SoapboxCombat_Recuperate_value)


	if  Playerhealth &amp;lt;= value
	and not Recuperate then
	return true
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-All Spec- Preparation</Name><Default>false</Default><SpellID>14185</SpellID><Actions></Actions><Lua>local Vanish, VanishCD = Vanish, VanishCD

if Nova_Cooldowns == 1 then
if (UnitLevel(&amp;quot;target&amp;quot;) == -1 or UnitIsUnit(&amp;quot;target&amp;quot;, &amp;quot;boss1&amp;quot;)) then
if not Vanish and VanishCD &amp;gt; 60 then
	if Subtlety == true then	
		if PQI_SoapboxSubtlety_Preparation_enable then
		return true
		end
	elseif Assassination == true then	
		if PQI_SoapboxAssassination_Preparation_enable then
		return true
		end
	elseif  Combat == true then	
		if PQI_SoapboxCombat_Preparation_enable then
		return true
		end
	end
end
end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-All Spec- Healthstone</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local HealthstoneCD = select(2,GetItemCooldown(5512))
local Playerhealth = 100 * UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;)


if Subtlety == true then
	if PQI_SoapboxSubtlety_Healthstone_enable then 

local value = tonumber(PQI_SoapboxSubtlety_Healthstone_value)

		if  Playerhealth &amp;lt;= value
		and HealthstoneCD &amp;lt; 1
		then
		UseItemByName(5512, &amp;quot;player&amp;quot;)
		end	
	end
elseif Combat == true then
	if PQI_SoapboxCombat_Healthstone_enable then 

local value = tonumber(PQI_SoapboxCombat_Healthstone_value)

		if  Playerhealth &amp;lt;= value
		and HealthstoneCD &amp;lt; 1
		then
		UseItemByName(5512, &amp;quot;player&amp;quot;)
		end	
	end
elseif Assassination == true then
	if PQI_SoapboxAssassination_Healthstone_enable then 

local value = tonumber(PQI_SoapboxAssassination_Healthstone_value)

		if  Playerhealth &amp;lt;= value
		and HealthstoneCD &amp;lt; 1
		then
		UseItemByName(5512, &amp;quot;player&amp;quot;)
		end	
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-All Spec- Feint</Name><Default>false</Default><SpellID>1966</SpellID><Actions></Actions><Lua>local Feint, FeintSwap = Feint, FeintSwap

if Subtlety == true then
	if PQI_SoapboxSubtlety_FeintSpam_enable then 
		if not Feint then
		return true
		end
	end
elseif Assassination == true then
	if PQI_SoapboxAssassination_FeintSpam_enable then 
		if not Feint then
		return true
		end
	end
elseif Combat == true then
	if PQI_SoapboxCombat_FeintSpam_enable then 
		if not Feint then
		return true
		end
	end
end


if Nova_Feint == 1 then 
	if not Feint then
	return true
	end
end</Lua><RecastDelay>5000</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>---1.Functions---</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>--Melee Range---
function MeleeRange()
	if IsSpellInRange(GetSpellInfo(1943), &amp;quot;target&amp;quot;) == 1 then 
	return true 
	else 
	return false
	end
end

if Guile == nil then
Guile = 0
end

if IsInRaid() then group = &amp;quot;raid&amp;quot;
elseif IsInGroup() then group = &amp;quot;party&amp;quot;
else group = nil
end

---Credits to Bu_ba for the line of code!---
if not IsLineOfSight then
 LoSTable = { }
 function IsLineOfSight(targetCheck, time)
  local time=time or 5
  targetGUID = UnitGUID(targetCheck) or 0 

   for i=1, #LoSTable do
    if time &amp;lt; (GetTime() - LoSTable[i].time) then
     table.remove(LoSTable, i)
     break
    end
  end

   function LoSCheck(self, event, ...)
    local targetGUID = targetGUID
    local Log = {...}
    local AlreadyTabled = false
    if Log[2] and Log[2] == &amp;quot;SPELL_CAST_FAILED&amp;quot; and targetGUID then
     if Log[4] and Log[4]==UnitGUID(&amp;quot;player&amp;quot;) then
      if Log[15] and Log[15]==SPELL_FAILED_LINE_OF_SIGHT then
       for j=1, #LoSTable do
        if targetGUID == LoSTable[j].unit then
         AlreadyTabled = true
         break
        end
       end
       if not AlreadyTabled then
        table.insert(LoSTable, { unit=targetGUID, time=GetTime() } )
        targetGUID = nil
        _G.NovaLineOfSight:UnregisterAllEvents()
       end
      end
     end
    end
    
   end

  if not NovaLineOfSight then
    frameLOS = CreateFrame(&amp;quot;frame&amp;quot;, &amp;quot;NovaLineOfSight&amp;quot;)
    frameLOS:SetScript(&amp;quot;OnEvent&amp;quot;, LoSCheck)
  end
  
   for k=1, #LoSTable do
     if targetGUID and targetGUID == LoSTable[k].unit then
     return false
    end
  end
  
  
  _G.NovaLineOfSight:RegisterEvent(&amp;quot;COMBAT_LOG_EVENT_UNFILTERED&amp;quot;)
  return true

 end
end


if sTimer == nil then
  sTimer = 0
 end
 if cTime == nil then
  cTime = 0
 end
 if UnitAffectingCombat(&amp;quot;player&amp;quot;) and sTimer == 0 then
   sTimer = GetTime()
 end
 if sTimer &amp;gt; 0 then
   cTime = (GetTime() - sTimer)
 end
 if not UnitAffectingCombat(&amp;quot;player&amp;quot;) and not UnitExists(&amp;quot;target&amp;quot;) then
  sTimer = 0
  cTime = 0
 end
 
 --Dummy 5min DPS Test
if UnitExists(&amp;quot;target&amp;quot;) then
if cTime &amp;gt;= 600 and dummy() then  
	StopAttack()
	ClearTarget()
	print(&amp;quot;5 Minute Dummy Test Concluded - Profile Stopped&amp;quot;)
	RunMacroText(&amp;quot;/run Screenshot()&amp;quot;)
	PQR_StopRotation()
end
end
function dummy()
	dummies = {
		31146, --Raider&amp;apos;s Training Dummy - Lvl ??
		67127, --Training Dummy - Lvl 90
		46647, --Training Dummy - Lvl 85
		32546, --Ebon Knight&amp;apos;s Training Dummy - Lvl 80
		31144, --Training Dummy - Lvl 80
		32667, --Training Dummy - Lvl 70
		32542, --Disciple&amp;apos;s Training Dummy - Lvl 65
		32666, --Training Dummy - Lvl 60
		32545, --Initiate&amp;apos;s Training Dummy - Lvl 55 
		32541, --Initiate&amp;apos;s Training Dummy - Lvl 55 (Scarlet Enclave) 
		54344
	}
	for i=1, #dummies do
		if UnitExists(&amp;quot;target&amp;quot;) then
			dummyID = tonumber(UnitGUID(&amp;quot;target&amp;quot;):sub(-13, -9), 16)
		else
			dummyID = 0
		end
		if dummyID == dummies[i] then
			return true
		end	
	end
end

T2D = nil
function T2D(unit)
	-- If no target is given, return false.
	if unit == nil then return false end
	
	if UnitExists(unit) then
		-- Target present; Set initial values.
		if (guid ~= UnitGUID(unit)) or (guid == UnitGUID(unit) and UnitHealth(unit) == _firstLifeMax) then
			guid = UnitGUID(unit)
			_firstLife = UnitHealth(unit)
			_firstLifeMax = UnitHealthMax(unit)
			_firstTime = GetTime()
		end
		
		-- Fetch current values.
		_currentLife = UnitHealth(unit)
		_currentTime = GetTime()
		timeDiff = _currentTime - _firstTime
		hpDiff = _firstLife - _currentLife
		
		-- Calculate time to die.
		if hpDiff &amp;gt; 0 then
			fullTime = timeDiff*_firstLifeMax/hpDiff
			pastFirstTime = (_firstLifeMax - _firstLife)*timeDiff/hpDiff
			calcTime = _firstTime - pastFirstTime + fullTime - _currentTime
			if calcTime &amp;lt; 1 then calcTime = 1 end
			timeToDie = calcTime
		end
		
		-- New target; reset settings.
		if hpDiff &amp;lt;= 0 then
			guid = UnitGUID(unit)
			_firstLife = UnitHealth(unit)
			_firstLifeMax = UnitHealth(unit)
			_firstTime = GetTime()
		end
	            
		-- Training Dummy&amp;apos;s are bad
		if UnitHealthMax(unit) == 1 then timeToDie = 99 end
		
		-- Initialize
		if not timeToDie then timeToDie = 100 end
		
		return timeToDie
	end
end


---No Time to Die---
if UnitExists(&amp;quot;target&amp;quot;) then 
local targetGUID = tonumber((UnitGUID(&amp;quot;target&amp;quot;)):sub(-12, -9), 16)

NOT2D = false

Target = { 70235, 70247, 70212, 63053 }

for i=1, #Target do
   if targetGUID == Target[i] then NOT2D = true
   end
end
end

---Blacklist Big Opener Targets---
if UnitExists(&amp;quot;target&amp;quot;) then 
local targetGUID = tonumber((UnitGUID(&amp;quot;target&amp;quot;)):sub(-12, -9), 16)

BUFFBOSS = false

buffed = { 69465 }

for i=1, #buffed do
   if targetGUID == buffed[i] then BUFFBOSS = true
   end
end
end

---Tier 16 2pc/4pc Check---
T16Helmet = false

T16helmetID = { 99008, 99631, 99114, 99348 }

for i=1, 2, 1  do
	 for y=1, #T16helmetID do
   if GetInventoryItemID(&amp;apos;player&amp;apos;, i) == T16helmetID[y] then 
     T16Helmet = true
   end
  end
end

T16Shoulder = false

T16shoulderID = { 99010, 99635, 99116, 99350 }

for i=1, 3, 1  do
	 for y=1, #T16shoulderID do
   if GetInventoryItemID(&amp;apos;player&amp;apos;, i) == T16shoulderID[y] then 
     T16Shoulder = true
   end
  end
end

T16Chest = false

T16chestID = { 99006, 99629, 99112, 99356 }

for i=4, 5, 1  do
	 for y=1, #T16chestID do
   if GetInventoryItemID(&amp;apos;player&amp;apos;, i) == T16chestID[y] then 
     T16Chest = true
   end
  end
end

T16Glove = false

T16gloveID = { 99007, 99630, 99113, 99355 }

for i=10, 11, 1  do
	 for y=1, #T16gloveID do
   if GetInventoryItemID(&amp;apos;player&amp;apos;, i) == T16gloveID[y] then 
     T16Glove = true
   end
  end
end

T16Leg = false

T16legID = { 99009, 99634, 99115, 99349 }

for i=7, 8, 1  do
	 for y=1, #T16legID do
   if GetInventoryItemID(&amp;apos;player&amp;apos;, i) == T16legID[y] then 
     T16Leg = true
   end
  end
end

Tier16 = 0

tier16ID = { T16Helmet, T16Shoulder, T16Chest, T16Glove, T16Leg }
for y=1, #tier16ID do
	if tier16ID[y] == true then Tier16 = Tier16 + 1
	end
end

---Tier 15 2pc/4pc Check---
T15Helmet = false

T15helmetID = { 95307, 96681, 95937 }

for i=1, 2, 1  do
	 for y=1, #T15helmetID do
   if GetInventoryItemID(&amp;apos;player&amp;apos;, i) == T15helmetID[y] then 
     T15Helmet = true
   end
  end
end

T15Shoulder = false

T15shoulderID = { 95309, 96683, 95939 }

for i=1, 3, 1  do
	 for y=1, #T15shoulderID do
   if GetInventoryItemID(&amp;apos;player&amp;apos;, i) == T15shoulderID[y] then 
     T15Shoulder = true
   end
  end
end

T15Chest = false

T15chestID = { 95305, 96679, 95935 }

for i=4, 5, 1  do
	 for y=1, #T15chestID do
   if GetInventoryItemID(&amp;apos;player&amp;apos;, i) == T15chestID[y] then 
     T15Chest = true
   end
  end
end

T15Glove = false

T15gloveID = { 95306, 96680, 95936 }

for i=10, 11, 1  do
	 for y=1, #T15gloveID do
   if GetInventoryItemID(&amp;apos;player&amp;apos;, i) == T15gloveID[y] then 
     T15Glove = true
   end
  end
end

T15Leg = false

T15legID = { 95308, 96682, 95938, }

for i=7, 8, 1  do
	 for y=1, #T15legID do
   if GetInventoryItemID(&amp;apos;player&amp;apos;, i) == T15legID[y] then 
     T15Leg = true
   end
  end
end

Tier15 = 0

tier15ID = { T15Helmet, T15Shoulder, T15Chest, T15Glove, T15Leg }
for y=1, #tier15ID do
	if tier15ID[y] == true then Tier15 = Tier15 + 1
	end
end



--Melee Range---
function MeleeRange()
	if IsSpellInRange(GetSpellInfo(35395), &amp;quot;target&amp;quot;) == 1 then 
	return true 
	else 
	return false
	end
end


---Disarm Target List---
if UnitExists(&amp;quot;target&amp;quot;) then 
local targetGUID = tonumber((UnitGUID(&amp;quot;target&amp;quot;)):sub(-12, -9), 16)

Grapple = false

Disarm = { 61947, 61240, 61398, 59240, 62405, 62408, 62402, 60396, 64453, 63591, 63589 }

for i=1, #Disarm do
   if targetGUID == Disarm[i] then Grapple = true
   end
end
end


-- Target Validation Function
TargetValidation = nil
function TargetValidation(unit, spell)
	if UnitExists(unit)
		and IsPlayerSpell(spell)
		and UnitCanAttack(&amp;quot;player&amp;quot;, unit) == 1
		and not UnitIsDeadOrGhost(unit)
		and not PQR_IsOutOfSight(unit, 1) then
			if IsSpellKnown(spell) then
				if PQR_SpellAvailable(spell) then
					if IsSpellInRange(GetSpellInfo(spell), unit) == 1 then return true else return false end
				else
					if spell == 8092 or spell == 32379 then
						local spellCD = select(2,GetSpellCooldown(spell)) + GetSpellCooldown(spell) - GetTime()
						if spellCD &amp;lt;= 0 then spellCD = 0 end
						if spellCD &amp;lt;= 0.5 then return true end
					end
					return false
				end
			else
				if select(2, GetSpellCooldown(spell)) == 0 then return true end
			end
	end
end

--- Sanguinary Vein Check---

function Bleeding()
Bleeds = { 703, 1943, 121411 }

for i=1, #Bleeds do
   if UnitDebuffID(&amp;quot;target&amp;quot;, Bleeds[i]) then Vein = true
   end
end
end
--- Insight Check---
Insight = false

insights = { 84745, 84746, 84747 }

for y=1, #insights do
   if UnitBuffID(&amp;quot;player&amp;quot;, insights[y]) then Insight = true
   end
end

---Is Target Disarmed---
Disarmed = false

Weapons = { 676, 51722, 91644, 64058, 117368 }

for y=1, #Weapons do
   if UnitDebuffID(&amp;quot;target&amp;quot;, Weapons[y]) then Disarmed = true
   end
end



---Trinket Slot Check---
Trinkets = 0

trinketID = { 94523 }

for i=1, 13, 1 do
	 for y=1, #trinketID do
   if GetInventoryItemID(&amp;apos;player&amp;apos;, i) == trinketID[y] then 
     Trinkets = Trinkets + 1
   end
  end
end

---Trinket Buff Check---
Proc = 0 

Buff = { 126649, 126554, 126707, 128984, 127928, 126483, 126489, 105574, 127575, 
126690, 136086, 136086, 126599, 126484, 136088, 118334, 104423, 104510, 105697, 126734 }

for i=1, #Buff do
   if UnitBuffID(&amp;quot;player&amp;quot;, Buff[i]) then Proc = Proc + 1 
   end
end




-- Check for restealth
if UnitBuffID(&amp;quot;player&amp;quot;, 1784)
   or UnitBuffID(&amp;quot;player&amp;quot;, 11327)
   or UnitIsDeadOrGhost(&amp;quot;Player&amp;quot;)
   or UnitAffectingCombat(&amp;quot;player&amp;quot;)
   or IsMounted()
   or UnitCastingInfo(&amp;quot;player&amp;quot;) ~= nil
then 
	restealth = false
end


	
	
	function Buff_Check( SpellID, TargetID )

	if UnitBuffID(TargetID, SpellID) then
	
		local StackCount = select(4, UnitBuffID(TargetID, SpellID) )
		local Duration	 = select(7, UnitBuffID(TargetID, SpellID) )
		
		return true, Duration - GetTime(), StackCount
		
	else
	
		return false, nil, nil
		
	end

end

function Debuff_Check( SpellID, TargetID, Filter )

	if UnitDebuffID( TargetID, SpellID, Filter ) then
	
		local Duration = select(7, UnitDebuffID( TargetID, SpellID, Filter ) )
		
		return true, Duration - GetTime()
		
	else
	
		return false, nil, nil
		
	end

end



 
if not pickpocketCheck then
	pickpocketCheck = CreateFrame(&amp;quot;Frame&amp;quot;)
end
local ppframe = pickpocketCheck
ppframe:RegisterEvent(&amp;quot;UI_ERROR_MESSAGE&amp;quot;)
ppframe:SetScript(&amp;quot;OnEvent&amp;quot;, function(self, event, ...)
	local msg = select(1, ...)
	--PQR_Event(&amp;quot;PQR_Text&amp;quot;,...)
	if (msg:find(&amp;quot;No pockets to pick&amp;quot;) ~= nil) or (msg:find(&amp;quot;Your target has already had its pockets picked&amp;quot;) ~= nil) or (msg:find(&amp;quot;There is no loot&amp;quot;) ~= nil) then
		picked=true
	else
		picked=false
	end
end)
if picked==nil then 
	picked=false 
end
if not UnitExists(&amp;quot;target&amp;quot;) then
	picked = false
end
---Blacklist AoE Targets---
if UnitExists(&amp;quot;target&amp;quot;) then 
local targetGUID = tonumber((UnitGUID(&amp;quot;target&amp;quot;)):sub(-12, -9), 16)

NoAoE = false

Name = { 62995 }

for i=1, #Name do
   if targetGUID == Name[i] then NoAoE = true
   end
end
end



-- Behind Check
function BehindFunc()
	if behindTimer == nil then
		behindTimer = 0
	end
	local BehindCheck = PQR_CheckUIError(SPELL_FAILED_NOT_BEHIND)
	Timer = GetTime() - behindTimer
	if BehindCheck and behindTimer == 0 then
		behindTimer = GetTime()
		behind = false
	end
	if not BehindCheck and Timer &amp;gt; 0 then
		behindTimer = 0
		behind = true
	end
	if Timer &amp;gt; 3 and Timer &amp;lt; 10 then
		behindTimer = 0
		behind = false
	end
end



PQ_ImpalingSpearCD = 0
PQ_ImpalingSpear = 122224

PQ_Frame = nil
PQ_CanCast = true
PQ_CanBT = true
PQ_CanImpalingSpear = true
function PQ_Frame_OnEvent(self, event, ...)
	if ... ~= &amp;quot;player&amp;quot; then return end
	
	local spellID = select(5, ...)
	
	if spellID ~= PQ_ImpalingSpear then
		PQ_GCD = GetTime() + 0.7
		PQ_CanCast = false
	end
			
	if spellID == PQ_ImpalingSpear then
		PQ_ImpalingSpearCD = GetTime() + 5
		PQ_CanImpalingSpear = false
	end
end

function IsSlowed(unit)
local Slows = {
--WARLOCK--
18223,
--WARRIOR--
12323,
1715,
--PALADIN--
110300,                             
--DK--
45524,
50435,
--DRUID--
58180,
102355,
--HUNTER--
5116,
72217,
--MAGE--
7302,
116,
120,
44614,
--PRIEST--
124468,
15407,
--ROGUE--
26679,
3408,
--SHAMAN--
8056,
--MONK--
116095
              }
for i=1,#Slows do
        if UnitDebuffID(unit,Slows[i])
                then
                        return true
                end
        end
end

function SlowImmune(unit)
local Freedom = {
--Hand of Freedom--
1044,
--Dispersion--
47585
             }
for i=1,#Freedom do
        if UnitBuffID(unit,Freedom[i])
                then
                        return true
                end
        end
end

function IsImmune(unit)
local Immunity = {
110700, --Divine Shield
1022, --Hand of Protection
45438, --Ice Block
31224,--Cloak of Shadows
19263, --Deterrence
97417--BrittleBarrier
					}
for i=1,#Immunity do
        if UnitBuffID(unit,Immunity[i])
                then
                        return true
                end
        end
end

-- Boss Unit Function
SpecialUnit = nil
function SpecialUnit()
	local PQ_BossUnits = PQ_BossUnits
	
	if UnitExists(&amp;quot;target&amp;quot;) then
		local npcID = tonumber(UnitGUID(&amp;quot;target&amp;quot;):sub(6,10), 16)
		
		-- Dungeons &amp; Raids
		if UnitLevel(&amp;quot;target&amp;quot;) == -1 then return true else
			for i=1,#PQ_BossUnits do
				if PQ_BossUnits[i] == npcID then return true end
			end
			return false
		end
	else return false end
end
-- Complete boss unit table (Dungeons/Heroics/Raids)
PQ_BossUnits = {
	-- Cataclysm Dungeons --
	-- Abyssal Maw: Throne of the Tides
	40586,		-- Lady Naz&amp;apos;jar
	40765,		-- Commander Ulthok
	40825,		-- Erunak Stonespeaker
	40788,		-- Mindbender Ghur&amp;apos;sha
	42172,		-- Ozumat
	-- Blackrock Caverns
	39665,		-- Rom&amp;apos;ogg Bonecrusher
	39679,		-- Corla, Herald of Twilight
	39698,		-- Karsh Steelbender
	39700,		-- Beauty
	39705,		-- Ascendant Lord Obsidius
	-- The Stonecore
	43438,		-- Corborus
	43214,		-- Slabhide
	42188,		-- Ozruk
	42333,		-- High Priestess Azil
	-- The Vortex Pinnacle
	43878,		-- Grand Vizier Ertan
	43873,		-- Altairus
	43875,		-- Asaad
	-- Grim Batol
	39625,		-- General Umbriss
	40177,		-- Forgemaster Throngus
	40319,		-- Drahga Shadowburner
	40484,		-- Erudax
	-- Halls of Origination
	39425,		-- Temple Guardian Anhuur
	39428,		-- Earthrager Ptah
	39788,		-- Anraphet
	39587,		-- Isiset
	39731,		-- Ammunae
	39732,		-- Setesh
	39378,		-- Rajh
	-- Lost City of the Tol&amp;apos;vir
	44577,		-- General Husam
	43612,		-- High Prophet Barim
	43614,		-- Lockmaw
	49045,		-- Augh
	44819,		-- Siamat
	-- Zul&amp;apos;Aman
	23574,		-- Akil&amp;apos;zon
	23576,		-- Nalorakk
	23578,		-- Jan&amp;apos;alai
	23577,		-- Halazzi
	24239,		-- Hex Lord Malacrass
	23863,		-- Daakara
	-- Zul&amp;apos;Gurub
	52155,		-- High Priest Venoxis
	52151,		-- Bloodlord Mandokir
	52271,		-- Edge of Madness
	52059,		-- High Priestess Kilnara
	52053,		-- Zanzil
	52148,		-- Jin&amp;apos;do the Godbreaker
	-- End Time
	54431,		-- Echo of Baine
	54445,		-- Echo of Jaina
	54123,		-- Echo of Sylvanas
	54544,		-- Echo of Tyrande
	54432,		-- Murozond
	-- Hour of Twilight
	54590,		-- Arcurion
	54968,		-- Asira Dawnslayer
	54938,		-- Archbishop Benedictus
	-- Well of Eternity
	55085,		-- Peroth&amp;apos;arn
	54853,		-- Queen Azshara
	54969,		-- Mannoroth
	55419,		-- Captain Varo&amp;apos;then
	
	-- Mists of Pandaria Dungeons --
	-- Scarlet Halls
	59303,		-- Houndmaster Braun
	58632,		-- Armsmaster Harlan
	59150,		-- Flameweaver Koegler
	-- Scarlet Monastery
	59789,		-- Thalnos the Soulrender
	59223,		-- Brother Korloff
	3977,		-- High Inquisitor Whitemane
	60040,		-- Commander Durand
	-- Scholomance
	58633,		-- Instructor Chillheart
	59184,		-- Jandice Barov
	59153,		-- Rattlegore
	58722,		-- Lilian Voss
	58791,		-- Lilian&amp;apos;s Soul
	59080,		-- Darkmaster Gandling
	-- Stormstout Brewery
	56637,		-- Ook-Ook
	56717,		-- Hoptallus
	59479,		-- Yan-Zhu the Uncasked
	-- Tempe of the Jade Serpent
	56448,		-- Wise Mari
	56843,		-- Lorewalker Stonestep
	59051,		-- Strife
	59726,		-- Peril
	58826,		-- Zao Sunseeker
	56732,		-- Liu Flameheart
	56762,		-- Yu&amp;apos;lon
	56439,		-- Sha of Doubt
	-- Mogu&amp;apos;shan Palace
	61444,		-- Ming the Cunning
	61442,		-- Kuai the Brute
	61445,		-- Haiyan the Unstoppable
	61243,		-- Gekkan
	61398,		-- Xin the Weaponmaster
	-- Shado-Pan Monastery
	56747,		-- Gu Cloudstrike
	56541,		-- Master Snowdrift
	56719,		-- Sha of Violence
	56884,		-- Taran Zhu
	-- Gate of the Setting Sun
	56906,		-- Saboteur Kip&amp;apos;tilak
	56589,		-- Striker Ga&amp;apos;dok
	56636,		-- Commander Ri&amp;apos;mok
	56877,		-- Raigonn
	-- Siege of Niuzao Temple
	61567,		-- Vizier Jin&amp;apos;bak
	61634,		-- Commander Vo&amp;apos;jak
	61485,		-- General Pa&amp;apos;valak
	62205,		-- Wing Leader Ner&amp;apos;onok
	
	-- Mists of Pandaria Heroic Scenarios --
	-- A Brewing Storm
	58739,		-- Borokhula the Destroyer
	-- Battle on the High Seas
	71303,		-- Whale Shark &amp;lt;Son of Whale Shark&amp;gt;
	71327,		-- Admiral Hodgson
	67426,		-- Admiral Hagman
	70893,		-- Lieutenant Blasthammer
	71329,		-- Lieutenant Boltblaster
	-- Blood in the Snow
	70468,		-- Bonechiller Barafu
	70474,		-- Farastu &amp;lt;The Living Ice&amp;gt;
	70544,		-- Hekima the Wise &amp;lt;Herald of Rastakhan&amp;gt;
	-- Crypt of the Forgotten Kings
	61707,		-- Abomination of Anger
	71492,		-- Maragor &amp;lt;Guardian of the Golden Doors&amp;gt;
	67081,		-- Forgotten King
	-- Dark Heart of Pandaria
	71123,		-- Echo of Y&amp;apos;Shaarj
	-- The Secrets of Ragefire
	70683,		-- Dark Shaman Xorenth
	71030,		-- Overseer Elaglo
	70665,		-- Kor&amp;apos;kron Dire Soldier

	-- Training Dummies --
	46647,		-- Level 85 Training Dummy
	67127,		-- Level 90 Training Dummy
	
	-- Pandaria Raid Adds --
	63346,		-- Tsulong: The Dark of Night
	62969,		-- Tsulong: Embodied Terror
	62977,		-- Tsulong: Frightspawn
	62919,		-- Tsulong: Unstable Sha
	61034,		-- Sha of Fear: Terror Spawn
	61003		-- Sha of Fear: Dread Spawn
}</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>---2.Globals---</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>---Engineer Glove Cooldown---
GloveCD = GetInventoryItemCooldown(&amp;quot;player&amp;quot;,10)

---Trinket 1 Cooldown---
Trinket1CD = GetInventoryItemCooldown(&amp;quot;player&amp;quot;,13)

---Trinket 2 Cooldown---
Trinket2CD = GetInventoryItemCooldown(&amp;quot;player&amp;quot;,14)

---Healthstone Cooldown---
HealthstoneCD = select(2,GetItemCooldown(5512))

---Killing Spree CD---
local KSStart, KSDuration = GetSpellCooldown(51690)
KSCD = KSStart + KSDuration - GetTime()

---Vendetta CD---
local VenStart, VenDuration = GetSpellCooldown(79140)
VenCD = VenStart + VenDuration - GetTime()

---Killing Spree CD---
local ARStart, ARDuration = GetSpellCooldown(13750)
ARCD = ARStart + ARDuration - GetTime()

---Vanish CD---
local VanishStart, VanishDuration = GetSpellCooldown(1856)
VanishCD = VanishStart + VanishDuration - GetTime()

---Stealth CD---
local StealthStart, StealthDuration = GetSpellCooldown(1784)
StealthCD = StealthStart + StealthDuration - GetTime()

---Shadow Dance CD---
local SDStart, SDDuration = GetSpellCooldown(51713)
SDCD = SDStart + SDDuration - GetTime()

---Shadow Blades CD---
local SBStart, SBDuration = GetSpellCooldown(121471)
SBCD = SBStart + SBDuration - GetTime()

---Shadow Blades CD---
local PremedStart, PremedDuration = GetSpellCooldown(14183)
PremedCD = PremedStart + PremedDuration - GetTime()

---Honor Among Thieves CD---
local HATStart, HATDuration = GetSpellCooldown(51699)
HATCD = HATStart + HATDuration - GetTime()


--------------------------------------HEALTH/POWER TOOLS------------------------------------------
Playerhealth = 100 * UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;)

---Energy---
Energy = UnitPower(&amp;quot;player&amp;quot;)




-------------------------------------BUFFS--------------------------------------------------------


---Blade Flurry---
BladeFlurry,_,_,_,_,_,BladeFlurrytimer = UnitBuffID(&amp;quot;player&amp;quot;,13877)

---Sapped---
Sapped,_,_,_,_,_,Sappedtimer = UnitDebuffID(&amp;quot;target&amp;quot;,6770)

---Deep Insight---
DeepInsight,_,_,_,_,_,DeepInsighttimer = UnitBuffID(&amp;quot;player&amp;quot;,84747)

---Deep Insight---
ShallowInsight,_,_,_,_,_,ShallowInsighttimer = UnitBuffID(&amp;quot;player&amp;quot;,84745)

---Adrenaline Rush---
AdrenalineRush,_,_,_,_,_,AdrenalineRushtimer = UnitBuffID(&amp;quot;player&amp;quot;,13750)

---Revealing Strike---
Reveal,_,_,_,_,_,Revealtimer = UnitDebuffID(&amp;quot;target&amp;quot;,84617)

---Vendetta---
Vendetta,_,_,_,_,_,Vendettatimer = UnitDebuffID(&amp;quot;target&amp;quot;,79140)

---Master of Subtlety---
MasterOfSub,_,_,_,_,_,MasterOfSubtetimer = UnitBuffID(&amp;quot;player&amp;quot;,31223)

---Find Weakness---
FindWeakness,_,_,_,_,_,FindWeaknesstimer = UnitDebuffID(&amp;quot;target&amp;quot;,91021)

---Recuperate---
Recuperate,_,_,_,_,_,Recuperatetimer = UnitBuffID(&amp;quot;player&amp;quot;,73651)

---Virmen&amp;apos;s Bite---
VirmenBuff,_,_,_,_,_,VirmenBufftimer = UnitBuffID(&amp;quot;player&amp;quot;,105697)

---Feint---
Feint,_,_,_,_,_,Feinttimer = UnitBuffID(&amp;quot;player&amp;quot;,1966)

---Shadow Dance---
SD,_,_,_,_,_,SDtimer = UnitBuffID(&amp;quot;player&amp;quot;,51713)

---Envenom---
Envenom,_,_,_,_,_,Envenomtimer = UnitBuffID(&amp;quot;player&amp;quot;,32645)

---Blindside---
Blindside,_,_,_,_,_,Blindsidetimer = UnitBuffID(&amp;quot;player&amp;quot;,121153)

---Slice and Dice---
SnD,_,_,_,_,_,SnDtimer = UnitBuffID(&amp;quot;player&amp;quot;,5171)

---Vanish---
Vanish,_,_,_,_,_,Vanishtimer = UnitBuffID(&amp;quot;player&amp;quot;,1856)

---Stealth---
Stealth,_,_,_,_,_,Stealthtimer = UnitBuffID(&amp;quot;player&amp;quot;,1784)

---Shadow Blades---
SB,_,_,_,_,_,SBtimer = UnitBuffID(&amp;quot;player&amp;quot;,121471)

---Rupture---
Rupture,_,_,_,_,_,Rupturetimer = UnitDebuffID(&amp;quot;target&amp;quot;,1943)

---Garrote---
Garrote,_,_,_,_,_,Garrotetimer = UnitDebuffID(&amp;quot;target&amp;quot;,703)

---Garrote---
CrimsonTempest,_,_,_,_,_,CrimsonTempesttimer = UnitDebuffID(&amp;quot;target&amp;quot;,121411)



---Bloodlust Check---
Bloodlust = UnitBuffID(&amp;quot;player&amp;quot;, 2825)  
or UnitBuffID(&amp;quot;player&amp;quot;, 32182) 
or UnitBuffID(&amp;quot;player&amp;quot;, 80353) 
or UnitBuffID(&amp;quot;player&amp;quot;, 90355)

if opener==nil then
	opener=0
end
if UnitAffectingCombat(&amp;quot;player&amp;quot;)~=1 or UnitBuffID(&amp;quot;player&amp;quot;,1784) then
	opener=1
end

-----------------------------------------GLYPHS--------------------------------------------------
Exoglyph = false

local enabled, glyphType, glyphTooltipIndex, glyphSpellID, icon = GetGlyphSocketInfo(2)
if glyphSpellID == 122028 then Exoglyph = true end

local enabled, glyphType, glyphTooltipIndex, glyphSpellID, icon = GetGlyphSocketInfo(4)
if glyphSpellID == 122028 then Exoglyph = true end

local enabled, glyphType, glyphTooltipIndex, glyphSpellID, icon = GetGlyphSocketInfo(6)
if glyphSpellID == 122028 then Exoglyph = true end


Assassination = false
Subtlety = false
Combat = false

	if IsSpellKnown(79140) then
	Assassination = true
	elseif IsSpellKnown(51713) then
	Subtlety = true
	elseif IsSpellKnown(51690) then
	Combat = true
	end
	
	
----------------------------------------TALENTS----------------------------------------------------
Subterfuge = false

if select(2,GetTalentRowSelectionInfo(1)) == 2 then Subterfuge = true end

Focus = false

if select(2,GetTalentRowSelectionInfo(1)) == 3 then Focus = true end

Anticipation = false

if select(2,GetTalentRowSelectionInfo(6)) == 18 then Anticipation = true end

Marked = false

if select(2,GetTalentRowSelectionInfo(6)) == 17 then Marked = true end

Paralytic = false

if select(2,GetTalentRowSelectionInfo(5)) == 14 then Paralytic = true end

Leeching = false

if select(2,GetTalentRowSelectionInfo(3)) == 8 then Leeching = true end


------------------------------------------RACIALS(Death Knight)--------------------------------------------
---Race Check---
Troll = IsSpellKnown(26297)
Orc = IsSpellKnown(20572)
Goblin = IsSpellKnown(69041)
BloodElf = IsSpellKnown(28730)

---Cooldown Check---
local TrollStart,TrollDuration = GetSpellCooldown(26297)
TrollCD = TrollStart + TrollDuration - GetTime()
local OrcStart,OrcDuration = GetSpellCooldown(20572)
OrcCD = OrcStart + OrcDuration - GetTime()
local BloodElfStart,BloodElfDuration = GetSpellCooldown(28730)
BloodElfCD = BloodElfStart + BloodElfDuration - GetTime()
local GoblinStart,GoblinDuration = GetSpellCooldown(69041)
GoblinCD = GoblinStart + GoblinDuration - GetTime()



------------------------------------------POTIONS--------------------------------------------------
VirmenCD = select(2,GetItemCooldown(76089))
Virmen = GetItemCount(76089)

MoguCD = select(2,GetItemCooldown(76095))
Mogu = GetItemCount(76095)

SharkCD = select(2,GetItemCooldown(77589))
Shark = GetItemCount(77589)</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Subtlety- Opener</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local CP, Vein, picked, Sapped, opener, StealthCD, Stealth, Energy, PremedCD, SnD, Vanish = CP, Vein, picked, Sapped, opener, StealthCD, Stealth, Energy, PremedCD, SnD, Vanish
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )



	if opener==1 and not IsMounted() and UnitExists(&amp;quot;target&amp;quot;) and not UnitIsDeadOrGhost(&amp;quot;player&amp;quot;) and not UnitIsDeadOrGhost(&amp;quot;target&amp;quot;) then
		if (UnitAffectingCombat(&amp;quot;player&amp;quot;)~=1 or UnitInParty(&amp;quot;player&amp;quot;) or UnitInRaid(&amp;quot;player&amp;quot;)) and not Stealth and  UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) and StealthCD &amp;lt; 1 then 
		CastSpellByName( GetSpellInfo(1784), nil )
		end
		if IsSpellInRange(tostring(GetSpellInfo(1943)), &amp;quot;target&amp;quot;) ~= 0 then
			if Stealth and UnitExists(&amp;quot;target&amp;quot;) and not (UnitCastingInfo(&amp;quot;player&amp;quot;) and select(9,UnitCastingInfo(&amp;quot;player&amp;quot;))) then
				if Nova_Pickpocket == 1 then
					if picked==true then
					ClearTarget()
					elseif picked==false then
						if not Sapped then
						CastSpellByName( GetSpellInfo(6770), nil )
						else
						RunMacroText(&amp;quot;/cast Pick Pocket&amp;quot;)
						PQR_DelayRotation(0.5) 
						end
					end
				end
				if Nova_PickpocketWithOpener == 1 then
					if picked==false then
					RunMacroText(&amp;quot;/cast Pick Pocket&amp;quot;)
					PQR_DelayRotation(0.5) 
					end
					if PQI_SoapboxSubtlety_Opener_enable then
						if Stealth and Energy &amp;gt;= 99 and picked==true and PremedCD &amp;lt; 1 then
						CastSpellByName( GetSpellInfo(14183), nil )
						elseif Stealth and Energy &amp;gt;= 99 and PremedCD &amp;gt; 1 then
							if not  UnitDebuffID(&amp;quot;target&amp;quot;, 703, &amp;quot;PLAYER&amp;quot;) and not UnitDebuffID(&amp;quot;target&amp;quot;, 1943, &amp;quot;PLAYER&amp;quot;) and not UnitDebuffID(&amp;quot;target&amp;quot;, 121411, &amp;quot;PLAYER&amp;quot;) then
							CastSpellByName( GetSpellInfo(703), nil )
							else	
							CastSpellByName( GetSpellInfo(8676), nil )	
							end
						end
					end
				end
				if Nova_PickpocketWithOpener ~= 1 and not Nova_Pickpocket ~= 1 then
					if PQI_SoapboxSubtlety_Opener_enable then
						if IsSpellInRange(tostring(GetSpellInfo(53)), &amp;quot;target&amp;quot;) ~= 0 and Stealth and Energy &amp;gt;= 99 and PremedCD &amp;lt; 1 and not Vanish and not UnitBuffID(&amp;quot;Player&amp;quot;,115192) then
						CastSpellByName( GetSpellInfo(14183), nil )
						end
						if Stealth and Energy &amp;gt;= 99 and PremedCD &amp;gt; 1 then
							if (CP &amp;gt; 1  and CP &amp;lt; 5) or (Anticipation == true and (CP &amp;gt; 1 and (CP &amp;lt; 5 or (not Anti or AntiCharges &amp;lt; 5)))) then
								if not  UnitDebuffID(&amp;quot;target&amp;quot;, 703, &amp;quot;PLAYER&amp;quot;) and not UnitDebuffID(&amp;quot;target&amp;quot;, 1943, &amp;quot;PLAYER&amp;quot;) and not UnitDebuffID(&amp;quot;target&amp;quot;, 121411, &amp;quot;PLAYER&amp;quot;) then
								CastSpellByName( GetSpellInfo(703), nil )
								else
								CastSpellByName( GetSpellInfo(8676), nil )
								end
							end
						end
						if SnD or CP == 0 then
							opener=0
						end
					end
				end
			elseif CP &amp;gt; 0 and Energy &amp;gt;= 25 and not SnD then
				CastSpellByName( GetSpellInfo(5171), nil )
			end
			if SnD or CP == 0 then
				opener=0
			end
		end
	end
	if PQI_SoapboxSubtlety_Opener_enable then 
		if opener==0 and AoESwap and not IsMounted() and UnitExists(&amp;quot;target&amp;quot;) and not UnitIsDeadOrGhost(&amp;quot;player&amp;quot;) and not UnitIsDeadOrGhost(&amp;quot;target&amp;quot;) then
			if Stealth then
				CastSpellByName( GetSpellInfo(51723), nil )
			end
			if not Stealth then
			StartAttack(&amp;quot;target&amp;quot;)
			end
		end
	end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>---5.Boss Special---</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>--abilities lower in the rotation from being cast.
--abilities lower in the rotation from being cast.
if PQR_resumeAttack == nil then
	PQR_resumeAttack = 0
elseif PQR_resumeAttack &amp;gt; GetTime() then
	return true
else
	PQR_resumeAttack = 0
end


--IMPORTANT: Change this if you have any cleaves that would do damage to a secondary target
--as part of your single target rotation. Better to be safe than sorry! 
--Used for : Spirit Kings
local cleaveClass = false
local isAOE = strmatch(strupper(PQR_RotationName), &amp;quot;AOE&amp;quot;) --checks if we are in AOE mode.

for i=1,4 do
	local bossCheck = &amp;quot;boss&amp;quot;..i

	if UnitExists(bossCheck) then
		
		local npcID = tonumber(UnitGUID(bossCheck):sub(6,10), 16)
		local bossCasting,_,_,_,_,castEnd = UnitCastingInfo(bossCheck)
		
		if npcID == 62511 or npcID == 62711 then --Amber-Shaper Un&amp;apos;sok or Amber Monstrosity
			local reshapeName = GetSpellInfo(122370)
			local reshapeLife = UnitDebuff(&amp;quot;player&amp;quot;, reshapeName)
			
			if reshapeLife ~= nil then
				local playerCasting = UnitCastingInfo(&amp;quot;vehicle&amp;quot;)
				local playerCasting2 = UnitCastingInfo(&amp;quot;player&amp;quot;)
				--grab spell names for abilities:
				local amberExplosion = GetSpellInfo(122402)
				
				--interrupt self if casting amber explosion
				if playerCasting == amberExplosion then
					--Press the 2nd button (Struggle for Control)
					RunMacroText(&amp;quot;/click OverrideActionBarButton2&amp;quot;)
					return true
				end
				
				--interrupt self if casting amber explosion
				if playerCasting2 == amberExplosion then
					--Press the 2nd button (Struggle for Control)
					RunMacroText(&amp;quot;/click OverrideActionBarButton2&amp;quot;)
					return true
				end
				
				--interrupt the target if casting amber explosion
				if bossCasting and bossCasting == amberExplosion then
					TargetUnit(bossCheck)
					--Press the 1st button (Amber Strike)
					RunMacroText(&amp;quot;/click OverrideActionBarButton1&amp;quot;)
					return true
				end
				
				if UnitExists(&amp;quot;boss2&amp;quot;) then
					if bossCheck == &amp;quot;boss2&amp;quot; then 
						return true --prevent the rotation from executing while reshaped
					end
				else
					return true
				end

			end
		elseif npcID == 62397 then -- Wind Lord Mel&amp;apos;jarak
        
        	if UnitExists(&amp;quot;focus&amp;quot;) then
        		local impalingDebuff = select(7, UnitDebuffID(&amp;quot;focus&amp;quot;, PQ_ImpalingSpear, &amp;quot;player&amp;quot;))
        		
        		if impalingDebuff and impalingDebuff - GetTime() &amp;lt; 7 or IsMouseButtonDown(3) then
        			if PQ_CanCast
        			and PQ_CanImpalingSpear then
        				if GetSpellInfo(PQ_ImpalingSpear) == UnitCastingInfo(&amp;quot;player&amp;quot;) then
        					return true 
        				end
        				RunMacroText(&amp;quot;/target [@focus]&amp;quot;)
        				RunMacroText(&amp;quot;/click ExtraActionButton1&amp;quot;)
        				RunMacroText(&amp;quot;/targetlasttarget&amp;quot;)
        				return true
        			end
        		end
       		end
		elseif npcID == 60709 then --Spirit Kings: Qiang. (Impervious Shield)
			--Stop all attacks until 0.2 seconds after cast time ends and until buff (Impervious Shield) is gone.
			
			--only continue checking if we are targetting the boss or have no target.
			if (not UnitExists(&amp;quot;target&amp;quot;)) or (UnitIsUnit(&amp;quot;target&amp;quot;, bossCheck)) or (cleaveClass or isAOE) then
				local impName = GetSpellInfo(117961)
				local impShieldBuff = UnitBuffID(bossCheck, 117961)
				
				if (bossCasting and bossCasting == impName) then
					StopAttack()
					SpellStopCasting()
					local delayAdd = (castEnd/1000) - GetTime() --the number of seconds remaining on the cast.
					PQR_resumeAttack = GetTime() + delayAdd + 0.2
					return true
				end
				
				if impShieldBuff then
					StopAttack()
					SpellStopCasting()
					return true
				end
			end
			
		elseif npcID == 60710 then --Spirit Kings: Subetai. (Sleight of Hand)
			--Stop all attacks when casting Sleight of Hand, and until 0.2 seconds after cast time ends.
			--Also stop attacks if not stunned.
			
			--only continue checking if we are targetting the boss or have no target.
			if (not UnitExists(&amp;quot;target&amp;quot;)) or (UnitIsUnit(&amp;quot;target&amp;quot;, bossCheck)) or (cleaveClass or isAOE) then
				local sleightName = GetSpellInfo(118162)
				local sleightBuff = UnitBuffID(bossCheck, 118162)
				--				  HoJ,   FoJ,  Kidney  
				local stunList = { 853, 105593, 408 }
				local isStunned = nil
				for _,v in ipairs(stunList) do
					local debuffCheck = UnitDebuffID(bossCheck, v)
					if debuffCheck then
						isStunned = true
					end
				end
				
				if (bossCasting and bossCasting == sleightName) then
					StopAttack()
					SpellStopCasting()
					local delayAdd = (castEnd/1000) - GetTime() --the number of seconds remaining on the cast.
					PQR_resumeAttack = GetTime() + delayAdd + 0.2
					return true
				end
				
				if sleightBuff and not isStunned then
					StopAttack()
					SpellStopCasting()
					return true
				end
			end

		elseif npcID == 60701 then --Spirit Kings: Zian. (Shield of Darkness)
			--Stop all attacks until 0.5 seconds after cast time ends and until buff (Shield of Darkness) is gone.
						
			if (not UnitExists(&amp;quot;target&amp;quot;)) or (UnitIsUnit(&amp;quot;target&amp;quot;, bossCheck)) or (cleaveClass or isAOE) then
				local sodName = GetSpellInfo(117697)
				local sodBuff = UnitBuffID(bossCheck, 117697)
				
				if (bossCasting and bossCasting == sodName) then
					StopAttack()
					SpellStopCasting()
					local delayAdd = (castEnd/1000) - GetTime() --the number of seconds remaining on the cast.
					PQR_resumeAttack = GetTime() + delayAdd + 0.5 --0.5 to account for lag... REALLY do not want to set this off.
					return true
				end
				
				if sodBuff then
					StopAttack()
					SpellStopCasting()
					return true
				end
			end
		elseif npcID == 69427 then --Animus
			--Stop all attacks when casting Interrupting Jolt, and until 0.2 seconds after cast time ends.
			
			--only continue checking if we are targetting the boss or have no target.
			if (not UnitExists(&amp;quot;target&amp;quot;)) or (UnitIsUnit(&amp;quot;target&amp;quot;, bossCheck)) or (cleaveClass or isAOE) then
				local intjoltName = GetSpellInfo(139867)
				
				if (bossCasting and bossCasting == intjoltName) then
					StopAttack()
					SpellStopCasting()
					local delayAdd = (castEnd/1000) - GetTime() --the number of seconds remaining on the cast.
					PQR_resumeAttack = GetTime() + delayAdd + 0.2
					return true
				end	
			end
		end
	end
end

--click button to leave.
--Gara&amp;apos;jal isn&amp;apos;t a boss while in the Spirit Realm.
local returnSoul = select(7,UnitDebuffID(&amp;quot;player&amp;quot;,116161))
if returnSoul and returnSoul - GetTime() &amp;lt; 2 then 
	RunMacroText(&amp;quot;/click ExtraActionButton1&amp;quot;) 
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>---6.Success!---</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if CombatLog == nil then
    BuBa_CombatLog = CreateFrame(&amp;apos;Frame&amp;apos;)
    BuBa_CombatLog:RegisterEvent(&amp;quot;COMBAT_LOG_EVENT_UNFILTERED&amp;quot;)

 function OnSuccessfulCast(self, event, ...)
  local type, _, sourceGUID, sourceNAME, _, _, destGUID, destNAME = select(2, ...)
  if (event==&amp;quot;COMBAT_LOG_EVENT_UNFILTERED&amp;quot;) then
		  	if (type==&amp;quot;SPELL_AURA_APPLIED&amp;quot;) then
                if sourceGUID == UnitGUID(&amp;quot;player&amp;quot;) then
					if select(12, ...) == 84745 or select(12, ...) == 84746 or select(12, ...) == 84747 then
					Guile = 0
					end
				end
			end
            if (type==&amp;quot;SPELL_CAST_SUCCESS&amp;quot;) 
             --or (type==&amp;quot;SPELL_CAST_START&amp;quot;) 
             then
                if sourceGUID == UnitGUID(&amp;quot;player&amp;quot;) then
        if select(12, ...) == 1856 then
		AmbushVanish = true
		elseif select(12, ...) ~= 1856 and (AmbushVanish == true or AmbushVanish == nil) then
		AmbushVanish = false
		end
		if select(12, ...) == 36554 then
		AmbushShadow = true
		elseif select(12, ...) ~= 36554 and (AmbushShadow == true or AmbushShadow == nil) then
		AmbushShadow = false
		end
        if (select(12, ...) == 1752 or select(12, ...) == 84617) then
        Guile = Guile + 1
		elseif select(12, ...) == 1966 and Nova_Feint == 1 then
		SetCVar(&amp;quot;Nova_Feint&amp;quot;, 0)
		PQR_WriteToChat(&amp;quot;Feint: \124cFFE61515Casted&amp;quot;)
		elseif select(12, ...) == 408 and Nova_Kidney == 1 then
		SetCVar(&amp;quot;Nova_Kidney&amp;quot;, 0)
		PQR_WriteToChat(&amp;quot;Kidney Shot: \124cFFE61515Casted&amp;quot;)
		elseif select(12, ...) == 31224 and Nova_Cloak == 1 then
		SetCVar(&amp;quot;Nova_Cloak&amp;quot;, 0)
		PQR_WriteToChat(&amp;quot;Cloak of Shadows: \124cFFE61515Casted&amp;quot;)
		elseif select(12, ...) == 5277 and Nova_Evasion == 1 then
		SetCVar(&amp;quot;Nova_Evasion&amp;quot;, 0)
		PQR_WriteToChat(&amp;quot;Evasion: \124cFFE61515Casted&amp;quot;)
		elseif select(12, ...) == 137619 and Nova_Marked == 1 then
		SetCVar(&amp;quot;Nova_Marked&amp;quot;, 0)
		PQR_WriteToChat(&amp;quot;Marked for Death: \124cFFE61515Casted&amp;quot;)
      end
     end
    end
   end
  end

 BuBa_CombatLog:SetScript(&amp;apos;OnEvent&amp;apos;, OnSuccessfulCast)

    CombatLog = true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Combat- Blade Flurry</Name><Default>false</Default><SpellID>13877</SpellID><Actions></Actions><Lua>local BladeFlurry = BladeFlurry

if Nova_Cleave == 1 or Nova_Cleave4To6 == 1 then 
	if not BladeFlurry then
		return true 
	end
end</Lua><RecastDelay>3000</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Subtlety- Hemo -Vanish-</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local Vanish = Vanish
BehindFunc()

if UnitBuffID(&amp;quot;Player&amp;quot;,115192) then return false end

if Nova_Hemo ~= 1 then return false end

if Vanish then
CastSpellByName(GetSpellInfo(16511), &amp;quot;target&amp;quot;)
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Assassination- Vanish Pooling</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not PQI_SoapboxAssassination_Vanish_enable then return false end
local SB, AdrenalineRush, VanishCD, Anticipation, CP, Energy, Focus, Subterfuge = SB, AdrenalineRush, VanishCD, Anticipation, CP, Energy, Focus, Subterfuge
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )
if SB or Nova_AOE == 1 or Nova_Cooldowns ~= 1 then return false end
if PQI_SoapboxAssassination_BossCooldowns_enable then
	if not SpecialUnit() then 
	return false
	end
end

 
  if UnitExists(&amp;quot;boss&amp;quot;..1) then
		local BossID = tonumber(UnitGUID(&amp;quot;boss&amp;quot;..1):sub(6,10), 16)
		if BossID == 69465	
		or BossID == 69712 then
   			if BossID == 69465 then -- Jin&amp;apos;Rokh
			local Fluidity = UnitDebuffID(&amp;quot;player&amp;quot;, 138002)	
				if Fluidity then
					if cTime &amp;gt; 10 and VanishCD &amp;lt; 1 then 
						if (CP &amp;lt; 3 or (CP &amp;gt; 2 and Anticipation == true and (not Anti or AntiCharges &amp;lt; 3))
						or (CP &amp;lt; 4 or (Anticipation == true and (not Anti or AntiCharges &amp;lt; 4))))
						and ((Focus == true and not SB and Energy &amp;lt; 15) 
						or (Subterfuge == true and Energy &amp;lt; 90) 
	 					or (Focus == false and Subterfuge == false and Energy &amp;lt; 60)) then
 	 					return true
	 					end
				 	end
				end				
    		elseif BossID == 69712 then -- Ji-Kun
  			local TargetID = tonumber(UnitGUID(&amp;quot;target&amp;quot;):sub(6,10), 16)
  			local Feed = UnitBuffID(&amp;quot;player&amp;quot;, 140741)
   				if TargetID == BossID then
   					if not UnitBuffID(&amp;quot;player&amp;quot;, 133755) then 
						if cTime &amp;gt; 10 and VanishCD &amp;lt; 1 then 
							if (CP &amp;lt; 3 or (CP &amp;gt; 2 and Anticipation == true and (not Anti or AntiCharges &amp;lt; 3))
							or (CP &amp;lt; 4 or (Anticipation == true and (not Anti or AntiCharges &amp;lt; 4))))
	 						and ((Focus == true and not SB and Energy &amp;lt; 15) 
	 						or (Subterfuge == true and Energy &amp;lt; 90) 
	 						or (Focus == false and Subterfuge == false and Energy &amp;lt; 60)) then
 	 						return true
	 						end
 						end
					elseif Feed then
						if cTime &amp;gt; 10 and VanishCD &amp;lt; 1 then 
							if (CP &amp;lt; 3 or (CP &amp;gt; 2 and Anticipation == true and (not Anti or AntiCharges &amp;lt; 3))
							or (CP &amp;lt; 4 or (Anticipation == true and (not Anti or AntiCharges &amp;lt; 4))))
	 						and ((Focus == true and not SB and Energy &amp;lt; 15) 
	 						or (Subterfuge == true and Energy &amp;lt; 90) 
	 						or (Focus == false and Subterfuge == false and Energy &amp;lt; 60)) then
 	 						return true
	 						end
 						end
					end
				end
			end
		elseif cTime &amp;gt; 10 and VanishCD &amp;lt; 1 then 
			if (CP &amp;lt; 3 or (CP &amp;gt; 2 and Anticipation == true and (not Anti or AntiCharges &amp;lt; 3))
			or (CP &amp;lt; 4 or (Anticipation == true and (not Anti or AntiCharges &amp;lt; 4))))
	 		and ((Focus == true and not SB and Energy &amp;lt; 15) 
	 		or (Subterfuge == true and Energy &amp;lt; 90) 
	 		or (Focus == false and Subterfuge == false and Energy &amp;lt; 60)) then
 	 		return true
	 		end
 		end
	elseif cTime &amp;gt; 10 and VanishCD &amp;lt; 1 then 
		if (CP &amp;lt; 3 or (CP &amp;gt; 2 and Anticipation == true and (not Anti or AntiCharges &amp;lt; 3))
		or (CP &amp;lt; 4 or (Anticipation == true and (not Anti or AntiCharges &amp;lt; 4))))
		and ((Focus == true and not SB and Energy &amp;lt; 15) 
		or (Subterfuge == true and Energy &amp;lt; 90) 
		or (Focus == false and Subterfuge == false and Energy &amp;lt; 60)) then
 		return true
	 	end
	 end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Assassination- Env -Subterfuge-</Name><Default>false</Default><SpellID>2098</SpellID><Actions></Actions><Lua>if Vanish then return false end

local CP = GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; )
local Envenom, EnvenomTimeLeft = Buff_Check( 32645, &amp;quot;player&amp;quot; )
local Rupture, RuptureTimeLeft 	= Debuff_Check( 1943, &amp;quot;target&amp;quot;, &amp;quot;PLAYER&amp;quot; )
local Vendetta, VendettaTimeLeft 	= Debuff_Check( 79140, &amp;quot;target&amp;quot;, &amp;quot;PLAYER&amp;quot; )
local CurrentEnergy		= UnitPower(&amp;quot;player&amp;quot;)
local SB, SBTimeLeft	= Buff_Check( 121471, &amp;quot;player&amp;quot; )
local EnergyRegen = select(2, GetPowerRegen(&amp;quot;player&amp;quot;))
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )
local EnergyAfterEnvenom = CurrentEnergy + (EnergyRegen * 1.5)

if not UnitBuffID(&amp;quot;Player&amp;quot;,115192) then return false end

if not PQI_SoapboxAssassination_PooledEnvenoms_enable then 
if CP &amp;gt; 4 and Rupture and not SB and (not Anti or AntiCharges &amp;lt; 4) then

	if RuptureTimeLeft &amp;lt; 6 and RuptureTimeLeft &amp;gt; 3 and (CurrentEnergy + (EnergyRegen * (RuptureTimeLeft - 2)) + 25) &amp;lt; 110 then
		return true
	end
	
	if RuptureTimeLeft &amp;lt; 3 or (RuptureTimeLeft &amp;gt; 3 and CurrentEnergy &amp;lt; 60 and not Vendetta) then
		return true
	end
	
end

if CP &amp;gt; 4 and (not Envenom or EnvenomTimeLeft &amp;lt; 1 or (EnergyAfterEnvenom &amp;gt; 100 and ((Anti and AntiCharges &amp;gt; 2) or Anticipation == false)) or (SB and SBTimeLeft &amp;gt; 1 and EnergyAfterEnvenom &amp;gt; 30 and (Anti and AntiCharges &amp;gt; 2)))  then
	return true
	
end

elseif Energy &amp;gt; 70 or SB or Nova_AOE == 1 then
	if CP &amp;gt; 4 and Rupture and not SB and (not Anti or AntiCharges &amp;lt; 4) then

		if RuptureTimeLeft &amp;lt; 6 and RuptureTimeLeft &amp;gt; 3 and (CurrentEnergy + (EnergyRegen * (RuptureTimeLeft - 2)) + 25) &amp;lt; 110 then
		return true
		end
	
		if RuptureTimeLeft &amp;lt; 3 or (RuptureTimeLeft &amp;gt; 3 and CurrentEnergy &amp;lt; 60 and not Vendetta) then
			return true
		end
	
	end

	if CP &amp;gt; 4 and (not Envenom or EnvenomTimeLeft &amp;lt; 1 or (EnergyAfterEnvenom &amp;gt; 100 and ((Anti and AntiCharges &amp;gt; 2) or Anticipation == false)) or (SB and SBTimeLeft &amp;gt; 1 and EnergyAfterEnvenom &amp;gt; 30 and (Anti and AntiCharges &amp;gt; 2)))  then
	return true
	
	end
end


if CP &amp;gt; 1 and SnD and SnDtimer - GetTime() &amp;lt; 3 then
return true
end</Lua><RecastDelay>1000</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Assassination- Ambush -Subterfuge-</Name><Default>false</Default><SpellID>1329</SpellID><Actions>/cast Shadowstep</Actions><Lua>BehindFunc()

if UnitBuffID(&amp;quot;Player&amp;quot;,115192) then
	if behind == false then
	CastSpellByName(GetSpellInfo(1329))
	return true
	elseif behind == true then
	CastSpellByName(GetSpellInfo(8676))
	return true
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Assassination- Rupture -Subterfuge-</Name><Default>false</Default><SpellID>1943</SpellID><Actions></Actions><Lua>local Vanish, Rupture, Rupturetimer, CP, Anticipation = Vanish, Rupture, Rupturetimer, CP, Anticipation

if Vanish then return false end

if not UnitBuffID(&amp;quot;Player&amp;quot;,115192) then return false end

if Nova_AOE ~= 1 then
if ((Rupture and Rupturetimer - GetTime() &amp;lt; 2 and CP == 5) or (Rupture and Rupturetimer - GetTime() &amp;lt; 1))
or (Anticipation == false and (CP == 5 and Rupture and Rupturetimer - GetTime() &amp;lt; 4) or (Rupture and Rupturetimer - GetTime() &amp;lt; 2))
or not Rupture then
return true
end
end

if Nova_AOE == 1 and not Rupture and CP &amp;gt; 2 then
return true
end</Lua><RecastDelay>2000</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Assassination- SnD -Subterfuge</Name><Default>false</Default><SpellID>5171</SpellID><Actions></Actions><Lua>local Rupture, SnD, SnDtimer = Rupture, SnD, SnDtimer

if not UnitBuffID(&amp;quot;Player&amp;quot;,115192) then return false end

if not SnD and CP &amp;gt; 2 and not Rupture then 
return false
end

if (SnD and SnDtimer - GetTime() &amp;lt; 2)
or not SnD then
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Subtlety- Garrote</Name><Default>false</Default><SpellID>703</SpellID><Actions></Actions><Lua>if Nova_AOE == 1 or Nova_Cleave == 1 then return false end

local Vein, CrimsonTempest, CrimsonTempesttimer, Vanish, Rupture, Garrote, Rupturetimer, Garrotetimer, CP, Anticipation = Vein, CrimsonTempest, CrimsonTempesttimer, Vanish, Rupture, Garrote, Rupturetimer, Garrotetimer, CP, Anticipation
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )

if Vanish or UnitBuffID(&amp;quot;Player&amp;quot;,115192) then 
	if CP &amp;lt; 5  or (Anticipation == true and (not Anti or AntiCharges &amp;lt; 5)) then
		if Rupture and not Garrote and not CrimsonTempest then
			if Rupturetimer - GetTime() &amp;lt; 4 or (SD and Rupturetimer - GetTime() &amp;lt; 2) then
				return true
			end
		elseif Garrote and not Rupture and not CrimsonTempest then
			if Garrotetimer - GetTime() &amp;lt; 4 or (SD and Garrotetimer - GetTime() &amp;lt; 2) then
				return true
			end
		elseif CrimsonTempest and not Rupture and not Garrote then
			if CrimsonTempesttimer - GetTime() &amp;lt; 4 or (SD and CrimsonTempesttimer - GetTime() &amp;lt; 2) then	
				return true
			end
		elseif not  UnitDebuffID(&amp;quot;target&amp;quot;, 703, &amp;quot;PLAYER&amp;quot;) and not UnitDebuffID(&amp;quot;target&amp;quot;, 1943, &amp;quot;PLAYER&amp;quot;) and not UnitDebuffID(&amp;quot;target&amp;quot;, 121411, &amp;quot;PLAYER&amp;quot;) then
		return true
		end
	end
end</Lua><RecastDelay>4000</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>---3a.Macro Table---</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>-------------------------------------------------------------------
--------------------------Macros Table-----------------------------
-------------------------------------------------------------------

  PQR_InterruptDelay =  0

	--------------------
	-- Register CVars --
	--------------------
	Nova_ValueCheck = {
		{	Var1 = nil,	Text = &amp;quot;Toggles&amp;quot;,					Var2 = nil		},
		{	Var1 = 0,	Text = &amp;quot;Cooldowns&amp;quot;,					Var2 = 1		},
		{	Var1 = 0,	Text = &amp;quot;Cleave&amp;quot;,					Var2 = 1		},
		{	Var1 = 0,	Text = &amp;quot;Cleave4To6&amp;quot;,				Var2 = 1		},
		{	Var1 = 0,	Text = &amp;quot;AOE&amp;quot;, 						Var2 = 1		},
		{	Var1 = 0,	Text = &amp;quot;Hemo&amp;quot;, 						Var2 = 1		},
		{	Var1 = 0,	Text = &amp;quot;Pickpocket&amp;quot;, 				Var2 = 1		},
		{	Var1 = 0,	Text = &amp;quot;PickpocketWithOpener&amp;quot;, 		Var2 = 1		},
		{	Var1 = nil,	Text = &amp;quot;QueuedAbilities&amp;quot;,			Var2 = nil		},
		{	Var1 = 0,	Text = &amp;quot;Evasion&amp;quot;,					Var2 = 1		},
		{	Var1 = 0,	Text = &amp;quot;Feint&amp;quot;,						Var2 = 1		},
		{	Var1 = 0,	Text = &amp;quot;Cloak&amp;quot;,						Var2 = 1		},
		{	Var1 = 0,	Text = &amp;quot;Marked&amp;quot;,					Var2 = 1		},
		{	Var1 = 0,	Text = &amp;quot;Kidney&amp;quot;,					Var2 = 1		}
	}		

	-----------------------------------------------
	-- Registering the CVars for the CustomFrame --
	-----------------------------------------------
	for i=1, #Nova_ValueCheck do
		if GetCVar(&amp;quot;Nova_&amp;quot;..Nova_ValueCheck[i].Text) == nil then 
			RegisterCVar(&amp;quot;Nova_&amp;quot;..string.gsub(Nova_ValueCheck[i].Text, &amp;quot;%s&amp;quot;, &amp;quot;_&amp;quot;), Nova_ValueCheck[i].Var1) 
		end
		if GetCVar(&amp;quot;Nova_&amp;quot;..Nova_ValueCheck[i].Text..&amp;apos;_Enabled&amp;apos;) == nil then 
			RegisterCVar(&amp;quot;Nova_&amp;quot;..string.gsub(Nova_ValueCheck[i].Text, &amp;quot;%s&amp;quot;, &amp;quot;_&amp;quot;)..&amp;apos;_Enabled&amp;apos;, Nova_ValueCheck[i].Var2) 
		end
	end


-- Latency Adjuster
local minValue = 0.05
local maxValue = 0.3
local curPing = tonumber((select(3,GetNetStats()) + select(4,GetNetStats())) / 1000) + .025

if curPing &amp;lt; minValue then
	curPing = minValue
elseif curPing &amp;gt; maxValue then
	curPing = maxValue
end

PQR_SpellAvailableTime = curPing

----------------------------
-- To Integer from String --
----------------------------
for i=1, #Nova_ValueCheck do
	if Nova_ValueCheck[i].Var1 ~= nil then
		_G[&amp;apos;Nova_&amp;apos;..string.gsub(Nova_ValueCheck[i].Text, &amp;apos;%s&amp;apos;, &amp;apos;_&amp;apos;)] = tonumber(GetCVar(&amp;apos;Nova_&amp;apos;..string.gsub(Nova_ValueCheck[i].Text, &amp;apos;%s&amp;apos;, &amp;apos;_&amp;apos;)))
	end
	if Nova_ValueCheck[i].Var2 ~= nil then
		_G[&amp;apos;Nova_&amp;apos;..string.gsub(Nova_ValueCheck[i].Text, &amp;apos;%s&amp;apos;, &amp;apos;_&amp;apos;)..&amp;apos;Check&amp;apos;] = GetCVarBool(&amp;apos;Nova_&amp;apos;..string.gsub(Nova_ValueCheck[i].Text, &amp;apos;%s&amp;apos;, &amp;apos;_&amp;apos;)..&amp;apos;_Enabled&amp;apos;)
	end
end

--------------------
-- Slash Commands --
--------------------
if SlashMacros == nil then
	SlashMacros = true
	
	SLASH_COOLDOWNS1 = &amp;quot;/cooldowns&amp;quot;
	SLASH_COOLDOWNS2 = &amp;quot;/cooldown&amp;quot;
	function SlashCmdList.COOLDOWNS(msg, editbox)
		if not GetCVarBool(&amp;quot;Nova_Cooldowns&amp;quot;) then
			xrn:message(&amp;quot;|cff800080Cooldowns - Active.&amp;quot;)
			SetCVar(&amp;quot;Nova_Cooldowns&amp;quot;, 1)
		else			
			xrn:message(&amp;quot;|cff800080Cooldowns - Inactive.&amp;quot;)
			SetCVar(&amp;quot;Nova_Cooldowns&amp;quot;, 0)
		end
	end			
	SLASH_CLEAVE1 = &amp;quot;/cleave&amp;quot;
	function SlashCmdList.CLEAVE(msg, editbox)
		if not GetCVarBool(&amp;quot;Nova_Cleave&amp;quot;) then 
			if Combat == true then	
			PQR_Event(&amp;quot;PQR_Text&amp;quot;, &amp;quot;Cleave&amp;quot;, nil, &amp;apos;55ff00&amp;apos;)
			xrn:message(&amp;quot;\124cFFF0A804Cleave Rotation.&amp;quot;)
			SetCVar(&amp;quot;Nova_Cleave&amp;quot;, 1)
			SetCVar(&amp;quot;Nova_Cleave4To6&amp;quot;, 0)
			SetCVar(&amp;quot;Nova_AOE&amp;quot;, 0)
			elseif Subtlety == true then	
			PQR_Event(&amp;quot;PQR_Text&amp;quot;, &amp;quot;Cleave&amp;quot;, nil, &amp;apos;55ff00&amp;apos;)
			xrn:message(&amp;quot;\124cFFF0A804Cleave Rotation.&amp;quot;)
			SetCVar(&amp;quot;Nova_Cleave&amp;quot;, 1)
			SetCVar(&amp;quot;Nova_Cleave4To6&amp;quot;, 0)
			SetCVar(&amp;quot;Nova_AOE&amp;quot;, 0)
			end
		elseif Combat == true then
		PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;Single Target&amp;quot;,nil,&amp;quot;FFFFFF&amp;quot;)
		xrn:message(&amp;quot;\124cFFD4D4D4Single target Rotation&amp;quot;)
		SetCVar(&amp;quot;Nova_Cleave&amp;quot;, 0)
		elseif Subtlety == true then
		PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;Single Target&amp;quot;,nil,&amp;quot;FFFFFF&amp;quot;)
		xrn:message(&amp;quot;\124cFFD4D4D4Single target Rotation&amp;quot;)
		SetCVar(&amp;quot;Nova_Cleave&amp;quot;, 0)
		end
	end
		SLASH_CLEAVEHIGH1 = &amp;quot;/fancleave&amp;quot;
	function SlashCmdList.CLEAVEHIGH(msg, editbox)
		if not GetCVarBool(&amp;quot;Nova_Cleave4To6&amp;quot;) then
			if Combat == true then
			PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;Cleave 4-6 Targets&amp;quot;,nil,&amp;quot;0fffff&amp;quot;)
			xrn:message(&amp;quot;\124cFFFFFFFFCleave 4-6 Target Rotation&amp;quot;)
			SetCVar(&amp;quot;Nova_Cleave4To6&amp;quot;, 1)
			SetCVar(&amp;quot;Nova_Cleave&amp;quot;, 0)
			SetCVar(&amp;quot;Nova_AOE&amp;quot;, 0)
			end
		elseif Combat == true then
		PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;Single Target&amp;quot;,nil,&amp;quot;FFFFFF&amp;quot;)
		xrn:message(&amp;quot;\124cFFD4D4D4Single target Rotation&amp;quot;)
		SetCVar(&amp;quot;Nova_Cleave4To6&amp;quot;, 0)
		elseif Subtlety == true then
		PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;Single Target&amp;quot;,nil,&amp;quot;FFFFFF&amp;quot;)
		xrn:message(&amp;quot;\124cFFD4D4D4Single target Rotation&amp;quot;)
		SetCVar(&amp;quot;Nova_Cleave4To6&amp;quot;, 0)
		elseif Assassination == true then
		PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;Single Target&amp;quot;,nil,&amp;quot;FFFFFF&amp;quot;)
		xrn:message(&amp;quot;\124cFFD4D4D4Single target Rotation&amp;quot;)
		SetCVar(&amp;quot;Nova_Cleave4To6&amp;quot;, 0)
		end
	end	
	SLASH_AOE1 = &amp;quot;/aoe&amp;quot;
	function SlashCmdList.AOE(msg, editbox)
		if not GetCVarBool(&amp;quot;Nova_AOE&amp;quot;) then
			PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;AOE&amp;quot;,nil,&amp;quot;0698FF&amp;quot;)
			xrn:message(&amp;quot;\124cFF3BB0FFArea of Effect Rotation&amp;quot;)
			SetCVar(&amp;quot;Nova_AOE&amp;quot;, 1)
			SetCVar(&amp;quot;Nova_Cleave&amp;quot;, 0)
			SetCVar(&amp;quot;Nova_Cleave4To6&amp;quot;, 0)
		else
			PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;Single Target&amp;quot;,nil,&amp;quot;FFFFFF&amp;quot;)
			xrn:message(&amp;quot;\124cFFD4D4D4Single target Rotation&amp;quot;) 
			SetCVar(&amp;quot;Nova_AOE&amp;quot;, 0)
		end
	end
	SLASH_HEMO1 = &amp;quot;/hemo&amp;quot;
	function SlashCmdList.HEMO(msg, editbox)
		if Subtlety == true then
		if not GetCVarBool(&amp;quot;Nova_Hemo&amp;quot;) then
			xrn:message(&amp;quot;\124cFFFF0000Hemorrhage Frontal Rotation&amp;quot;)
			SetCVar(&amp;quot;Nova_Hemo&amp;quot;, 1)
		else
			xrn:message(&amp;quot;\124cFFFF0000Backstab Rotation&amp;quot;)
			SetCVar(&amp;quot;Nova_Hemo&amp;quot;, 0)
		end
		end
	end	
	SLASH_PICKOPEN1 = &amp;quot;/pick&amp;quot;
	function SlashCmdList.PICKOPEN(msg, editbox)
		if not GetCVarBool(&amp;quot;Nova_PickpocketWithOpener&amp;quot;) and not GetCVarBool(&amp;quot;Nova_Pickpocket&amp;quot;) then
			if Subtlety == true then
				if PQI_SoapboxSubtlety_Opener_enable then
				xrn:message(&amp;quot;\124cFF008000Pickpocket With Opener&amp;quot;)
				SetCVar(&amp;quot;Nova_PickpocketWithOpener&amp;quot;, 1)
				SetCVar(&amp;quot;Nova_Pickpocket&amp;quot;, 0)
				else
				xrn:message(&amp;quot;\124cFF008000Pickpocket Without Opener&amp;quot;)
				SetCVar(&amp;quot;Nova_Pickpocket&amp;quot;, 1)
				SetCVar(&amp;quot;Nova_PickpocketWithOpener&amp;quot;, 0)
				end
			elseif Combat == true then
				if PQI_SoapboxCombat_Opener_enable then
				xrn:message(&amp;quot;\124cFF008000Pickpocket With Opener&amp;quot;)
				SetCVar(&amp;quot;Nova_PickpocketWithOpener&amp;quot;, 1)
				SetCVar(&amp;quot;Nova_Pickpocket&amp;quot;, 0)
				else
				xrn:message(&amp;quot;\124cFF008000Pickpocket Without Opener&amp;quot;)
				SetCVar(&amp;quot;Nova_Pickpocket&amp;quot;, 1)
				SetCVar(&amp;quot;Nova_PickpocketWithOpener&amp;quot;, 0)
				end
			elseif Assassination == true then
				if PQI_SoapboxAssassination_Opener_enable then
				xrn:message(&amp;quot;\124cFF008000Pickpocket With Opener&amp;quot;)
				SetCVar(&amp;quot;Nova_PickpocketWithOpener&amp;quot;, 1)
				SetCVar(&amp;quot;Nova_Pickpocket&amp;quot;, 0)
				else
				xrn:message(&amp;quot;\124cFF008000Pickpocket Without Opener&amp;quot;)
				SetCVar(&amp;quot;Nova_Pickpocket&amp;quot;, 1)
				SetCVar(&amp;quot;Nova_PickpocketWithOpener&amp;quot;, 0)
				end
			end
		elseif GetCVarBool(&amp;quot;Nova_PickpocketWithOpener&amp;quot;) and not GetCVarBool(&amp;quot;Nova_Pickpocket&amp;quot;) then
			xrn:message(&amp;quot;\124cFF008000Pickpocket Without Opener&amp;quot;)
			SetCVar(&amp;quot;Nova_Pickpocket&amp;quot;, 1)
			SetCVar(&amp;quot;Nova_PickpocketWithOpener&amp;quot;, 0)
		elseif GetCVarBool(&amp;quot;Nova_Pickpocket&amp;quot;) and not GetCVarBool(&amp;quot;Nova_PickpocketWithOpener&amp;quot;) then
			xrn:message(&amp;quot;\124cFF008000Pickpocket Disabled&amp;quot;)
			SetCVar(&amp;quot;Nova_Pickpocket&amp;quot;, 0)
			SetCVar(&amp;quot;Nova_PickpocketWithOpener&amp;quot;, 0)
		end
	end
	SLASH_EVASION1 = &amp;quot;/evasion&amp;quot;
	function SlashCmdList.EVASION(msg, editbox)
		if not GetCVarBool(&amp;quot;Nova_Evasion&amp;quot;) then
			xrn:message(&amp;quot;\124cFF008000Evasion Queued&amp;quot;)
			SetCVar(&amp;quot;Nova_Evasion&amp;quot;, 1)
		else
			xrn:message(&amp;quot;\124cFF008000Evasion Canceled&amp;quot;)
			SetCVar(&amp;quot;Nova_Evasion&amp;quot;, 0)
		end
	end	
		SLASH_FEINT1 = &amp;quot;/feint&amp;quot;
	function SlashCmdList.FEINT(msg, editbox)
		if not GetCVarBool(&amp;quot;Nova_Feint&amp;quot;) then
			xrn:message(&amp;quot;\124cFF008000Feint Queued&amp;quot;)
			SetCVar(&amp;quot;Nova_Feint&amp;quot;, 1)
		else
			xrn:message(&amp;quot;\124cFF008000Feint Canceled&amp;quot;)
			SetCVar(&amp;quot;Nova_Feint&amp;quot;, 0)
		end
	end	
		SLASH_CLOAK1 = &amp;quot;/cloak&amp;quot;
	function SlashCmdList.CLOAK(msg, editbox)
		if not GetCVarBool(&amp;quot;Nova_Cloak&amp;quot;) then
			xrn:message(&amp;quot;\124cFF008000Cloak of Shadows Queued&amp;quot;)
			SetCVar(&amp;quot;Nova_Cloak&amp;quot;, 1)
		else
			xrn:message(&amp;quot;\124cFF008000Cloak of Shadows Canceled&amp;quot;)
			SetCVar(&amp;quot;Nova_Cloak&amp;quot;, 0)
		end
	end	
		SLASH_MARK1 = &amp;quot;/marked&amp;quot;
	function SlashCmdList.MARK(msg, editbox)
		if Marked == true then
		if not GetCVarBool(&amp;quot;Nova_Marked&amp;quot;) then
			xrn:message(&amp;quot;\124cFFFF0000Marked for Death Queued&amp;quot;)
			SetCVar(&amp;quot;Nova_Marked&amp;quot;, 1)
		else
			xrn:message(&amp;quot;\124cFFFF0000Marked for Death Canceled&amp;quot;)
			SetCVar(&amp;quot;Nova_Marked&amp;quot;, 0)
		end
		end
	end	
		SLASH_KIDNEY1 = &amp;quot;/kidney&amp;quot;
	function SlashCmdList.KIDNEY(msg, editbox)
		if not GetCVarBool(&amp;quot;Nova_kidney&amp;quot;) then
			xrn:message(&amp;quot;\124cFFFF0000Kidney Shot Queued&amp;quot;)
			SetCVar(&amp;quot;Nova_Kidney&amp;quot;, 1)
		else
			xrn:message(&amp;quot;\124cFFFF0000Kidney Shot Canceled&amp;quot;)
			SetCVar(&amp;quot;Nova_Kidney&amp;quot;, 0)
		end
	end	
	
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>---7.Pause---</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if PauseSwap then
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-All Spec- Cloak of Shadows</Name><Default>false</Default><SpellID>31224</SpellID><Actions></Actions><Lua>if Nova_Cloak == 1 then 
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-All Spec- Evasion</Name><Default>false</Default><SpellID>5277</SpellID><Actions></Actions><Lua>if Nova_Evasion == 1 then 
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>---0. Rotation Check---</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if GetSpecialization() == 1 then
	Spec = &amp;quot;Assassination&amp;quot;
	PQR_SwapRotation(&amp;quot;Assassination (Soapbox Rogue Serial ACS1986)&amp;quot;) 
elseif GetSpecialization() == 2 then
	Spec = &amp;quot;Combat&amp;quot;
	PQR_SwapRotation(&amp;quot;Combat (Soapbox Rogue Serial ACS1986)&amp;quot;)
elseif GetSpecialization() == 3 then
	Spec = &amp;quot;Subtlety&amp;quot;
	PQR_SwapRotation(&amp;quot;Subtlety (Soapbox Rogue Serial ACS1986)&amp;quot;)
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>---3. Sub Table---</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if SOAPBOX_SUBTLETY then return false end

local config = {
	name  = &amp;apos;Subtlety&amp;apos;,
	author  = &amp;apos;Soapbox&amp;apos;,
	abilities = {
					{ 	name	= &amp;quot;Spell Queue Type&amp;quot;,
			    tooltip = &amp;quot;Allows you to enable and select how you want Spell Queue overriding to work. It will either queue up the spell on the next GCD when you mouseover or click the ability.&amp;quot;,
				enable	= true,
				newSection  = true,
				widget	= { type = &amp;quot;select&amp;quot;,
					tooltip = &amp;quot;Select how you want to queue the next spell.&amp;quot;,
					values	= {
						&amp;quot;Click&amp;quot;,
						&amp;quot;Mouseover&amp;quot;,
					},
					width	= 80,
				},
				},
				{ 	name	= &amp;quot;Auto Target Next Enemy&amp;quot;,
					enable	= true,
				},
		{  name = &amp;quot;Opener&amp;quot;,
			enable = true,
			newSection = true,
		tooltip	= &amp;quot;|cffCC0099Starts Combat automatically when in range.&amp;quot;, 
		},
		{  name = &amp;quot;Feint Spam&amp;quot;,
			enable = false,
			newSection = true,
			tooltip	= &amp;quot;|cffCC0099Maintains Feint Buff.&amp;quot;, 
		},
		{  name = &amp;quot;Auto Marked for Death&amp;quot;,
			enable = false,
			newSection = true,
			tooltip	= &amp;quot;|cffCC0099Automatically applys Marked for Death at 0 CPs.&amp;quot;, 
		},
				{  name = &amp;quot;Frag Belt&amp;quot;,
			enable = false,
			newSection = true, 
		},
		{  name = &amp;quot;Potions&amp;quot;,
			enable = false,
		},
		{  name = &amp;quot;Vanish&amp;quot;,
			enable = true,
			newSection = true,
		},
		{  name = &amp;quot;Shadow Dance&amp;quot;,
			enable = true,
			newSection = false,
		},
		{  name = &amp;quot;Shadow Blades&amp;quot;,
			enable = true,
			newSection = false,
		},
		{  name = &amp;quot;Preparation&amp;quot;,
			enable = true,
			newSection = false,
		},
		{  name = &amp;quot;Recuperate&amp;quot;,			
			newSection = true,
			enable = false,
			widget = { type = &amp;apos;numBox&amp;apos;,
				value = 15,
				step = 5,
			},
		},
		{  name = &amp;quot;Healthstone&amp;quot;,
			enable = true,
			widget = { type = &amp;apos;numBox&amp;apos;,
				value = 65,
				step = 5,
			},
		},
	},
	hotkeys = {
		{ name = &amp;quot;Pause&amp;quot;,  					enable = true, hotkeys = {&amp;apos;ra&amp;apos;}, 
		tooltip	= &amp;quot;|cffCC0099Assign |cffFFFFFFPause |cffCC0099Keybind.&amp;quot;, },					
	},	
}
SOAPBOX_SUBTLETY = PQI:AddRotation(config)</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>---3.Com Table---</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if SOAPBOX_COMBAT then return false end

local config = {
	name  = &amp;apos;Combat&amp;apos;,
	author  = &amp;apos;Soapbox&amp;apos;,
	abilities = {
					{ 	name	= &amp;quot;Spell Queue Type&amp;quot;,
			    tooltip = &amp;quot;Allows you to enable and select how you want Spell Queue overriding to work. It will either queue up the spell on the next GCD when you mouseover or click the ability.&amp;quot;,
				enable	= true,
				newSection  = true,
				widget	= { type = &amp;quot;select&amp;quot;,
					tooltip = &amp;quot;Select how you want to queue the next spell.&amp;quot;,
					values	= {
						&amp;quot;Click&amp;quot;,
						&amp;quot;Mouseover&amp;quot;,
					},
					width	= 80,
				},
				},
				{ 	name	= &amp;quot;Auto Target Next Enemy&amp;quot;,
					enable	= true,
				},
		{   name = &amp;quot;Opener&amp;quot;,
			enable = true,
			newSection = true,
			tooltip	= &amp;quot;|cffCC0099Starts Combat automatically when in range.&amp;quot;, 
		},
		{  name = &amp;quot;Feint Spam&amp;quot;,
			enable = false,
			newSection = true,
			tooltip	= &amp;quot;|cffCC0099Maintains Feint Buff.&amp;quot;, 
		},
		{  name = &amp;quot;Auto Marked for Death&amp;quot;,
			enable = false,
			newSection = true,
			tooltip	= &amp;quot;|cffCC0099Automatically applys Marked for Death at 0 CPs.&amp;quot;, 
		},
		{  name = &amp;quot;Frag Belt&amp;quot;,
			enable = false,
			newSection = true, 
		},
		{  name = &amp;quot;Potions&amp;quot;,
			enable = false,
		},
		{  name = &amp;quot;Vanish&amp;quot;,
			enable = true,
			newSection = true,
		},
		{  name = &amp;quot;Killing Spree&amp;quot;,
			enable = true,
			newSection = false,
		},
		{  name = &amp;quot;Adrenaline Rush&amp;quot;,
			enable = true,
			newSection = false,
		},
  		{  name = &amp;quot;Shadow Blades&amp;quot;,
			enable = true,
			newSection = false,
		},
		{  name = &amp;quot;Preparation&amp;quot;,
			enable = true,
			newSection = false,
		},
		{  name = &amp;quot;Recuperate&amp;quot;,			
			newSection = true,
			enable = false,
			widget = { type = &amp;apos;numBox&amp;apos;,
				value = 15,
				step = 5,
			},
		},
		{  name = &amp;quot;Healthstone&amp;quot;,
			enable = true,
			widget = { type = &amp;apos;numBox&amp;apos;,
				value = 65,
				step = 5,
			},
		},
	},
	hotkeys = {
		{ name = &amp;quot;Pause&amp;quot;,  					enable = true, hotkeys = {&amp;apos;ra&amp;apos;}, 
		tooltip	= &amp;quot;|cffCC0099Assign |cffFFFFFFPause |cffCC0099Keybind.&amp;quot;, },					
	},		
}
SOAPBOX_COMBAT = PQI:AddRotation(config)</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>---3. Sin Table---</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if SOAPBOX_ASSASSINATION then return false end

local config = {
	name  = &amp;apos;Assassination&amp;apos;,
	author  = &amp;apos;Soapbox&amp;apos;,
	abilities = {
					{ 	name	= &amp;quot;Spell Queue Type&amp;quot;,
			    tooltip = &amp;quot;Allows you to enable and select how you want Spell Queue overriding to work. It will either queue up the spell on the next GCD when you mouseover or click the ability.&amp;quot;,
				enable	= true,
				newSection  = true,
				widget	= { type = &amp;quot;select&amp;quot;,
					tooltip = &amp;quot;Select how you want to queue the next spell.&amp;quot;,
					values	= {
						&amp;quot;Click&amp;quot;,
						&amp;quot;Mouseover&amp;quot;,
					},
					width	= 80,
				},
				},
				{ 	name	= &amp;quot;Auto Target Next Enemy&amp;quot;,
					enable	= true,
				},
		{   name = &amp;quot;Opener&amp;quot;,
			enable = true,
			newSection = true,
			tooltip	= &amp;quot;|cffCC0099Starts Combat automatically when in range.&amp;quot;, 
		},
				{  name = &amp;quot;Boss Cooldowns&amp;quot;,
			enable = true,
			newSection = true,
			tooltip	= &amp;quot;|cffCC0099Will only use cooldowns on boss targets.&amp;quot;, 
		},
		{  name = &amp;quot;Pooled Envenoms&amp;quot;,
			enable = true,
			newSection = true,
			tooltip	= &amp;quot;|cffCC0099Pools Energy before using envenom to get off 2 mutilates (Dont use with bad gear).&amp;quot;, 
		},
		{  name = &amp;quot;Feint Spam&amp;quot;,
			enable = false,
			newSection = true,
			tooltip	= &amp;quot;|cffCC0099Maintains Feint Buff.&amp;quot;, 
		},
		{  name = &amp;quot;Auto Marked for Death&amp;quot;,
			enable = false,
			newSection = true,
			tooltip	= &amp;quot;|cffCC0099Automatically applys Marked for Death at 0 CPs.&amp;quot;, 
		},
		{  name = &amp;quot;Frag Belt&amp;quot;,
			enable = false,
			newSection = true, 
		},
		{  name = &amp;quot;Synapse Springs&amp;quot;,
			enable = false,
			newSection = true, 
		},
		{  name = &amp;quot;Potions&amp;quot;,
			enable = false,
		},
		{  name = &amp;quot;Vanish&amp;quot;,
			enable = true,
			newSection = truem
		},
		{  name = &amp;quot;Vendetta&amp;quot;,
			enable = true,
			newSection = false,
		},
		{  name = &amp;quot;Shadow Blades&amp;quot;,
			enable = true,
			newSection = false,
		},
		{  name = &amp;quot;Preparation&amp;quot;,
			enable = true,
			newSection = false,
		},
		{  name = &amp;quot;Recuperate&amp;quot;,			
			newSection = true,
			enable = false,
			widget = { type = &amp;apos;numBox&amp;apos;,
				value = 15,
				step = 5,
			},
		},
		{  name = &amp;quot;Healthstone&amp;quot;,
			enable = true,
			widget = { type = &amp;apos;numBox&amp;apos;,
				value = 65,
				step = 5,
			},
		},
	},
	hotkeys = {
		{ name = &amp;quot;Pause&amp;quot;,  					enable = true, hotkeys = {&amp;apos;ra&amp;apos;}, 
		tooltip	= &amp;quot;|cffCC0099Assign |cffFFFFFFPause |cffCC0099Keybind.&amp;quot;, },					
	},	
}
SOAPBOX_ASSASSINATION = PQI:AddRotation(config)</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Assassination- Opener</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local CP, Vein, picked, Sapped, opener, StealthCD, Stealth, Energy, PremedCD, SnD, Vanish = CP, Vein, picked, Sapped, opener, StealthCD, Stealth, Energy, PremedCD, SnD, Vanish
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )

if UnitBuffID(&amp;quot;Player&amp;quot;,1856) then return false end


	if opener==1 and not IsMounted() and UnitExists(&amp;quot;target&amp;quot;) and not UnitIsDeadOrGhost(&amp;quot;player&amp;quot;) and not UnitIsDeadOrGhost(&amp;quot;target&amp;quot;) then
		if (UnitAffectingCombat(&amp;quot;player&amp;quot;)~=1 or UnitInParty(&amp;quot;player&amp;quot;) or UnitInRaid(&amp;quot;player&amp;quot;)) and not Stealth and  UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) and StealthCD &amp;lt; 1 then 
			CastSpellByName( GetSpellInfo(1784), nil )
		end
		if IsSpellInRange(tostring(GetSpellInfo(1943)), &amp;quot;target&amp;quot;) ~= 0 then
			if Stealth and UnitExists(&amp;quot;target&amp;quot;) and not (UnitCastingInfo(&amp;quot;player&amp;quot;) and select(9,UnitCastingInfo(&amp;quot;player&amp;quot;))) then
				if Nova_Pickpocket == 1 then
					if picked==true then
						ClearTarget()
					elseif picked==false then
						if not Sapped then
						CastSpellByName( GetSpellInfo(6770), nil )
						else
						RunMacroText(&amp;quot;/cast Pick Pocket&amp;quot;)
						PQR_DelayRotation(0.5) 
						end
					end
				end
				if Nova_PickpocketWithOpener == 1 then
					if picked==false then
					RunMacroText(&amp;quot;/cast Pick Pocket&amp;quot;)
					PQR_DelayRotation(0.5) 
					end
					if PQI_SoapboxAssassination_Opener_enable then 
						if Stealth and Energy &amp;gt;= 60 and picked==true then
							if UnitExists(&amp;quot;boss&amp;quot;..1) then
								local BossID = tonumber(UnitGUID(&amp;quot;boss&amp;quot;..1):sub(6,10), 16)
								if BossID == 69465 then
								CastSpellByName(GetSpellInfo(1329),&amp;quot;target&amp;quot;) 
								elseif PQR_SpellAvailable(79140) then
									if Nova_Cooldowns == 1 and PQI_SoapboxAssassination_Vendetta_enable and (SpecialUnit() or not PQI_SoapboxAssassination_BossCooldowns_enable) then
									CastSpellByName(GetSpellInfo(79140),&amp;quot;target&amp;quot;) 
									PQR_DelayRotation(1)
									else
									CastSpellByName(GetSpellInfo(1329),&amp;quot;target&amp;quot;)
									end
									if (Vendetta and Vendettatimer - GetTime() &amp;lt;= 29) then
									CastSpellByName(GetSpellInfo(1329),&amp;quot;target&amp;quot;)
									end
								else
								CastSpellByName(GetSpellInfo(1329),&amp;quot;target&amp;quot;)
								end
							elseif PQR_SpellAvailable(79140) then
								if Nova_Cooldowns == 1 and PQI_SoapboxAssassination_Vendetta_enable and (SpecialUnit() or not PQI_SoapboxAssassination_BossCooldowns_enable) then
								CastSpellByName(GetSpellInfo(79140),&amp;quot;target&amp;quot;) 
								PQR_DelayRotation(1)
								else
								CastSpellByName(GetSpellInfo(1329),&amp;quot;target&amp;quot;)
								end
								if (Vendetta and Vendettatimer - GetTime() &amp;lt;= 29) then
								CastSpellByName(GetSpellInfo(1329),&amp;quot;target&amp;quot;)
								end
							else
							CastSpellByName(GetSpellInfo(1329),&amp;quot;target&amp;quot;)
							end
						end
					end
				end
				if Nova_PickpocketWithOpener ~= 1 and Nova_Pickpocket ~= 1 then
					if PQI_SoapboxAssassination_Opener_enable then 
						if Stealth and Energy &amp;gt;= 60 then
							if UnitExists(&amp;quot;boss&amp;quot;..1) then
								local BossID = tonumber(UnitGUID(&amp;quot;boss&amp;quot;..1):sub(6,10), 16)
								if BossID == 69465 then
								CastSpellByName(GetSpellInfo(1329),&amp;quot;target&amp;quot;) 
								elseif PQR_SpellAvailable(79140) then
									if Nova_Cooldowns == 1 and PQI_SoapboxAssassination_Vendetta_enable and (SpecialUnit() or not PQI_SoapboxAssassination_BossCooldowns_enable) then
									CastSpellByName(GetSpellInfo(79140),&amp;quot;target&amp;quot;) 
									PQR_DelayRotation(1)
									else
									CastSpellByName(GetSpellInfo(1329),&amp;quot;target&amp;quot;)
									end
									if (Vendetta and Vendettatimer - GetTime() &amp;lt;= 29) then
									CastSpellByName(GetSpellInfo(1329),&amp;quot;target&amp;quot;)
									end
								else
								CastSpellByName(GetSpellInfo(1329),&amp;quot;target&amp;quot;)
								end
							elseif PQR_SpellAvailable(79140) then
								if Nova_Cooldowns == 1 and PQI_SoapboxAssassination_Vendetta_enable and (SpecialUnit() or not PQI_SoapboxAssassination_BossCooldowns_enable) then
								CastSpellByName(GetSpellInfo(79140),&amp;quot;target&amp;quot;) 
								PQR_DelayRotation(1)
								else
								CastSpellByName(GetSpellInfo(1329),&amp;quot;target&amp;quot;)
								end
								if (Vendetta and Vendettatimer - GetTime() &amp;lt;= 29) then
								CastSpellByName(GetSpellInfo(1329),&amp;quot;target&amp;quot;)
								end
							else
							CastSpellByName(GetSpellInfo(1329),&amp;quot;target&amp;quot;)
							end
						end
						if CP &amp;gt; 0 and Energy &amp;gt;= 25 and not Rupture and Stealth then
							CastSpellByName( GetSpellInfo(1943), nil )
						end
						if Rupture or CP == 0 then
							opener=0
						end
					end
				end
			elseif CP &amp;gt; 0 and Energy &amp;gt;= 25 and not Rupture and PQI_SoapboxAssassination_Opener_enable and Stealth then
				CastSpellByName( GetSpellInfo(1943), nil )
			end
			if Rupture or CP == 0 then
			opener=0
			end
		end
	end
	if PQI_SoapboxAssassination_Opener_enable then 
		if opener==0 and AoESwap and not IsMounted() and UnitExists(&amp;quot;target&amp;quot;) and not UnitIsDeadOrGhost(&amp;quot;player&amp;quot;) and not UnitIsDeadOrGhost(&amp;quot;target&amp;quot;) then
			if Stealth then
			CastSpellByName( GetSpellInfo(51723), nil )
			end
		end
	end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Combat- Opener</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local CP, Vein, picked, Sapped, opener, StealthCD, Stealth, Energy, PremedCD, SnD, Vanish = CP, Vein, picked, Sapped, opener, StealthCD, Stealth, Energy, PremedCD, SnD, Vanish
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )



	if opener==1 and not IsMounted() and UnitExists(&amp;quot;target&amp;quot;) and not UnitIsDeadOrGhost(&amp;quot;player&amp;quot;) and not UnitIsDeadOrGhost(&amp;quot;target&amp;quot;) then
		if (UnitAffectingCombat(&amp;quot;player&amp;quot;)~=1 or UnitInParty(&amp;quot;player&amp;quot;) or UnitInRaid(&amp;quot;player&amp;quot;)) and not Stealth and  UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) and StealthCD &amp;lt; 1 then 
		CastSpellByName( GetSpellInfo(1784), nil )
		end
		if IsSpellInRange(tostring(GetSpellInfo(1943)), &amp;quot;target&amp;quot;) ~= 0 then
			if Stealth and UnitExists(&amp;quot;target&amp;quot;) and not (UnitCastingInfo(&amp;quot;player&amp;quot;) and select(9,UnitCastingInfo(&amp;quot;player&amp;quot;))) then
				if Nova_Pickpocket == 1 then
					if picked==true then
						ClearTarget()
					elseif picked==false then
						if not Sapped then
							CastSpellByName( GetSpellInfo(6770), nil )
						else
							RunMacroText(&amp;quot;/cast Pick Pocket&amp;quot;)
							PQR_DelayRotation(0.5) 
						end
					end
				end
				if Nova_PickpocketWithOpener == 1 then
					if picked==false then
						RunMacroText(&amp;quot;/cast Pick Pocket&amp;quot;)
						PQR_DelayRotation(0.5) 
					end
					if PQI_SoapboxCombat_Opener_enable then 
						if Stealth and Energy &amp;gt;= 60 and picked==true then
							CastSpellByName( GetSpellInfo(8676), nil )
						end
					end
				end
				if Nova_PickpocketWithOpener ~= 1 and Nova_Pickpocket ~= 1 then
					if PQI_SoapboxCombat_Opener_enable then 
						if Stealth and Energy &amp;gt;= 60 then
							CastSpellByName( GetSpellInfo(8676), nil )
						end
						if CP == 0 then
							opener=0
						end
					end
				end
			end
		end
	end
	if PQI_SoapboxCombat_Opener_enable then 
		if opener==0 and Nova_AOE == 1 and not IsMounted() and UnitExists(&amp;quot;target&amp;quot;) and not UnitIsDeadOrGhost(&amp;quot;player&amp;quot;) and not UnitIsDeadOrGhost(&amp;quot;target&amp;quot;) then
			if Stealth then
				CastSpellByName( GetSpellInfo(51723), nil )
			end
			if not Stealth then
				StartAttack(&amp;quot;target&amp;quot;)
			end
		end
	end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>---4. Sin Toggle Key---</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if PQR_RotationStarted then
	CP = 0
	restealth = false
	

	
 ---Chat Overlay---
	local function onUpdate(self,elapsed) 
	  if self.time &amp;lt; GetTime() - 2.8 then
	    if self:GetAlpha() == 0 then self:Hide() else self:SetAlpha(self:GetAlpha() - .05) end
	  end
	end
	xrn = CreateFrame(&amp;quot;Frame&amp;quot;,nil,ChatFrame1) 
	xrn:SetSize(ChatFrame1:GetWidth(),30)
	xrn:Hide()
	xrn:SetScript(&amp;quot;OnUpdate&amp;quot;,onUpdate)
	xrn:SetPoint(&amp;quot;TOP&amp;quot;,0,0)
	xrn.text = xrn:CreateFontString(nil,&amp;quot;OVERLAY&amp;quot;,&amp;quot;MovieSubtitleFont&amp;quot;)
	xrn.text:SetAllPoints()
	xrn.texture = xrn:CreateTexture()
	xrn.texture:SetAllPoints()
	xrn.texture:SetTexture(0,0,0,.50) 
	xrn.time = 0
	function xrn:message(message) 
	  self.text:SetText(message)
	  self:SetAlpha(1)
	  self.time = GetTime() 
	  self:Show() 
	end
	
	Nova_CustomT = { }
	
	
	
	
		-- Nova Notification Frame
	-- Update Debug Frame
	Nova_NotifyFrame = nil
	function Nova_NotifyFrame_OnUpdate()
		if (Nova_NotifyFrameTime &amp;lt; GetTime() - 0.2) then
			local alpha = Nova_NotifyFrame:GetAlpha()
			if (alpha ~= 0) then Nova_NotifyFrame:SetAlpha(alpha - .5) end
			if (aplha == 0) then Nova_NotifyFrame:Hide() end
		end
	end
	-- Debug messages.
	function Nova_Notify(message)
		Nova_NotifyFrame.text:SetText(message)
		Nova_NotifyFrame:SetAlpha(1)
		Nova_NotifyFrame:Show()
		Nova_NotifyFrameTime = GetTime()
	end
	-- Debug Notification Frame
	Nova_NotifyFrame = CreateFrame(&amp;apos;Frame&amp;apos;)
	Nova_NotifyFrame:ClearAllPoints()
	Nova_NotifyFrame:SetHeight(300)
	Nova_NotifyFrame:SetWidth(300)
	Nova_NotifyFrame:SetScript(&amp;apos;OnUpdate&amp;apos;, Nova_NotifyFrame_OnUpdate)
	Nova_NotifyFrame:Hide()
	Nova_NotifyFrame.text = Nova_NotifyFrame:CreateFontString(nil, &amp;apos;BACKGROUND&amp;apos;, &amp;apos;PVPInfoTextFont&amp;apos;)
	Nova_NotifyFrame.text:SetAllPoints()
	Nova_NotifyFrame:SetPoint(&amp;apos;LEFT&amp;apos;, 40, - 75)
	Nova_NotifyFrameTime = 0
	
	function CastClick()
		if IsMouseButtonDown(1) 
	  	  and MainMenuBar:IsShown() then
	  		local mousefocus = GetMouseFocus()
			if mousefocus 
			  and mousefocus.feedback_action then 
		  		SpellCancelQueuedSpell() 
		  		PQR_DelayRotation(1) 
		  	end
		end 	
	end
	
	
	function EventHandler(self, event, ...)


		if event == &amp;quot;UNIT_COMBO_POINTS&amp;quot; then
			CP = GetComboPoints(&amp;quot;player&amp;quot;)
		end

		-- Automatic restealth
		if event == &amp;quot;PLAYER_REGEN_ENABLED&amp;quot; then
			if UnitBuffID(&amp;quot;player&amp;quot;, 1856) then return end
			restealth = GetTime()
		end

		if event == &amp;quot;PLAYER_TARGET_CHANGED&amp;quot; or event == &amp;quot;PLAYER_REGEN_ENABLED&amp;quot; then
			if UnitBuffID(&amp;quot;player&amp;quot;, 1856) then return end
			local redirect = GetSpellCooldown(73981)
			if (0 == redirect and CP &amp;gt;= 4 and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;)) then
				CastSpellByID(73981)
			end			
			-- Recuperate / Slice and Dice
			if UnitIsUnit(&amp;quot;target&amp;quot;, &amp;quot;focus&amp;quot;) then return end
			-- Recupe if not full health
			local s, _, _, _, _, _, sexpire = UnitBuffID(&amp;quot;player&amp;quot;, 73651)
			sexpire = (sexpire ~= nil) and sexpire or 0
			if CP &amp;gt; 0 and (redirect ~= 0 or CP &amp;lt; 5) and (sexpire - GetTime()) &amp;lt; 6 and (UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;)) &amp;lt; 1 then
				CastSpellByID(73651)
				return
			end
			local r, _, _, _, _, _, rexpire = UnitBuffID(&amp;quot;player&amp;quot;, 5171)
			rexpire = (rexpire ~= nil) and rexpire or 0
			-- Only cast if we have less than 5 combo points or redirect is on cooldown
			if CP &amp;gt; 0 and (redirect ~= 0 or CP &amp;lt;= 5) and (12 + (CP * 6)) &amp;gt; (rexpire - GetTime()) then
				CastSpellByID(5171)
				return
			end
		end
	end
  
	if not OurFrame then

	-- Create our frame and bind combat log events
	frame = CreateFrame(&amp;quot;FRAME&amp;quot;, &amp;quot;OurFrame&amp;quot;)
	frame:RegisterEvent(&amp;quot;UNIT_COMBO_POINTS&amp;quot;)
	frame:RegisterEvent(&amp;quot;PLAYER_REGEN_ENABLED&amp;quot;)
	frame:RegisterEvent(&amp;quot;PLAYER_TARGET_CHANGED&amp;quot;)
	frame:SetScript(&amp;quot;OnEvent&amp;quot;, EventHandler)

	print(&amp;quot;Loaded event handler&amp;quot;)

	end
  PQR_RotationStarted = false


  ----------------
  --Nova  Checks--
  ----------------
  if Nova_Cooldowns == 1 then
  PQR_WriteToChat(&amp;quot;Cooldowns: \124cFF15E615Active&amp;quot;) end
  if (Nova_AOE == nil or Nova_AOE == 0) then
  PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;Single Target&amp;quot;,nil,&amp;quot;FFFFFF&amp;quot;) end
  if Nova_AOE == 1 then			
  PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;AOE&amp;quot;,nil,&amp;quot;0698FF&amp;quot;) end
  if Nova_Cleave == 1 then	
  SetCVar(&amp;quot;Nova_Cleave&amp;quot;, 0)		
  PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;Single Target&amp;quot;,nil,&amp;quot;FFFFFF&amp;quot;) end
  if Nova_Cleave4To6 == 1 then	
  SetCVar(&amp;quot;Nova_Cleave4To6&amp;quot;, 0)		
  PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;Single Target&amp;quot;,nil,&amp;quot;FFFFFF&amp;quot;) end
  
end


if modtime == nil then
	modtime = 0
end

if PQI_SoapboxAssassination_Pause_enable then
	if PQI:IsHotkeys(PQI_SoapboxAssassination_Pause_key) and GetTime() - modtime &amp;gt; 1 
	and GetCurrentKeyBoardFocus() == nil then
	modtime = GetTime()
		if PauseSwap then 
			PauseSwap = nil
		else
			PauseSwap = 1
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>---4.Com Toggle Key---</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if PQR_RotationStarted then
	CP = 0
	restealth = false
	

 ---Chat Overlay---
	local function onUpdate(self,elapsed) 
	  if self.time &amp;lt; GetTime() - 2.8 then
	    if self:GetAlpha() == 0 then self:Hide() else self:SetAlpha(self:GetAlpha() - .05) end
	  end
	end
	xrn = CreateFrame(&amp;quot;Frame&amp;quot;,nil,ChatFrame1) 
	xrn:SetSize(ChatFrame1:GetWidth(),30)
	xrn:Hide()
	xrn:SetScript(&amp;quot;OnUpdate&amp;quot;,onUpdate)
	xrn:SetPoint(&amp;quot;TOP&amp;quot;,0,0)
	xrn.text = xrn:CreateFontString(nil,&amp;quot;OVERLAY&amp;quot;,&amp;quot;MovieSubtitleFont&amp;quot;)
	xrn.text:SetAllPoints()
	xrn.texture = xrn:CreateTexture()
	xrn.texture:SetAllPoints()
	xrn.texture:SetTexture(0,0,0,.50) 
	xrn.time = 0
	function xrn:message(message) 
	  self.text:SetText(message)
	  self:SetAlpha(1)
	  self.time = GetTime() 
	  self:Show() 
	end
	
	Nova_CustomT = { }
	
	
	
	
		-- Nova Notification Frame
	-- Update Debug Frame
	Nova_NotifyFrame = nil
	function Nova_NotifyFrame_OnUpdate()
		if (Nova_NotifyFrameTime &amp;lt; GetTime() - 0.2) then
			local alpha = Nova_NotifyFrame:GetAlpha()
			if (alpha ~= 0) then Nova_NotifyFrame:SetAlpha(alpha - .5) end
			if (aplha == 0) then Nova_NotifyFrame:Hide() end
		end
	end
	-- Debug messages.
	function Nova_Notify(message)
		Nova_NotifyFrame.text:SetText(message)
		Nova_NotifyFrame:SetAlpha(1)
		Nova_NotifyFrame:Show()
		Nova_NotifyFrameTime = GetTime()
	end
	-- Debug Notification Frame
	Nova_NotifyFrame = CreateFrame(&amp;apos;Frame&amp;apos;)
	Nova_NotifyFrame:ClearAllPoints()
	Nova_NotifyFrame:SetHeight(300)
	Nova_NotifyFrame:SetWidth(300)
	Nova_NotifyFrame:SetScript(&amp;apos;OnUpdate&amp;apos;, Nova_NotifyFrame_OnUpdate)
	Nova_NotifyFrame:Hide()
	Nova_NotifyFrame.text = Nova_NotifyFrame:CreateFontString(nil, &amp;apos;BACKGROUND&amp;apos;, &amp;apos;PVPInfoTextFont&amp;apos;)
	Nova_NotifyFrame.text:SetAllPoints()
	Nova_NotifyFrame:SetPoint(&amp;apos;LEFT&amp;apos;, 40, - 75)
	Nova_NotifyFrameTime = 0
	
	function CastClick()
		if IsMouseButtonDown(1) 
	  	  and MainMenuBar:IsShown() then
	  		local mousefocus = GetMouseFocus()
			if mousefocus 
			  and mousefocus.feedback_action then 
		  		SpellCancelQueuedSpell() 
		  		PQR_DelayRotation(1) 
		  	end
		end 	
	end
	
	
	function EventHandler(self, event, ...)


		if event == &amp;quot;UNIT_COMBO_POINTS&amp;quot; then
			CP = GetComboPoints(&amp;quot;player&amp;quot;)
		end

		-- Automatic restealth
	--	if event == &amp;quot;PLAYER_REGEN_ENABLED&amp;quot; then
	--		if UnitBuffID(&amp;quot;player&amp;quot;, 1856) then return end
	--		restealth = GetTime()
	--	end

		if event == &amp;quot;PLAYER_TARGET_CHANGED&amp;quot; or event == &amp;quot;PLAYER_REGEN_ENABLED&amp;quot; then
			if UnitBuffID(&amp;quot;player&amp;quot;, 1856) then return end
			local redirect = GetSpellCooldown(73981)
			if (0 == redirect and CP &amp;gt;= 4 and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;)) then
				CastSpellByID(73981)
			end			
			-- Recuperate / Slice and Dice
			if UnitIsUnit(&amp;quot;target&amp;quot;, &amp;quot;focus&amp;quot;) then return end
			-- Recupe if not full health
			local s, _, _, _, _, _, sexpire = UnitBuffID(&amp;quot;player&amp;quot;, 73651)
			sexpire = (sexpire ~= nil) and sexpire or 0
			if CP &amp;gt; 0 and (redirect ~= 0 or CP &amp;lt; 5) and (sexpire - GetTime()) &amp;lt; 6 and (UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;)) &amp;lt; 1 then
				CastSpellByID(73651)
				return
			end
			local r, _, _, _, _, _, rexpire = UnitBuffID(&amp;quot;player&amp;quot;, 5171)
			rexpire = (rexpire ~= nil) and rexpire or 0
			-- Only cast if we have less than 5 combo points or redirect is on cooldown
			if CP &amp;gt; 0 and (redirect ~= 0 or CP &amp;lt;= 5) and (12 + (CP * 6)) &amp;gt; (rexpire - GetTime()) then
				CastSpellByID(5171)
				return
			end
		end
	end
  
	if not OurFrame then

	-- Create our frame and bind combat log events
	frame = CreateFrame(&amp;quot;FRAME&amp;quot;, &amp;quot;OurFrame&amp;quot;)
	frame:RegisterEvent(&amp;quot;UNIT_COMBO_POINTS&amp;quot;)
	frame:RegisterEvent(&amp;quot;PLAYER_REGEN_ENABLED&amp;quot;)
	frame:RegisterEvent(&amp;quot;PLAYER_TARGET_CHANGED&amp;quot;)
	frame:SetScript(&amp;quot;OnEvent&amp;quot;, EventHandler)

	print(&amp;quot;Loaded event handler&amp;quot;)

	end
  PQR_RotationStarted = false


  ----------------
  --Nova  Checks--
  ----------------
  if Nova_Cooldowns == 1 then
  PQR_WriteToChat(&amp;quot;Cooldowns: \124cFF15E615Active&amp;quot;) end
  if (Nova_AOE == nil or Nova_AOE == 0) and (Nova_Cleave == nil or Nova_Cleave == 0) and (Nova_Cleave4To6 == nil or Nova_Cleave4To6 == 0) then
  PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;Single Target&amp;quot;,nil,&amp;quot;FFFFFF&amp;quot;) end
  if Nova_AOE == 1 then			
  PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;AOE&amp;quot;,nil,&amp;quot;0698FF&amp;quot;) end
  if Nova_Cleave == 1 then			
  PQR_Event(&amp;quot;PQR_Text&amp;quot;, &amp;quot;Cleave&amp;quot;, nil, &amp;apos;55ff00&amp;apos;) end
  if Nova_Cleave4To6 == 1 then			
  PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;Cleave 4-6 Targets&amp;quot;,nil,&amp;quot;0fffff&amp;quot;) end
  
end


if modtime == nil then
	modtime = 0
end


if PQI_SoapboxCombat_Pause_enable then
	if PQI:IsHotkeys(PQI_SoapboxCombat_Pause_key) and GetTime() - modtime &amp;gt; 1 
	and GetCurrentKeyBoardFocus() == nil then
	modtime = GetTime()
		if PauseSwap then 
			PauseSwap = nil
		else
			PauseSwap = 1
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>---4. Sub Toggle Key---</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if PQR_RotationStarted then
	CP = 0
	restealth = false
	Vein = false

	
 ---Chat Overlay---
	local function onUpdate(self,elapsed) 
	  if self.time &amp;lt; GetTime() - 2.8 then
	    if self:GetAlpha() == 0 then self:Hide() else self:SetAlpha(self:GetAlpha() - .05) end
	  end
	end
	xrn = CreateFrame(&amp;quot;Frame&amp;quot;,nil,ChatFrame1) 
	xrn:SetSize(ChatFrame1:GetWidth(),30)
	xrn:Hide()
	xrn:SetScript(&amp;quot;OnUpdate&amp;quot;,onUpdate)
	xrn:SetPoint(&amp;quot;TOP&amp;quot;,0,0)
	xrn.text = xrn:CreateFontString(nil,&amp;quot;OVERLAY&amp;quot;,&amp;quot;MovieSubtitleFont&amp;quot;)
	xrn.text:SetAllPoints()
	xrn.texture = xrn:CreateTexture()
	xrn.texture:SetAllPoints()
	xrn.texture:SetTexture(0,0,0,.50) 
	xrn.time = 0
	function xrn:message(message) 
	  self.text:SetText(message)
	  self:SetAlpha(1)
	  self.time = GetTime() 
	  self:Show() 
	end
	
	Nova_CustomT = { }
	
	
	
	
		-- Nova Notification Frame
	-- Update Debug Frame
	Nova_NotifyFrame = nil
	function Nova_NotifyFrame_OnUpdate()
		if (Nova_NotifyFrameTime &amp;lt; GetTime() - 0.2) then
			local alpha = Nova_NotifyFrame:GetAlpha()
			if (alpha ~= 0) then Nova_NotifyFrame:SetAlpha(alpha - .5) end
			if (aplha == 0) then Nova_NotifyFrame:Hide() end
		end
	end
	-- Debug messages.
	function Nova_Notify(message)
		Nova_NotifyFrame.text:SetText(message)
		Nova_NotifyFrame:SetAlpha(1)
		Nova_NotifyFrame:Show()
		Nova_NotifyFrameTime = GetTime()
	end
	-- Debug Notification Frame
	Nova_NotifyFrame = CreateFrame(&amp;apos;Frame&amp;apos;)
	Nova_NotifyFrame:ClearAllPoints()
	Nova_NotifyFrame:SetHeight(300)
	Nova_NotifyFrame:SetWidth(300)
	Nova_NotifyFrame:SetScript(&amp;apos;OnUpdate&amp;apos;, Nova_NotifyFrame_OnUpdate)
	Nova_NotifyFrame:Hide()
	Nova_NotifyFrame.text = Nova_NotifyFrame:CreateFontString(nil, &amp;apos;BACKGROUND&amp;apos;, &amp;apos;PVPInfoTextFont&amp;apos;)
	Nova_NotifyFrame.text:SetAllPoints()
	Nova_NotifyFrame:SetPoint(&amp;apos;LEFT&amp;apos;, 40, - 75)
	Nova_NotifyFrameTime = 0
	
	function CastClick()
		if IsMouseButtonDown(1) 
	  	  and MainMenuBar:IsShown() then
	  		local mousefocus = GetMouseFocus()
			if mousefocus 
			  and mousefocus.feedback_action then 
		  		SpellCancelQueuedSpell() 
		  		PQR_DelayRotation(1) 
		  	end
		end 	
	end
	
	
	function EventHandler(self, event, ...)


		if event == &amp;quot;UNIT_COMBO_POINTS&amp;quot; then
			CP = GetComboPoints(&amp;quot;player&amp;quot;)
		end

		-- Automatic restealth
		if event == &amp;quot;PLAYER_REGEN_ENABLED&amp;quot; then
			if UnitBuffID(&amp;quot;player&amp;quot;, 1856) then return end
			restealth = GetTime()
		end

		if event == &amp;quot;PLAYER_TARGET_CHANGED&amp;quot; or event == &amp;quot;PLAYER_REGEN_ENABLED&amp;quot; then
			if UnitBuffID(&amp;quot;player&amp;quot;, 1856) then return end
			local redirect = GetSpellCooldown(73981)
			if (0 == redirect and CP &amp;gt;= 4 and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;)) then
				CastSpellByID(73981)
			end			
			-- Recuperate / Slice and Dice
			if UnitIsUnit(&amp;quot;target&amp;quot;, &amp;quot;focus&amp;quot;) then return end
			-- Recupe if not full health
			local s, _, _, _, _, _, sexpire = UnitBuffID(&amp;quot;player&amp;quot;, 73651)
			sexpire = (sexpire ~= nil) and sexpire or 0
			if CP &amp;gt; 0 and (redirect ~= 0 or CP &amp;lt; 5) and (sexpire - GetTime()) &amp;lt; 6 and (UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;)) &amp;lt; 1 then
				CastSpellByID(73651)
				return
			end
			local r, _, _, _, _, _, rexpire = UnitBuffID(&amp;quot;player&amp;quot;, 5171)
			rexpire = (rexpire ~= nil) and rexpire or 0
			-- Only cast if we have less than 5 combo points or redirect is on cooldown
			if CP &amp;gt; 0 and (redirect ~= 0 or CP &amp;lt;= 5) and (12 + (CP * 6)) &amp;gt; (rexpire - GetTime()) then
				CastSpellByID(5171)
				return
			end
		end
	end
  
	if not OurFrame then

	-- Create our frame and bind combat log events
	frame = CreateFrame(&amp;quot;FRAME&amp;quot;, &amp;quot;OurFrame&amp;quot;)
	frame:RegisterEvent(&amp;quot;UNIT_COMBO_POINTS&amp;quot;)
	frame:RegisterEvent(&amp;quot;PLAYER_REGEN_ENABLED&amp;quot;)
	frame:RegisterEvent(&amp;quot;PLAYER_TARGET_CHANGED&amp;quot;)
	frame:SetScript(&amp;quot;OnEvent&amp;quot;, EventHandler)

	print(&amp;quot;Loaded event handler&amp;quot;)

	end
  PQR_RotationStarted = false


  ----------------
  --Nova  Checks--
  ----------------
  if Nova_Cooldowns == 1 then
  PQR_WriteToChat(&amp;quot;Cooldowns: \124cFF15E615Active&amp;quot;) end
  if (Nova_AOE == nil or Nova_AOE == 0) and (Nova_Cleave == nil or Nova_Cleave == 0) then
  PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;Single Target&amp;quot;,nil,&amp;quot;FFFFFF&amp;quot;) end
  if Nova_AOE == 1 then			
  PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;AOE&amp;quot;,nil,&amp;quot;0698FF&amp;quot;) end
  if Nova_Cleave == 1 then			
  PQR_Event(&amp;quot;PQR_Text&amp;quot;, &amp;quot;Cleave&amp;quot;, nil, &amp;apos;55ff00&amp;apos;) end
  if Nova_Cleave4To6 == 1 then
  SetCVar(&amp;quot;Nova_Cleave4To6&amp;quot;, 0)			
  PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;Single Target&amp;quot;,nil,&amp;quot;FFFFFF&amp;quot;) end
  
end


if modtime == nil then
	modtime = 0
end



if PQI_SoapboxSubtlety_Pause_enable then
	if PQI:IsHotkeys(PQI_SoapboxSubtlety_Pause_key) and GetTime() - modtime &amp;gt; 1 
	and GetCurrentKeyBoardFocus() == nil then
	modtime = GetTime()
		if PauseSwap then 
			PauseSwap = nil
		else
			PauseSwap = 1
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Dead CPs</Name><Default>false</Default><SpellID>1329</SpellID><Actions></Actions><Lua>if CP &amp;gt; 0 and GetComboPoints(&amp;quot;player&amp;quot;, &amp;quot;target&amp;quot;) &amp;lt; 1 and Energy &amp;gt; 109 then
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-All Spec- Frag Belt</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>for i=1,9 do
	if select(7,GetProfessionInfo(i)) == 202 then hasEngi = true end
end
if not hasEngi then return false end
local Belt = GetInventoryItemID(&amp;quot;player&amp;quot;, 6)
if not IsEquippedItem(Belt) then return false end
if GetItemCooldown(Belt) &amp;gt; 0 then return false end


if Combat == true then
	if PQI_SoapboxCombat_FragBelt_enable then
	if GetCurrentKeyBoardFocus() == nil 
	and UnitIsUnit(&amp;quot;target&amp;quot;, &amp;quot;mouseover&amp;quot;)
then
	UseItemByName(Belt)
	if SpellIsTargeting() then CameraOrSelectOrMoveStart() CameraOrSelectOrMoveStop() end
	return true
end
end
elseif Assassination == true then
	if PQI_SoapboxAssassination_FragBelt_enable then 
		if GetCurrentKeyBoardFocus() == nil 
	and UnitIsUnit(&amp;quot;target&amp;quot;, &amp;quot;mouseover&amp;quot;)
then
	UseItemByName(Belt)
	if SpellIsTargeting() then CameraOrSelectOrMoveStart() CameraOrSelectOrMoveStop() end
	return true
end
end
elseif Subtlety == true then
	if PQI_SoapboxSubtlety_FragBelt_enable then 
		if GetCurrentKeyBoardFocus() == nil 
	and UnitIsUnit(&amp;quot;target&amp;quot;, &amp;quot;mouseover&amp;quot;)
then
	UseItemByName(Belt)
	if SpellIsTargeting() then CameraOrSelectOrMoveStart() CameraOrSelectOrMoveStop() end
	return true
end
end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-All Spec- Potions</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local T2D = T2D

if Subtlety == true then
	if not PQI_SoapboxSubtlety_Potions_enable then return false end
elseif Combat == true then
	if not PQI_SoapboxCombat_Potions_enable then return false end
elseif Assassination == true then
	if not PQI_SoapboxAssassination_Potions_enable then return false end
end
if GetItemCount(76089) &amp;lt; 1 then return false end
if GetItemCooldown(76089) ~= 0 then return false end
if not SpecialUnit() then return false end
if not Bloodlust or T2D(&amp;quot;target&amp;quot;) &amp;gt; 20 then return false end
UseItemByName(76089)</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Assassination- Synapse Springs</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not PQI_SoapboxAssassination_SynapseSprings_enable then return false end


local Gloves = GetInventoryItemID(&amp;quot;player&amp;quot;, 10)

if VenCD &amp;gt; 30 and not Vendetta then
	if not Bloodlust then
	return false
	elseif T2D(&amp;quot;target&amp;quot;) &amp;gt; 15 then
	return false
	end
end

-- If we don&amp;apos;t know Engineering. Don&amp;apos;t activate.
for i=1,9 do
	if select(7,GetProfessionInfo(i)) == 202 then hasEngi = true end
end

-- Don&amp;apos;t have Engineering.
if not hasEngi then return false end

-- Item not equipped?
if not IsEquippedItem(Gloves) then return false end

-- Don&amp;apos;t use it if it&amp;apos;s on cooldown as well!
if GetItemCooldown(Gloves) &amp;gt; 0 then return false end


-- Cast Engineering Gloves
if (VenCD &amp;gt; 59 or (SB or SBCD &amp;gt; 29)) then UseItemByName(Gloves) return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Assassination- Queue</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not PQI_SoapboxAssassination_SpellQueueType_enable then return false end
local v=PQI_SoapboxAssassination_SpellQueueType_value or 1

if v == 1 then
	if IsMouseButtonDown() and UnitAffectingCombat(&amp;quot;player&amp;quot;) then
		if GetMouseFocus():GetName() ~= nil then
			SpellCancelQueuedSpell()
			RunMacroText(&amp;quot;/click &amp;quot;..GetMouseFocus():GetName())
		end
	end
elseif v == 2 then
	if GetMouseFocus():GetName() ~= nil and UnitAffectingCombat(&amp;quot;player&amp;quot;) then
		SpellCancelQueuedSpell()
		RunMacroText(&amp;quot;/click &amp;quot;..GetMouseFocus():GetName())
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Subtlety- Queue</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not PQI_SoapboxSubtlety_SpellQueueType_enable then return false end
local v=PQI_SoapboxSubtlety_SpellQueueType_value or 1

if v == 1 then
	if IsMouseButtonDown() and UnitAffectingCombat(&amp;quot;player&amp;quot;) then
		if GetMouseFocus():GetName() ~= nil then
			SpellCancelQueuedSpell()
			RunMacroText(&amp;quot;/click &amp;quot;..GetMouseFocus():GetName())
		end
	end
elseif v == 2 then
	if GetMouseFocus():GetName() ~= nil and UnitAffectingCombat(&amp;quot;player&amp;quot;) then
		SpellCancelQueuedSpell()
		RunMacroText(&amp;quot;/click &amp;quot;..GetMouseFocus():GetName())
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Combat- Queue</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not PQI_SoapboxCombat_SpellQueueType_enable then return false end
local v=PQI_SoapboxCombat_SpellQueueType_value or 1

if v == 1 then
	if IsMouseButtonDown() and UnitAffectingCombat(&amp;quot;player&amp;quot;) then
		if GetMouseFocus():GetName() ~= nil then
			SpellCancelQueuedSpell()
			RunMacroText(&amp;quot;/click &amp;quot;..GetMouseFocus():GetName())
		end
	end
elseif v == 2 then
	if GetMouseFocus():GetName() ~= nil and UnitAffectingCombat(&amp;quot;player&amp;quot;) then
		SpellCancelQueuedSpell()
		RunMacroText(&amp;quot;/click &amp;quot;..GetMouseFocus():GetName())
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Auto Target</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if GetSpecialization(&amp;quot;player&amp;quot;) == 2 and not PQI_SoapboxCombat_AutoTargetNextEnemy_enable then return false end
if GetSpecialization(&amp;quot;player&amp;quot;) == 1 and not PQI_SoapboxAssassination_AutoTargetNextEnemy_enable then return false end
if GetSpecialization(&amp;quot;player&amp;quot;) == 3 and not PQI_SoapboxSubtlety_AutoTargetNextEnemy_enable then return false end


if (UnitExists(&amp;quot;Target&amp;quot;) == nil 
or (UnitExists(&amp;quot;Target&amp;quot;) and UnitIsDead(&amp;quot;Target&amp;quot;)))
and UnitAffectingCombat(&amp;quot;Player&amp;quot;)
then TargetNearestEnemy() end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Combat- Finisher</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local Energy, CP, Rupture, Rupturetimer, Anticipation = Energy, CP, Rupture, Rupturetimer, Anticipation
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )

--run_action_list,name=finisher,if=!talent.anticipation.enabled|buff.deep_insight.up|cooldown.shadow_blades.remains&amp;lt;=11|anticipation_charges&amp;gt;=4|(buff.shadow_blades.up&amp;anticipation_charges&amp;gt;=3)
 	
 	
if CP &amp;gt; 4 then
	if not IsPlayerSpell(114015) or UnitBuffID(&amp;quot;player&amp;quot;, 84747) or SBCD &amp;lt;= 11 or (Anti and AntiCharges &amp;gt;= 4) or (ShadowBlades and (Anti and AntiCharges &amp;gt;= 3)) then
		--rupture,if=ticks_remain&amp;lt;2&amp;target.time_to_die&amp;gt;=26&amp;(active_enemies&amp;lt;2|!buff.blade_flurry.up)	
		if (Rupture and Rupturetimer - GetTime() &amp;lt; 4) or not Rupture then
			if T2D(&amp;quot;target&amp;quot;) &amp;gt;= 26 and ((Nova_AOE ~= 1 and Nova_Cleave4To6 ~= 1 and Nova_Cleave ~= 1) or (not UnitBuffID(&amp;quot;player&amp;quot;, 13877) and Nova_AOE ~= 1)) then
			CastSpellByName(GetSpellInfo(1943))
			return true
			elseif Nova_AOE == 1 then
				if CrimsonTempest then
					if CrimsonTempesttimer - GetTime() &amp;lt; 4 then
					CastSpellByName(GetSpellInfo(121411))
					return true
					end
				else
				CastSpellByName(GetSpellInfo(121411))
				return true
				end
			--eviscerate
			else
			CastSpellByName(GetSpellInfo(2098))
			return true
			end
		elseif Nova_AOE == 1 then
			if CrimsonTempest then
				if CrimsonTempesttimer - GetTime() &amp;lt; 4 then
				CastSpellByName(GetSpellInfo(121411))
				return true
				end
			else
			CastSpellByName(GetSpellInfo(121411))
			return true
			end
		--eviscerate
		else
		CastSpellByName(GetSpellInfo(2098))
		return true
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Combat- A. Generator (AOE)</Name><Default>false</Default><SpellID>51723</SpellID><Actions></Actions><Lua>--run_action_list,name=generator,if=combo_points&amp;lt;5|(talent.anticipation.enabled&amp;anticipation_charges&amp;lt;=4&amp;!dot.revealing_strike.ticking)
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )
if CP &amp;lt; 5 then
--fan_of_knives,line_cd=5,if=active_enemies&amp;gt;=4
	if Nova_AOE == 1 or Nova_Cleave4To6 == 1 then
	return true
	end
elseif IsPlayerSpell(114015) and not Anti or (Anti and AntiCharges &amp;lt;= 4) and not Reveal then
	--fan_of_knives,line_cd=5,if=active_enemies&amp;gt;=4
	if Nova_AOE == 1 or Nova_Cleave4To6 == 1 then
	return true
	end
end</Lua><RecastDelay>5000</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Combat- A. Generator</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>--run_action_list,name=generator,if=combo_points&amp;lt;5|(talent.anticipation.enabled&amp;anticipation_charges&amp;lt;=4&amp;!dot.revealing_strike.ticking)
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )
if CP &amp;lt; 5 then
	if Reveal then
		if Revealtimer - GetTime() &amp;lt; 4 then
		CastSpellByName(GetSpellInfo(84617))
		return true
		else
		CastSpellByName(GetSpellInfo(1752))
		return true
		end
	else
	CastSpellByName(GetSpellInfo(84617))
	return true
	end
elseif IsPlayerSpell(114015) and (not Anti or (Anti and AntiCharges &amp;lt;= 4)) and not Reveal then
CastSpellByName(GetSpellInfo(84617))
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Combat- B. Generator</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>--run_action_list,name=generator,if=energy&amp;gt;60|buff.deep_insight.down|buff.deep_insight.remains&amp;gt;5-combo_points
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )
if Energy &amp;gt; 60 or not DeepInsight or (DeepInsight and DeepInsighttimer - GetTime() &amp;gt; 5-CP) then
	if Reveal then
		if Revealtimer - GetTime() &amp;lt; 4 then
		CastSpellByName(GetSpellInfo(84617))
		return true
		else
		CastSpellByName(GetSpellInfo(1752))
		return true
		end
	else
	CastSpellByName(GetSpellInfo(84617))
	return true
	end
end</Lua><RecastDelay>5000</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-Combat- B. Generator (AOE)</Name><Default>false</Default><SpellID>51723</SpellID><Actions></Actions><Lua>--run_action_list,name=generator,if=energy&amp;gt;60|buff.deep_insight.down|buff.deep_insight.remains&amp;gt;5-combo_points
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )
if Energy &amp;lt; 60 or not DeepInsight or (DeepInsight and DeepInsighttimer - GetTime() &amp;gt; 5-CP) then
--fan_of_knives,line_cd=5,if=active_enemies&amp;gt;=4
	if Nova_AOE == 1 or Nova_Cleave4To6 == 1 then
	return true
	end
end</Lua><RecastDelay>5000</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-All- Ambush</Name><Default>false</Default><SpellID>8676</SpellID><Actions></Actions><Lua>if AmbushVanish then
	if GetSpecialization() == 1 then
		if not PQI_SoapboxAssassination_Vanish_enable then
		return false 
		end
	elseif GetSpecialization() == 2 then
		if not PQI_SoapboxCombat_Vanish_enable then
		return false
		end
	elseif GetSpecialization() == 3 then
		if not PQI_SoapboxSubtlety_Vanish_enable then
		return false
		end
	end
end

if AmbushVanish or AmbushShadow then
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>---GET IN MELEE RANGE---</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not IsSpellInRange(GetSpellInfo(1943), &amp;quot;target&amp;quot;) == 1 then
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability></ROGUE>