<?xml version="1.0" encoding="utf-8" ?><ROGUE><Ability><Name>All : Preparation</Name><Default>false</Default><SpellID>14185</SpellID><Actions></Actions><Lua>local start, duration, enabled = GetSpellCooldown(1856)

if duration ~= 0 and nv_CDs and SafeToCastCD() and PQR_SpellAvailable(14185) then

	local vanishCD = duration + start - GetTime()
	if  vanishCD &amp;gt; 60 and vanishCD &amp;lt; 110 then
	
		return true
	
	end

end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>All : Frag</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>-- FragBelt 
if GetInventoryItemCooldown(&amp;quot;player&amp;quot;,6) == 0 then  
        UseInventoryItem(6) 
        if SpellIsTargeting() then  
            CameraOrSelectOrMoveStart()  
            CameraOrSelectOrMoveStop()  
        end
        return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>All : Trinket</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local _,trinketcd,trinkethasuse = GetInventoryItemCooldown(&amp;quot;player&amp;quot;,14)

if trinketcd == 0 and trinkethasuse == 1 and not UnitChannelInfo(&amp;quot;player&amp;quot;) 
then UseInventoryItem(14) return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Comb : Adrenaline Rush</Name><Default>false</Default><SpellID>13750</SpellID><Actions></Actions><Lua>local ShadowBladesUP 	= Buff_Check( 121471, &amp;quot;player&amp;quot; )
local CurrentEnergy		= UnitPower(&amp;quot;player&amp;quot;)

if ShadowBladesUP or CurrentEnergy &amp;lt; 35 and nv_CDs then

	return true
	
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Comb : Ambush</Name><Default>false</Default><SpellID>8676</SpellID><Actions></Actions><Lua>return true</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Comb : Arcane Torrent</Name><Default>false</Default><SpellID>25046</SpellID><Actions></Actions><Lua>local CurrentEnergy	= UnitPower(&amp;quot;player&amp;quot;)

if CurrentEnergy &amp;lt; 75 and nv_CDs then

	return true
	
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Comb : Cooldowns</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>--Cooldowns

if not nv_RightShift then nv_RightShift = 0 end

if IsRightShiftKeyDown() and GetTime() - nv_RightShift &amp;gt; 1 then
	nv_RightShift = GetTime()
	
	if nv_CDs then 

    	nv_CDs  = false 
		PQR_WriteToChat(&amp;quot;Cooldowns: |cFFFF0000Disabled&amp;quot;,&amp;quot;Combat&amp;quot;)

  	else 
    	
		nv_CDs  = true 
		PQR_WriteToChat(&amp;quot;Cooldowns: |cFF00FF00Enabled&amp;quot;,&amp;quot;Combat&amp;quot;)

  	end
end

if not nv_RightCTRL then nv_RightCTRL = 0 end

if IsRightControlKeyDown() and GetTime() - nv_RightCTRL &amp;gt; 1 then
	nv_RightCTRL = GetTime()
	
	if nv_multi then 

    	nv_multi  = false 
		PQR_WriteToChat(&amp;quot;AoE: |cFFFF0000Disabled&amp;quot;,&amp;quot;Combat&amp;quot;)

  	else 
    	
		nv_multi  = true 
		PQR_WriteToChat(&amp;quot;AoE: |cFF00FF00Enabled&amp;quot;,&amp;quot;Combat&amp;quot;)

  	end
end

if not nv_RightAlt then nv_RightAlt = 0 end

if IsRightAltKeyDown() and GetTime() - nv_RightAlt &amp;gt; 1 then
	nv_RightAlt = GetTime()
	
	if nv_feint then 

    	nv_feint  = false 
		PQR_WriteToChat(&amp;quot;Feint: |cFFFF0000Disabled&amp;quot;,&amp;quot;Combat&amp;quot;)

  	else 
    	
		nv_feint  = true 
		PQR_WriteToChat(&amp;quot;Feint: |cFF00FF00Enabled&amp;quot;,&amp;quot;Combat&amp;quot;)

  	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Comb : Eviscerate</Name><Default>false</Default><SpellID>2098</SpellID><Actions></Actions><Lua>local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )
local CPs 					= GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; )
local DeepInsightUP			= Buff_Check( 84747, &amp;quot;player&amp;quot; )


if ( CPs == 5 and DeepInsightUP ) then

	return true
	
elseif Anti then

	if AntiCharges &amp;gt;= 4 and CPs == 5 then
	
		return true
		
	end

end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Comb : Eviscerate 2</Name><Default>false</Default><SpellID>2098</SpellID><Actions></Actions><Lua>local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )
local CPs 					= GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; )
local DeepInsightUP			= Buff_Check( 84747, &amp;quot;player&amp;quot; )


if CPs == 5 then

	return true
	
elseif Anti then

	if AntiCharges &amp;gt;= 4 and CPs == 5 then
	
		return true
		
	end

end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Comb : Killing Spree</Name><Default>false</Default><SpellID>51690</SpellID><Actions></Actions><Lua>local SnD, SnDTimeLeft 	= Buff_Check( 5171, &amp;quot;player&amp;quot; )
local ShadowBladesUP 	= Buff_Check( 121471, &amp;quot;player&amp;quot; )
local AdrenalinRushUP 	= Buff_Check( 13750, &amp;quot;player&amp;quot; )
local DeepInsightUP		= Buff_Check( 84747, &amp;quot;player&amp;quot; )
local CurrentEnergy		= UnitMana(&amp;quot;player&amp;quot;)

if not ( ShadowBladesUP or AdrenalinRushUP ) and CurrentEnergy &amp;lt; 35 and nv_CDs then

	if SnD then
	
		if SnDTimeLeft &amp;gt; 3 then
	
			return true
			
		end

	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Comb : Init</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not PQR_LoadLua(&amp;quot;PQR_notvalid.lua&amp;quot;) then
	PQR_WriteToChat(&amp;quot;PQR_notvalid.lua is missing. Rotation has been stopped.&amp;quot;, &amp;quot;Error&amp;quot;)
  	PQR_StopRotation()
  	return true
end

if PQR_RotationStarted then
	
	nv_CDs 		= false
	nv_multi 	= false
	nv_feint 	= false
	combopoints = 0
	

	-- Global
	
	BGStack = 0
	
	-- Global

	if nv_CDs then
		PQR_WriteToChat(&amp;quot;Cooldowns: |cFF00FF00Enabled&amp;quot;,&amp;quot;Combat&amp;quot;)
		PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;Cooldowns: Enabled&amp;quot;,nil,&amp;quot;00FF00&amp;quot;)
	else
		PQR_WriteToChat(&amp;quot;Cooldowns: |cFFFF0000Disabled&amp;quot;,&amp;quot;Combat&amp;quot;)
		PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;Cooldowns: Disabled&amp;quot;,nil,&amp;quot;FF0000&amp;quot;)
	end
	if nv_multi then
		PQR_WriteToChat(&amp;quot;AoE: |cFF00FF00Enabled&amp;quot;,&amp;quot;Combat&amp;quot;)
		PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;AoE: Enabled&amp;quot;,nil,&amp;quot;00FF00&amp;quot;)
	else
		PQR_WriteToChat(&amp;quot;AoE: |cFFFF0000Disabled&amp;quot;,&amp;quot;Combat&amp;quot;)
		PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;AoE: Disabled&amp;quot;,nil,&amp;quot;FF0000&amp;quot;)
	end
		if nv_feint then
		PQR_WriteToChat(&amp;quot;Feint: |cFF00FF00Enabled&amp;quot;,&amp;quot;Combat&amp;quot;)
		PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;Feint: Enabled&amp;quot;,nil,&amp;quot;00FF00&amp;quot;)
	else
		PQR_WriteToChat(&amp;quot;Feint: |cFFFF0000Disabled&amp;quot;,&amp;quot;Combat&amp;quot;)
		PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;Feint: Disabled&amp;quot;,nil,&amp;quot;FF0000&amp;quot;)
	end
	
	
	-- Create our event handler function
	function EventHandler(self, event, ...)

		-- Keeping track of combo points
		if event == &amp;quot;UNIT_COMBO_POINTS&amp;quot; then
			combopoints = GetComboPoints(&amp;quot;player&amp;quot;)
		end

		-- Automatic restealth
		--if event == &amp;quot;PLAYER_REGEN_ENABLED&amp;quot; then
		--	if UnitBuffID(&amp;quot;player&amp;quot;, 1856) then return end
		--	print(&amp;quot;\124cFF15E61CRe-stealthing&amp;quot;);
		--	restealth = GetTime()
		--end


		if event == &amp;quot;PLAYER_TARGET_CHANGED&amp;quot; or event == &amp;quot;PLAYER_REGEN_ENABLED&amp;quot; then
			if UnitBuffID(&amp;quot;player&amp;quot;, 1856) then return end
			-- Recuperate / Slice and Dice
			--if not UnitAffectingCombat(&amp;quot;player&amp;quot;) then return end
			if UnitIsUnit(&amp;quot;target&amp;quot;, &amp;quot;focus&amp;quot;) then return end
			-- Recupe if not full health
			local s, _, _, _, _, _, sexpire = UnitBuffID(&amp;quot;player&amp;quot;, 73651)
			sexpire = (sexpire ~= nil) and sexpire or 0
			if combopoints &amp;gt; 0 and (redirect ~= 0 or combopoints &amp;lt; 5) and (sexpire - GetTime()) &amp;lt; 6 and (UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;)) &amp;lt; 1 then
				CastSpellByID(73651)
				return
			end
			local r, _, _, _, _, _, rexpire = UnitBuffID(&amp;quot;player&amp;quot;, 5171)
			rexpire = (rexpire ~= nil) and rexpire or 0
			-- Only cast if we have less than 5 combo points or redirect is on cooldown
			--if combopoints &amp;gt; 0 and (redirect ~= 0 or combopoints &amp;lt; 5) and (12 + (combopoints * 6)) &amp;gt; (rexpire - GetTime()) then
			if combopoints &amp;gt; 0 and (redirect ~= 0 or combopoints &amp;lt; 5) and (rexpire - GetTime()) &amp;lt; 3 then
				CastSpellByID(5171)
				return
			end
		end
	end
  
	if not OurFrame then

	-- Create our frame and bind combat log events
	frame = CreateFrame(&amp;quot;FRAME&amp;quot;, &amp;quot;OurFrame&amp;quot;)
	frame:RegisterEvent(&amp;quot;UNIT_COMBO_POINTS&amp;quot;)
	frame:RegisterEvent(&amp;quot;PLAYER_REGEN_ENABLED&amp;quot;)
	frame:RegisterEvent(&amp;quot;PLAYER_TARGET_CHANGED&amp;quot;)
	frame:SetScript(&amp;quot;OnEvent&amp;quot;, EventHandler)

	print(&amp;quot;Loaded event handler&amp;quot;)

	end
	
	PQR_RotationStarted = false

end



-- Target enemy
if UnitAffectingCombat(&amp;quot;player&amp;quot;) and not UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) then
	TargetNearestEnemy()
end
--and not UnitExists(&amp;quot;boss1&amp;quot;)

--local targetswitch = &amp;quot;Sulik&amp;apos;shor&amp;quot;
--print(&amp;quot;searching for&amp;quot;, targetswitch)
--RunMacroText(&amp;quot;/target &amp;quot;..targetswitch)
--if UnitName(&amp;quot;target&amp;quot;) == targetswitch then
--	RunMacroText(&amp;quot;/startattack&amp;quot;)
--end

-- Maybe I&amp;apos;ll add slash commands later
if IsLeftShiftKeyDown() or IsLeftControlKeyDown() or IsMounted() then

	return true 
	
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Comb : Revealing Strike</Name><Default>false</Default><SpellID>84617</SpellID><Actions></Actions><Lua>local RvS, RvSTimeLeft 		= Debuff_Check( 84617, &amp;quot;target&amp;quot;, &amp;quot;PLAYER&amp;quot; )
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )
local CPs 					= GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; )
local DeepInsightUP			= Buff_Check( 84747, &amp;quot;player&amp;quot; )

if not DeepInsightUP then

	if Anti then
	
		if AntiCharges &amp;lt; 5 then
		
			if RvS then
			
			
				if RvSTimeLeft &amp;lt; 2 then
				
					BGTrigger()
					return true
				
				end
			
			else
				
				BGTrigger()
				return true
				
			end
		
		elseif AntiCharges &amp;gt; 4 and CPs &amp;lt; 5 then
		
			if RvS then
			
			
				if RvSTimeLeft &amp;lt; 2 then
				
					BGTrigger()
					return true
				
				end
			
			else
				
				BGTrigger()
				return true
				
			end		
		
		end
		
	
	else
	
		if RvS then
			
			if RvSTimeLeft &amp;lt; 2 then
			
				BGTrigger()
				return true
				
			end
			
		else
		
			BGTrigger()
			return true
			
		end
	
	end

elseif DeepInsightUP and CPs &amp;lt; 5 then

	if RvS then
			
		if RvSTimeLeft &amp;lt; 2 then
			
			BGTrigger()
			return true
				
		end
			
	else
		
		BGTrigger()
		return true
	
	end

end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Comb : Rupture</Name><Default>false</Default><SpellID>1943</SpellID><Actions></Actions><Lua>local Rup, RupTimeLeft 	= Debuff_Check( 1943, &amp;quot;target&amp;quot;, &amp;quot;PLAYER&amp;quot; )
local CPs 				= GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; )
local DeepInsightUP		= Buff_Check( 84747, &amp;quot;player&amp;quot; )
local BladeFlurryUP		= Buff_Check( 13877, &amp;quot;player&amp;quot; )

if Rup and CPs == 5 and not BladeFlurryUP and not nv_multi then

	if RupTimeLeft &amp;lt; 2 then
	
		return true
		
	end

elseif not Rup and CPs == 5 and not BladeFlurryUP and not nv_multi then

	return true
	
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Comb : Rupture ( DI )</Name><Default>false</Default><SpellID>1943</SpellID><Actions></Actions><Lua>local Rup, RupTimeLeft 	= Debuff_Check( 1943, &amp;quot;target&amp;quot;, &amp;quot;PLAYER&amp;quot; )
local CPs 				= GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; )
local DeepInsightUP		= Buff_Check( 84747, &amp;quot;player&amp;quot; )
local BladeFlurryUP		= Buff_Check( 13877, &amp;quot;player&amp;quot; )

if DeepInsightUP and Rup and CPs == 5 and not BladeFlurryUP and not nv_multi then

	if RupTimeLeft &amp;lt; 2 then
	
		return true
		
	end

elseif DeepInsightUP and not Rup and CPs == 5 and not BladeFlurryUP and not nv_multi then

	return true
	
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Comb : Shadow Blades</Name><Default>false</Default><SpellID>121471</SpellID><Actions></Actions><Lua>local AdrenalinRushUP = Buff_Check( 13750, &amp;quot;player&amp;quot; )

if nv_CDs and AdrenalinRushUP then

	return true

end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Comb : Sinister Strike</Name><Default>false</Default><SpellID>1752</SpellID><Actions></Actions><Lua>local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )
local CPs 					= GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; )
local DeepInsightUP			= Buff_Check( 84747, &amp;quot;player&amp;quot; )

if DeepInsightUP then

	if CPs &amp;lt; 5 then
	
		BGTrigger()
		return true
		
	end
	
elseif not DeepInsightUP then

	if Anti then
	
		if AntiCharges &amp;lt; 5 or ( AntiCharges &amp;gt; 4 and CPs &amp;lt; 5 ) then
		
			BGTrigger()
			return true
			
		end
	 
	else
	
		BGTrigger()
		return true
		
	end

end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>All : Feint</Name><Default>false</Default><SpellID>1966</SpellID><Actions></Actions><Lua>local FeintUP = Buff_Check( 1966, &amp;quot;player&amp;quot; )

if nv_feint and not FeintUP then

	return true

end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>All : Recuperate</Name><Default>false</Default><SpellID>73651</SpellID><Actions></Actions><Lua>if nv_feint and UnitBuffID(&amp;quot;player&amp;quot;,73651) == nil
and 100 * UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;) &amp;lt; 70
and GetComboPoints(&amp;quot;player&amp;quot;, &amp;quot;target&amp;quot;) &amp;gt; 0
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Comb : Slice and Dice</Name><Default>false</Default><SpellID>5171</SpellID><Actions></Actions><Lua>local SnD, SnDTimeLeft = Buff_Check( 5171, &amp;quot;player&amp;quot; )
local CPs = GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; )

if SnD and CPs &amp;gt; 0 then

	if SnDTimeLeft &amp;lt; 2 or ( SnDTimeLeft &amp;lt;15 and BGStack == 3 and CPs &amp;gt;= 4 ) then
	
		return true
		
	end

elseif not SnD and CPs &amp;gt; 0 then

	return true

end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Comb : Start</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local Shadowstep 		= Buff_Check( 36554, &amp;quot;player&amp;quot; )
if UnitIsDead(&amp;quot;target&amp;quot;)
or not UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;)
or ( (not UnitAffectingCombat(&amp;quot;player&amp;quot;) and not Shadowstep) and not UnitIsPlayer(&amp;quot;target&amp;quot;) and not Buff_Check( 115193, &amp;quot;player&amp;quot; ))
--and not SpecialAggro(&amp;quot;target&amp;quot;) 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Comb : Vanish</Name><Default>false</Default><SpellID>1856</SpellID><Actions></Actions><Lua>local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )
local CPs 					= GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; )
local ShadowBladesUP 		= Buff_Check( 121471, &amp;quot;player&amp;quot; )
local AdrenalinRushUP 		= Buff_Check( 13750, &amp;quot;player&amp;quot; )
local DeepInsightUP			= Buff_Check( 84747, &amp;quot;player&amp;quot; )
local CurrentEnergy			= UnitPower(&amp;quot;player&amp;quot;)

if nv_CDs and not nv_multi and not PQR_UnitFacing(&amp;quot;target&amp;quot;, &amp;quot;player&amp;quot;) and CurrentEnergy &amp;lt; 30 then

	if not ShadowBladesUP and not AdrenalinRushUP and ( DeepInsightUP and CPs &amp;lt; 4 ) then
	
	
	elseif not ShadowBladesUP and not AdrenalinRushUP then
	
		if Anti then
		
			if AntiCharges &amp;lt; 4 or CPs &amp;lt; 4 or ( CPs == 4 and AntiCharges &amp;lt; 5 ) then
			
				return true
			
			end
				
		else
		
			return true
		
		end
	
	end

end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>All : Expose Armor</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>--Misc
local hasTarget = UnitExists(&amp;quot;Target&amp;quot;)
local Enemy = UnitCanAttack(&amp;quot;Player&amp;quot;,&amp;quot;Target&amp;quot;)
local isDead = UnitIsDead(&amp;quot;Target&amp;quot;)

if hasTarget and Enemy and not isDead 
and ( UnitLevel(&amp;quot;target&amp;quot;) == -1 or UnitIsUnit(&amp;quot;target&amp;quot;, &amp;quot;boss1&amp;quot;) )

then
	local waBuff = select(4,UnitDebuffID(&amp;quot;Target&amp;quot;,113746))
	
	if not waBuff or waBuff &amp;lt; 3 then
		CastSpellByName(tostring(GetSpellInfo(8647)))
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>All : Feint PVP</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local playerHP = 100 * UnitHealth(&amp;quot;Player&amp;quot;) / UnitHealthMax(&amp;quot;Player&amp;quot;)
local feint = UnitBuffID(&amp;quot;Player&amp;quot;, 1966)
local ShadowDance = UnitBuffID(&amp;quot;Player&amp;quot;, 51713)

if nv_feint and UnitPower(&amp;quot;player&amp;quot;) &amp;gt; 20 and UnitAffectingCombat(&amp;quot;Player&amp;quot;) 
and playerHP &amp;lt; 75 and not feint and not ShadowDance then
    CastSpellByName(tostring(GetSpellInfo(1966)),&amp;quot;Player&amp;quot;)
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>All : Gloves</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local _,trinketcd,trinkethasuse = GetInventoryItemCooldown(&amp;quot;player&amp;quot;,10)

if trinketcd == 0 and trinkethasuse == 1 and not UnitChannelInfo(&amp;quot;player&amp;quot;) and not UnitBuffID(&amp;quot;player&amp;quot;, 1784)
then UseInventoryItem(10) return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>All : Marked for Death</Name><Default>false</Default><SpellID>137619</SpellID><Actions></Actions><Lua>if IsUsableSpell(137619) then
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>All : Shuriken</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local CP = GetComboPoints(&amp;quot;Player&amp;quot;, &amp;quot;Target&amp;quot;)
local Stealth = UnitBuffID(&amp;quot;Player&amp;quot;,1784)

if UnitPower(&amp;quot;player&amp;quot;) &amp;gt; 80 and not Stealth and CP &amp;lt; 5
and not CheckInteractDistance(&amp;quot;target&amp;quot;,3)
then CastSpellByName(&amp;quot;Shuriken Toss&amp;quot;)
return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>All : Tempest</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local Temp, TempTimeLeft 	= Debuff_Check( 122233, &amp;quot;target&amp;quot;, &amp;quot;PLAYER&amp;quot; )
local CPs 				= GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; )


if not Temp and CPs &amp;gt; 4 and nv_multi then

	CastSpellByName( GetSpellInfo(121411), nil )
	return true
	
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>--Deadly Throw</Name><Default>false</Default><SpellID>26679</SpellID><Actions></Actions><Lua>local CP = GetComboPoints(&amp;quot;Player&amp;quot;, &amp;quot;Target&amp;quot;)
local Stealth = UnitBuffID(&amp;quot;Player&amp;quot;,1784)

if UnitPower(&amp;quot;player&amp;quot;) &amp;gt; 35 and not Stealth and CP &amp;gt; 2
and not CheckInteractDistance(&amp;quot;target&amp;quot;,3) 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Assn : Ambush</Name><Default>false</Default><SpellID>8676</SpellID><Actions></Actions><Lua>return true</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Assn : Arcane Torrent</Name><Default>false</Default><SpellID>25046</SpellID><Actions></Actions><Lua>local CurrentEnergy	= UnitPower(&amp;quot;player&amp;quot;)

if CurrentEnergy &amp;lt; 75 and (nv_CDs == CD_On or (nv_CDs == CD_BossOnly and SpecialUnit())) and SafeToCastCD() then

	return true
	
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Assn : Cooldowns</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>--Cooldowns

if not nv_RightShift then nv_RightShift = 0 end

if IsRightShiftKeyDown() and GetTime() - nv_RightShift &amp;gt; 1 then
	nv_RightShift = GetTime()
	
	if nv_CDs then 

    	nv_CDs  = false 
		PQR_WriteToChat(&amp;quot;Cooldowns: |cFFFF0000Disabled&amp;quot;,&amp;quot;Assassination&amp;quot;)

  	else 
    	
		nv_CDs  = true 
		PQR_WriteToChat(&amp;quot;Cooldowns: |cFF00FF00Enabled&amp;quot;,&amp;quot;Assassination&amp;quot;)

  	end
end

if not nv_RightCTRL then nv_RightCTRL = 0 end

if IsRightControlKeyDown() and GetTime() - nv_RightCTRL &amp;gt; 1 then
	nv_RightCTRL = GetTime()
	
	if nv_multi then 

    	nv_multi  = false 
		PQR_WriteToChat(&amp;quot;AoE: |cFFFF0000Disabled&amp;quot;,&amp;quot;Assassination&amp;quot;)

  	else 
    	
		nv_multi  = true 
		PQR_WriteToChat(&amp;quot;AoE: |cFF00FF00Enabled&amp;quot;,&amp;quot;Assassination&amp;quot;)

  	end
end

if not nv_RightAlt then nv_RightAlt = 0 end

if IsRightAltKeyDown() and GetTime() - nv_RightAlt &amp;gt; 1 then
	nv_RightAlt = GetTime()
	
	if nv_feint then 

    	nv_feint  = false 
		PQR_WriteToChat(&amp;quot;Feint: |cFFFF0000Disabled&amp;quot;,&amp;quot;Assassination&amp;quot;)

  	else 
    	
		nv_feint  = true 
		PQR_WriteToChat(&amp;quot;Feint: |cFF00FF00Enabled&amp;quot;,&amp;quot;Assassination&amp;quot;)

  	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Assn : Dispatch Energy</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local CurHealth		 	= 100 * UnitHealth(&amp;quot;target&amp;quot;) / UnitHealthMax(&amp;quot;target&amp;quot;)
local Blindside 		= Buff_Check( 121153, &amp;quot;player&amp;quot; )
local Rup, RupTimeLeft 	= Debuff_Check( 1943, &amp;quot;target&amp;quot;, &amp;quot;PLAYER&amp;quot; )
local CurrentEnergy		= UnitPower(&amp;quot;player&amp;quot;)
local CPs 				= GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; )
local Env, EnvTimeLeft = Buff_Check( 32645, &amp;quot;player&amp;quot; )
local van = Buff_Check( 115193, &amp;quot;player&amp;quot; );
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )
local CurrentEnergy		= UnitPower(&amp;quot;player&amp;quot;)
local ShadowBladesUP 		= Buff_Check( 121471, &amp;quot;player&amp;quot; )
local EnergyRegen = select(2, GetPowerRegen(&amp;quot;player&amp;quot;))

if (CurHealth &amp;lt; 35 or Blindside) and not van then

	if CurrentEnergy &amp;gt; 110 then
	
		if Rup then
		
			if RupTimeLeft &amp;lt; 2 then
			
				CastSpellByName( GetSpellInfo(111240), nil )
				return true
			
			end
		
		else
		
			CastSpellByName( GetSpellInfo(111240), nil )
			return true
		
		end
	
	end
	
	-- 5cps with dispatch proc
	if Blindside and CPs &amp;gt; 4 and Rup and RupTimeLeft &amp;gt; 3 and Env and (not Anti or ((ShadowBladesUP and AntiCharges &amp;lt; 3) or (not ShadowBladesUP and AntiCharges &amp;lt; 4))) and (CurrentEnergy + (EnergyRegen * 1.5)) &amp;lt; 100 then
		CastSpellByName( GetSpellInfo(111240), nil )
		return true
	end

end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Assn : Envenom</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local CPs = GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; )
local Env, EnvTimeLeft = Buff_Check( 32645, &amp;quot;player&amp;quot; )
local Rup, RupTimeLeft 	= Debuff_Check( 1943, &amp;quot;target&amp;quot;, &amp;quot;PLAYER&amp;quot; )
local Ven, VenTimeLeft 	= Debuff_Check( 79140, &amp;quot;target&amp;quot;, &amp;quot;PLAYER&amp;quot; )
local CurrentEnergy		= UnitPower(&amp;quot;player&amp;quot;)
local ShadowBladesUP, SBTimeLeft	= Buff_Check( 121471, &amp;quot;player&amp;quot; )
local EnergyRegen = select(2, GetPowerRegen(&amp;quot;player&amp;quot;))
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )
local EnergyAfterEnvenom = CurrentEnergy + (EnergyRegen * 1.5)

--print(ttd())

-- Pooling
if CPs &amp;gt; 4 and Rup and not ShadowBladesUP and (not Anti or AntiCharges &amp;lt; 4) then

	if RupTimeLeft &amp;lt; 6 and RupTimeLeft &amp;gt; 3 and (CurrentEnergy + (EnergyRegen * (RupTimeLeft - 2)) + 25) &amp;lt; 110 then
		return
	end
	
	if RupTimeLeft &amp;lt; 3 or (RupTimeLeft &amp;gt; 3 and CurrentEnergy &amp;lt; 60 and not Ven) then
		return
	end
	
end

if CPs &amp;gt; 4 and (not Env or EnvTimeLeft &amp;lt; 1 or (EnergyAfterEnvenom &amp;gt; 100 and (Anti and AntiCharges &amp;gt; 2)) or (ShadowBladesUP and SBTimeLeft &amp;gt; 1 and EnergyAfterEnvenom &amp;gt; 90 and (Anti and AntiCharges &amp;gt; 2)))  then
	CastSpellByName( GetSpellInfo(32645), nil )
	return true
	
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Assn : Envenom SnD</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local CPs = GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; )
local SnD, SnDTimeLeft = Buff_Check( 5171, &amp;quot;player&amp;quot; )

if CPs &amp;gt;= 2 and SnD and SnDTimeLeft &amp;lt; 3 then

	CastSpellByName( GetSpellInfo(32645), nil )
	return true
	
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Assn : Fan of Knives</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local CPs 				= GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; )
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )
local van = Buff_Check( 115193, &amp;quot;player&amp;quot; );

if nv_multi and (CPs &amp;lt; 5 or (Env and EnvTimeLeft &amp;gt; 2 and (not Anti or AntiCharges &amp;lt; 5))) and not van then

	CastSpellByName( GetSpellInfo(51723), nil )
	return true

end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Assn : Gloves</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if SafeToCastCD() and not PQR_SpellAvailable(121471) and not PQR_SpellAvailable(79140) then
	UseItem(10)
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Assn : Init</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not PQR_LoadLua(&amp;quot;PQR_notvalid.lua&amp;quot;) then
	PQR_WriteToChat(&amp;quot;PQR_notvalid.lua is missing. Rotation has been stopped.&amp;quot;, &amp;quot;Error&amp;quot;)
  	PQR_StopRotation()
  	return true
end

if PQR_RotationStarted then
	
	nv_CDs 		= false
	nv_multi 	= false
	nv_feint 	= false
	combopoints = 0


	if nv_CDs then
		PQR_WriteToChat(&amp;quot;Cooldowns: |cFF00FF00Enabled&amp;quot;,&amp;quot;Assassination&amp;quot;)
		PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;Cooldowns: Enabled&amp;quot;,nil,&amp;quot;00FF00&amp;quot;)
	else
		PQR_WriteToChat(&amp;quot;Cooldowns: |cFFFF0000Disabled&amp;quot;,&amp;quot;Assassination&amp;quot;)
		PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;Cooldowns: Disabled&amp;quot;,nil,&amp;quot;FF0000&amp;quot;)
	end
	if nv_multi then
		PQR_WriteToChat(&amp;quot;AoE: |cFF00FF00Enabled&amp;quot;,&amp;quot;Assassination&amp;quot;)
		PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;AoE: Enabled&amp;quot;,nil,&amp;quot;00FF00&amp;quot;)
	else
		PQR_WriteToChat(&amp;quot;AoE: |cFFFF0000Disabled&amp;quot;,&amp;quot;Assassination&amp;quot;)
		PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;AoE: Disabled&amp;quot;,nil,&amp;quot;FF0000&amp;quot;)
	end
	if nv_feint then
		PQR_WriteToChat(&amp;quot;Feint: |cFF00FF00Enabled&amp;quot;,&amp;quot;Assassination&amp;quot;)
		PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;Feint: Enabled&amp;quot;,nil,&amp;quot;00FF00&amp;quot;)
	else
		PQR_WriteToChat(&amp;quot;Feint: |cFFFF0000Disabled&amp;quot;,&amp;quot;Assassination&amp;quot;)
		PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;Feint: Disabled&amp;quot;,nil,&amp;quot;FF0000&amp;quot;)
	end
	
	
	-- Create our event handler function
	function EventHandler(self, event, ...)

		-- Keeping track of combo points
		if event == &amp;quot;UNIT_COMBO_POINTS&amp;quot; then
			combopoints = GetComboPoints(&amp;quot;player&amp;quot;)
		end
		
		-- Automatic restealth
		--if event == &amp;quot;PLAYER_REGEN_ENABLED&amp;quot; then
		--	if UnitBuffID(&amp;quot;player&amp;quot;, 1856) then return end
		--	print(&amp;quot;\124cFF15E61CRe-stealthing&amp;quot;);
		--	restealth = GetTime()
		--end


		if event == &amp;quot;PLAYER_TARGET_CHANGED&amp;quot; or event == &amp;quot;PLAYER_REGEN_ENABLED&amp;quot; then
			if UnitBuffID(&amp;quot;player&amp;quot;, 1856) then return end
			-- Recuperate / Slice and Dice
			--if not UnitAffectingCombat(&amp;quot;player&amp;quot;) then return end
			if UnitIsUnit(&amp;quot;target&amp;quot;, &amp;quot;focus&amp;quot;) then return end
			-- Recupe if not full health
			local s, _, _, _, _, _, sexpire = UnitBuffID(&amp;quot;player&amp;quot;, 73651)
			sexpire = (sexpire ~= nil) and sexpire or 0
			if combopoints &amp;gt; 0 and (redirect ~= 0 or combopoints &amp;lt; 5) and (sexpire - GetTime()) &amp;lt; 6 and (UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;)) &amp;lt; 1 then
				CastSpellByID(73651)
				return
			end
			local r, _, _, _, _, _, rexpire = UnitBuffID(&amp;quot;player&amp;quot;, 5171)
			rexpire = (rexpire ~= nil) and rexpire or 0
			-- Only cast if we have less than 5 combo points or redirect is on cooldown
			--if combopoints &amp;gt; 0 and (redirect ~= 0 or combopoints &amp;lt; 5) and (12 + (combopoints * 6)) &amp;gt; (rexpire - GetTime()) then
			if combopoints &amp;gt; 0 and (redirect ~= 0 or combopoints &amp;lt; 5) and (rexpire - GetTime()) &amp;lt; 3 then
				CastSpellByID(5171)
				return
			end
		end
	end
  
	if not OurFrame then

	-- Create our frame and bind combat log events
	frame = CreateFrame(&amp;quot;FRAME&amp;quot;, &amp;quot;OurFrame&amp;quot;)
	frame:RegisterEvent(&amp;quot;UNIT_COMBO_POINTS&amp;quot;)
	frame:RegisterEvent(&amp;quot;PLAYER_REGEN_ENABLED&amp;quot;)
	frame:RegisterEvent(&amp;quot;PLAYER_TARGET_CHANGED&amp;quot;)
	frame:SetScript(&amp;quot;OnEvent&amp;quot;, EventHandler)

	print(&amp;quot;Loaded event handler&amp;quot;)

	end
	
	PQR_RotationStarted = false

end



-- Target enemy
if UnitAffectingCombat(&amp;quot;player&amp;quot;) and not UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) then
	TargetNearestEnemy()
end
--and not UnitExists(&amp;quot;boss1&amp;quot;)

--local targetswitch = &amp;quot;Sulik&amp;apos;shor&amp;quot;
--print(&amp;quot;searching for&amp;quot;, targetswitch)
--RunMacroText(&amp;quot;/target &amp;quot;..targetswitch)
--if UnitName(&amp;quot;target&amp;quot;) == targetswitch then
--	RunMacroText(&amp;quot;/startattack&amp;quot;)
--end

-- Maybe I&amp;apos;ll add slash commands later
if IsLeftShiftKeyDown() or IsLeftControlKeyDown() or IsMounted() then

	return true 
	
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Assn : Mutilate Energy</Name><Default>false</Default><SpellID>1329</SpellID><Actions></Actions><Lua>local CurHealth		 	= 100 * UnitHealth(&amp;quot;target&amp;quot;) / UnitHealthMax(&amp;quot;target&amp;quot;)
local Rup, RupTimeLeft 	= Debuff_Check( 1943, &amp;quot;target&amp;quot;, &amp;quot;PLAYER&amp;quot; )
local CurrentEnergy		= UnitPower(&amp;quot;player&amp;quot;)
local CPs 				= GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; )

if CurHealth &amp;gt; 35 then

	if CurrentEnergy &amp;gt; 110 then
	
		if Rup then
		
			if RupTimeLeft &amp;lt; 2 then
			
				return true
			
			end
		
		else
			return true
		
		end
	
	end

end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Assn : Rupture</Name><Default>false</Default><SpellID>1943</SpellID><Actions></Actions><Lua>local Rup, RupTimeLeft 	= Debuff_Check( 1943, &amp;quot;target&amp;quot;, &amp;quot;PLAYER&amp;quot; )
local CPs 				= GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; )

--if Rup and ttd() &amp;gt;= 25 then
if Rup then

	if CPs &amp;gt; 0 and RupTimeLeft &amp;lt; 2 then
	
		return true
		
	end
		
else

	return true
	
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Assn : Rupture PVP</Name><Default>false</Default><SpellID>1943</SpellID><Actions></Actions><Lua>local Rup, RupTimeLeft 	= Debuff_Check( 1943, &amp;quot;target&amp;quot;, &amp;quot;PLAYER&amp;quot; )
local Garrote = Debuff_Check( 703, &amp;quot;target&amp;quot;, &amp;quot;PLAYER&amp;quot; )
local CPs = GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; )

if Rup then

	if CPs &amp;gt; 4 and RupTimeLeft &amp;lt; 3 and not Garrote then
	
		return true
		
	elseif CPs &amp;gt; 1 and RupTimeLeft &amp;lt; 2 and not Garrote then
	
		return true
		
	end
		
else

	return true
	
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Assn : Shadow Blades</Name><Default>false</Default><SpellID>121471</SpellID><Actions></Actions><Lua>local CurrentEnergy = UnitPower(&amp;quot;player&amp;quot;)
local Rup, RupTimeLeft 	= Debuff_Check( 1943, &amp;quot;target&amp;quot;, &amp;quot;PLAYER&amp;quot; )
local VenStart, VenDuration = GetSpellCooldown(79140);
if nv_CDs and not nv_multi and (VenStart + VenDuration - GetTime()) &amp;lt; 119.1 and Rup and RupTimeLeft &amp;gt; 2 and SafeToCastCD() then

	return true

end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Assn : Slice and Dice</Name><Default>false</Default><SpellID>5171</SpellID><Actions></Actions><Lua>local SnD, SnDTimeLeft = Buff_Check( 5171, &amp;quot;player&amp;quot; )
local CPs = GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; )

if SnD and CPs &amp;gt; 0 then

	if SnDTimeLeft &amp;lt; 2 then
	
		return true
		
	end

elseif not SnD and CPs &amp;gt; 0 then

	return true

end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Assn : Start</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local Shadowstep 		= Buff_Check( 36554, &amp;quot;player&amp;quot; )
if UnitIsDead(&amp;quot;target&amp;quot;)
or not UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;)
or ( (not UnitAffectingCombat(&amp;quot;player&amp;quot;) and not Shadowstep) and not UnitIsPlayer(&amp;quot;target&amp;quot;) and not Buff_Check( 115193, &amp;quot;player&amp;quot; ))
then return true end

--and not SpecialAggro(&amp;quot;target&amp;quot;)</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Assn : Stealth</Name><Default>false</Default><SpellID>1784</SpellID><Actions></Actions><Lua>if restealth and (GetTime() - restealth) &amp;gt; 3 and 0 == GetNumLootItems() and PQR_SpellAvailable(1784) then
	--print(GetSpellCooldown(1784))
	return true
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Assn : Vanish</Name><Default>false</Default><SpellID>1856</SpellID><Actions></Actions><Lua>local CPs 					= GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; )
local ShadowBladesUP 		= Buff_Check( 121471, &amp;quot;player&amp;quot; )
local CurrentEnergy			= UnitPower(&amp;quot;player&amp;quot;)
local Rup, RupTimeLeft 	= Debuff_Check( 1943, &amp;quot;target&amp;quot;, &amp;quot;PLAYER&amp;quot; )
local Blindside 		= Buff_Check( 121153, &amp;quot;player&amp;quot; )
local Env, EnvTimeLeft = Buff_Check( 32645, &amp;quot;player&amp;quot; )
local van = Buff_Check( 115193, &amp;quot;player&amp;quot; );

if nv_CDs and not nv_multi and SafeToCastCD() and CPs &amp;lt; 5 and CurrentEnergy &amp;lt; 60 and not PQR_SpellAvailable(121471) and not Blindside and (not Env or EnvTimeLeft &amp;lt; 1) and Rup and RupTimeLeft &amp;gt; 2 then

	if not ShadowBladesUP  then

		return true
	
	end

end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Assn : Vendetta</Name><Default>false</Default><SpellID>79140</SpellID><Actions></Actions><Lua>local CurrentEnergy		= UnitPower(&amp;quot;player&amp;quot;) 
local ShadowBladesUP 		= Buff_Check( 121471, &amp;quot;player&amp;quot; )
local Rup, RupTimeLeft 	= Debuff_Check( 1943, &amp;quot;target&amp;quot;, &amp;quot;PLAYER&amp;quot; )
if nv_CDs and not nv_multi and SafeToCastCD() and Rup and RupTimeLeft &amp;gt; 2 then

	return true

end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Sub : Ambush</Name><Default>false</Default><SpellID>8676</SpellID><Actions>/cast Premeditation</Actions><Lua>-- if GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; ) &amp;lt; 5 then

	return true
	
-- end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Sub : Backstab</Name><Default>false</Default><SpellID>53</SpellID><Actions></Actions><Lua>if not UnitBuffID( &amp;quot;player&amp;quot;, 1784 ) and not UnitBuffID( &amp;quot;player&amp;quot;, 11327 ) and not UnitBuffID( &amp;quot;player&amp;quot;, 51713 ) then

	if GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; ) &amp;lt; 5  then

		if UnitPower( &amp;quot;player&amp;quot; ) &amp;gt; 35 then
		
			return true
			
		end
		
	end
	
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Sub : Cooldowns</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>--Cooldowns

if not nv_RightShift then nv_RightShift = 0 end

if IsRightShiftKeyDown() and GetTime() - nv_RightShift &amp;gt; 1 then
	nv_RightShift = GetTime()
	
	if nv_CDs then 

    	nv_CDs  = false 
		PQR_WriteToChat(&amp;quot;Cooldowns: |cFFFF0000Disabled&amp;quot;,&amp;quot;Subtlety&amp;quot;)

  	else 
    	
		nv_CDs  = true 
		PQR_WriteToChat(&amp;quot;Cooldowns: |cFF00FF00Enabled&amp;quot;,&amp;quot;Subtlety&amp;quot;)

  	end
end

if not nv_RightCTRL then nv_RightCTRL = 0 end

if IsRightControlKeyDown() and GetTime() - nv_RightCTRL &amp;gt; 1 then
	nv_RightCTRL = GetTime()
	
	if nv_multi then 

    	nv_multi  = false 
		PQR_WriteToChat(&amp;quot;AoE: |cFFFF0000Disabled&amp;quot;,&amp;quot;Subtlety&amp;quot;)

  	else 
    	
		nv_multi  = true 
		PQR_WriteToChat(&amp;quot;AoE: |cFF00FF00Enabled&amp;quot;,&amp;quot;Subtlety&amp;quot;)

  	end
end

if not nv_RightAlt then nv_RightAlt = 0 end

if IsRightAltKeyDown() and GetTime() - nv_RightAlt &amp;gt; 1 then
	nv_RightAlt = GetTime()
	
	if nv_feint then 

    	nv_feint  = false 
		PQR_WriteToChat(&amp;quot;Feint: |cFFFF0000Disabled&amp;quot;,&amp;quot;Subtlety&amp;quot;)

  	else 
    	
		nv_feint  = true 
		PQR_WriteToChat(&amp;quot;Feint: |cFF00FF00Enabled&amp;quot;,&amp;quot;Subtlety&amp;quot;)

  	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Sub : Eviscerate</Name><Default>false</Default><SpellID>2098</SpellID><Actions></Actions><Lua>if GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; ) &amp;gt; 4 then

	return true
	
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Sub : Hemorrhage</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not UnitBuffID( &amp;quot;player&amp;quot;, 115191 ) and not UnitBuffID( &amp;quot;player&amp;quot;, 31665 ) and not UnitBuffID( &amp;quot;player&amp;quot;, 51713 ) then

	if  GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; ) &amp;lt; 5  then
	
		if UnitDebuffID( &amp;quot;target&amp;quot;, 89775 ) == nil then
		
			CastSpellByName( GetSpellInfo(16511), nil )	
			return true
			
		end
	
	end
	
	if ( PQR_UnitFacing(&amp;quot;target&amp;quot;, &amp;quot;player&amp;quot;) or PQR_NotBehindTarget() ) and ( GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; ) &amp;lt; 5) then

		
			CastSpellByName( GetSpellInfo(16511), nil )	
			return true

	
	elseif not PQR_UnitFacing( &amp;quot;target&amp;quot;, &amp;quot;player&amp;quot; ) and ( GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; ) == 4 and UnitPower( &amp;quot;player&amp;quot; ) &amp;gt; 79 ) then
		
			CastSpellByName( GetSpellInfo(16511), nil )	
			return true
		
	end
	
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Sub : Init</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not PQR_LoadLua(&amp;quot;PQR_notvalid.lua&amp;quot;) then
	PQR_WriteToChat(&amp;quot;PQR_notvalid.lua is missing. Rotation has been stopped.&amp;quot;, &amp;quot;Error&amp;quot;)
  	PQR_StopRotation()
  	return true
end

if PQR_RotationStarted then
	
	nv_CDs 		= false
	nv_multi 	= false
	nv_feint 	= false
	combopoints = 0


	if nv_CDs then
		PQR_WriteToChat(&amp;quot;Cooldowns: |cFF00FF00Enabled&amp;quot;,&amp;quot;Subtlety&amp;quot;)
		PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;Cooldowns: Enabled&amp;quot;,nil,&amp;quot;00FF00&amp;quot;)
	else
		PQR_WriteToChat(&amp;quot;Cooldowns: |cFFFF0000Disabled&amp;quot;,&amp;quot;Subtlety&amp;quot;)
		PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;Cooldowns: Disabled&amp;quot;,nil,&amp;quot;FF0000&amp;quot;)
	end
	if nv_multi then
		PQR_WriteToChat(&amp;quot;AoE: |cFF00FF00Enabled&amp;quot;,&amp;quot;Subtlety&amp;quot;)
		PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;AoE: Enabled&amp;quot;,nil,&amp;quot;00FF00&amp;quot;)
	else
		PQR_WriteToChat(&amp;quot;AoE: |cFFFF0000Disabled&amp;quot;,&amp;quot;Subtlety&amp;quot;)
		PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;AoE: Disabled&amp;quot;,nil,&amp;quot;FF0000&amp;quot;)
	end
	if nv_feint then
		PQR_WriteToChat(&amp;quot;Feint: |cFF00FF00Enabled&amp;quot;,&amp;quot;Subtlety&amp;quot;)
		PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;Feint: Enabled&amp;quot;,nil,&amp;quot;00FF00&amp;quot;)
	else
		PQR_WriteToChat(&amp;quot;Feint: |cFFFF0000Disabled&amp;quot;,&amp;quot;Subtlety&amp;quot;)
		PQR_Event(&amp;quot;PQR_Text&amp;quot;,&amp;quot;Feint: Disabled&amp;quot;,nil,&amp;quot;FF0000&amp;quot;)
	end
	
	
	-- Create our event handler function
	function EventHandler(self, event, ...)

		-- Keeping track of combo points
		if event == &amp;quot;UNIT_COMBO_POINTS&amp;quot; then
			combopoints = GetComboPoints(&amp;quot;player&amp;quot;)
		end

		-- Automatic restealth
		--if event == &amp;quot;PLAYER_REGEN_ENABLED&amp;quot; then
		--	if UnitBuffID(&amp;quot;player&amp;quot;, 1856) then return end
		--	print(&amp;quot;\124cFF15E61CRe-stealthing&amp;quot;);
		--	restealth = GetTime()
		--end

		if event == &amp;quot;PLAYER_TARGET_CHANGED&amp;quot; or event == &amp;quot;PLAYER_REGEN_ENABLED&amp;quot; then
			if UnitBuffID(&amp;quot;player&amp;quot;, 1856) then return end
			-- Recuperate / Slice and Dice
			--if not UnitAffectingCombat(&amp;quot;player&amp;quot;) then return end
			if UnitIsUnit(&amp;quot;target&amp;quot;, &amp;quot;focus&amp;quot;) then return end
			-- Recupe if not full health
			local s, _, _, _, _, _, sexpire = UnitBuffID(&amp;quot;player&amp;quot;, 73651)
			sexpire = (sexpire ~= nil) and sexpire or 0
			if combopoints &amp;gt; 0 and (redirect ~= 0 or combopoints &amp;lt; 5) and (sexpire - GetTime()) &amp;lt; 6 and (UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;)) &amp;lt; 1 then
				CastSpellByID(73651)
				return
			end
			local r, _, _, _, _, _, rexpire = UnitBuffID(&amp;quot;player&amp;quot;, 5171)
			rexpire = (rexpire ~= nil) and rexpire or 0
			-- Only cast if we have less than 5 combo points or redirect is on cooldown
			--if combopoints &amp;gt; 0 and (redirect ~= 0 or combopoints &amp;lt; 5) and (12 + (combopoints * 6)) &amp;gt; (rexpire - GetTime()) then
			if combopoints &amp;gt; 0 and (redirect ~= 0 or combopoints &amp;lt; 5) and (rexpire - GetTime()) &amp;lt; 3 then
				CastSpellByID(5171)
				return
			end
		end
	end
  
	if not OurFrame then

	-- Create our frame and bind combat log events
	frame = CreateFrame(&amp;quot;FRAME&amp;quot;, &amp;quot;OurFrame&amp;quot;)
	frame:RegisterEvent(&amp;quot;UNIT_COMBO_POINTS&amp;quot;)
	frame:RegisterEvent(&amp;quot;PLAYER_REGEN_ENABLED&amp;quot;)
	frame:RegisterEvent(&amp;quot;PLAYER_TARGET_CHANGED&amp;quot;)
	frame:SetScript(&amp;quot;OnEvent&amp;quot;, EventHandler)

	print(&amp;quot;Loaded event handler&amp;quot;)

	end
	
	PQR_RotationStarted = false

end


-- Target enemy
if UnitAffectingCombat(&amp;quot;player&amp;quot;) and not UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) then
	TargetNearestEnemy()
end
--and not UnitExists(&amp;quot;boss1&amp;quot;)

--local targetswitch = &amp;quot;Sulik&amp;apos;shor&amp;quot;
--print(&amp;quot;searching for&amp;quot;, targetswitch)
--RunMacroText(&amp;quot;/target &amp;quot;..targetswitch)
--if UnitName(&amp;quot;target&amp;quot;) == targetswitch then
--	RunMacroText(&amp;quot;/startattack&amp;quot;)
--end

-- Maybe I&amp;apos;ll add slash commands later
if IsLeftShiftKeyDown() or IsLeftControlKeyDown() or IsMounted() then

	return true 
	
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Sub : Pooling Shadow Dance</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>--Test

local start, duration, enabled = GetSpellCooldown(51713);


--Test
if nv_CDs and not nv_multi then

	if PQR_SpellAvailable(51713) and not UnitDebuffID( &amp;quot;target&amp;quot;, 91021, &amp;quot;PLAYER&amp;quot; ) and not ( UnitBuffID( &amp;quot;player&amp;quot;, 115191 ) or UnitBuffID( &amp;quot;player&amp;quot;, 115193 ) ) then

		if GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; ) &amp;lt; 5 then
	
			if UnitPower( &amp;quot;player&amp;quot; ) &amp;lt; 75 then
		
				return true
					
			end
	
		end

	end
	
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Sub : Premeditation</Name><Default>false</Default><SpellID>14183</SpellID><Actions></Actions><Lua>if GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; ) &amp;lt; 4 then

	return true
	
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Sub : Premeditation PVP</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local sa = PQR_SpellAvailable(14183)
local Enemy = UnitCanAttack(&amp;quot;Player&amp;quot;,&amp;quot;Target&amp;quot;)


if not SpellIsTargeting()
or  UnitExists(&amp;quot;Target&amp;quot;)
or not UnitIsDeadOrGhost(&amp;quot;Player&amp;quot;) 
or not UnitIsDeadOrGhost(&amp;quot;Target&amp;quot;)
or not UnitAffectingCombat(&amp;quot;Player&amp;quot;)then


if GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; ) &amp;lt; 4 and Enemy and sa  then
   CastSpellByName(tostring(GetSpellInfo(14183)),&amp;quot;Target&amp;quot;)
end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Sub : Rupture</Name><Default>false</Default><SpellID>1943</SpellID><Actions></Actions><Lua>local Garrote = Debuff_Check( 703, &amp;quot;target&amp;quot;, &amp;quot;PLAYER&amp;quot; )


if GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; ) &amp;gt; 4 and not nv_multi and not Garrote then

		if UnitDebuffID( &amp;quot;target&amp;quot;, 1943, &amp;quot;PLAYER&amp;quot; ) == nil then
	
			return true
		
		elseif select(7,  UnitDebuffID( &amp;quot;target&amp;quot;, 1943, &amp;quot;PLAYER&amp;quot; ) ) - GetTime() &amp;lt; 3 then
	
		return true
		
	end

end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Sub : Shadow Blades</Name><Default>false</Default><SpellID>121471</SpellID><Actions></Actions><Lua>if nv_CDs and not nv_multi and not UnitBuffID( &amp;quot;player&amp;quot;, 51713 ) then

	return true

end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Sub : Shadow Dance</Name><Default>false</Default><SpellID>51713</SpellID><Actions>/use 10</Actions><Lua>if nv_CDs and not nv_multi and not UnitBuffID( &amp;quot;player&amp;quot;, 121471 ) then

	if  GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; ) &amp;lt; 3 and not UnitDebuffID( &amp;quot;target&amp;quot;, 91021, &amp;quot;PLAYER&amp;quot; ) and not ( UnitBuffID( &amp;quot;player&amp;quot;, 115191 ) or UnitBuffID( &amp;quot;player&amp;quot;, 115193 ) ) then
	
		if UnitPower( &amp;quot;player&amp;quot; ) &amp;gt; 74 then

			return true		
		
		end

	end

end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Sub : Slice and Dice</Name><Default>false</Default><SpellID>5171</SpellID><Actions></Actions><Lua>if GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; ) &amp;gt; 4 then

	if UnitBuffID( &amp;quot;player&amp;quot;, 5171 ) == nil then
	
		return true
		
	elseif select(7, UnitBuffID( &amp;quot;player&amp;quot;, 5171 ) ) - GetTime() &amp;lt; 3 then
	
		return true
		
	end

end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Sub : Start</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local Shadowstep 		= Buff_Check( 36554, &amp;quot;player&amp;quot; )
if UnitIsDead(&amp;quot;target&amp;quot;)
or not UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;)
or ( (not UnitAffectingCombat(&amp;quot;player&amp;quot;) and not Shadowstep) and not UnitIsPlayer(&amp;quot;target&amp;quot;) and not Buff_Check( 115193, &amp;quot;player&amp;quot; ))
then return true end
--and not SpecialAggro(&amp;quot;target&amp;quot;)</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Sub : Pooling Vanish</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>--Test

local start, duration, enabled = GetSpellCooldown(51713);
-- if start ~= 0 then print( start + duration - GetTime() ) end

--Test
if not nv_multi and GetSpellCooldown(14183) == 0 then

	if PQR_SpellAvailable(1856) and not PQR_SpellAvailable(51713) 
	and not UnitDebuffID( &amp;quot;target&amp;quot;, 91021, &amp;quot;PLAYER&amp;quot; ) 
	and not ( UnitBuffID( &amp;quot;player&amp;quot;, 115191 ) or UnitBuffID( &amp;quot;player&amp;quot;, 115193 ) ) 
	and not UnitBuffID( &amp;quot;player&amp;quot;, 51713 ) 
	then

		if GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; ) &amp;lt; 5 then
	
			if UnitPower( &amp;quot;player&amp;quot; ) &amp;lt; 59 then

				return true

			end
	
		end

	end
	
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Sub : Vanish</Name><Default>false</Default><SpellID>1856</SpellID><Actions></Actions><Lua>if not nv_multi and not PQR_SpellAvailable(51713) and GetSpellCooldown(14183) == 0 then
--nv_CDs and
	if  GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; ) &amp;lt; 5 and not UnitDebuffID( &amp;quot;target&amp;quot;, 91021, &amp;quot;PLAYER&amp;quot; ) 
	    and not ( UnitBuffID( &amp;quot;player&amp;quot;, 115191 ) or UnitBuffID( &amp;quot;player&amp;quot;, 115193 ) ) 
	    and not UnitBuffID( &amp;quot;player&amp;quot;, 51713 ) and not PQR_UnitFacing(&amp;quot;target&amp;quot;, &amp;quot;player&amp;quot;)
	    then
	
		if UnitPower( &amp;quot;player&amp;quot; ) &amp;gt; 59 then

					return true

		end

	end

end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Comb : Gloves</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local AdrenalinRushUP = Buff_Check( 13750, &amp;quot;player&amp;quot; )
local DeepInsightUP			= Buff_Check( 84747, &amp;quot;player&amp;quot; )
local _,trinketcd,trinkethasuse = GetInventoryItemCooldown(&amp;quot;player&amp;quot;,10)

if trinketcd == 0 and trinkethasuse == 1 and not UnitChannelInfo(&amp;quot;player&amp;quot;) and AdrenalinRushUP and not UnitBuffID(&amp;quot;player&amp;quot;, 1784)
then UseInventoryItem(10) return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Assn : Mutilate</Name><Default>false</Default><SpellID>1329</SpellID><Actions></Actions><Lua>local CPs = GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; )
local van = Buff_Check( 115193, &amp;quot;player&amp;quot; );
local vstart, vduration = GetSpellCooldown(1856);
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )
local Env, EnvTimeLeft = Buff_Check( 32645, &amp;quot;player&amp;quot; )
local Rup, RupTimeLeft 	= Debuff_Check( 1943, &amp;quot;target&amp;quot;, &amp;quot;PLAYER&amp;quot; )
local Blindside 		= Buff_Check( 121153, &amp;quot;player&amp;quot; )

if van and (vstart + vduration - GetTime()) &amp;gt; 119.9 then return end

if CPs &amp;lt; 5 or (Env and EnvTimeLeft &amp;gt; 2 and (not Anti or AntiCharges &amp;lt; 3)) then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Assn : Dispatch</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local CPs 				= GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; )
local CurHealth		 	= 100 * UnitHealth(&amp;quot;target&amp;quot;) / UnitHealthMax(&amp;quot;target&amp;quot;)
local CurrentEnergy		= UnitPower(&amp;quot;player&amp;quot;)
local EnergyRegen = select(2, GetPowerRegen(&amp;quot;player&amp;quot;))
local Blindside 		= Buff_Check( 121153, &amp;quot;player&amp;quot; )
local ShadowBladesUP 		= Buff_Check( 121471, &amp;quot;player&amp;quot; )
local van = Buff_Check( 115193, &amp;quot;player&amp;quot; );
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )
local Env, EnvTimeLeft = Buff_Check( 32645, &amp;quot;player&amp;quot; )

if Blindside
	and not van
	and (CPs &amp;lt; 5
	or (Env
		and EnvTimeLeft &amp;gt; 2 
		and (not Anti
			or (ShadowBladesUP and AntiCharges &amp;lt; 3 and (CurrentEnergy + (EnergyRegen * 1.5)) &amp;lt; 100)
			or (not ShadowBladesUP and AntiCharges &amp;lt; 4)
			)
		)
	)
then

	CastSpellByName( GetSpellInfo(111240), nil )
	return true

elseif CurHealth &amp;lt; 35
	and not van
	and (CPs &amp;lt; 5 
	or (Env 
		and EnvTimeLeft &amp;gt; 2
		and (not Anti
			or (ShadowBladesUP and AntiCharges &amp;lt; 3)
			or (not ShadowBladesUP and AntiCharges &amp;lt; 4)
			)
		)
	)
then

	CastSpellByName( GetSpellInfo(111240), nil )
	return true

end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Sub : Garrote</Name><Default>false</Default><SpellID>703</SpellID><Actions>/cast Premeditation</Actions><Lua>local Rup, RupTimeLeft 	= Debuff_Check( 1943, &amp;quot;target&amp;quot;, &amp;quot;PLAYER&amp;quot; )


if UnitBuffID( &amp;quot;player&amp;quot;, 1784 ) and not Rup then 
	return true
	end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Sub : Backstab 2</Name><Default>false</Default><SpellID>53</SpellID><Actions></Actions><Lua>if not UnitBuffID( &amp;quot;player&amp;quot;, 1784 ) and not UnitBuffID( &amp;quot;player&amp;quot;, 11327 ) and not UnitBuffID( &amp;quot;player&amp;quot;, 51713 ) then

	if GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; ) &amp;lt; 5  and not PQR_NotBehindTarget() then

		if UnitPower( &amp;quot;player&amp;quot; ) &amp;gt; 35 then
		
			return true
			
		end
		
	end
	
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>--Stealther&amp;apos;s Bane</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>--RedRussian&amp;apos;s &amp;quot;Stealthers&amp;apos; Bane&amp;quot;

local rescan_period = 2 --how often stealthed list is repopulated

local function IsStealthed(unit) --check if unit is stealthed
stealth, prowl, shadowmeld = 1784, 5215, 58984 --list of detectable stealth buffs may be incomplete!
	return ( UnitBuffID(unit, stealth) or UnitBuffID(unit, prowl) or UnitBuffID(unit, shadowmeld) )
end

local function Breaker() --instant stealth breaker, class dependent
_, playerClass = UnitClass(&amp;quot;player&amp;quot;)
	if playerClass == &amp;quot;WARRIOR&amp;quot; then
		return 57755 --Heroic Throw
	elseif playerClass == &amp;quot;PALADIN&amp;quot; then
		if PQR_SpellAvailable(879) then
			return 879 --Exorcism
		else	
			return 20271 --Judgment
		end	
	elseif playerClass == &amp;quot;HUNTER&amp;quot; then
		return 1978 --Serpent Sting
	elseif playerClass == &amp;quot;ROGUE&amp;quot; then
		if IsStealthed(&amp;apos;player&amp;apos;) then
			return 6770 --Sap
		else
			return 121733 --Throw
		end
	elseif playerClass == &amp;quot;PRIEST&amp;quot; then
		return 589 --Shadow Word: Pain
	elseif playerClass == &amp;quot;DEATHKNIGHT&amp;quot; then
		return 45524 --Chains of Ice
	elseif playerClass == &amp;quot;SHAMAN&amp;quot; then
		return 8056 --Frost Shock
	elseif playerClass == &amp;quot;MAGE&amp;quot; then
		return 30455 --Ice Lance
	elseif playerClass == &amp;quot;WARLOCK&amp;quot; then
		return 77799 --Fel Flame
	elseif playerClass == &amp;quot;MONK&amp;quot; then
		return 115546 --Taunt
	elseif playerClass == &amp;quot;DRUID&amp;quot; then
		if IsStealthed(&amp;apos;player&amp;apos;) then
			return 0 --do nothing
		elseif ( not IsStealthed(&amp;apos;player&amp;apos;) and PQR_SpellAvailable(770) ) then
			return 770 --fairy fire
		elseif 	not ( IsStealthed(&amp;apos;player&amp;apos;) or PQR_SpellAvailable(770) ) then
			return 8921 --moonfire
		end
	else
		return 0 
	end
end

local breakername = GetSpellInfo(Breaker()) --localized breaker name for use with IsSpellInRange


------------------------BG/RBG--------------------------------
--get player&amp;apos;s faction
if ( not last_faction_check or GetTime()-last_faction_check &amp;gt;= 60 ) then
local pname = UnitName(&amp;apos;player&amp;apos;) --player&amp;apos;s name
	for j=1,GetNumBattlefieldScores() do --get player faction to make profile work in rbgs and arenas
	local name, killingBlows, honorableKills, deaths, honorGained, faction, rank, race, class = GetBattlefieldScore(j) 
		if name == pname then 
		pfaction = faction
		break
		end 
	end
end

--get stealthed list
if ( not last_scan or GetTime()-last_scan &amp;gt;= rescan_period ) then --repopulate list every T seconds
last_scan = GetTime()
stealthed = {} --depopulate stealthed list
local currtarget = UnitName(&amp;apos;target&amp;apos;) --get current target&amp;apos;s name

	for i=1,GetNumBattlefieldScores() do 
	local name, killingBlows, honorableKills, deaths, honorGained, faction, rank, race, class = GetBattlefieldScore(i)
	local matched_name = name:match(&amp;apos;[^-]+&amp;apos;) --filter out &amp;quot;-Realm&amp;quot; part
		if ( class == &amp;quot;DRUID&amp;quot; or class == &amp;quot;ROGUE&amp;quot; ) and faction ~= pfaction and not UnitChannelInfo(&amp;apos;player&amp;apos;) then --target change is fatal to channgeling
		TargetUnit(name)
			if ( UnitName(&amp;apos;target&amp;apos;) ~= matched_name or ( UnitName(&amp;apos;target&amp;apos;) == matched_name and IsStealthed(&amp;apos;target&amp;apos;) ) ) then --targeting attemp was unsuccessful or stealthed target was caught during list repopulation
			stealthed[name] = 1
			end
		end
		if ( currtarget and UnitName(&amp;apos;target&amp;apos;) ~= currtarget ) then --return to previous target after targeting stealther
		TargetLastTarget() 
		elseif not currtarget then 
		ClearTarget() 
		end	
	end
end

--look for stealthed
if PQR_SpellAvailable(Breaker()) then --CD/GCD check to prevent excessive spam. NOTE: spell with ID 0 is never avalaible
local currtarget = UnitName(&amp;apos;target&amp;apos;) --get current target&amp;apos;s name
local stealther_spotted = false
	for k,v in pairs(stealthed) do
		if ( not ( UnitCastingInfo(&amp;apos;player&amp;apos;) or UnitChannelInfo(&amp;apos;player&amp;apos;) ) and v == 1 ) then --not on GCD &amp; not casting &amp; not channeling
		TargetUnit(k)
			if UnitName(&amp;apos;target&amp;apos;) == k:match(&amp;apos;[^-]+&amp;apos;) then --k is matched to be the same format with UnitName(&amp;apos;target&amp;apos;)
				if ( IsStealthed(&amp;apos;target&amp;apos;) and IsSpellInRange(breakername, &amp;apos;target&amp;apos;) == 1 ) then --range check to prevent spam caused by stealth glitch
				CastSpellByID(Breaker(), &amp;apos;target&amp;apos;)
				PetAttack() --hunter/mage/warlock - only. Really helps to spot stealthers who&amp;apos;are out of LoS
				stealther_spotted = true --flag fixing your target on spotted stealther
				break
				else
				stealthed[k] = nil	--exclude non-stealthed or too distant stealther from the list
				end
			end
		end
		if not stealther_spotted then	--return to previous target if no stealther was spotted, do nothing otherwise
			if ( currtarget and UnitName(&amp;apos;target&amp;apos;) ~= currtarget ) then 
			TargetLastTarget() 
			elseif not currtarget then 
			ClearTarget() 
			end
		end	
	end	
end
------------------------ARENA--------------------------------
for a=1,5 do
local arenatarget = &amp;apos;arena&amp;apos;..a
	if IsStealthed(arenatarget) then
	CastSpellByID(Breaker(), arenatarget)
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>All : Bosses</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>-- Darkmoon Faerie Cannon
if select(7,UnitBuffID(&amp;quot;player&amp;quot;,102116))
 and select(7,UnitBuffID(&amp;quot;player&amp;quot;,102116)) - GetTime() &amp;lt; 1.07 then 
	CancelUnitBuff(&amp;quot;player&amp;quot;,&amp;quot;Magic Wings&amp;quot;) 
end

-- Gara&amp;apos;jal the Spiritbinder
local timer = select(7,UnitDebuffID(&amp;quot;player&amp;quot;,116161))
if timer and timer - GetTime() &amp;lt; 1.5 then
	SpellStopCasting()
	RunMacroText(&amp;quot;/click ExtraActionButton1&amp;quot;)
end

for i = 1, 4 do
	local bossUnit = &amp;quot;boss&amp;quot;..i
	
	if UnitExists(bossUnit) then
		local castName = UnitCastingInfo(bossUnit)
		local channelName = UnitChannelInfo(bossUnit)
		local BossID = tonumber(UnitGUID(bossUnit):sub(6,10), 16)

		-- Lei Shen - Thunderstruck
		if BossID == 68397 then
			if castName == &amp;quot;Thunderstruck&amp;quot;
			 and not UnitBuffID(&amp;quot;player&amp;quot;, 1966) then
				RunMacroText(&amp;quot;/cast Feint&amp;quot;)
			end
		end
		
		-- Horridon - Dire Call
		if BossID == 68476 then
			if castName == &amp;quot;Dire Call&amp;quot;
			 and not UnitBuffID(&amp;quot;player&amp;quot;, 1966) then
			 	RunMacroText(&amp;quot;/cast Feint&amp;quot;)
			end
		end

		-- Jin&amp;apos;rokh - Ionization
		if BossID == 69465 then
			if castName == &amp;quot;Ionization&amp;quot; then
				RunMacroText(&amp;quot;/cast Cloak of Shadows&amp;quot;)
			end
		end

		-- Tortos - Quake Stomp
		if BossID == 67977 then
			if castName == &amp;quot;Quake Stomp&amp;quot;
			 and not UnitBuffID(&amp;quot;player&amp;quot;, 1966) then
				RunMacroText(&amp;quot;/cast Feint&amp;quot;)
			end
		end

		-- Ji-kun - Quills
		if BossID == 69712 then
			if channelName == &amp;quot;Quills&amp;quot;
			 and not UnitBuffID(&amp;quot;player&amp;quot;, 1966) then
				RunMacroText(&amp;quot;/cast Feint&amp;quot;)
			end
		end

		-- Primordius - Caustic Gas
		if BossID == 69017 then
			if castName == &amp;quot;Caustic Gas&amp;quot;
			 and not UnitBuffID(&amp;quot;player&amp;quot;, 1966) then
				RunMacroText(&amp;quot;/cast Feint&amp;quot;)
			end
		end

		-- Dark Animus - Interrupting Jolt
		if BossID == 69427 then
			if castName == &amp;quot;Interrupting Jolt&amp;quot;
			 and not UnitBuffID(&amp;quot;player&amp;quot;, 1966) then
				RunMacroText(&amp;quot;/cast Feint&amp;quot;)
			end
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>All : Poisons</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if UnitCastingInfo(&amp;quot;player&amp;quot;) ~= nil then return end
local DP = 1
local WP = 0
local LP = 1
local CP = 0
local MNP = 0
local PARP = 0

MHPOISON = nil
if ( DP ~= 1 and WP == 1 ) then
	MHPOISON = 8679
elseif ( DP == 1 and WP ~= 1 ) then
	MHPOISON = 2823
elseif ( DP == 1 and WP == 1 ) then
	return false
elseif ( DP ~= 1 and WP ~= 1 ) then
	return false
end

OHPOISON = nil
if ( LP == 1 and CP ~= 1 and MNP ~= 1 and PARP ~= 1 ) then
	OHPOISON = 108211
elseif ( LP ~= 1 and CP == 1 and MNP ~= 1 and PARP ~= 1 ) then
	OHPOISON = 3408
elseif ( LP ~= 1 and CP ~= 1 and MNP == 1 and PARP ~= 1 ) then
	OHPOISON = 5761
elseif ( LP ~= 1 and CP ~= 1 and MNP ~= 1 and PARP == 1 ) then
	OHPOISON = 108215
elseif ( ( LP == 1 and CP == 1 and MNP ~= 1 and PARP ~= 1 ) or
		 ( LP == 1 and CP ~= 1 and MNP == 1 and PARP ~= 1 ) or
		 ( LP == 1 and CP ~= 1 and MNP ~= 1 and PARP == 1 ) or
		 ( LP ~= 1 and CP == 1 and MNP == 1 and PARP ~= 1 ) or
		 ( LP ~= 1 and CP == 1 and MNP ~= 1 and PARP == 1 ) or
		 ( LP ~= 1 and CP ~= 1 and MNP == 1 and PARP == 1 ) or
		 ( LP ~= 1 and CP ~= 1 and MNP ~= 1 and PARP ~= 1 ) ) then
	return false
end

if not IsMounted() then
-- Check to Apply Main hand poison
if not UnitBuffID(&amp;quot;player&amp;quot;, MHPOISON) then
	CastSpellByName(GetSpellInfo(MHPOISON))
end
-- Check to Apply Leeching Poison
if not UnitBuffID(&amp;quot;player&amp;quot;, OHPOISON) then
	CastSpellByName(GetSpellInfo(OHPOISON))
end
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>--Stealther&amp;apos;s Bane BGs</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>--RedRussian&amp;apos;s &amp;quot;Stealthers&amp;apos; Bane&amp;quot;

local rescan_period = 2 --how often stealthed list is repopulated

local function IsStealthed(unit) --check if unit is stealthed
stealth, prowl, shadowmeld = 1784, 5215, 58984 --list of detectable stealth buffs may be incomplete!
	return ( UnitBuffID(unit, stealth) or UnitBuffID(unit, prowl) or UnitBuffID(unit, shadowmeld) )
end

local function Breaker() --instant stealth breaker, class dependent
_, playerClass = UnitClass(&amp;quot;player&amp;quot;)
	if playerClass == &amp;quot;WARRIOR&amp;quot; then
		return 57755 --Heroic Throw
	elseif playerClass == &amp;quot;PALADIN&amp;quot; then
		if PQR_SpellAvailable(879) then
			return 879 --Exorcism
		else	
			return 20271 --Judgment
		end	
	elseif playerClass == &amp;quot;HUNTER&amp;quot; then
		return 1978 --Serpent Sting
	elseif playerClass == &amp;quot;ROGUE&amp;quot; then
		if IsStealthed(&amp;apos;player&amp;apos;) then
			return 6770 --Sap
		else
			return 121733 --Throw
		end
	elseif playerClass == &amp;quot;PRIEST&amp;quot; then
		return 589 --Shadow Word: Pain
	elseif playerClass == &amp;quot;DEATHKNIGHT&amp;quot; then
		return 45524 --Chains of Ice
	elseif playerClass == &amp;quot;SHAMAN&amp;quot; then
		return 8056 --Frost Shock
	elseif playerClass == &amp;quot;MAGE&amp;quot; then
		return 30455 --Ice Lance
	elseif playerClass == &amp;quot;WARLOCK&amp;quot; then
		return 77799 --Fel Flame
	elseif playerClass == &amp;quot;MONK&amp;quot; then
		return 115546 --Taunt
	elseif playerClass == &amp;quot;DRUID&amp;quot; then
		if IsStealthed(&amp;apos;player&amp;apos;) then
			return 0 --do nothing
		elseif ( not IsStealthed(&amp;apos;player&amp;apos;) and PQR_SpellAvailable(770) ) then
			return 770 --fairy fire
		elseif 	not ( IsStealthed(&amp;apos;player&amp;apos;) or PQR_SpellAvailable(770) ) then
			return 8921 --moonfire
		end
	else
		return 0 
	end
end

local breakername = GetSpellInfo(Breaker()) --localized breaker name for use with IsSpellInRange

local factions = { [&amp;apos;Alliance&amp;apos;]=1, [&amp;apos;Horde&amp;apos;]=0 }
local pfaction = pfaction or factions[UnitFactionGroup(&amp;apos;player&amp;apos;)]

----------

--get stealthed list
if ( not last_scan or GetTime()-last_scan &amp;gt;= rescan_period ) then --repopulate list every T seconds
last_scan = GetTime()
stealthed = {} --depopulate stealthed list
local currtarget = UnitName(&amp;apos;target&amp;apos;) --get current target&amp;apos;s name

	for i=1,GetNumBattlefieldScores() do 
	local name, killingBlows, honorableKills, deaths, honorGained, faction, rank, race, class = GetBattlefieldScore(i)
	local matched_name = name:match(&amp;apos;[^-]+&amp;apos;) --filter out &amp;quot;-Realm&amp;quot; part
		if ( class == &amp;quot;DRUID&amp;quot; or class == &amp;quot;ROGUE&amp;quot; ) and faction ~= pfaction and not UnitChannelInfo(&amp;apos;player&amp;apos;) then --target change is fatal to channgeling
		TargetUnit(name)
			if ( UnitName(&amp;apos;target&amp;apos;) ~= matched_name or ( UnitName(&amp;apos;target&amp;apos;) == matched_name and IsStealthed(&amp;apos;target&amp;apos;) ) ) then --targeting attemp was unsuccessful or stealthed target was caught during list repopulation
			stealthed[name] = 1
			end
		end
		if ( currtarget and UnitName(&amp;apos;target&amp;apos;) ~= currtarget ) then --return to previous target after targeting stealther
		TargetLastTarget() 
		elseif not currtarget then 
		ClearTarget() 
		end	
	end
end

--look for stealthed
if PQR_SpellAvailable(Breaker()) then --CD/GCD check to prevent excessive spam. NOTE: spell with ID 0 is never avalaible
local currtarget = UnitName(&amp;apos;target&amp;apos;) --get current target&amp;apos;s name
local stealther_spotted = false
	for k,v in pairs(stealthed) do
		if ( not ( UnitCastingInfo(&amp;apos;player&amp;apos;) or UnitChannelInfo(&amp;apos;player&amp;apos;) ) and v == 1 ) then --not on GCD &amp; not casting &amp; not channeling
		TargetUnit(k)
			if UnitName(&amp;apos;target&amp;apos;) == k:match(&amp;apos;[^-]+&amp;apos;) then --k is matched to be the same format with UnitName(&amp;apos;target&amp;apos;)
				if ( IsStealthed(&amp;apos;target&amp;apos;) and IsSpellInRange(breakername, &amp;apos;target&amp;apos;) == 1 ) then --range check to prevent spam caused by stealth glitch
				CastSpellByID(Breaker(), &amp;apos;target&amp;apos;)
				PetAttack() --hunter/mage/warlock - only. Really helps to spot stealthers who&amp;apos;are out of LoS
				stealther_spotted = true --flag fixing your target on spotted stealther
				break
				else
				stealthed[k] = nil	--exclude non-stealthed or too distant stealther from the list
				end
			end
		end
		if not stealther_spotted then	--return to previous target if no stealther was spotted, do nothing otherwise
			if ( currtarget and UnitName(&amp;apos;target&amp;apos;) ~= currtarget ) then 
			TargetLastTarget() 
			elseif not currtarget then 
			ClearTarget() 
			end
		end	
	end	
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>All : Racials</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if nv_CDs and SafeToCastCD() then

	-- Troll: Berserking    
	if IsPlayerSpell(26297) and PQR_SpellAvailable(26297) then
		CastSpellByName(GetSpellInfo(26297),&amp;quot;player&amp;quot;)
	end
	-- Orc: Blood Fury
	if IsPlayerSpell(20572) and PQR_SpellAvailable(20572) then
		CastSpellByName(GetSpellInfo(20572),&amp;quot;player&amp;quot;)
	end 
	
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>All : Redirect</Name><Default>false</Default><SpellID>73981</SpellID><Actions></Actions><Lua>local cpstarget = GetComboPoints(&amp;quot;player&amp;quot;, &amp;quot;target&amp;quot;)
if combopoints &amp;gt; cpstarget
	and combopoints &amp;gt;= 2
	and not IsStealthed()
	and UnitExists(&amp;quot;target&amp;quot;)
	and UnitCanAttack(&amp;quot;player&amp;quot;, &amp;quot;target&amp;quot;)
	and 1 == IsSpellInRange(GetSpellInfo(73981), &amp;quot;target&amp;quot;)
then
	return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Assn : Tricks</Name><Default>false</Default><SpellID>57934</SpellID><Actions></Actions><Lua>local Rup, RupTimeLeft 	= Debuff_Check( 1943, &amp;quot;target&amp;quot;, &amp;quot;PLAYER&amp;quot; )
if UnitExists(&amp;quot;focus&amp;quot;) and UnitInParty(&amp;quot;focus&amp;quot;) and not UnitIsDead(&amp;quot;focus&amp;quot;) and not PQR_IsOutOfSight(&amp;quot;focus&amp;quot;, 1) and Rup and RupTimeLeft &amp;gt; 3 then

	PQR_CustomTarget = &amp;quot;focus&amp;quot;
	--PQR_WriteToChat(&amp;quot;Casted Tricks on: &amp;quot;..UnitName(&amp;quot;focus&amp;quot;),&amp;quot;Rogue : Assassination&amp;quot;)
	return true

end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Comb : Fan of Knives</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local CPs 				= GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; )
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )
local van = Buff_Check( 115193, &amp;quot;player&amp;quot; );

if nv_multi and (CPs &amp;lt; 5 or (not Anti or AntiCharges &amp;lt; 5)) and not van then

	CastSpellByName( GetSpellInfo(51723), nil )
	return true

end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Comb : Tricks</Name><Default>false</Default><SpellID>57934</SpellID><Actions></Actions><Lua>if UnitExists(&amp;quot;focus&amp;quot;) and UnitInParty(&amp;quot;focus&amp;quot;) and not UnitIsDead(&amp;quot;focus&amp;quot;) and not PQR_IsOutOfSight(&amp;quot;focus&amp;quot;, 1) then

	PQR_CustomTarget = &amp;quot;focus&amp;quot;
	--PQR_WriteToChat(&amp;quot;Casted Tricks on: &amp;quot;..UnitName(&amp;quot;focus&amp;quot;),&amp;quot;Rogue : Assassination&amp;quot;)
	return true

end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Comb : Preparation</Name><Default>false</Default><SpellID>14185</SpellID><Actions></Actions><Lua>local start, duration, enabled = GetSpellCooldown(1856)

if duration ~= 0 and nv_CDs and PQR_SpellAvailable(14185) then

	if duration + start - GetTime() &amp;gt; 60 then
	
		return true
	
	end

end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Comb : Stealth</Name><Default>false</Default><SpellID>1784</SpellID><Actions></Actions><Lua>if restealth and (GetTime() - restealth) &amp;gt; 3 and 0 == GetNumLootItems() and PQR_SpellAvailable(1784) then
	--print(GetSpellCooldown(1784))
	return true
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Sub : Stealth</Name><Default>false</Default><SpellID>1784</SpellID><Actions></Actions><Lua>if restealth and (GetTime() - restealth) &amp;gt; 3 and 0 == GetNumLootItems() and PQR_SpellAvailable(1784) then
	--print(GetSpellCooldown(1784))
	return true
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Sub : Tricks</Name><Default>false</Default><SpellID>57934</SpellID><Actions></Actions><Lua>if UnitExists(&amp;quot;focus&amp;quot;) and UnitInParty(&amp;quot;focus&amp;quot;) and not UnitIsDead(&amp;quot;focus&amp;quot;) and not PQR_IsOutOfSight(&amp;quot;focus&amp;quot;, 1) then

	PQR_CustomTarget = &amp;quot;focus&amp;quot;
	--PQR_WriteToChat(&amp;quot;Casted Tricks on: &amp;quot;..UnitName(&amp;quot;focus&amp;quot;),&amp;quot;Rogue : Assassination&amp;quot;)
	return true

end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Sub : Fan of Knives</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local CPs 				= GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; )
local Anti, _, AntiCharges 	= Buff_Check( 115189, &amp;quot;player&amp;quot; )
local van = Buff_Check( 115193, &amp;quot;player&amp;quot; );

if nv_multi and (CPs &amp;lt; 5 or (not Anti or AntiCharges &amp;lt; 5)) and not van then

	CastSpellByName( GetSpellInfo(51723), nil )
	return true

end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Sub : Preparation</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local start, duration = GetSpellCooldown(1856) -- Vanish
local start2, duration2 = GetSpellCooldown(14185) -- Preparation 

if nv_CDs then
	if not ( start2 &amp;gt; 0 and duration2 &amp;gt; 1.5 ) then
		if not IsStealthed() then
			if ( start &amp;gt; 0 and duration &amp;gt; 1.5 ) and ( start + duration - GetTime()) &amp;lt; 115 then
				CastSpellByName(GetSpellInfo(14185), &amp;quot;player&amp;quot;)
			end
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>All : Fan</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if nv_multi and GetComboPoints( &amp;quot;player&amp;quot;, &amp;quot;target&amp;quot; ) &amp;lt; 5 then

	CastSpellByName( GetSpellInfo(51723), nil )
	return true
	
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability></ROGUE>