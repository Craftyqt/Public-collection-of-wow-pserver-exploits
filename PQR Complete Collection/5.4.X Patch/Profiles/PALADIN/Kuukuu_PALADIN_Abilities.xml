<?xml version="1.0" encoding="utf-8" ?><PALADIN><Ability><Name>&amp;gt; Initialize</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>GroupInfo() 
CastClick() 

if IsLeftAltKeyDown() 
or IsMounted()
or SpellIsTargeting()
or UnitBuffID(&amp;quot;player&amp;quot;,80169)
or UnitBuffID(&amp;quot;player&amp;quot;,87959)
--or UnitChannelInfo(&amp;quot;player&amp;quot;) 
or UnitIsDeadOrGhost(&amp;quot;player&amp;quot;) 
or UnitIsDeadOrGhost(&amp;quot;target&amp;quot;) 
then return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>&amp;gt; Healing spells</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local InCombat = false

for i=1, #members do 
	if UnitAffectingCombat(members[i].Unit) 
		then InCombat = true 
	end 
end
	if not InCombat and not IsLeftShiftKeyDown() 
		then return true 
	end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Word of Glory (5 hp)</Name><Default>false</Default><SpellID>114163</SpellID><Actions></Actions><Lua>if members[1].HP &amp;lt; 95 
and ( UnitPower(&amp;quot;player&amp;quot;, 9) == 5 or UnitBuffID(&amp;quot;player&amp;quot;,90174) )
then
  PQR_CustomTarget = members[1].Unit
  return true
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Beacon (focus)</Name><Default>false</Default><SpellID>53563</SpellID><Actions></Actions><Lua>if UnitExists(&amp;quot;focus&amp;quot;)
and not UnitIsDeadOrGhost(&amp;quot;focus&amp;quot;)
and UnitCanCooperate(&amp;quot;player&amp;quot;, &amp;quot;focus&amp;quot;)
and not HaveBuff(&amp;quot;focus&amp;quot;,53563,0,&amp;quot;PLAYER&amp;quot;)
and IsSpellInRange(&amp;quot;Beacon of Light&amp;quot;, &amp;quot;focus&amp;quot;) 
and	not UnitIsDeadOrGhost(&amp;quot;focus&amp;quot;)
--and	UnitCanCooperate(&amp;quot;player&amp;quot;, &amp;quot;focus&amp;quot;)
then
return true
end</Lua><RecastDelay>1000</RecastDelay><Target>Focus</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Sacred Shield (focus)</Name><Default>false</Default><SpellID>20925</SpellID><Actions></Actions><Lua>if UnitExists(&amp;quot;focus&amp;quot;)
and not UnitIsDeadOrGhost(&amp;quot;focus&amp;quot;)
and UnitCanCooperate(&amp;quot;player&amp;quot;, &amp;quot;focus&amp;quot;)
and not HaveBuff(&amp;quot;focus&amp;quot;,20925,0,&amp;quot;PLAYER&amp;quot;)
and IsSpellInRange(&amp;quot;Beacon of Light&amp;quot;, &amp;quot;focus&amp;quot;) 
and	not UnitIsDeadOrGhost(&amp;quot;focus&amp;quot;)
--and	UnitCanCooperate(&amp;quot;player&amp;quot;, &amp;quot;focus&amp;quot;)
then
return true
end</Lua><RecastDelay>1000</RecastDelay><Target>Focus</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Divine Light</Name><Default>false</Default><SpellID>82326</SpellID><Actions></Actions><Lua>if members[1].HP &amp;lt; 50
and not PQR_IsMoving(1) 
then
  PQR_CustomTarget = members[1].Unit
  return true
end</Lua><RecastDelay>300</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Flash of Light</Name><Default>false</Default><SpellID>19750</SpellID><Actions></Actions><Lua>if members[1].HP &amp;lt; 25
and not PQR_IsMoving(1) 
then
  PQR_CustomTarget = members[1].Unit
  return true
end</Lua><RecastDelay>300</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Holy Light</Name><Default>false</Default><SpellID>635</SpellID><Actions>/use 13</Actions><Lua>if members[1].HP &amp;lt; 95
and not PQR_IsMoving(1) 
then
  PQR_CustomTarget = members[1].Unit
  return true
end</Lua><RecastDelay>1000</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Holy Shock</Name><Default>false</Default><SpellID>20473</SpellID><Actions></Actions><Lua>if members[1].HP &amp;lt; 95
then
  PQR_CustomTarget = members[1].Unit
  return true
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Divine Protection</Name><Default>false</Default><SpellID>498</SpellID><Actions></Actions><Lua>if 100 * UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;) &amp;lt; 50 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Lay on Hands</Name><Default>false</Default><SpellID>633</SpellID><Actions></Actions><Lua>if members[1].HP &amp;lt; 10
and not HaveBuff(members[1].Unit,25771)
and not HaveBuff(members[1].Unit,642)
and not HaveBuff(members[1].Unit,1022)
then
  PQR_CustomTarget = members[1].Unit
  return true
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Hand of Sacrifice</Name><Default>false</Default><SpellID>6940</SpellID><Actions></Actions><Lua>playerhp = 100 * UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;)

if members[1].HP &amp;lt; 40
and playerhp &amp;gt; 65
then
  PQR_CustomTarget = members[1].Unit
  return true
end</Lua><RecastDelay>500</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Divine Shield</Name><Default>false</Default><SpellID>642</SpellID><Actions></Actions><Lua>local myHealth = 100 * UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;)

if myHealth &amp;lt; 20 then
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Divine Plea</Name><Default>false</Default><SpellID>0</SpellID><Actions>/use 13</Actions><Lua>if 100 * UnitPower(&amp;quot;player&amp;quot;) / UnitPowerMax(&amp;quot;player&amp;quot;) &amp;lt; 80
and not PQR_IsMoving(1)
and GetSpellCooldown(118730) == 0
and UnitAffectingCombat(&amp;quot;player&amp;quot;)
then
CastSpellByName(&amp;quot;Arcane Torrent&amp;quot;)
CastSpellByName(&amp;quot;Divine Plea&amp;quot;)
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Hand of Protection</Name><Default>false</Default><SpellID>1022</SpellID><Actions></Actions><Lua>if members[1].HP &amp;lt; 20
and not HaveBuff(members[1].Unit,25771)
and not HaveBuff(members[1].Unit,642)
and not HaveBuff(members[1].Unit,53563)
then
  PQR_CustomTarget = members[1].Unit
  return true
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Holy Radiance</Name><Default>false</Default><SpellID>82327</SpellID><Actions></Actions><Lua>if members[1].HP &amp;lt; 85
and group.low &amp;gt; 4
and not PQR_IsMoving(1) 
then
  PQR_CustomTarget = members[1].Unit
  return true
end</Lua><RecastDelay>7000</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Word of Glory</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if PQR_SpellAvailable(114163) then
CastSpellByName(GetSpellInfo(114163), &amp;quot;target&amp;quot;) 
return true
if members[1].HP &amp;lt; 85 
--and UnitPower(&amp;quot;player&amp;quot;, 9) &amp;gt; 2 
then
PQR_CustomTarget = members[1].Unit
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Avenging Wrath</Name><Default>false</Default><SpellID>31884</SpellID><Actions></Actions><Lua>if members[1].HP &amp;lt; 55
and group.low &amp;gt; 3
then
  PQR_CustomTarget = members[1].Unit
  return true
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Divine Favor</Name><Default>false</Default><SpellID>31842</SpellID><Actions></Actions><Lua>if members[1].HP &amp;lt; 35
and group.low &amp;gt; 2
then
  PQR_CustomTarget = members[1].Unit
  return true
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Guardian of Ancient Kings</Name><Default>false</Default><SpellID>86669</SpellID><Actions></Actions><Lua>if members[1].HP &amp;lt; 30
and group.low &amp;gt; 3
then
  PQR_CustomTarget = members[1].Unit
  return true
end</Lua><RecastDelay>500</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Cleanse</Name><Default>false</Default><SpellID>4987</SpellID><Actions></Actions><Lua>--buff = { 109325, 104599, 104601, 104600, 103434, 96328, 96325, 96326, 92876, 92877, 92878, 86788 }
local candispel = 1

--for i,v in ipairs(buff) do
-- if UnitDebuffID(members[1].Unit,v) then candispel = nil end
--end

local i = 1
local buff,_,_,count,bufftype,duration = UnitDebuff(members[1].Unit, i)
while buff do
  if bufftype == &amp;quot;Magic&amp;quot;
  --or bufftype == &amp;quot;Curse&amp;quot;
  and UnitIsFriend(&amp;quot;player&amp;quot;,members[1].Unit)
  and candispel ~= nil
  then
  PQR_CustomTarget = members[1].Unit
  return true end
  i = i + 1;
  buff,_,_,count,bufftype,duration = UnitDebuff(members[1].Unit, i)
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Buffs</Name><Default>false</Default><SpellID>20217</SpellID><Actions></Actions><Lua>if not UnitAffectingCombat(&amp;quot;player&amp;quot;) then
  for i=1,#members do 
    if not HaveBuff(members[i].Unit,{115921,20217,1126,90363}) 
    then return true end
  end
end</Lua><RecastDelay>10000</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Light of Dawn</Name><Default>false</Default><SpellID>85222</SpellID><Actions></Actions><Lua>if members[1].HP &amp;lt; 92
and group.low &amp;gt; 2
and ( UnitPower(&amp;quot;player&amp;quot;, 9) &amp;gt; 2 or UnitBuffID(&amp;quot;player&amp;quot;,90174) )
then
  PQR_CustomTarget = members[1].Unit
  return true
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Holy Radiance (spam)</Name><Default>false</Default><SpellID>82327</SpellID><Actions></Actions><Lua>if IsLeftControlKeyDown()
and not PQR_IsMoving(1) 
then
  PQR_CustomTarget = members[1].Unit
  return true
end</Lua><RecastDelay>500</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Light of Dawn (5 hp)</Name><Default>false</Default><SpellID>85222</SpellID><Actions></Actions><Lua>if members[1].HP &amp;lt; 94
and ( UnitPower(&amp;quot;player&amp;quot;, 9) == 5  or UnitBuffID(&amp;quot;player&amp;quot;,90174) )
then
  PQR_CustomTarget = members[1].Unit
  return true
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Seal of Insight</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if GetShapeshiftForm(&amp;quot;player&amp;quot;) ~= 3 then
CastShapeshiftForm(3)
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Cleanse Mouseover</Name><Default>false</Default><SpellID>4987</SpellID><Actions></Actions><Lua>if UnitExists(&amp;quot;mouseover&amp;quot;)
   then

local i = 1
local buff,_,_,count,bufftype,duration = UnitDebuff(&amp;quot;mouseover&amp;quot;, i)
while buff do
  if bufftype == &amp;quot;Magic&amp;quot; 
  and UnitIsFriend(&amp;quot;player&amp;quot;,&amp;quot;mouseover&amp;quot;)
  then return true end
  i = i + 1;
  buff,_,_,count,bufftype,duration = UnitDebuff(&amp;quot;mouseover&amp;quot;, i)
end

end</Lua><RecastDelay>500</RecastDelay><Target>Mouseover</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Word of Glory (3 hp)</Name><Default>false</Default><SpellID>114163</SpellID><Actions></Actions><Lua>if members[1].HP &amp;lt; 95 
and ( UnitPower(&amp;quot;player&amp;quot;, 9) &amp;gt; 3 or UnitBuffID(&amp;quot;player&amp;quot;,90174) )
then
  PQR_CustomTarget = members[1].Unit
  return true
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Holy Light Spine</Name><Default>false</Default><SpellID>635</SpellID><Actions></Actions><Lua>if members[1].HP &amp;lt; 100 
and not PQR_IsMoving(1) 
then
  PQR_CustomTarget = members[1].Unit
  return true
end</Lua><RecastDelay>300</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>&amp;gt; Functions</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if SetFunctions == nil then

--------------------------------------------------

function HaveBuff(UnitID,SpellID,TimeLeft,Filter) 
  if not TimeLeft then TimeLeft = 0 end
  if type(SpellID) == &amp;quot;number&amp;quot; then SpellID = { SpellID } end 
  for i=1,#SpellID do 
    local spell, rank = GetSpellInfo(SpellID[i])
    if spell then
      local buff = select(7,UnitBuff(UnitID,spell,rank,Filter)) 
      if buff and ( buff == 0 or buff - GetTime() &amp;gt; TimeLeft ) then return true end
    end
  end
end

--------------------------------------------------

function HaveDebuff(UnitID,SpellID,TimeLeft,Filter) 
  if not TimeLeft then TimeLeft = 0 end
  if type(SpellID) == &amp;quot;number&amp;quot; then SpellID = { SpellID } end 
  for i=1,#SpellID do 
    local spell, rank = GetSpellInfo(SpellID[i])
    if spell then
      local debuff = select(7,UnitDebuff(UnitID,spell,rank,Filter)) 
      if debuff and ( debuff == 0 or debuff - GetTime() &amp;gt; TimeLeft ) then return true end
    end
  end
end

--------------------------------------------------

function CalculateHP(t)
  incomingheals = UnitGetIncomingHeals(t) or 0
  return 100 * ( UnitHealth(t) + incomingheals ) / UnitHealthMax(t)
end

--------------------------------------------------

function CanHeal(t)
  if UnitInRange(t) and UnitCanCooperate(&amp;quot;player&amp;quot;,t) and not UnitIsEnemy(&amp;quot;player&amp;quot;,t) 
  and not UnitIsCharmed(t) and not UnitIsDeadOrGhost(t) and not PQR_IsOutOfSight(t) 
  then return true end 
end

--------------------------------------------------

function GroupInfo()
  members, group = { { Unit = &amp;quot;player&amp;quot;, HP = CalculateHP(&amp;quot;player&amp;quot;) } }, { low = 0, tanks = { } } 
  group.type = IsInRaid() and &amp;quot;raid&amp;quot; or &amp;quot;party&amp;quot; 
  group.number = GetNumGroupMembers()
  for i=1,group.number do if CanHeal(group.type..i) then 
    local unit, hp = group.type..i, CalculateHP(group.type..i) 
    table.insert( members,{ Unit = unit, HP = hp } ) 
    if hp &amp;lt; 90 then group.low = group.low + 1 end 
    if UnitGroupRolesAssigned(unit) == &amp;quot;TANK&amp;quot; then table.insert(group.tanks,unit) end 
  end end 
  if group.type == &amp;quot;raid&amp;quot; and #members &amp;gt; 1 then table.remove(members,1) end 
  table.sort(members, function(x,y) return x.HP &amp;lt; y.HP end)
  local customtarget = CanHeal(&amp;quot;target&amp;quot;) and &amp;quot;target&amp;quot; -- or CanHeal(&amp;quot;mouseover&amp;quot;) and GetMouseFocus() ~= WorldFrame and &amp;quot;mouseover&amp;quot; 
  if customtarget then table.sort(members, function(x) return UnitIsUnit(customtarget,x.Unit) end) end 
end

--------------------------------------------------

function CastClick()
  if IsMouseButtonDown(1) and MainMenuBar:IsShown() then 
    local mousefocus = GetMouseFocus() 
    if mousefocus and mousefocus.feedback_action 
    then SpellCancelQueuedSpell() PQR_DelayRotation(1) end
  end
end

--------------------------------------------------

  SetFunctions = true

end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Holy prism</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local HolyPrism = 114165
local PlayerHP = UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;) * 100

if IsPlayerSpell(HolyPrism) and PQR_SpellAvailable(HolyPrism) then
	if PlayerHP &amp;lt; 95 then
		CastSpellByName(GetSpellInfo(HolyPrism),&amp;quot;target&amp;quot;)
		return true
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Sentence</Name><Default>false</Default><SpellID>114157</SpellID><Actions></Actions><Lua>if members[1].HP &amp;lt; 75
then
  PQR_CustomTarget = members[1].Unit
  return true
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Light&amp;apos;s hammer</Name><Default>false</Default><SpellID>114158</SpellID><Actions></Actions><Lua>if IsLeftShiftKeyDown()
then
  PQR_CustomTarget = members[1].Unit
  return true
end</Lua><RecastDelay>500</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Eternal Flame</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if members[1].HP &amp;lt; 90
	and ( UnitPower(&amp;quot;player&amp;quot;, 9) &amp;gt; 0 or UnitBuffID(&amp;quot;player&amp;quot;,90174) )
then
	PQR_CustomTarget = members[1].Unit
	CastSpellByName(GetSpellInfo(114163), PQR_CustomTarget)
    return true
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Eternal Flame (3 hp)</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if members[1].HP &amp;lt; 94
and ( UnitPower(&amp;quot;player&amp;quot;, 9) &amp;gt; 3 or UnitBuffID(&amp;quot;player&amp;quot;,90174) )
then
PQR_CustomTarget = members[1].Unit
CastSpellByName(GetSpellInfo(114163), PQR_CustomTarget)
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Eternal Flame (5 hp)</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if members[1].HP &amp;lt; 95 
and ( UnitPower(&amp;quot;player&amp;quot;, 9) == 5 or UnitBuffID(&amp;quot;player&amp;quot;,90174) )
then
PQR_CustomTarget = members[1].Unit 
CastSpellByName(GetSpellInfo(114163), PQR_CustomTarget) 
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability></PALADIN>