<?xml version="1.0" encoding="utf-8" ?><SHAMAN><Ability><Name>-- Init --</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>-- Load LUA data files.
if PQR_RotationStarted then
	PQR_RotationStarted = false 
	
	-- Load required data files
	if PQR_LoadLua ~= nil then
		if PQR_LoadLua(&amp;quot;PQR_ShamanPvPLite.lua&amp;quot;) == false then
			PQR_WriteToChat(&amp;quot;|cffb73737You&amp;apos;re missing PQR_ShamanPvPLite.lua - Make sure it&amp;apos;s in your Data folder! The Rotation has been halted.|cffffffff&amp;quot;, &amp;quot;Error&amp;quot;)
			PQR_StopRotation()
			return true
		end
	end
end

  
GroupInfo() 

  
if PauseKey
or IsMounted() then
	return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Healing Wave</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if PQR_SpellAvailable(331) then
	for i=1, #members do 
		if members[i].HP &amp;lt; HealingWaveHP 
		and PQR_IsOutOfSight(members[i].Unit, 0.1) == false
		and not PQR_IsMoving(.5) then
	  		_castSpell(331, members[i].Unit)
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Greater Healing Wave</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if PQR_SpellAvailable(77472) then
	for i=1, #members do 
		if members[i].HP &amp;lt; GreaterHealingWaveHP 
		and PQR_IsOutOfSight(members[i].Unit, 0.1) == false
		and not PQR_IsMoving(.5) then
	  		_castSpell(77472, members[i].Unit)
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Healing Surge</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if PQR_SpellAvailable(8004) then
	for i=1, #members do 
		if members[i].HP &amp;lt; HealingSurgeHP 
		and PQR_IsOutOfSight(members[i].Unit, 0.1) == false
		and not PQR_IsMoving(.5) then
	  		_castSpell(8004, members[i].Unit)
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Tremor Totem</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local _, talent = GetTalentRowSelectionInfo(4)
local fears = { 
5484,  -- Howl
8122,  -- scream
5782,   -- Fear
5246, -- Intimidating Shout
113004  -- Intimidating Shout (druid symbio) 
}

if PQR_SpellAvailable(8143) then
	for i = 1, #members do
		for f = 1, #fears do
			local isFeared, _, _, _, _, Dur = UnitDebuffID(members[i].Unit, fears[f])
			
			if isFeared
			and Dur &amp;gt;= 6  --Most full fears are 6 or 8 seconds
			and IsSpellInRange(GetSpellInfo(8004), members[i].Unit) == 1 then
				_castSpell(8143)
				
				if talent == 8 then
					RunMacroText(&amp;quot;/click TotemFrameTotem1 RightButton&amp;quot;)
				end
			end
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Grounding Totem</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>for i = 1, #custTars do
	if UseGrounding(custTars[i]) then
		_castSpell(8177)
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Astral Shift</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if AstralShiftKey then	
 	 CastSpellByName(tostring(GetSpellInfo(108271))) 
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Earthliving Weapon</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local ELW = GetWeaponEnchantInfo()

if ELW ~= 1 then
	_castSpell(51730)
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Water Shield</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if UnitBuffID(&amp;quot;player&amp;quot;,974) then return false end

if UnitBuffID( &amp;quot;player&amp;quot;, 52127 ) == nil then
	_castSpell(52127)
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Purge</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PlayerHP = 100 * UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;)

local PlayerMana = 100 * UnitPower(&amp;quot;player&amp;quot;) / UnitPowerMax(&amp;quot;player&amp;quot;)

local purgeThis2 = {

1044,   -- Hand of Freedom

6940,   -- Hand of Sacrifice

69369,   -- Predatory Swiftness

12472,  -- Icy Veins

1022,   -- Hand of Protection

11426,   -- Ice Barrier

20925,  -- Sacred Shield

114250,   -- Selfless Healer

17    -- Power Word: Shield

}

if PQR_SpellAvailable(370) then
	for m = 1, #members do
		if members[m].HP &amp;gt; 70
		and PlayerMana &amp;gt; 70 then
			for i = 1, #custTars do
				if UnitExists(custTars[i]) then
					for j = 1, #purgeThis2 do
						if UnitBuffID(custTars[i], purgeThis2[j]) ~= nil
						and UnitCanAttack(&amp;quot;player&amp;quot;,custTars[i]) ~= nil
						and PQR_IsOutOfSight(custTars[i], 0.1) == false then
							_castSpell(370, custTars[i])
						end
					end
				end
			end
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Riptide</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if PQR_SpellAvailable(61295) then
	for i=1, #members do
		if members[i].HP &amp;lt; RiptideHP 
		and not UnitBuffID(members[i].Unit, 61295)
		and PQR_IsOutOfSight(members[i].Unit, 0.1) == false  then
		 	_castSpell(61295, members[i].Unit)
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Healing Stream Totem</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if PQR_SpellAvailable(5394) then
	for i=1, #members do
		if members[i].HP &amp;lt; HealingStreamHP then
			_castSpell(5394)
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Dispell CC</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if PQR_SpellAvailable(77130) then
	for i=1,#members do 
	    if dispellableCC(members[i].Unit) 
	    and PQR_IsOutOfSight(members[i], 0.1) == false
	    and not UnitDebuff(members[i].Unit, 30108)
	    and not UnitDebuff(members[i].Unit, 34914)
	    and not UnitDebuff(members[i].Unit, 131736) then 
	  		_castSpell(77130,members[i].Unit)
	  	end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Healing Surge SWG</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local SWG = UnitBuffID(&amp;quot;player&amp;quot;, 79206)

if PQR_SpellAvailable(8004) then
	for i=1, #members do 
		if members[i].HP &amp;lt; HealingSurgeHP 
		and SWG
		and PQR_IsOutOfSight(members[i].Unit, 0.1) == false then
	  		_castSpell(8004, members[i].Unit)
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Earth Shield</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>function CheckEarthShield(t)
 	local _,_,_,EScount,_,_,EStimer = UnitBuffID(t,974,&amp;quot;PLAYER&amp;quot;) 
    return EScount, EStimer 
end 

local memberid = 1
local esactive = false

if PQR_SpellAvailable(974) then
	for i = 1, #members do
		if UnitBuffID(members[i].Unit,974,&amp;quot;PLAYER&amp;quot;) then 
			esactive = true 
		end
	end
	
	--Put it on some one if theres not an ES up.
	for i = 1, #members do 
	  	if esactive == false  
	  	and members[i].HP &amp;lt;= 99 
	  	and not UnitBuffID(members[i].Unit, 52127) --Water shield 
	  	and PQR_IsOutOfSight(members[i].Unit, 0.1) == false then 
		    _castSpell(974, members[i].Unit)
	  	end
	end
	
	
	--Change ES targets if some oen else is taking alot of damage
	for i = 1, #members do
	  	local EScount, EStimer = CheckEarthShield(members[i].Unit)
	  	if members[i].HP &amp;lt; EarthShieldHP
	  	and not UnitBuffID(members[i].Unit, 974, Player) 
	  	and PQR_IsOutOfSight(members[i].Unit, 0.1) == false then 
		    _castSpell(974, members[i].Unit)
	  	end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Unleashed Elements</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if PQR_SpellAvailable(73680) then
	for i=1, #members do 
		if members[i].HP &amp;lt; UnleashedElementsHP 
		and PQR_IsOutOfSight(members[i].Unit, 0.1) == false then
	  		_castSpell(73680, members[i].Unit)
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Spirit Link</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local myHp = 100 * UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;)


if PQR_SpellAvailable(98008)
and AutoSpiritLink then
	for i=1, #members do
		if CheckInteractDistance(members[i].Unit, 3) == 1 then
			--Link other people
			if members[i].HP &amp;lt; SpiritLinkHP
			and UnitName(members[i].Unit) ~= UnitName(&amp;quot;player&amp;quot;)
			and myHp &amp;gt; SafeToLink then
				SpellStopCasting()
				_castSpell(98008, members[i].Unit)
			end
			
			--Link me
			if myHp &amp;lt; SpiritLinkHP
			and UnitName(members[i].Unit) ~= UnitName(&amp;quot;player&amp;quot;)
			and members[i].HP &amp;gt; SafeToLink then
				SpellStopCasting()
				_castSpell(98008, members[i].Unit)
			end
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Healing Tide Totem</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if PQR_SpellAvailable(108280) then
	if HealingTideKey then
		_castSpell(108280)
	end

	if AutoHealingTide then
		for i=1, #members do
			if members[i].HP &amp;lt; HealingTideHP then
				_castSpell(108280)
			end
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Ascendance</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if AscendanceKey then
	_castSpell(114049)
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>NS Greater Healing Wave</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local NS = UnitBuffID(&amp;quot;player&amp;quot;, 16188)

if PQR_SpellAvailable(77472) then
	for i=1, #members do 
		if members[i].HP &amp;lt; NatureSwiftnessHP 
		and NS
		and PQR_IsOutOfSight(members[i].Unit, 0.1) == false then
	  		_castSpell(77472, members[i].Unit)
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Nature Swiftness</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if AutoNatureSwiftness then 
	if PQR_SpellAvailable(16188) then
		for i=1, #members do 
			if members[i].HP &amp;lt; NatureSwiftnessHP then
		  		_castSpell(16188)
			end
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Mana Tide</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PlayerMana = 100 * UnitPower(&amp;quot;player&amp;quot;) / UnitPowerMax(&amp;quot;player&amp;quot;)

if PQR_SpellAvailable(16190) then
	if AutoManaTide then
		if PlayerMana &amp;lt; ManaTideMP then
			_castSpell(16190)
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-- Surge Play Options --</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>-- OPTIONS -- 
HealingWaveHP = 95
HealingSurgeHP = 85
GreaterHealingWaveHP = 0
RiptideHP = 96
HealingStreamHP = 85
EarthShieldHP = 80
UnleashedElementsHP = 75

AutoSpiritLink = true
SpiritLinkHP = 20
SafeToLink = 90
AutoHealingTide = true
HealingTideHP = 35
AutoNatureSwiftness = true
NatureSwiftnessHP = 25
AutoManaTide = true
ManaTideMP = 50
HealthStoneHP = 40


--Keybinds
--						= IsLeftShiftKeyDown()	
AstralShiftKey			= IsLeftControlKeyDown()
--						= IsRightAltKeyDown()
HealingTideKey			= IsRightShiftKeyDown()
AscendanceKey			= IsRightControlKeyDown()
PauseKey				= IsLeftAltKeyDown()
DPSKey					= IsMouseButtonDown(3)  --When you push down the scroll button on mouse(usually)
HexKey					= IsMouseButtonDown(4)  --MouseButton4 depends on mouse
--						= IsMouseButtonDown(5)  --MouseButton5 depends on mouse


--List of UsableKey Variables.
-- AstralShiftKey 
-- pauseKey
-- DPSKey
-- HealingTideKey
-- HexKey
-- AscendanceKey</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Hex</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if HexKey then
	if UnitExists(&amp;quot;focus&amp;quot;)
	and UnitIsEnemy(&amp;quot;focus&amp;quot;, &amp;quot;player&amp;quot;)
	and PQR_IsOutOfSight(&amp;quot;focus&amp;quot;, 0.1) == false
	and IsSpellInRange(GetSpellInfo(51514), &amp;quot;focus&amp;quot;) == 1 then
		_castSpell(51514, &amp;quot;focus&amp;quot;)
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability></SHAMAN>