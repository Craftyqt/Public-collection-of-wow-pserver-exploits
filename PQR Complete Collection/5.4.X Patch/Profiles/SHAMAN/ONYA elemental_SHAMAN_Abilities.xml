<?xml version="1.0" encoding="utf-8" ?><SHAMAN><Ability><Name>Elemental: -- defensive spells</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if IsShiftKeyDown()
or IsMounted()
or UnitBuffID(&amp;quot;player&amp;quot;,87959)
or UnitIsDeadOrGhost(&amp;quot;player&amp;quot;) 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Elemental: Earth Shock</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>_,_,_,LSCount = UnitBuffID(&amp;quot;player&amp;quot;, 324)
local _,b = GetSpellCooldown(8042)
local _, _, _, _, fulmination = GetTalentInfo(1, 13)
if fulmination == 1 then
if (AOE or autoAOE) and LSCount &amp;gt;= 9 and PQR_SpellAvailable(8042) then
    SilentCast(8042,&amp;quot;target&amp;quot;)         
    return true
  end

if not (AOE or autoAOE) and PQR_SpellAvailable(8042) then
  if (exptime &amp;gt; 5 and b &amp;lt; 5) then
    if ((LSCount &amp;gt;= 9) or (exptime &amp;lt; 10 and LSCount &amp;gt;= 7)) then
      SilentCast(8042,&amp;quot;target&amp;quot;)         
      return true
    end
  end
end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Elemental: Elemental Mastery</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if PQR_SpellAvailable(16166) then
  SilentCast(16166)
  return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Elemental: Flame Shock</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>FSdebuff, _, _, _,_,_, expirationTime = UnitDebuffID(&amp;quot;target&amp;quot;, 8050, &amp;quot;PLAYER|HARMFUL&amp;quot;)
if FSdebuff == nil then
   exptime = 0
else
    exptime = (expirationTime - GetTime()) 
end

local a,b = GetSpellCooldown(8050)
if PQR_SpellAvailable(8050) and b &amp;lt; 5 and exptime &amp;lt; 1.5 and not (AOE or autoAOE) then
  SilentCast(8050,&amp;quot;target&amp;quot;)
  return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Elemental: FT weapon</Name><Default>false</Default><SpellID>8024</SpellID><Actions></Actions><Lua>local hasFT = GetWeaponEnchantInfo()

if hasFT ~= 1  then
   return true
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Elemental: Lava Burst</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local _, _, _, _, _, _, castTime = GetSpellInfo(51505)

if PQR_SpellAvailable(51505) and exptime &amp;gt; (castTime/1000) and not (AOE or autoAOE) and moving == 0 then
  SilentCast(51505,&amp;quot;target&amp;quot;)
  return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Elemental: Lightning Bolt</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if (moving == 0 or HasGlyph(101052))and not (AOE or autoAOE) then
  SilentCast(403,&amp;quot;target&amp;quot;)
  return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Elemental: Lightning Shield</Name><Default>false</Default><SpellID>324</SpellID><Actions></Actions><Lua>LS = UnitBuffID(&amp;quot;player&amp;quot;, 324) 
		
if LS == nil then
	return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Elemental: Totems</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local _, WaterTotem = GetTotemInfo(3)
local _, FireTotem = GetTotemInfo(1)
local _, AirTotem = GetTotemInfo(4)
local _, EarthTotem = GetTotemInfo(2)
local MQ = UnitBuffID(&amp;quot;player&amp;quot;, 49868)
local MA = UnitBuffID(&amp;quot;player&amp;quot;, 24907)
local HP = UnitBuffID(&amp;quot;player&amp;quot;, 53290)
local IIT = UnitBuffID(&amp;quot;player&amp;quot;, 55610)
local DA = UnitBuffID(&amp;quot;player&amp;quot;, 465)
local ST = UnitBuffID(&amp;quot;player&amp;quot;, 8071)
local BoM = UnitBuffID(&amp;quot;player&amp;quot;, 19740)
local FI = UnitBuffID(&amp;quot;player&amp;quot;, 54424)

if FireTotem == &amp;quot;&amp;quot; and  AirTotem == &amp;quot;&amp;quot; and EarthTotem == &amp;quot;&amp;quot; and WaterTotem == &amp;quot;&amp;quot; and incombat == 1 and PQR_SpellAvailable(66842) then
  SilentCast(66842)
  return true
end

if MQ == nil and MA == nil and PQR_SpellAvailable(3738) then
  SetMultiCastSpell (136,3738)
  if AirTotem == &amp;quot;&amp;quot; and incombat == 1  then
     CastSpellByID(3738)
     return true
  end
else
  if HP == nil and IIT == nil and PQR_SpellAvailable(8512) then
    SetMultiCastSpell (136,8512)
    if AirTotem == &amp;quot;&amp;quot; and incombat == 1 then
       SilentCast(8512)
       return true        
    end
  end
end

if DA == nil  and PQR_SpellAvailable(8071)  then
  SetMultiCastSpell (134,8071)
  if EarthTotem == &amp;quot;&amp;quot; and incombat == 1  then
     SilentCast(8071)
     return true
  end
else
   if PQR_SpellAvailable(8075) then
    SetMultiCastSpell (134,8075)
    if EarthTotem == &amp;quot;&amp;quot; and incombat == 1    then
       SilentCast(8075)
       return true
    end
   end
end

if  BoM == nil and FI == nil and PQR_SpellAvailable(5675)  then
  SetMultiCastSpell (135,5675)
  if WaterTotem == &amp;quot;&amp;quot; and incombat == 1   then
     SilentCast(5675)
     return true
  end
else 
 if PQR_SpellAvailable(5394) then
  SetMultiCastSpell (135,5394)
  if WaterTotem == &amp;quot;&amp;quot; and incombat == 1  then
      SilentCast(5394)
      return true
    end
   end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Elemental: trinket 1</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if GetInventoryItemCooldown(&amp;quot;player&amp;quot;,13) == 0 then UseInventoryItem(13) end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Elemental: trinket 2</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if  GetInventoryItemCooldown(&amp;quot;player&amp;quot;,14) == 0 then UseInventoryItem(14) end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Elemental: -- damage spells</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if (not UnitAffectingCombat(&amp;quot;target&amp;quot;) and  not UnitAffectingCombat(&amp;quot;player&amp;quot;)) then return true end

if (UnitIsDead(&amp;quot;target&amp;quot;) or UnitExists(&amp;quot;target&amp;quot;) ~= 1 ) and incombat == 1 then
  for i = 1, members, 1 do
    local member = group..tostring(i)
    if UnitGroupRolesAssigned(member) == &amp;quot;TANK&amp;quot; then
      RunMacroText(&amp;quot;/target &amp;quot;..member..&amp;quot;target&amp;quot;)
       return true
    end
  end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Elemenatal: canceltotems</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local _, WaterTotem = GetTotemInfo(3)
local _, FireTotem = GetTotemInfo(1)
local _, AirTotem = GetTotemInfo(4)
local _, EarthTotem = GetTotemInfo(2)

 if incombat ~=1 and ((FireTotem ~= &amp;quot;&amp;quot;) or  (AirTotem ~= &amp;quot;&amp;quot;) or (EarthTotem ~= &amp;quot;&amp;quot;) or (WaterTotem ~= &amp;quot;&amp;quot;)) and PQR_SpellAvailable(36936) then
    SilentCast(36936)
 end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Elemental: Earthquake</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if PQR_IsCastingSpell(61882) or not PQR_SpellAvailable(61882)then
  eqc = false
end

if PQR_SpellAvailable(61882) and GetCurrentKeyBoardFocus() == nil and eqkey==1 then
  eqc = true
end

if eqc then
  SilentCast(61882)
  if SpellIsTargeting() then CameraOrSelectOrMoveStart() CameraOrSelectOrMoveStop() end  
  return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Elemental: Chain Lightning</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local _, _, _, _, fulmination = GetTalentInfo(1, 13)

if (AOE or autoAOE) and moving == 0 then
    _,_,_,LSCount = UnitBuffID(&amp;quot;player&amp;quot;, 324)
    local _,b = GetSpellCooldown(8042)
   --- if LSCount &amp;gt;= 9 and PQR_SpellAvailable(8042) and fulmination == 1 then return true end
    SilentCast (421,&amp;quot;target&amp;quot;)
    return true
  end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Elemental: Thunderstorm</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local manapercent = 100 * UnitPower(&amp;quot;player&amp;quot;) / UnitPowerMax(&amp;quot;player&amp;quot;)
if PQR_SpellAvailable(51490) and manapercent &amp;lt; 850 then 
   SilentCast(51490)  
   return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Elemental: Searing Totem</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local _, FireTotem = GetTotemInfo(1)
if FireTotem == &amp;quot;&amp;quot; and incombat == 1 and PQR_SpellAvailable(3599) then
   SetMultiCastSpell (133,3599)
   SilentCast(3599)
   return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Elemental: Wind Shear</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local ispell = { &amp;quot;Healing Wave&amp;quot;,&amp;quot;Hex&amp;quot;,&amp;quot;Shock Blast&amp;quot;,&amp;quot;Chain Lightning&amp;quot;,&amp;quot;Shadow Strike&amp;quot;,&amp;quot;Dark Command&amp;quot;,&amp;quot;Confounding Flames&amp;quot;,&amp;quot;Warped Twilight&amp;quot;,&amp;quot;Conjure Twisted Visage&amp;quot;,&amp;quot;Focused Geyser&amp;quot;,&amp;quot;Flame Conduit&amp;quot;,&amp;quot;Chained Mind&amp;quot;,&amp;quot;Umbral Mending&amp;quot;,&amp;quot;Tranquility&amp;quot;,&amp;quot;Pact of Darkness&amp;quot;,&amp;quot;Charged Shot&amp;quot;,&amp;quot;Anti-Magic Prison&amp;quot;,&amp;quot;Reverberating Hymn&amp;quot;,&amp;quot;Summon Sun Orb&amp;quot;,&amp;quot;Inferno Leap&amp;quot;,&amp;quot;Hex&amp;quot;,&amp;quot;Ritual of Bloodletting&amp;quot;,&amp;quot;Chain Lightning&amp;quot;,&amp;quot;Lightning Lash&amp;quot;,&amp;quot;Greater Heal&amp;quot;,&amp;quot;Cloudburst&amp;quot;,&amp;quot;Force of Earth&amp;quot;,&amp;quot;Magma Eruption&amp;quot;,&amp;quot;Demon Portal&amp;quot;,&amp;quot;Force Grip&amp;quot;,&amp;quot;Holy Fire&amp;quot;,&amp;quot;Motivate&amp;quot;,&amp;quot;Seaswell&amp;quot;,&amp;quot;Fear&amp;quot;,&amp;quot;Drain Life&amp;quot;,&amp;quot;Pain and Suffering&amp;quot;,&amp;quot;Unholy Empowerment&amp;quot;,&amp;quot;Cursed Bullets&amp;quot;,&amp;quot;Fireball Volley&amp;quot;,&amp;quot;Ancient Power&amp;quot;,&amp;quot;Heal&amp;quot;,&amp;quot;Holy Light&amp;quot;,&amp;quot;Healing Wave&amp;quot;,&amp;quot;Flash Heal&amp;quot;,&amp;quot;Ancient Power&amp;quot;,&amp;quot;Blood Leech&amp;quot;,&amp;quot;Whispers of Hethiss&amp;quot;,&amp;quot;Tears of Blood&amp;quot;,&amp;quot;Fieroblast&amp;quot;}
local _,lcd =  GetSpellCooldown(57994)
if lcd == 0 then
for i = 0, members, 1 do
  if i==0 then mem = &amp;quot;player&amp;quot; else mem = group..tostring(i) end
   local meminrange = UnitInRange(mem)
   if meminrange then
     local wsinrange = IsSpellInRange(&amp;quot;Wind Shear&amp;quot;, mem..&amp;quot;target&amp;quot;)
     if UnitIsEnemy(&amp;quot;player&amp;quot;,mem..&amp;quot;target&amp;quot;) and wsinrange == 1 then
       local canint= 0
       local spell, _, _, _, _, _, _, _, interrupt = UnitChannelInfo(mem..&amp;quot;target&amp;quot;)
       if not interupt then 
         for k,v in ipairs(ispell) do        
           if spell == v then canint = 1 end
         end
       end
       local spell, _, _, _, _, _, _, _, interrupt = UnitCastingInfo(mem..&amp;quot;target&amp;quot;)
       if not interupt then 
         for k,v in ipairs(ispell) do        
           if spell == v then canint = 1 end
         end
       end
       if canint == 1 and incombat ~= nil then
          RunMacroText(&amp;quot;/stopcasting&amp;quot;)
           RunMacroText(&amp;quot;/console Sound_EnableSFX 0&amp;quot;)
           CastSpellByID(57994,mem..&amp;quot;target&amp;quot;)
           RunMacroText(&amp;quot;/console Sound_EnableSFX 1&amp;quot;)
      end
  end
end
end
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Elemental: Purge</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local buff= { 97987,43242,43421 }
  for i = 0, members, 1 do
    if i==0 then purgetarget = &amp;quot;target&amp;quot; else purgetarget = group..tostring(i)..&amp;quot;target&amp;quot; end
     local purgeinrange = IsSpellInRange(&amp;quot;Purge&amp;quot;, purgetarget)
      if UnitIsEnemy(&amp;quot;player&amp;quot;,purgetarget) and purgeinrange == 1 then
        local canpurge= 0
        for k,v in ipairs(buff) do
          if UnitBuffID(purgetarget,v) then canpurge = 1 end
        end
        if canpurge == 1 and incombat ~= nil then
           RunMacroText(&amp;quot;/console Sound_EnableSFX 0&amp;quot;)
           CastSpellByID(370,purgetarget)
           RunMacroText(&amp;quot;/console Sound_EnableSFX 1&amp;quot;)
          return true
        end
    end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Keybinds</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local function ProcessKB(sid)
   local cv = &amp;quot;onya_&amp;quot;..sid
   local dur,lcd =  GetSpellCooldown(sid)
   local name = GetSpellInfo(sid)
   local d= floor( dur - GetTime()+lcd)
   if GetCVarBool(cv) then
     SetCVar(cv,nil)
     if (d &amp;lt;10)or (lcd &amp;lt; 1.5)  then
       table.insert(spelltocast,sid)
       PQR_WriteToChat(name) 
     else
       if d &amp;gt; 10 then
         PQR_WriteToChat(name..&amp;quot; off cooldown in &amp;quot;..d..&amp;quot; seconds&amp;quot;)
       end
     end
   end
end

for k, val in pairs(onyacvars) do 
  ProcessKB(val)
end

for k,v in ipairs(spelltocast) do
  local dur,lcd =  GetSpellCooldown(v)
 --- local d= ( dur - GetTime()+lcd)
  if lcd &amp;lt; 1.5 and IsUsableSpell(v) then
    if v == 57994 then SilentCast(v,&amp;quot;target&amp;quot;)
        else SilentCast(v) end     
    return true
  end  
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>--- special events</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>---copied from team nova
-- Edited with Mentally&amp;apos;s Code
-- Fading Light
local FadingLight = {110070, 105925, 109075, 110079, 110069, 110070, 110080, 110068, 110078}
for i,v in ipairs(FadingLight) do
	if select(7,UnitDebuffID(&amp;quot;player&amp;quot;, v)) and select(7,UnitDebuffID(&amp;quot;player&amp;quot;, v)) - GetTime() &amp;lt; 2 then
			RunMacroText(&amp;quot;/click ExtraActionButton1&amp;quot;)
	end
end

-- Hour of Twilight
local HoT,_,_,_,_,timer = UnitCastingInfo(&amp;quot;boss1&amp;quot;)
local HourOfTwilight = {109415, 106371, 109416, 109415, 109417}
	
for i,v in ipairs(HourOfTwilight) do
	if HoT == GetSpellInfo(v) and timer/1000 - GetTime() &amp;lt; 2 then
		RunMacroText(&amp;quot;/click ExtraActionButton1&amp;quot;)
	end
end

-- Try to aim on Darkmoon Faerie Cannon
local canontime = select(7,UnitBuffID(&amp;quot;player&amp;quot;,102116))
if canontime and canontime - GetTime() &amp;lt; 1.07 then CancelUnitBuff(&amp;quot;player&amp;quot;,&amp;quot;Magic Wings&amp;quot;) end
-- Code provided by Kickmydog
-- Avoid Fragmentation on Madness
local tentacledeath = select(7,UnitDebuffID(&amp;quot;player&amp;quot;,109597))
if tentacledeath and tentacledeath - GetTime() &amp;lt; 0.7 then RunMacroText(&amp;quot;/click ExtraActionButton1&amp;quot;) end

--- xepler lightwell
local LightwellName = &amp;quot;Lightwell&amp;quot;
local hp = UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;) * 100
local sLightwell = UnitBuffID(&amp;quot;player&amp;quot;, 7001)
local sDeepCorruption = UnitDebuffID(&amp;quot;player&amp;quot;, 108220)
if PQR_LightwellTimeout == nil then
    PQR_LightwellTimeout = 0
end

if hp &amp;lt; 80 and sLightwell == nil then
    if PQR_LightwellTimeout &amp;lt; GetTime() then
        if sDeepCorruption == nil then
            PQR_LightwellTimeout = GetTime() + 1
            InteractUnit(LightwellName)
        end
    end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>---init</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local ctrl = IsControlKeyDown()
local leftctrl = IsLeftControlKeyDown()
local rightctrl = IsRightControlKeyDown()
local shift = IsShiftKeyDown()
local leftshift = IsLeftShiftKeyDown()
local rightshift = IsRightShiftKeyDown()
local leftalt = IsLeftAltKeyDown()
local alt = IsAltKeyDown()
local rightalt = IsRightAltKeyDown()

aoekey = rightalt or 0 -- AOE switch key
eqkey = leftctrl or 0 --- earthquake key

if PQR_RotationStarted == true then
  PQR_RotationStarted = false
  onyacvars = {2894,2825,79206,2062,36936,66842,57994} -- spells to create macros for
  aoetimer = GetTime()
  chainadds = 3 -- how many units CL needs to hit before we auto turn it on
  chaindistance = 15  -- how close a unit needs to be to jump 
  PQR_ObjMgrPulseTimer = 300
  if GetPrimaryTalentTree() ==3 then PQR_SwapRotation(&amp;quot;raid healing (ONYA resto)&amp;quot;) end
  if GetPrimaryTalentTree() ==2 then
     PQR_WriteToChat(&amp;quot;enhance spec not supported&amp;quot;)     
     PQR_StopRotation()
     return true
  end
  
 PQR_SpellAvailableTime = 0.2
 function HasGlyph(sid)
  	for i = 1,GetNumGlyphSockets() do
		local enabled, glyphType, _, glyphSpell = GetGlyphSocketInfo(i)
		if (enabled and glyphType and glyphSpell) then
			if glyphSpell == sid then return true end
		end
	end
	return false
  end
  
  function SilentCast(scspell,sctarget)
   SFX = GetCVar(&amp;quot;Sound_EnableSFX&amp;quot;)	
   ---print(SFX)
   SetCVar(&amp;quot;Sound_EnableSFX&amp;quot;, 0)
   if sctarget ~= nil then
        CastSpellByID(scspell,sctarget)        
   end
   if sctarget == nil then
      CastSpellByID(scspell)       
   end
   SetCVar(&amp;quot;Sound_EnableSFX&amp;quot;, SFX)
   return true
  end
  spelltocast = {}  
  if GetCVar(&amp;quot;synchronizeMacros&amp;quot;) ~=0 then SetCVar(&amp;quot;synchronizeMacros&amp;quot;,0) end
  for k, val in pairs(onyacvars) do 
    local aval = &amp;quot;onya_&amp;quot;..tostring(val)
    if GetCVarBool(aval) then SetCVar(aval,nil) end
    local name = GetSpellInfo(val)
    if GetMacroInfo(name) ~= name then
      local mac = &amp;quot;#showtooltip &amp;quot;..name..&amp;quot;\\n/cast &amp;quot;..name..&amp;quot;\\n/run if GetCVar\\(\\&amp;quot;&amp;quot;..aval..&amp;quot;\\&amp;quot;\\) == nil then RegisterCVar\\(\\&amp;quot;&amp;quot;..aval..&amp;quot;\\&amp;quot;\\,nil) end;SetCVar\\(\\&amp;quot;&amp;quot;..aval..&amp;quot;\\&amp;quot;\\,1)&amp;quot;
      CreateMacro(name,&amp;quot;INV_MISC_QUESTIONMARK&amp;quot;,mac, 1) 
    end
  end
  spelltocast = {}
function EventHandler(self, event, ...)
  if event == &amp;quot;COMBAT_LOG_EVENT_UNFILTERED&amp;quot; then
      if (select(2, ...) == &amp;quot;SPELL_CAST_SUCCESS&amp;quot; ) and
        bit.band(select(6, ...), COMBATLOG_OBJECT_AFFILIATION_MINE) == 1
      then
         local castspell =  select(12, ...)       
         for k,v in ipairs(spelltocast) do
            if castspell == v then table.remove(spelltocast,k) end
         end
      end
  end
end

frame = CreateFrame(&amp;quot;FRAME&amp;quot;, &amp;quot;OurFrame&amp;quot;)
frame:RegisterEvent(&amp;quot;COMBAT_LOG_EVENT_UNFILTERED&amp;quot;)
frame:SetScript(&amp;quot;OnEvent&amp;quot;, EventHandler)

  eqc = false
  autoAOE = false
  PQR_AddToSpellDelayList(61882, 0, 2) -- earthquake
 k =0
end

if aoekey==1 and ( GetTime() - k &amp;gt; 1 ) then
  k = GetTime()
  if AOE then AOE = false print(&amp;quot;single target mode&amp;quot;)
  else AOE = true print(&amp;quot;AOE mode&amp;quot;) end
end

group = &amp;quot;party&amp;quot;
members = GetNumPartyMembers()
if GetNumRaidMembers() &amp;gt; 0 then
  group = &amp;quot;raid&amp;quot;
  members = GetNumRaidMembers()
end

incombat = 1
incom = UnitAffectingCombat(&amp;quot;player&amp;quot;)
if ooctimer == nil then ooctimer = 0 end
if incom == 1 then ooctimerstarted = 0 end
if incom ~=1 and ooctimerstarted == 0 then
   ooctimer = GetTime()
   ooctimerstarted = 1
 end
if  (GetTime() - ooctimer &amp;gt; 2) and incom ~= 1 then incombat = 0 end

local SwG = UnitBuffID(&amp;quot;player&amp;quot;, 79206)
local mf = UnitBuffID(&amp;quot;player&amp;quot;, 98734)
if ((SwG ~= nil ) or ( PQR_IsMoving(0.1) == false) or (mf ~= nil )) then
 moving = 0
else 
  moving = 1
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability></SHAMAN>