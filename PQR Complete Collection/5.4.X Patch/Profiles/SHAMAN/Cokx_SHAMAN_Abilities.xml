<?xml version="1.0" encoding="utf-8" ?><SHAMAN><Ability><Name>&amp;gt; RDY</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if PQR_RotationStarted then
  ----------------------------------
  -- Load Data Files
  ----------------------------------

	if not PQR_LoadLua(&amp;quot;PQR_Cokx_PVP_DATA.lua&amp;quot;) then
		PQR_WriteToChat(&amp;quot;You are missing a key file: PQR_Cokx_PVP_DATA.lua. Please put this file in the Data folder and reload PQR. Thank You!&amp;quot;, &amp;quot;Error&amp;quot;)
		PQR_RotationStop()
		return true
		else
		PQR_WriteToChat(&amp;quot;Datafile loaded!&amp;quot;)
	end
	if not PQR_LoadLua(&amp;quot;PQR_Cokx_PVP_Settings.lua&amp;quot;) then
		PQR_WriteToChat(&amp;quot;You are missing a key file: PQR_Cokx_PVP_DATA.lua. Please put this file in the Data folder and reload PQR. Thank You!&amp;quot;, &amp;quot;Error&amp;quot;)
		PQR_RotationStop()
		return true
		else
		PQR_WriteToChat(&amp;quot;Settings loaded!&amp;quot;)
		
	end
	
	
	PQR_RotationStarted = false
end
local numglobal,numperchar = GetNumMacros()
if numperchar &amp;lt; 18 then
if not GetMacroInfo(&amp;quot;AvailableMacros&amp;quot;) then
CreateMacro(&amp;quot;AvailableMacros&amp;quot;, &amp;quot;INV_MISC_QUESTIONMARK&amp;quot;, &amp;quot;/Pause&amp;quot;, 1)
end
end


	--------------------
	-- Register CVars --
	--------------------

	Nova_ValueCheck = {
		{	Var1 = nil,	Text = &amp;quot;Toggles&amp;quot;,				Var2 = nil		},
		{	Var1 = 0,	Text = &amp;quot;Pause&amp;quot;, 				Var2 = 1		}	
	}		

	-----------------------------------------------
	-- Registering the CVars for the CustomFrame --
	-----------------------------------------------
	for i=1, #Nova_ValueCheck do
		if GetCVar(&amp;quot;Nova_&amp;quot;..Nova_ValueCheck[i].Text) == nil then 
			RegisterCVar(&amp;quot;Nova_&amp;quot;..string.gsub(Nova_ValueCheck[i].Text, &amp;quot;%s&amp;quot;, &amp;quot;_&amp;quot;), Nova_ValueCheck[i].Var1) 
		end
		if GetCVar(&amp;quot;Nova_&amp;quot;..Nova_ValueCheck[i].Text..&amp;apos;_Enabled&amp;apos;) == nil then 
			RegisterCVar(&amp;quot;Nova_&amp;quot;..string.gsub(Nova_ValueCheck[i].Text, &amp;quot;%s&amp;quot;, &amp;quot;_&amp;quot;)..&amp;apos;_Enabled&amp;apos;, Nova_ValueCheck[i].Var2) 
		end
	end


	

----------------------------
-- To Integer from String --
----------------------------
for i=1, #Nova_ValueCheck do
	if Nova_ValueCheck[i].Var1 ~= nil then
		_G[&amp;apos;Nova_&amp;apos;..string.gsub(Nova_ValueCheck[i].Text, &amp;apos;%s&amp;apos;, &amp;apos;_&amp;apos;)] = tonumber(GetCVar(&amp;apos;Nova_&amp;apos;..string.gsub(Nova_ValueCheck[i].Text, &amp;apos;%s&amp;apos;, &amp;apos;_&amp;apos;)))
	end
	if Nova_ValueCheck[i].Var2 ~= nil then
		_G[&amp;apos;Nova_&amp;apos;..string.gsub(Nova_ValueCheck[i].Text, &amp;apos;%s&amp;apos;, &amp;apos;_&amp;apos;)..&amp;apos;Check&amp;apos;] = GetCVarBool(&amp;apos;Nova_&amp;apos;..string.gsub(Nova_ValueCheck[i].Text, &amp;apos;%s&amp;apos;, &amp;apos;_&amp;apos;)..&amp;apos;_Enabled&amp;apos;)
	end
end



--------------------
-- Slash Commands --
--------------------
if SlashMacros == nil then
	SlashMacros = true

	
		SLASH_Pause1 = &amp;quot;/Pause&amp;quot;
	function SlashCmdList.Pause(msg, editbox)
		if not GetCVarBool(&amp;quot;Nova_Pause&amp;quot;) then
	
			SetCVar(&amp;quot;Nova_Pause&amp;quot;, 1)
		end
	end
	
end
if getInfos == nil then
getInfos = 0
end

CastClick()
settings()
checks()
if  GetTime() - getInfos &amp;gt; 1 and (GCDCheck(8004) or GCDCheck(3599)) then
getInfos = GetTime()
clearCEH()
if cTtimer == nil then cTtimer = 0
end
if GetTime() - cTtimer &amp;gt; 5 then
cTtimer = GetTime()
clearTables()
end
getcTar()
RangeCheckcTar()
clearcTar()
for i=1,#cTar do
redRing(cTar[i],403,39,i)
end
getmembers()
RangeCheckMembers()
clearmembers()
RangeCheckPet()
interrupt()
if GetItemCount(GetItemInfo(80618)) == 0 then
InteractUnit(&amp;quot;&amp;quot;..GetSpellInfo(57287))end

if GetItemCount(GetItemInfo(5512)) == 0 then
InteractUnit(&amp;quot;&amp;quot;..GetSpellInfo(58275))end
RunMacroText(&amp;quot;/run UIErrorsFrame:Clear()&amp;quot;)
end
GroupInfo()
cokxMacros()



if rotationPause == nil then rotationPause = 0 end

if Nova_Pause == 1 then
rotationPause = GetTime()
SetCVar(&amp;quot;Nova_Pause&amp;quot;, 0)
end
if GetTime() - rotationPause &amp;lt; 0.3 then
if MacroSpellNumber ~= 0 and MacroUnitNumber ~= 0 and GCDCheck(MacroSpellNumber) then
CastSpellByName(GetSpellInfo(MacroSpellNumber),MacroCT)
return true
end
return true
end
SetCVar(&amp;quot;MacroSpell&amp;quot;, 0)
SetCVar(&amp;quot;MacroUnit&amp;quot;, 0)
SetCVar(&amp;quot;MacroHP&amp;quot;, 100)
SetCVar(&amp;quot;MacroDR&amp;quot;,nil)
SetCVar(&amp;quot;MacroBuff&amp;quot;,nil)
SetCVar(&amp;quot;MacroDebuff&amp;quot;,nil)

if not playerdpsinc then playerdpsinc = 0 end
if not playerdpssum then playerdpssum = 0 end
if not playerdpscalc then playerdpscalc = 0 end
if not sumDps then sumDps = 0 end
if not lastplayerhp then lastplayerhp = UnitHealth(&amp;quot;player&amp;quot;) end



if modtime == nil then
	modtime = 0
end

if GetTime() - modtime &amp;gt; 1 then
	modtime = GetTime()
	playerdpsinc = lastplayerhp -UnitHealth(&amp;quot;player&amp;quot;)
	playerdpssum = playerdpssum + playerdpsinc
	lastplayerhp = UnitHealth(&amp;quot;player&amp;quot;)
end

if avgmodtime == nil then
	avgmodtime = 0
end

if GetTime() - avgmodtime &amp;gt; 5 then
	avgmodtime = GetTime()
	sumDps = 0
	playerdpscalc = playerdpssum/5
	sumDps = playerdpscalc
	playerdpscalc = 0
	playerdpssum = 0
end









if numberfriends == 0 or numberfriends &amp;gt; #members then
numberfriends = #members or nil
end

if UnitExists(&amp;quot;target&amp;quot;)
and PQR_UnitFacing(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;)
then
IsFacing = true
else
IsFacing = false
end


local flag = { &amp;quot;&amp;quot;..GetSpellInfo(23335), &amp;quot;&amp;quot;..GetSpellInfo(23333) }

for _,v in ipairs(flag) do 
InteractUnit(v)end

local arg1, arg2, arg3, arg4 = UnitBuffID( &amp;quot;player&amp;quot;, 53817 )

if HaveBuff(&amp;quot;player&amp;quot;,{79206,16188},0) or not PQR_IsMoving(.1) or arg4 == 5 then
IsMoving = 1
else
IsMoving = 0
end


-------------------



if not inMelee then
inMelee = 0
end

if UnitExists(&amp;quot;target&amp;quot;) and inRange(&amp;quot;target&amp;quot;,60103) then
inMelee = 1
else 
inMelee = 0
end


if aoetoggletimer == nil then
	aoetoggletimer = 0
end

if shamanaoego == nil then
	shamanaoego = 0
end

if shamanaoe
and shamantoggle == 1
and shamanaoego == 0
and GetTime() - aoetoggletimer &amp;gt; 0.5 then
	aoetoggletimer = GetTime()
	shamanaoego = 1
	PQR_WriteToChat(&amp;quot;Shaman AOE ON!&amp;quot;)
end

if shamanaoe
and shamantoggle == 1
and shamanaoego == 1
and GetTime() - aoetoggletimer &amp;gt; 0.5 then
	aoetoggletimer = GetTime()
	shamanaoego = 0
	PQR_WriteToChat(&amp;quot;Shaman AOE OFF!&amp;quot;)
end

if shamanaoe
and shamantoggle == 0
then
shamanaoego = 1
end
if not shamanaoe
and shamantoggle == 0
then
shamanaoego = 0
end



local _,_,_,Lbcount,_,_,Lbtimer = UnitBuffID(&amp;quot;player&amp;quot;,324,&amp;quot;PLAYER&amp;quot;) 
if Lbcount == 7 then
goRage = 1
if UnitExists(&amp;quot;target&amp;quot;) and CalculateHP(&amp;quot;target&amp;quot;) &amp;lt; 30 and Lbcount &amp;gt; 3 then
goRage = 1
end
else
goRage = 0
end
SpellCancelQueuedSpell()


local spell, _, _, _, _, endTime = UnitCastingInfo(&amp;quot;player&amp;quot;)
if lastHealTarget == nil or 0 then lastHealTarget = 1 end
if CalculateHP(members[lastHealTarget]) == 100
and UnitAffectingCombat(&amp;quot;player&amp;quot;) 
and (spell == GetSpellInfo(331)
or spell == GetSpellInfo(8004)
or spell == GetSpellInfo(77472))
then
SpellStopCasting()
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>JukeBox</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not JukeBoxHero then
	JukeBoxHero = CreateFrame(&amp;quot;FRAME&amp;quot;, nil, UIParent)
	JukeBoxHero:Hide()
end

function JukeBoxHero_OnEvent(self, event, ...)
	local type, _, sourceGUID, sourceNAME, _, _, destGUID, destNAME = select(2, ...)
	if event == &amp;quot;COMBAT_LOG_EVENT_UNFILTERED&amp;quot; then
		if type == &amp;quot;SPELL_CAST_SUCCESS&amp;quot; then
			if destGUID == UnitGUID(&amp;quot;player&amp;quot;)
			and not HaveBuff(&amp;quot;player&amp;quot;,131557,0) then
				local spellId = select(12, ...)
				local listId = {
				
					47476, --Strangulate
					15487, -- Shadow Silence
				34490,	-- Silencing Shot
				
				17962,
				2139, --Counterspell
					19647 --Spell Lock
					
				}
					for i = 1, #listId do
					if listId[i] == spellId then
						SpellStopCasting()
						SpellStopCasting()
						SpellStopCasting()
						for i = 1, #members do
						if CalculateHP(members[i]) &amp;lt; 70 
						and IsSpellKnown(61295)
						and eMembers[i].Range &amp;lt; 40 then
						CastSpellByName(GetSpellInfo(79206)) 
						end
						end
						PQR_WriteToChat(&amp;quot;JukeBox Fake&amp;quot;)
							return true
					end
				end
							local listId = {
					6552, --Pummel
					1766, --Kick
					47528, --Mind Freeze
					47476, --Strangulate
					147362,
					102060,
					96231, --Rebuke
					15487, -- Shadow SIlence
					116705, -- Spear Hand
					57994, --Wind Shear
					2139, --Counterspell
					19647, --Spell Lock
					80965 --Skull Bash
				}
					for i = 1, #listId do
					if listId[i] == spellId then
						SpellStopCasting()
						SpellStopCasting()
						SpellStopCasting()
						PQR_WriteToChat(&amp;quot;JukeBox Fake&amp;quot;)
						PQR_DelayRotation(.5)
						return true
					end
				end
			end
		end
	end
end

JukeBoxHero:SetScript(&amp;quot;OnEvent&amp;quot;, JukeBoxHero_OnEvent)
JukeBoxHero:RegisterEvent(&amp;quot;COMBAT_LOG_EVENT_UNFILTERED&amp;quot;)</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Interrupt</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>for j=1 , #cTar do
	 if  UnitExists(cTar[j])
     and (100 * UnitHealth(cTar[j]) / UnitHealthMax(cTar[j])) &amp;lt; 60
     then
     ddislow = 1
    
     
     end
  end
  
  for j=1 , #cTar do
	 if  UnitExists(cTar[j])
     and IsHealer(cTar[j])
     then
     interrupthealer = 1
     end
  end
  
  for i=1, numberfriends do
  if UnitExists(members[i])
  and CalculateHP(members[i]) &amp;lt; 60 then
  interrupthealer = 0
  end
  end
  


for i=1, #cTar do
	if UnitExists(cTar[i])
	  and IsHealer(cTar[i])
	  and ddislow == 1
	  and interrupthealer == 1
	and UnitCanAttack(&amp;quot;player&amp;quot;,cTar[i])
	 then
			local castName, _, _, _, castStartTime, castEndTime, _, _, castInterruptable = UnitCastingInfo(cTar[i])
			for _, v in ipairs(castInt()) do
				if GetSpellInfo(v) == castName and castInterruptable == false then
						local timeSinceStart = (GetTime() * 1000 - castStartTime) / 1000 + (tonumber((select(3,GetNetStats()) + select(4,GetNetStats())) / 2000)) 
						local timeLeft = ((GetTime() * 1000 - castEndTime) * -1) / 1000
						local castTime = castEndTime - castStartTime
						local currentPercent = timeSinceStart / castTime * 100000
					if currentPercent &amp;gt; maxMSinterrupt  
					and currentPercent &amp;lt; minMSinterrupt  
					then
						PQR_CustomTarget = cTar[i]
						if select(2,GetSpellCooldown(57994)) == 0
							and inRange(cTar[i],57994)
							and ecTar[i].Facing
							and LineOfSight(cTar[i])
							then
							SpellStopCasting()
							CastSpellByName(GetSpellInfo(57994),PQR_CustomTarget)
					--		PQR_DelayRotation(.5)
							return true
						end
					
					end
				end
			end
	
	

---------------------------------------------





	
			local channelName, _, _, _, channelStartTime, channelEndTime, _, channelInterruptable = UnitChannelInfo(cTar[i])
			for _, v in ipairs(channelInt()) do
				if GetSpellInfo(v) == channelName and channelInterruptable == false then
						local timeSinceStart = (GetTime() * 1000 - channelStartTime) / 1000  + (tonumber((select(3,GetNetStats()) + select(4,GetNetStats())) / 2000)) 
						local timeLeft = ((GetTime() * 1000 - channelEndTime) * -1) / 1000
						local castTime = channelEndTime - channelStartTime
						local currentPercent = timeSinceStart / castTime * 100000
					if currentPercent &amp;lt; channelInterruptmax  
					and currentPercent &amp;gt; channelInterruptmin  
					then
						PQR_CustomTarget = cTar[i]
						if select(2,GetSpellCooldown(57994)) == 0
							and inRange(cTar[i],57994)
							and ecTar[i].Facing
							and LineOfSight(cTar[i])
							then
							SpellStopCasting()
							CastSpellByName(GetSpellInfo(57994),PQR_CustomTarget)
						--	PQR_DelayRotation(.5)
							return true
						end
					
					end
				end
			end
		end
	end






for i=1, #cTar do
	if UnitExists(cTar[i])
	 and (interrupthealer == 0 or (ddislow == 0 and interrupthealer == 1))
	and UnitCanAttack(&amp;quot;player&amp;quot;,cTar[i]) then
			local castName, _, _, _, castStartTime, castEndTime, _, _, castInterruptable = UnitCastingInfo(cTar[i])
			for _, v in ipairs(castInt()) do
				if GetSpellInfo(v) == castName and castInterruptable == false then
						local timeSinceStart = (GetTime() * 1000 - castStartTime) / 1000 + (tonumber((select(3,GetNetStats()) + select(4,GetNetStats())) / 2000)) 
						local timeLeft = ((GetTime() * 1000 - castEndTime) * -1) / 1000
						local castTime = castEndTime - castStartTime
						local currentPercent = timeSinceStart / castTime * 100000
					if currentPercent &amp;gt; maxMSinterrupt  
					and currentPercent &amp;lt; minMSinterrupt  
					then
						PQR_CustomTarget = cTar[i]
						if select(2,GetSpellCooldown(57994)) == 0
							and inRange(cTar[i],57994)
							and ecTar[i].Facing
							and LineOfSight(cTar[i])
							then
							SpellStopCasting()
							CastSpellByName(GetSpellInfo(57994),PQR_CustomTarget)
					--		PQR_DelayRotation(.5)
							return true
						end
					
					end
				end
			end
	
	

---------------------------------------------




	
			local channelName, _, _, _, channelStartTime, channelEndTime, _, channelInterruptable = UnitChannelInfo(cTar[i])
			for _, v in ipairs(channelInt()) do
				if GetSpellInfo(v) == channelName and channelInterruptable == false then
						local timeSinceStart = (GetTime() * 1000 - channelStartTime) / 1000  + (tonumber((select(3,GetNetStats()) + select(4,GetNetStats())) / 2000)) 
						local timeLeft = ((GetTime() * 1000 - channelEndTime) * -1) / 1000
						local castTime = channelEndTime - channelStartTime
						local currentPercent = timeSinceStart / castTime * 100000
					if currentPercent &amp;lt; channelInterruptmax  
					and currentPercent &amp;gt; channelInterruptmin  
					then
						PQR_CustomTarget = cTar[i]
						if select(2,GetSpellCooldown(57994)) == 0
							and inRange(cTar[i],57994)
							and ecTar[i].Facing
							and LineOfSight(cTar[i])
							then
							SpellStopCasting()
							CastSpellByName(GetSpellInfo(57994),PQR_CustomTarget)
						--	PQR_DelayRotation(.5)
							return true
						end
					
					end
				end
			end
		end
	end



ddislow = 0
interrupthealer = 0</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>TotemKill</Name><Default>false</Default><SpellID>30455</SpellID><Actions></Actions><Lua>local typem= UnitCreatureType(&amp;quot;mouseover&amp;quot;)

if UnitExists(&amp;quot;mouseover&amp;quot;)
and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;mouseover&amp;quot;) 
and typem == &amp;quot;Totem&amp;quot;
then
	return true
end</Lua><RecastDelay>0</RecastDelay><Target>Mouseover</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Success</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if CombatLog == nil then
    BuBa_CombatLog = CreateFrame(&amp;apos;Frame&amp;apos;)
    BuBa_CombatLog:RegisterEvent(&amp;quot;COMBAT_LOG_EVENT_UNFILTERED&amp;quot;)

 function OnSuccessfulCast(self, event, ...)
  local type, _, sourceGUID, sourceNAME, _, _, destGUID, destNAME = select(2, ...)
  if (event==&amp;quot;COMBAT_LOG_EVENT_UNFILTERED&amp;quot;) then
            if (type==&amp;quot;SPELL_CAST_SUCCESS&amp;quot;) 
             or (type==&amp;quot;SPELL_CAST_START&amp;quot;) then
                if sourceGUID == UnitGUID(&amp;quot;player&amp;quot;) then
         if select(12, ...) == GetSpellInfo(403) 
         or select(12, ...) == 403 
         then
		lightning = 1
		else
		lightning = 0
	
	      end
	     end
    end
   end
  end

 BuBa_CombatLog:SetScript(&amp;apos;OnEvent&amp;apos;, OnSuccessfulCast)

    CombatLog = true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Auto Trinket</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if HaveDebuff(&amp;quot;player&amp;quot;,
{
--115001,		-- Remorseless Winter ( not sure about this, cause it could activate onf 4 or below stacks ....)
110698,		-- Hammer of Justice (Paladin)
117526,		-- Binding Shot
3355,		-- Freezing Trap
118271,		-- Combustion Impact
44572,		-- Deep Freeze
31661,		-- Dragon&amp;apos;s Breath
118,		-- Polymorph
61305,		-- Polymorph: Black Cat
28272,		-- Polymorph: Pig
61721,		-- Polymorph: Rabbit
61780,		-- Polymorph: Turkey
28271,		-- Polymorph: Turtle
82691,		-- Ring of Frost
123393,		-- Breath of Fire (Glyph of Breath of Fire)
115078,		-- Paralysis
105421,		-- Blinding Light
115752,		-- Blinding Light (Glyph of Blinding Light)
105593,		-- Fist of Justice
853,		-- Hammer of Justice
119072,		-- Holy Wrath
20066,		-- Repentance
10326,		-- Turn Evil
64044,		-- Psychic Horror
8122,		-- Psychic Scream
113792,		-- Psychic Terror (Psyfiend)
9484,		-- Shackle Undead
118905,		-- Static Charge (Capacitor Totem)
5782,		-- Fear
118699,		-- Fear
5484,		-- Howl of Terror
6789,		-- Mortal Coil
30283,		-- Shadowfury
104045,		-- Sleep (Metamorphosis)
115268,		-- Mesmerize (Shivarra)
113092,		-- Frost Bomb
6358,		-- Seduction (Succubus)
	108194,		-- Asphyxiate
	115001,		-- Remorseless Winter
	91800,		-- Gnaw
	91797,		-- Monstrous Blow (Dark Transformation)
	102795,		-- Bear Hug
	22570,		-- Maim
	5211,		-- Mighty Bash
	9005,		-- Pounce
	102546,		-- Pounce (Incarnation)
	110698,		-- Hammer of Justice (Paladin)
	113004,		-- Intimidating Roar [Fleeing in fear] (Warrior)
	118271,		-- Combustion Impact
	44572,		-- Deep Freeze
	126451,		-- Clash
	122242,		-- Clash (not sure which one is right)
	119392,		-- Charging Ox Wave
	119381,		-- Leg Sweep
	105593,		-- Fist of Justice
	853,		-- Hammer of Justice
	88625,		-- Holy Word: Chastise
	64044,		-- Psychic Horror
	8122,		-- Psychic Scream
	113792,		-- Psychic Terror (Psyfiend)
	1833,		-- Cheap Shot
	408,		-- Kidney Shot
	113953,		-- Paralysis (Paralytic Poison)
	51514,		-- Hex
	118905,		-- Static Charge (Capacitor Totem)
	54786,		-- Demonic Leap (Metamorphosis)
	5782,		-- Fear
	118699,		-- Fear
	5484,		-- Howl of Terror
	6789,		-- Mortal Coil
	30283,		-- Shadowfury
	89766,		-- Axe Toss (Felguard/Wrathguard)
	7922,		-- Charge Stun
	118895,		-- Dragon Roar
	5246,		-- Intimidating Shout (aoe)
	132168,		-- Shockwave
	105771		-- Warbringer
},3)
and (100 * UnitHealth(&amp;quot;target&amp;quot;) / UnitHealthMax(&amp;quot;target&amp;quot;)) &amp;lt;= 60
and GetInventoryItemCooldown(&amp;quot;player&amp;quot;, 14) == 0
 then
	
	RunMacroText(&amp;quot;/use 14&amp;quot;)
	return true
	end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Remove Curse</Name><Default>false</Default><SpellID>51886</SpellID><Actions></Actions><Lua>for i=1,numberfriends do 

    if (UnitInRange(members[i]) or eMembers[i].Range &amp;lt; 40)
    and GCDCheck(51886)
    and not HaveDebuff(members[i],{33786,113506},0)
    and HaveDebuff(members[i],{51514,80240},0) 
    and LineOfSight(members[i])
    then
      PQR_CustomTarget = members[i]  
       return true
       end
    end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Lightning Shield</Name><Default>false</Default><SpellID>324</SpellID><Actions></Actions><Lua>if not HaveBuff(&amp;quot;player&amp;quot;,324,1)
and GCDCheck(324)
then return true end</Lua><RecastDelay>10000</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Lightning Bolt</Name><Default>false</Default><SpellID>403</SpellID><Actions></Actions><Lua>if IsFacing
and GCDCheck(403)
and (shamanaoego == 0 or IsMoving == 0 )
and PQR_SpellAvailable(403)
and inRange(&amp;quot;target&amp;quot;,403)
and LineOfSight(&amp;quot;target&amp;quot;)
and not HaveBuff(&amp;quot;target&amp;quot;,iDMG(),1)
and not HaveBuff(&amp;quot;target&amp;quot;,iSpells(),1)
and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) 
 then
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Lava Burst</Name><Default>false</Default><SpellID>51505</SpellID><Actions></Actions><Lua>if (IsMoving == 1 or HaveBuff(&amp;quot;player&amp;quot;,77762,0))
and PQR_SpellAvailable(51505)
and GCDCheck(51505)
and IsFacing
and shamanaoego == 0
and inRange(&amp;quot;target&amp;quot;,403)
and LineOfSight(&amp;quot;target&amp;quot;)
and not HaveBuff(&amp;quot;target&amp;quot;,iDMG(),1)
and not HaveBuff(&amp;quot;target&amp;quot;,iSpells(),1)
and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) 
 then
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>FlameShock</Name><Default>false</Default><SpellID>8050</SpellID><Actions></Actions><Lua>if  not HaveDebuff(&amp;quot;target&amp;quot;,8050,2,&amp;quot;player&amp;quot;)
and UnitExists(&amp;quot;target&amp;quot;)
and GCDCheck(8050)
and IsFacing
and goRage == 0
	and not HaveBuff(&amp;quot;target&amp;quot;,iDMG(),0)
	and not HaveBuff(&amp;quot;target&amp;quot;,iSpell(),0)
	and not HaveBuff(&amp;quot;player&amp;quot;,103958,0)
	and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) 
	and LineOfSight(&amp;quot;target&amp;quot;) then
	PQR_CustomTarget = &amp;quot;target&amp;quot;
	return true
	end
	

	
	for i=1 , #cTar do
	
	if UnitExists(cTar[i]) then
	if not HaveDebuff(cTar[i],8050,2,&amp;quot;player&amp;quot;)
	and GCDCheck(8050)
	and LineOfSight(cTar[i])
	and ecTar[i].Range &amp;lt; 45
	and ecTar[i].Facing
	and goRage == 0
	and not HaveBuff(cTar[i],iDMG(),0)
	and not HaveBuff(&amp;quot;player&amp;quot;,103958,0)
	and not UnitIsDeadOrGhost(cTar[i])
	and not HaveDebuff(cTar[i],ccCanBreak(),0) 
	and not HaveBuff(cTar[i],iSpell(),0)
	and UnitCanAttack(&amp;quot;player&amp;quot;,cTar[i]) 
	then
	PQR_CustomTarget = cTar[i]
	return true
	end
	end
	end</Lua><RecastDelay>50</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Ele: Earth Shock</Name><Default>false</Default><SpellID>8042</SpellID><Actions></Actions><Lua>if goRage == 1
and GCDCheck(8042)
and IsFacing
and inRange(&amp;quot;target&amp;quot;,8042)
and LineOfSight(&amp;quot;target&amp;quot;)
and not HaveBuff(&amp;quot;target&amp;quot;,iDMG(),1)
and not HaveBuff(&amp;quot;target&amp;quot;,iSpells(),1)
and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) 
 then
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Elemental Blast</Name><Default>false</Default><SpellID>117014</SpellID><Actions></Actions><Lua>if IsFacing
and GCDCheck(117014)
and PQR_SpellAvailable(117014)
and IsMoving == 1
and inRange(&amp;quot;target&amp;quot;,403)
and LineOfSight(&amp;quot;target&amp;quot;)
and not HaveBuff(&amp;quot;target&amp;quot;,iDMG(),1)
and not HaveBuff(&amp;quot;target&amp;quot;,iSpells(),1)
and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) 
 then
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Unleash Elements</Name><Default>false</Default><SpellID>73680</SpellID><Actions></Actions><Lua>if IsFacing
and GCDCheck(73680)
and inRange(&amp;quot;target&amp;quot;,403)
and LineOfSight(&amp;quot;target&amp;quot;)
and not HaveBuff(&amp;quot;target&amp;quot;,iDMG(),1)
and not HaveBuff(&amp;quot;target&amp;quot;,iSpells(),1)
and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) 
 then
return true
end</Lua><RecastDelay>800</RecastDelay><Target>Target</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Frost Shock</Name><Default>false</Default><SpellID>8056</SpellID><Actions></Actions><Lua>if UnitExists(&amp;quot;target&amp;quot;)
and GCDCheck(8056)
and UnitExists(cTar[1])
and 100 * UnitHealth(&amp;quot;target&amp;quot;) / UnitHealthMax(&amp;quot;target&amp;quot;) &amp;gt;= 25
and UnitIsPlayer(&amp;quot;target&amp;quot;) 

and IsFacing
and LineOfSight(&amp;quot;target&amp;quot;)
and ecTar[1].Range &amp;lt; 45
and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) 
and not HaveBuff(&amp;quot;target&amp;quot;,iDMG(),0) 
and not HaveBuff(&amp;quot;target&amp;quot;,iSpell(),0) 
--and HaveDebuff(&amp;quot;player&amp;quot;,aSRS(),0)
and not HaveDebuff(&amp;quot;target&amp;quot;,aSRS(),0)
and not HaveBuff(&amp;quot;target&amp;quot;,iSlow(),0)
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Auto Thunderstorm</Name><Default>false</Default><SpellID>51490</SpellID><Actions></Actions><Lua>for i=1 , #cTar do
	
	if UnitExists(cTar[i]) then
	if  LineOfSight(cTar[i])
	and GCDCheck(51490)
	and ecTar[i].Range &amp;lt; 10
	and CalculateHP(&amp;quot;player&amp;quot;) &amp;lt; 50
	and not HaveBuff(cTar[i],iDMG(),0)
	and not HaveDebuff(&amp;quot;target&amp;quot;,44572,0)
	and not UnitIsDeadOrGhost(cTar[i])
	and UnitIsPlayer(cTar[i])
	and not HaveDebuff(cTar[i],ccCanBreak(),0) 
	and not HaveBuff(cTar[i],iSpell(),0)
	and UnitCanAttack(&amp;quot;player&amp;quot;,cTar[i]) 
	then
	PQR_CustomTarget = cTar[i]
	return true
	end
	end
end</Lua><RecastDelay>400</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Purge</Name><Default>false</Default><SpellID>370</SpellID><Actions></Actions><Lua>for i=1, #cTar do
	if UnitExists(cTar[i]) then
	if  LineOfSight(cTar[i])
and GCDCheck(370)
	and ecTar[i].Range &amp;lt; 30
	and ecTar[i].Facing
	and 100 * ( UnitPower(&amp;quot;player&amp;quot;)) / UnitPowerMax(&amp;quot;player&amp;quot;) &amp;gt; 10
	and not HaveBuff(cTar[i],iDMG(),1)
	and HaveBuff(cTar[i],{1022,6940,108978},1.5)
	and not UnitIsDeadOrGhost(cTar[i])
	and UnitIsPlayer(cTar[i])
	and UnitCanAttack(&amp;quot;player&amp;quot;,cTar[i]) 
	then
	PQR_CustomTarget = cTar[i]
	 
	return true
	end
	end
	end


for i=1 , #cTar do
	
	if UnitExists(cTar[i]) then
	if  LineOfSight(cTar[i])
and GCDCheck(370)
	and ecTar[i].Range &amp;lt; 30
	and not HaveBuff(&amp;quot;player&amp;quot;,77762,0)
	and (100 * ( UnitPower(&amp;quot;player&amp;quot;)) / UnitPowerMax(&amp;quot;player&amp;quot;) &amp;gt; 70 or CalculateHP(cTar[i]) &amp;lt; 30)
	and not HaveBuff(cTar[i],iDMG(),1)
	and HaveBuff(cTar[i],{29166,132158,53271,12472,12043,44549,54428,6940,774,
	10060,6346,16166,16188,117014,79206,48108,124682,1022,6940,1044,974,108978},1.5)
	and not UnitIsDeadOrGhost(cTar[i])
	and UnitIsPlayer(cTar[i])
	and not HaveBuff(cTar[i],33763,3)
	and not HaveBuff(cTar[i],iSpell(),1)
	and UnitCanAttack(&amp;quot;player&amp;quot;,cTar[i]) 
	then
	PQR_CustomTarget = cTar[i]
	return true
	end
	end
	
if UnitExists(cTar[i]) then
	if  LineOfSight(cTar[i])
and GCDCheck(370)
	and ecTar[i].Range &amp;lt; 30
	and (100 * ( UnitPower(&amp;quot;player&amp;quot;)) / UnitPowerMax(&amp;quot;player&amp;quot;) &amp;gt; 70 or CalculateHP(cTar[i]) &amp;lt; 30)
	and not HaveBuff(cTar[i],iDMG(),1)
	and (HaveBuff(cTar[i],{11426},2))
	and not UnitIsDeadOrGhost(cTar[i])
		and not HaveBuff(&amp;quot;player&amp;quot;,77762,0)
	and UnitIsPlayer(cTar[i])
		and not HaveBuff(cTar[i],33763,3)
	and not HaveBuff(cTar[i],iSpell(),1)
	and UnitCanAttack(&amp;quot;player&amp;quot;,cTar[i]) 
	then
	purgemeter = select(15, UnitBuff(cTar[i],GetSpellInfo(11426),nil))
	if purgemeter &amp;gt; 60000 then
	PQR_CustomTarget = cTar[i]
	return true
	end
	end
	end
	
	if UnitExists(cTar[i]) then
	if  LineOfSight(cTar[i])
and GCDCheck(370)
	and ecTar[i].Range &amp;lt; 30
	and (100 * ( UnitPower(&amp;quot;player&amp;quot;)) / UnitPowerMax(&amp;quot;player&amp;quot;) &amp;gt; 70 or CalculateHP(cTar[i]) &amp;lt; 30)
	and not HaveBuff(cTar[i],iDMG(),1)
	and (HaveBuff(cTar[i],{17},2))
		and not HaveBuff(cTar[i],33763,3)
	and not UnitIsDeadOrGhost(cTar[i])
		and not HaveBuff(&amp;quot;player&amp;quot;,77762,0)
	and UnitIsPlayer(cTar[i])
	and not HaveBuff(cTar[i],iSpell(),1)
	and UnitCanAttack(&amp;quot;player&amp;quot;,cTar[i]) 
	then
	purgemeter = select(15, UnitBuff(cTar[i],GetSpellInfo(17),nil))
	if purgemeter &amp;gt; 60000 then
	PQR_CustomTarget = cTar[i]
	return true
	end
	end
	end
	
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Grounding</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>for i = 1, numberfriends do
if GCDCheck(8177)
and UnitExists(members[i])
and CalculateHP(members[i]) &amp;lt; 25
and (eMembers[i].Range &amp;lt; 30)
and LineOfSight(members[i])
then
for j = 1, #cTar do
if select(2, UnitClass(cTar[j])) == &amp;quot;Mage&amp;quot;
or select(2, UnitClass(cTar[j])) == &amp;quot;Druid&amp;quot;
or select(2, UnitClass(cTar[j])) == &amp;quot;Warlock&amp;quot;
or select(2, UnitClass(cTar[j])) == &amp;quot;Priest&amp;quot;
or select(2, UnitClass(cTar[j])) == &amp;quot;Paladin&amp;quot;
or select(2, UnitClass(cTar[j])) == &amp;quot;Shaman&amp;quot;
then
CastSpellByName(GetSpellInfo(8177))
return true
end
end
end
end




for i=1, #cTar do
	if UnitExists(cTar[i])
	  and GCDCheck(8177)
	and UnitCanAttack(&amp;quot;player&amp;quot;,cTar[i])
	 then
			local castName, _, _, _, castStartTime, castEndTime, _, _, castInterruptable = UnitCastingInfo(cTar[i])
			for _, v in ipairs(groundSpells()) do
				if GetSpellInfo(v) == castName and castInterruptable == false then
					
						if  ecTar[i].Range &amp;lt; 40
							and LineOfSight(cTar[i])
							then
							SpellStopCasting()
							 CastSpellByName(GetSpellInfo(8177))
							return true
						end
					
				
				end
			end
	
	

---------------------------------------------





	
			local channelName, _, _, _, channelStartTime, channelEndTime, _, channelInterruptable = UnitChannelInfo(cTar[i])
			for _, v in ipairs(groundSpells()) do
				if GetSpellInfo(v) == channelName  then
					
					
						if ecTar[i].Range &amp;lt; 40
							and LineOfSight(cTar[i])
							then
							SpellStopCasting()
							 CastSpellByName(GetSpellInfo(8177))
							return true
						end
					
				
				end
			end
		end
	end






for i=1, #cTar do
	if UnitExists(cTar[i])
	  and GCDCheck(8177)
	and UnitCanAttack(&amp;quot;player&amp;quot;,cTar[i]) then
			local castName, _, _, _, castStartTime, castEndTime, _, _, castInterruptable = UnitCastingInfo(cTar[i])
			for _, v in ipairs(groundSpells()) do
				if GetSpellInfo(v) == castName  then
					
					
						if  ecTar[i].Range &amp;lt; 40
							and LineOfSight(cTar[i])
							then
							SpellStopCasting()
							 CastSpellByName(GetSpellInfo(8177))
							return true
						end
				
				end
			end
	
	

---------------------------------------------




	
			local channelName, _, _, _, channelStartTime, channelEndTime, _, channelInterruptable = UnitChannelInfo(cTar[i])
			for _, v in ipairs(groundSpells()) do
				if GetSpellInfo(v) == channelName then
					
						
						if  ecTar[i].Range &amp;lt; 40
							and LineOfSight(cTar[i])
							then
							SpellStopCasting()
							 CastSpellByName(GetSpellInfo(8177))
							return true
						end
					
				
				end
			end
		end
	end
	
	
	
	
	
--------------------------</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Purge Target</Name><Default>false</Default><SpellID>370</SpellID><Actions></Actions><Lua>purgemeter = 0
if UnitExists(cTar[1]) then
	if  LineOfSight(cTar[1])
and GCDCheck(370)
	and ecTar[1].Range &amp;lt; 30
	and (100 * ( UnitPower(&amp;quot;player&amp;quot;)) / UnitPowerMax(&amp;quot;player&amp;quot;) &amp;gt; 40 or CalculateHP(cTar[1]) &amp;lt; 40)
	and not HaveBuff(cTar[1],iDMG(),1)
	and HaveBuff(cTar[1],{29166,139,132158,53271,12472,12043,44549,54428,6940,774,115151,
	10060,6346,16166,16188,117014,79206,48108,124682,1022,6940,1044,974,108978},1.5)
	and not UnitIsDeadOrGhost(cTar[1])
	and UnitIsPlayer(cTar[1])
		and not HaveBuff(cTar[1],33763,3)
	and not HaveBuff(cTar[1],iSpell(),1)
	and not HaveBuff(&amp;quot;player&amp;quot;,114049,0)
	and UnitCanAttack(&amp;quot;player&amp;quot;,cTar[1]) 
	then
	PQR_CustomTarget = cTar[1]
	return true
	end
	end
	
if UnitExists(cTar[1]) then
	if  LineOfSight(cTar[1])
and GCDCheck(370)
	and ecTar[1].Range &amp;lt; 30
	and (100 * ( UnitPower(&amp;quot;player&amp;quot;)) / UnitPowerMax(&amp;quot;player&amp;quot;) &amp;gt; 40 or CalculateHP(cTar[1]) &amp;lt; 40)
	and not HaveBuff(cTar[1],iDMG(),1)
	and (HaveBuff(cTar[1],{11426},4))
	and not UnitIsDeadOrGhost(cTar[1])
	and UnitIsPlayer(cTar[1])
			and not HaveBuff(cTar[1],33763,3)
	and not HaveBuff(cTar[1],iSpell(),1)
		and not HaveBuff(&amp;quot;player&amp;quot;,114049,0)
	and UnitCanAttack(&amp;quot;player&amp;quot;,cTar[1]) 
	then
	purgemeter = select(15, UnitBuff(cTar[1],GetSpellInfo(11426),nil))
	if purgemeter &amp;gt; 50000 then
	PQR_CustomTarget = cTar[1]
	return true
	end
	end
	end
	
	if UnitExists(cTar[1]) then
	if  LineOfSight(cTar[1])
and GCDCheck(370)
	and ecTar[1].Range &amp;lt; 30
	and (100 * ( UnitPower(&amp;quot;player&amp;quot;)) / UnitPowerMax(&amp;quot;player&amp;quot;) &amp;gt; 40 or CalculateHP(cTar[1]) &amp;lt; 40)
	and not HaveBuff(cTar[1],iDMG(),1)
	and (HaveBuff(cTar[1],{17},4))
	and not UnitIsDeadOrGhost(cTar[1])
	and UnitIsPlayer(cTar[1])
			and not HaveBuff(cTar[1],33763,3)
	and not HaveBuff(cTar[1],iSpell(),1)
		and not HaveBuff(&amp;quot;player&amp;quot;,114049,0)
	and UnitCanAttack(&amp;quot;player&amp;quot;,cTar[1]) 
	then
	purgemeter = select(15, UnitBuff(cTar[1],GetSpellInfo(17),nil))
	if purgemeter &amp;gt; 50000 then
	PQR_CustomTarget = cTar[1]
	return true
	end
	end
	end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Searing Totem</Name><Default>false</Default><SpellID>3599</SpellID><Actions></Actions><Lua>local haveTotem, totemName, startTime, duration = GetTotemInfo(1)
local dauer = startTime+duration-GetTime() 

if UnitExists(&amp;quot;target&amp;quot;)
and GCDCheck(3599)
and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) 
and dauer &amp;lt; 1 then
	return true	
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Healing Stream</Name><Default>false</Default><SpellID>5394</SpellID><Actions></Actions><Lua>local haveTotem, totemName, startTime, duration = GetTotemInfo(3)
local dauer = startTime+duration-GetTime() 




for i = 1, numberfriends do
if CalculateHP(members[i]) &amp;lt; 90
and GCDCheck(5394)
and not HaveDebuff(members[i],{33786,113506},0)
and (UnitInRange(members[i]) or eMembers[i].Range &amp;lt; 40)
and LineOfSight(members[i])
then
if dauer &amp;lt; 0.1 then
	return true	
end
end
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Earthbind Totem</Name><Default>false</Default><SpellID>2484</SpellID><Actions></Actions><Lua>local haveTotem, totemName, startTime, duration = GetTotemInfo(2)
local dauer = startTime+duration-GetTime() 

if dauer &amp;lt; 1 then
	

for i=1 , #cTar do
	if UnitExists(cTar[i]) then
	if  LineOfSight(cTar[i])
	and GCDCheck(2484)
	and ecTar[i].Range &amp;lt; 10
	and not HaveBuff(cTar[i],iDMG(),1)
	and not UnitIsDeadOrGhost(cTar[i])
	and UnitIsPlayer(cTar[i])
	and not HaveBuff(cTar[i],iSlow(),0)
	and not HaveBuff(cTar[i],iDMG(),0)
	and not HaveDebuff(cTar[i],ccCanBreak(),0) 
	and not HaveBuff(cTar[i],iSpell(),1)
	and UnitCanAttack(&amp;quot;player&amp;quot;,cTar[i]) 
	then
	return true
	end
	end
end
	
	
end</Lua><RecastDelay>400</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Grounding Instants</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not GBoxHero then
 GBoxHero = CreateFrame(&amp;quot;FRAME&amp;quot;, nil, UIParent)
 GBoxHero:Hide()
end

function GBoxHero_OnEvent(self, event, ...)
 local type, _, sourceGUID, sourceNAME, _, _, destGUID, destNAME = select(2, ...)
 if event == &amp;quot;COMBAT_LOG_EVENT_UNFILTERED&amp;quot; then
  if type == &amp;quot;SPELL_CAST_SUCCESS&amp;quot; then
   if destGUID == UnitGUID(&amp;quot;player&amp;quot;)
   then
    local spellId = select(12, ...)
    local listId = {
     44572, --DeepFreeze
     80240, --ShadowBurn
     19503,	-- Scatter Shot
     24275, --Hammer of Wrath
     47476, --Strangulate
     2139, --Counterspell
    }
    for i = 1, #listId do
     if listId[i] == spellId
     and GCDCheck(8177)
     then
     CastSpellByName(GetSpellInfo(8177))

      --return true
     end
    end
   end
  end
 end
end

GBoxHero:SetScript(&amp;quot;OnEvent&amp;quot;, GBoxHero_OnEvent)
GBoxHero:RegisterEvent(&amp;quot;COMBAT_LOG_EVENT_UNFILTERED&amp;quot;)


if not TrapBox then
	TrapBox = CreateFrame(&amp;quot;FRAME&amp;quot;, nil, UIParent)
	TrapBox:Hide()
end

if dontshoot == 0 or nil then
dontshoot = 0
end

function TrapBox_OnEvent(self, event, ...)
	local type, _, sourceGUID, sourceNAME, _, _, destGUID, destNAME = select(2, ...)
	if event == &amp;quot;COMBAT_LOG_EVENT_UNFILTERED&amp;quot; then
		if type == &amp;quot;SPELL_CAST_SUCCESS&amp;quot; then
		--	if destGUID == UnitGUID(&amp;quot;player&amp;quot;) then
				local spellId = select(12, ...)
				local listId = {
					1499,		-- Freezing Trap
					60192		-- Freezing Trap
					
				}
				
				for i = 1, #listId do
					if listId[i] == spellId then
					if PQR_SpellAvailable(8177)
					and PQR_UnitDistance(&amp;quot;player&amp;quot;,sourceGUID) &amp;lt; 30
					then
				     CastSpellByName(GetSpellInfo(8177))
				     return true
				        end
				      
					end
			--	end
			end
		end
	end
end

dontshoot = 0

TrapBox:SetScript(&amp;quot;OnEvent&amp;quot;, TrapBox_OnEvent)
TrapBox:RegisterEvent(&amp;quot;COMBAT_LOG_EVENT_UNFILTERED&amp;quot;)


for i =1 , numberfriends do
if UnitExists(members[i])
and HaveDebuff(members[i], {
  	115001,		-- Remorseless Winter
						50245,		-- Pin (Crab)
						54706,		-- Venom Web Spray (Silithid)
						4167,		-- Web (Spider)
						19503,		-- Scatter Shot
						126246,		-- Lullaby
						96201		-- Web Wrap
						})
and UnitInRange(members[i])
and PQR_SpellAvailable(8177) 
then
CastSpellByName(GetSpellInfo(8177))
return true
end
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Healing Surge Auto</Name><Default>false</Default><SpellID>8004</SpellID><Actions></Actions><Lua>for i = 1, numberfriends do
if CalculateHP(members[i]) &amp;lt; 85
and IsMoving == 1
and GCDCheck(8004)
and not HaveDebuff(members[i],{33786,113506},0)
and (UnitInRange(members[i]) or eMembers[i].Range &amp;lt; 40)
and LineOfSight(members[i])
then
PQR_CustomTarget = members[i]
return true
end
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Healing Surge</Name><Default>false</Default><SpellID>8004</SpellID><Actions></Actions><Lua>for i = 1, numberfriends do
if heal
and GCDCheck(8004)
and CalculateHP(members[i]) &amp;lt;= 100
and IsMoving == 1
and not HaveDebuff(members[i],{33786,113506},0)

and (UnitInRange(members[i]) or eMembers[i].Range &amp;lt; 40)
and LineOfSight(members[i])
then
PQR_CustomTarget = members[i]
return true
end
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Tremor</Name><Default>false</Default><SpellID>8143</SpellID><Actions></Actions><Lua>for i = 1, numberfriends do
if UnitExists(members[i])
and UnitInRange(members[i])
and CalculateHP(members[1]) &amp;lt; 85
and GCDCheck(8143)
and eMembers[i].Range &amp;lt; 30
and LineOfSight(members[i])
and HaveDebuff(members[i],fear(),3)
and IsHealer(members[i])
then
return true
end
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Ghost Wolf</Name><Default>false</Default><SpellID>2645</SpellID><Actions></Actions><Lua>if PQR_IsMoving(8)
and GCDCheck(2645)
and select(2,GetSpellCooldown(403)) == 0 
and not HaveBuff(&amp;quot;player&amp;quot;,2645,0)
then return true
end</Lua><RecastDelay>10000</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Auto Hex Attention</Name><Default>false</Default><SpellID>51514</SpellID><Actions></Actions><Lua>if sheepon == nil then  sheepon = 0 end
if unitsheeped == nil then  unitsheeped = 0 end

for i=1 , #cTar do
	if UnitExists(cTar[i])
	and HaveDebuff(cTar[i],{51514},0,&amp;quot;Player&amp;quot;)
	then
	 sheepon = 1
	unitsheeped = UnitGUID(cTar[i])
	end
end



for i=1, #cTar do
	if UnitExists(cTar[i])
	and unitsheeped == UnitGUID(cTar[i])
	and not HaveDebuff(cTar[i],{51514},2,&amp;quot;Player&amp;quot;)
	then
	sheepon = 0
	end
end



	for j=1 , #cTar do
	 if  UnitExists(cTar[j])
	 and GCDCheck(51514)
	 and sheepon == 0
	 and IsMoving == 1
	 and CokxDRInfo(cTar[j],&amp;quot;poly&amp;quot;) &amp;lt; 2
	 and not UnitIsDeadOrGhost(cTar[j]) 
	 and UnitCanAttack(&amp;quot;player&amp;quot;,cTar[j]) 
	 and UnitIsPlayer(cTar[j])
	 and not HaveDebuff(cTar[j],dPoisonCC(),2)
	 and LineOfSight(cTar[j])
	 and not HaveBuff(&amp;quot;player&amp;quot;,114168,0)
	 and ecTar[j].Range ~= nil
     and ecTar[j].Range &amp;lt; 29
	 and not HaveDebuff(cTar[j],dCurseCC(),3)
	 and not HaveDebuff(cTar[j],dMagicCC(),3)
	 and not HaveDebuff(cTar[j],dSilence(),3)
	 and not HaveDebuff(cTar[j],dSilenceCC(),3)
	 and not HaveDebuff(cTar[j],dCC(),3)
	 and not HaveDebuff(cTar[j],{33786, -- Cyclone
113506,18499,783,768,5487,49039}) -- Cyclone
and not HaveBuff(cTar[j],{18499,783,768,5487,49039},0)
	 and not HaveBuff(cTar[j],iDMG(),0)
	 and not HaveBuff(cTar[j],iSpell(),0)
	
	 then
	   if IsHealer(cTar[j])
	   and (100 * UnitHealth(&amp;quot;target&amp;quot;) / UnitHealthMax(&amp;quot;target&amp;quot;)) &amp;lt; 70
	   	 and not UnitIsUnit(cTar[j],&amp;quot;target&amp;quot;)
	   then
	 PQR_CustomTarget=cTar[j]

	return true
	end
	if HaveBuff(cTar[j],attentionBuffs(),3)
	then
		 PQR_CustomTarget=cTar[j]
	return true
	end
	
	
	if  GCDCheck(51514)
	and (HaveDebuff(cTar[j],dPoisonCC(),0)
 	 or HaveDebuff(cTar[j],dCurseCC(),0)
	 or HaveDebuff(cTar[j],dMagicCC(),0)
	 or HaveDebuff(cTar[j],dSilenceCC(),0)
	 or HaveDebuff(cTar[j],dCC(),0))
	 and not UnitIsUnit(cTar[j],&amp;quot;target&amp;quot;)
	 then
	 PQR_CustomTarget=cTar[j]

	 return true
	end

end
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>FlameTongue</Name><Default>false</Default><SpellID>8024</SpellID><Actions></Actions><Lua>local hwv, hwd  = GetWeaponEnchantInfo()

if hwv ~= 1 then
	return true
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Immun Spells</Name><Default>false</Default><SpellID>403</SpellID><Actions></Actions><Lua>if IsFacing
and GCDCheck(403)
and inRange(&amp;quot;target&amp;quot;,403)
and LineOfSight(&amp;quot;target&amp;quot;)
and HaveBuff(&amp;quot;target&amp;quot;,{8178,23920,114028},1)
and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) 
 then
return true
end</Lua><RecastDelay>800</RecastDelay><Target>Target</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Riptide</Name><Default>false</Default><SpellID>61295</SpellID><Actions></Actions><Lua>for i = 1, numberfriends do
if CalculateHP(members[i]) &amp;lt; 75
and GCDCheck(61295)
and (UnitInRange(members[i]) or eMembers[i].Range &amp;lt; 40)
and LineOfSight(members[i])
and not HaveDebuff(members[i],{33786,113506},0)
then
    PQR_CustomTarget = members[i]  
    return true
end
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>UE: Heal</Name><Default>false</Default><SpellID>73680</SpellID><Actions></Actions><Lua>for i = 1, numberfriends do
if CalculateHP(members[i]) &amp;lt; 90
and GCDCheck(73680)
and (UnitInRange(members[i]) or eMembers[i].Range &amp;lt; 40)
and LineOfSight(members[i])
and not HaveDebuff(members[i],{33786,113506},0)
then
  PQR_CustomTarget = members[i]  
  return true
end
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Lava Burst Procc</Name><Default>false</Default><SpellID>51505</SpellID><Actions></Actions><Lua>if ( HaveBuff(&amp;quot;player&amp;quot;,77762,0))
and PQR_SpellAvailable(51505)
and GCDCheck(51505)
and IsFacing
and inRange(&amp;quot;target&amp;quot;,403)
and LineOfSight(&amp;quot;target&amp;quot;)
and not HaveBuff(&amp;quot;target&amp;quot;,iDMG(),0)
and not HaveBuff(&amp;quot;target&amp;quot;,iSpells(),0)
and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) 
 then
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Water Shield</Name><Default>false</Default><SpellID>52127</SpellID><Actions></Actions><Lua>if not HaveBuff(&amp;quot;player&amp;quot;,{974,52127},1)
--or (UnitPower(&amp;quot;player&amp;quot;) &amp;lt; 20000 and not HaveBuff(&amp;quot;player&amp;quot;,52127) and not primaryFriendly(&amp;quot;player&amp;quot;))
--or (UnitAffectingCombat(&amp;quot;player&amp;quot;) and CalculateHP(&amp;quot;player&amp;quot;) &amp;gt; 97 and not HaveBuff(&amp;quot;player&amp;quot;,52127))
--or (CalculateHP(&amp;quot;player&amp;quot;) &amp;gt; 50 and not primaryFriendly(&amp;quot;player&amp;quot;) and not HaveBuff(&amp;quot;player&amp;quot;,{52127},1)and UnitAffectingCombat(&amp;quot;player&amp;quot;))
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Resto: Healing Surge</Name><Default>false</Default><SpellID>8004</SpellID><Actions></Actions><Lua>for i = 1, numberfriends do
if CalculateHP(members[i]) &amp;lt; 60
and IsMoving == 1
and GCDCheck(8004)
    and UnitIsPlayer(members[i])
and (UnitInRange(members[i]) or eMembers[i].Range &amp;lt; 40)
and LineOfSight(members[i])
and not HaveDebuff(members[i],{33786,113506},0)
and not HaveBuff(&amp;quot;player&amp;quot;,16188,0)
then
PQR_CustomTarget = members[i]
lastHealTarget = i
return true
end
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Resto: Healing Wave</Name><Default>false</Default><SpellID>331</SpellID><Actions></Actions><Lua>for i = 1, numberfriends do
if CalculateHP(members[i]) &amp;lt; 95
and IsMoving == 1
and GCDCheck(331)
and (UnitInRange(members[i]) or eMembers[i].Range &amp;lt; 40)
and LineOfSight(members[i])
and not HaveDebuff(members[i],{33786,113506},0)
and not HaveBuff(&amp;quot;player&amp;quot;,16188,0)
then
PQR_CustomTarget = members[i]
lastHealTarget = i
return true
end
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Resto: Greater Healing Wave</Name><Default>false</Default><SpellID>77472</SpellID><Actions></Actions><Lua>for i = 1, numberfriends do
if CalculateHP(members[i]) &amp;lt;= 70
and GCDCheck(77472)
and IsMoving == 1
    and UnitIsPlayer(members[i])
and (UnitInRange(members[i]) or eMembers[i].Range &amp;lt; 40)
and LineOfSight(members[i])
and not HaveDebuff(members[i],{33786,113506},0)
and (HaveBuff(&amp;quot;player&amp;quot;,53390,0)
or HaveBuff(&amp;quot;player&amp;quot;,16188,0)) 
then
PQR_CustomTarget = members[i]
lastHealTarget = i
return true
end
end</Lua><RecastDelay>50</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Purify Spirit</Name><Default>false</Default><SpellID>51886</SpellID><Actions></Actions><Lua>for i=1,numberfriends do 
    if  LineOfSight(members[i])
    and GCDCheck(51886)
    and UnitIsPlayer(members[i])
    and not HaveDebuff(members[i],{33786,113506},0)
   and (UnitInRange(members[i]) or eMembers[i].Range &amp;lt; 40)
    and IsHealer(members[i])
    and (not HaveDebuff(members[i],{34914,30108,131736},0) or CalculateHP(&amp;quot;player&amp;quot;) &amp;gt; 90)
  	and (HaveDebuff(members[i],dMagicCC(),2)
     or HaveDebuff(members[i],dCurseCC(),2)
     or HaveDebuff(members[i],dSilence(),2))

    then
      PQR_CustomTarget = members[i]
       return true end
    end
    
    for i=1,numberfriends do 
    if LineOfSight(members[i])
    and GCDCheck(51886)
        and UnitIsPlayer(members[i])
    and (UnitInRange(members[i]) or eMembers[i].Range &amp;lt; 40)
    and not HaveDebuff(members[i],{33786,113506},0)
   and (not HaveDebuff(members[i],{34914,30108,131736},0) or CalculateHP(&amp;quot;player&amp;quot;) &amp;gt; 90)
   and (HaveDebuff(members[i],dMagicCC(),2)
    or HaveDebuff(members[i],dCurseCC(),2)
     )
    then
      PQR_CustomTarget = members[i]
       return true end
    end
    
   for i=1,numberfriends do 
    if LineOfSight(members[i])
    and GCDCheck(51886)
        and UnitIsPlayer(members[i])
    and (UnitInRange(members[i]) or eMembers[i].Range &amp;lt; 40)
    and not HaveDebuff(members[i],{33786,113506},0)
   and (not HaveDebuff(members[i],{34914,30108,131736},0) or CalculateHP(&amp;quot;player&amp;quot;) &amp;gt; 90)
   and  UnitPowerMax(members[i]) &amp;lt; 100000
   and UnitExists(members[i]..&amp;quot;target&amp;quot;)
   and CalculateHP(members[i]..&amp;quot;target&amp;quot;) &amp;lt; 95
  and HaveDebuff(members[i],dRoot(),1)  then
      PQR_CustomTarget = members[i]
       return true end
    end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Earth Shield</Name><Default>false</Default><SpellID>974</SpellID><Actions></Actions><Lua>if not CheckLifebloom then
  function CheckLifebloom(t)
    local _,_,_,Lbcount,_,_,Lbtimer = UnitBuffID(t,974,&amp;quot;PLAYER&amp;quot;) 
    return Lbcount, Lbtimer 
  end 
end 
local memberid = 1
local lbactive = false
for i = 1, #members do
if UnitBuffID(members[i],974,&amp;quot;PLAYER&amp;quot;)
then 
lbactive = true
memberid = i
end
end
if select(2, GetInstanceInfo()) == &amp;quot;raid&amp;quot; or  select(2, GetInstanceInfo()) == &amp;quot;party&amp;quot; or  select(2, GetInstanceInfo()) == &amp;quot;scenario&amp;quot; then
 for i=1,#members do
    if UnitGroupRolesAssigned(members[i]) == &amp;quot;TANK&amp;quot; 
    and UnitThreatSituation(members[i]) == 3 
    and not HaveDebuff(members[i],{33786,113506},0)
    and lbactive == false
    and not UnitBuffID(members[i],974,&amp;quot;PLAYER&amp;quot;)
    then PQR_CustomTarget = members[i] return true end 
  end
end
if select(2, GetInstanceInfo()) ~= &amp;quot;raid&amp;quot; and select(2, GetInstanceInfo()) ~= &amp;quot;party&amp;quot; and select(2, GetInstanceInfo()) ~= &amp;quot;scenario&amp;quot; then

for i = 1, #members do
 local Lbcount, Lbtimer = CheckLifebloom(members[i])
  if CalculateHP(members[i]) &amp;lt;= 100
  and GCDCheck(974)
  and (primaryFriendly(members[i]) or not UnitIsUnit(&amp;quot;player&amp;quot;,members[i]))
and (UnitInRange(members[i]) or eMembers[i].Range &amp;lt; 40)
  and LineOfSight(members[i])
  and not HaveDebuff(members[i],{33786,113506},0)
  and UnitIsPlayer(members[i])
  and lbactive == false  
  then 
    PQR_CustomTarget = members[i] 
     return true 
  end
end

for i = 1, numberfriends do
  local Lbcount, Lbtimer = CheckLifebloom(members[i])
  if CalculateHP(members[i]) &amp;lt; (CalculateHP(members[memberid])-10)
    and GCDCheck(974)
    and primaryFriendly(members[i])
    and not HaveDebuff(members[i],{33786,113506},0)
    and UnitIsPlayer(members[i])
and (UnitInRange(members[i]) or eMembers[i].Range &amp;lt; 40)
  and LineOfSight(members[i])
  then 
    PQR_CustomTarget = members[i] 
      return true 
  end
end
end</Lua><RecastDelay>7000</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Earthliving</Name><Default>false</Default><SpellID>51730</SpellID><Actions></Actions><Lua>local hwv, hwd  = GetWeaponEnchantInfo()

if hwv ~= 1 then
	return true
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Capacitor Totem</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local haveTotem, totemName, startTime, duration = GetTotemInfo(4)
local dauer = startTime+duration-GetTime() 

if PQR_SpellAvailable(108269)
and stuntotemswap
then
CastSpellByName(GetSpellInfo(108269))
return true
end

if PQR_SpellAvailable(108287) 
and IsSpellKnown(108287) 
and GCDCheck(108287)
and stuntotemswap
 and not GetCurrentKeyBoardFocus()
 and not IsMouselooking()
and dauer &amp;lt; 1.5
and dauer &amp;gt; 0.3 then 
	SpellStopCasting()
	CastSpellByName(GetSpellInfo(108287))
		if SpellIsTargeting() then
	CameraOrSelectOrMoveStart()
	CameraOrSelectOrMoveStop() 
	return true	
end
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Hex</Name><Default>false</Default><SpellID>51514</SpellID><Actions></Actions><Lua>for i=1,#cTar do
if UnitExists(cTar[i])
and GCDCheck(51514)
	 and not UnitIsDeadOrGhost(cTar[i]) 
	 and CalculateHP(members[1])&amp;gt; 30
	 and IsMoving == 1
	 and hexunit == UnitGUID(cTar[i])
	 and UnitCanAttack(&amp;quot;player&amp;quot;,cTar[i]) 
	 and LineOfSight(cTar[i])
	 and CokxDRInfo(cTar[i],&amp;quot;poly&amp;quot;) &amp;lt; 2
	 and ecTar[i].Range &amp;lt; 30
	 and not HaveBuff(cTar[i],{49039,18499,18499,783,768,5487,49039},1.3)
	 and not HaveDebuff(cTar[i],dPoisonCC(),2)
	 and not HaveDebuff(cTar[i],dCurseCC(),2)
	 and not HaveDebuff(cTar[i],dMagicCC(),2)
	 and not HaveDebuff(cTar[i],dSilence(),2)
	 and not HaveDebuff(cTar[i],dSilenceCC(),2)
	 and not HaveDebuff(cTar[i],dCC(),2)
	 and not HaveDebuff(cTar[i],{33786, -- Cyclone
113506}) -- Cyclone
	 and not HaveBuff(cTar[i],iDMG(),1)
	 and not HaveBuff(cTar[i],iSpell(),1)
then
PQR_CustomTarget = cTar[i]

return true
end
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Stormstrike</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if IsFacing
and (inMelee == 1  or HaveBuff(&amp;quot;playeR&amp;quot;,114049,0))
and (PQR_SpellAvailable(17364) or PQR_SpellAvailable(115356))
and LineOfSight(&amp;quot;target&amp;quot;)
and not HaveBuff(&amp;quot;target&amp;quot;,iDMG(),1)
and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) 
 then
 RunMacroText(&amp;quot;/use 13&amp;quot;)
 CastSpellByName(tostring(GetSpellInfo(115356)))
 CastSpellByName(tostring(GetSpellInfo(17364)))
return true
else
if UnitExists(&amp;quot;target&amp;quot;) 
and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) then
RunMacroText(&amp;quot;/startattack&amp;quot;)
end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Lava Lash</Name><Default>false</Default><SpellID>60103</SpellID><Actions></Actions><Lua>if IsFacing
and GCDCheck(60103)
and inMelee == 1
and LineOfSight(&amp;quot;target&amp;quot;)
and not HaveBuff(&amp;quot;target&amp;quot;,iDMG(),1)
and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) 
 then
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>False</SkipUnknown></Ability><Ability><Name>Enh: Ghost Wolf</Name><Default>false</Default><SpellID>2645</SpellID><Actions></Actions><Lua>if (inMelee== 0 or not IsFacing)
and GCDCheck(2645)
and not HaveBuff(&amp;quot;player&amp;quot;,2645,0)
then return true
end</Lua><RecastDelay>4000</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Enh: Lightning Bolt</Name><Default>false</Default><SpellID>403</SpellID><Actions></Actions><Lua>local arg1, arg2, arg3, arg4 = UnitBuffID( &amp;quot;player&amp;quot;, 53817 )
if IsFacing
and GCDCheck(403)
and UnitExists(&amp;quot;target&amp;quot;)
and shamanaoego == 0
and ((IsSpellKnown(117014) and (GetSpellCooldown(GetSpellInfo(117014))+select(2,GetSpellCooldown(GetSpellInfo(117014)))-GetTime()&amp;gt; 3.1))
 or not IsSpellKnown(117014))
and (arg4 == 5 or (ecTar[1].Range &amp;gt; 15))
and PQR_SpellAvailable(403)
and inRange(&amp;quot;target&amp;quot;,403)
and LineOfSight(&amp;quot;target&amp;quot;)
and not HaveBuff(&amp;quot;target&amp;quot;,iDMG(),1)
and not HaveBuff(&amp;quot;target&amp;quot;,iSpells(),1)
and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) 
 then
for i = 1, numberfriends do
if CalculateHP(members[i]) &amp;gt; 90
and (UnitInRange(members[i]) or eMembers[i].Range &amp;lt; 40)
then
return true
end
end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Enh: Earth Shock</Name><Default>false</Default><SpellID>8042</SpellID><Actions></Actions><Lua>if IsFacing
and GCDCheck(8042)
and inRange(&amp;quot;target&amp;quot;,8042)
and LineOfSight(&amp;quot;target&amp;quot;)
and not HaveBuff(&amp;quot;target&amp;quot;,iDMG(),1)
and not HaveBuff(&amp;quot;target&amp;quot;,iSpells(),1)
and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) 
 then
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>CHain Lightning</Name><Default>false</Default><SpellID>421</SpellID><Actions></Actions><Lua>if IsFacing
and GCDCheck(421)
and (shamanaoego == 1 or aoeUnits(3,30,1))
and IsMoving == 1
and PQR_SpellAvailable(421)
and inRange(&amp;quot;target&amp;quot;,403)
and LineOfSight(&amp;quot;target&amp;quot;)
and not HaveBuff(&amp;quot;target&amp;quot;,iDMG(),1)
and not HaveBuff(&amp;quot;target&amp;quot;,iSpells(),1)
and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) 
 then
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Enh: Chain Lightning</Name><Default>false</Default><SpellID>421</SpellID><Actions></Actions><Lua>local arg1, arg2, arg3, arg4 = UnitBuffID( &amp;quot;player&amp;quot;, 53817 )
if IsFacing
and UnitExists(&amp;quot;target&amp;quot;)
and GCDCheck(421)
and ((IsSpellKnown(117014) and (GetSpellCooldown(GetSpellInfo(117014))+select(2,GetSpellCooldown(GetSpellInfo(117014)))-GetTime()&amp;gt; 3.1))
 or not IsSpellKnown(117014))
and (shamanaoego == 1 or aoeUnits(3,30,1))
and (arg4 == 5 or (ecTar[1].Range &amp;gt; 15 and not PQR_IsMoving(1)))
and PQR_SpellAvailable(421)
and inRange(&amp;quot;target&amp;quot;,421)
and LineOfSight(&amp;quot;target&amp;quot;)
and not HaveBuff(&amp;quot;target&amp;quot;,iDMG(),1)
and not HaveBuff(&amp;quot;target&amp;quot;,iSpells(),1)
and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) 
 then
for i = 1, numberfriends do
if CalculateHP(members[i]) &amp;gt; 95
and (UnitInRange(members[i]) or eMembers[i].Range &amp;lt; 40)
then
return true
end
end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Immun Spells FS</Name><Default>false</Default><SpellID>8050</SpellID><Actions></Actions><Lua>if IsFacing
and GCDCheck(8050)
and inRange(&amp;quot;target&amp;quot;,403)
and LineOfSight(&amp;quot;target&amp;quot;)
and HaveBuff(&amp;quot;target&amp;quot;,{23920,114028},1)
and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) 
 then
return true
end</Lua><RecastDelay>800</RecastDelay><Target>Target</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Resto: Earth Shock</Name><Default>false</Default><SpellID>8042</SpellID><Actions></Actions><Lua>if CalculateHP(members[1])&amp;lt;= 70
and (UnitInRange(members[1]) or eMembers[1].Range &amp;lt; 40)
then
if IsFacing
and inRange(&amp;quot;target&amp;quot;,8042)
and GCDCheck(8042)
and LineOfSight(&amp;quot;target&amp;quot;)
and UnitPowerMax(&amp;quot;target&amp;quot;) &amp;lt; 150000
and not HaveBuff(&amp;quot;target&amp;quot;,iDMG(),0)
and not HaveBuff(&amp;quot;target&amp;quot;,iSpells(),0)
and not HaveDebuff(&amp;quot;target&amp;quot;,115798,0)
and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) 
 then
return true
end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Resto: Frost Shock</Name><Default>false</Default><SpellID>8056</SpellID><Actions></Actions><Lua>for i=1,#cTar do
if UnitExists(cTar[i])
and UnitIsPlayer(cTar[i]) 
and GCDCheck(8056)
and ecTar[i].Facing
and LineOfSight(cTar[i])
and ecTar[i].Range &amp;lt; 45
and UnitCanAttack(&amp;quot;player&amp;quot;,cTar[i]) 
and UnitIsUnit(&amp;quot;player&amp;quot;,cTar[i]..&amp;quot;target&amp;quot;)
and not HaveBuff(cTar[i],iDMG(),0) 
and not HaveBuff(cTar[i],iSpell(),0) 
and not HaveDebuff(cTar[i],aSRS(),0)
and not HaveBuff(cTar[i],iSlow(),0)
then
PQR_CustomTarget = cTar[i]
 return true end
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Pause</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if shamanpause
or IsMounted()
--or SpellIsTargeting() 
or UnitBuffID(&amp;quot;player&amp;quot;,80169)
or UnitBuffID(&amp;quot;player&amp;quot;,87959)
or UnitBuffID(&amp;quot;player&amp;quot;,40120)
then return true end

if  GetTime() - getInfos &amp;lt; 0.2 and  GetTime() - getInfos &amp;gt; 0.1 and (GCDCheck(8004) or GCDCheck(3599)) then
return true
end
if  GetTime() - getInfos &amp;lt; 0.6 and  GetTime() - getInfos &amp;gt; 0.325 and (GCDCheck(8004) or GCDCheck(3599)) then
return true
end
if  GetTime() - getInfos &amp;lt; 0.4 and  GetTime() - getInfos &amp;gt; 0.225 and (GCDCheck(8004) or GCDCheck(3599)) then
return true
end
if  GetTime() - getInfos &amp;lt; 0.9 and  GetTime() - getInfos &amp;gt; 0.625 and (GCDCheck(8004) or GCDCheck(3599)) then
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Stone Bulwark Totem</Name><Default>false</Default><SpellID>108270</SpellID><Actions></Actions><Lua>if CalculateHP(&amp;quot;player&amp;quot;) &amp;lt; 70
and IsSpellKnown(108270)
then
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Healthstone</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if CalculateHP(&amp;quot;player&amp;quot;) &amp;lt; 30
   and GetItemCount(GetItemInfo(5512)) ~= 0
  and select(2,GetItemCooldown(5512)) == 0 
  then 
	UseItemByName(5512)
	return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Ancestral Swiftness</Name><Default>false</Default><SpellID>77472</SpellID><Actions></Actions><Lua>for i = 1, numberfriends do
if CalculateHP(members[i]) &amp;lt;= 30
and UnitIsPlayer(members[i])
and not HaveDebuff(members[i],{33786,113506},0)
and IsSpellKnown(16188)
and(GCDCheck(16188) or HaveBuff(&amp;quot;player&amp;quot;,16188,0))
and GCDCheck(77472)
and (UnitInRange(members[i]) or eMembers[i].Range &amp;lt; 40)
and LineOfSight(members[i])
then
  CastSpellByName(GetSpellInfo(16188))
  PQR_CustomTarget = members[i]
--   CastSpellByName(GetSpellInfo(77472),PQR_CustomTarget)
return true
end
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>FocusBG</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not myFocusID then myFocusID = 0 end

if not UnitExists(&amp;quot;focus&amp;quot;)
or UnitGUID(&amp;quot;focus&amp;quot;) == myFocusID then
for i = 1, #cTar do
if UnitExists(cTar[i]) and IsHealer(cTar[i])
and ecTar[i].Range &amp;lt; 60
and not UnitIsUnit(&amp;quot;target&amp;quot;,cTar[i]) then
FocusUnit(cTar[i])
myFocusID = 0
break
end
end

for i = 1, #cTar do
if UnitExists(cTar[i])
and ecTar[i].Range &amp;lt; 60
and not eHealer()
and not UnitIsUnit(&amp;quot;target&amp;quot;,cTar[i]) then
FocusUnit(cTar[i])
myFocusID=UnitGUID(cTar[i])
break
end
end
end
if UnitExists(&amp;quot;focus&amp;quot;) and not UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;focus&amp;quot;) and UnitGUID(&amp;quot;focus&amp;quot;) == myFocusID then ClearFocus() end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Resto: Chain Heal</Name><Default>false</Default><SpellID>1064</SpellID><Actions></Actions><Lua>for i = 1, numberfriends do
if CalculateHP(members[i]) &amp;lt;= 95
and aoeHeal(95,40) &amp;gt; 7
and GCDCheck(1064)
and IsMoving == 1
and HaveBuff(members[i],61295,2,&amp;quot;player&amp;quot;)
and UnitIsPlayer(members[i])
and (UnitInRange(members[i]) or eMembers[i].Range &amp;lt; 40)
and LineOfSight(members[i])
and not HaveDebuff(members[i],{33786,113506},0)
then
PQR_CustomTarget = members[i]
return true
end
end</Lua><RecastDelay>50</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Healing Rain</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if PQR_SpellAvailable(73920) 
and IsSpellKnown(73920) 
and GCDCheck(73920)
and heal
 and not GetCurrentKeyBoardFocus()
 and not IsMouselooking()
 then 
	CastSpellByName(GetSpellInfo(73920))
		if SpellIsTargeting() then
	CameraOrSelectOrMoveStart()
	CameraOrSelectOrMoveStop() 
	return true	
end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>SRG</Name><Default>false</Default><SpellID>8050</SpellID><Actions></Actions><Lua>local spell, _, _, _, _, endTime = UnitChannelInfo(&amp;quot;player&amp;quot;)
for i = 1 , #cTar do
if UnitExists(cTar[i])
and GCDCheck(8050)
and spell == GetSpellInfo(51514) 
and HaveBuff(cTar[i],{114028,23920,8177},0)
then
SpellStopCasting()
PQR_CustomTarget = cTar[i]
return true
end
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>eventRA</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not CokxLog then
    Cokx_CokxLog = CreateFrame(&amp;apos;Frame&amp;apos;)
    Cokx_CokxLog:RegisterEvent(&amp;quot;COMBAT_LOG_EVENT_UNFILTERED&amp;quot;)

 function OnSuccessfulCast(self, event, ...)
  local type, _, sourceGUID, sourceNAME, _, _, destGUID, destNAME = select(2, ...)
  if (event==&amp;quot;COMBAT_LOG_EVENT_UNFILTERED&amp;quot;) then
            if (type==&amp;quot;SPELL_CAST_SUCCESS&amp;quot;) then
                if sourceGUID == UnitGUID(&amp;quot;target&amp;quot;) then
       			targetPhysRA = EphysRA()
       			for i=1,#targetPhysRA do
       				if select(12, ...) == targetPhysRA[i] then
       					if IsSpellKnown(108269) 
       					and GCDCheck(108269) then
						CastSpellByName(GetSpellInfo(108269),&amp;quot;target&amp;quot;)
						return true
						end
       				end
       			end
       			end
	     		
	     		
	     		for i = 1, #cTar do
                if sourceGUID == UnitGUID(cTar[i])
                and ecTar[i].Range &amp;lt; 40 then
       				if select(12, ...) == 19503	then
       					if IsSpellKnown(8177)
       					and GCDCheck(8177)
       					then
						CastSpellByName(GetSpellInfo(8177))
						return true
						end
					end
	     		end
	     		end
	     		     		
	     		for j = 1, #members do
                if destGUID == UnitGUID(members[j])
                and eMembers[j].Range &amp;lt; 30 then
       			allSpellRA = spellRA()
       			for i=1,#allSpellRA do
       				if select(12, ...) == allSpellRA[i] then
       					if IsSpellKnown(8177)
       					and GCDCheck(8177)
       					then
						CastSpellByName(GetSpellInfo(8177))
						return true
						end
       				end
       			end
	     		end
	     		end
	     		
	     		for j = 1, #members do
                if destGUID == UnitGUID(members[j])
                and eMembers[j].Range &amp;lt; 25 then
       			allHSpellRA = HealerphysRA()
       			for i=1,#allHSpellRA do
       				if select(12, ...) == allHSpellRA[i] then
       				if IsSpellKnown(108269) 
       					and GCDCheck(108269) then
						CastSpellByName(GetSpellInfo(108269))
						return true
					end
       				end
	     		end
	     		end
	     		end
	     	   		
		    end
  end
 end

 Cokx_CokxLog:SetScript(&amp;apos;OnEvent&amp;apos;, OnSuccessfulCast)

    CokxLog = true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Riptide Low</Name><Default>false</Default><SpellID>61295</SpellID><Actions></Actions><Lua>for i = 1, #members do
if CalculateHP(members[i]) &amp;lt; 99
and GCDCheck(61295)
and not HaveBuff(members[i],61295,0,&amp;quot;player&amp;quot;)
and (UnitInRange(members[i]) or eMembers[i].Range &amp;lt; 40)
and LineOfSight(members[i])
and not HaveDebuff(members[i],{33786,113506},0)
then
    PQR_CustomTarget = members[i]  
    return true
end
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Unleash Elements Ele</Name><Default>false</Default><SpellID>73680</SpellID><Actions></Actions><Lua>if select(2, GetInstanceInfo()) ~= &amp;quot;raid&amp;quot; and select(2, GetInstanceInfo()) ~= &amp;quot;party&amp;quot; and select(2, GetInstanceInfo()) ~= &amp;quot;scenario&amp;quot; then

if IsFacing
and GCDCheck(73680)
and inRange(&amp;quot;target&amp;quot;,403)
and LineOfSight(&amp;quot;target&amp;quot;)
and not HaveBuff(&amp;quot;target&amp;quot;,iDMG(),1)
and not HaveBuff(&amp;quot;target&amp;quot;,iSpells(),1)
and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) 
 then
return true
end
end

if select(2, GetInstanceInfo()) == &amp;quot;raid&amp;quot; or  select(2, GetInstanceInfo()) == &amp;quot;party&amp;quot; or  select(2, GetInstanceInfo()) == &amp;quot;scenario&amp;quot; then
if IsFacing
and select(2,GetTalentRowSelectionInfo(6)) == 16
and GCDCheck(73680)
and inRange(&amp;quot;target&amp;quot;,403)
and LineOfSight(&amp;quot;target&amp;quot;)
and not HaveBuff(&amp;quot;target&amp;quot;,iDMG(),1)
and not HaveBuff(&amp;quot;target&amp;quot;,iSpells(),1)
and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) 
 then
return true
end
end</Lua><RecastDelay>800</RecastDelay><Target>Target</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Purge Enh</Name><Default>false</Default><SpellID>370</SpellID><Actions></Actions><Lua>for i=1, #cTar do
	if UnitExists(cTar[i]) then
	if  LineOfSight(cTar[i])
and GCDCheck(370)
	and ecTar[i].Range &amp;lt; 30
	and ecTar[i].Facing
	and not HaveBuff(cTar[i],iDMG(),1)
	and HaveBuff(cTar[i],{1022,6940,108978},1.5)
	and not UnitIsDeadOrGhost(cTar[i])
	and UnitIsPlayer(cTar[i])
	and UnitCanAttack(&amp;quot;player&amp;quot;,cTar[i]) 
	then
	PQR_CustomTarget = cTar[i]
	 
	return true
	end
	end
	end


for i=1 , #cTar do
	
	if UnitExists(cTar[i]) then
	if  LineOfSight(cTar[i])
and GCDCheck(370)
	and ecTar[i].Range &amp;lt; 30
	and not HaveBuff(&amp;quot;player&amp;quot;,77762,0)
	and not HaveBuff(cTar[i],iDMG(),1)
	and HaveBuff(cTar[i],{29166,132158,53271,12472,12043,44549,54428,6940,774,
	10060,6346,16166,16188,117014,79206,48108,124682,1022,6940,1044,974,108978},1.5)
	and not UnitIsDeadOrGhost(cTar[i])
	and UnitIsPlayer(cTar[i])
	and not HaveBuff(cTar[i],33763,3)
	and not HaveBuff(cTar[i],iSpell(),1)
	and UnitCanAttack(&amp;quot;player&amp;quot;,cTar[i]) 
	then
	PQR_CustomTarget = cTar[i]
	return true
	end
	end
	
if UnitExists(cTar[i]) then
	if  LineOfSight(cTar[i])
and GCDCheck(370)
	and ecTar[i].Range &amp;lt; 30
	and not HaveBuff(cTar[i],iDMG(),1)
	and (HaveBuff(cTar[i],{11426},2))
	and not UnitIsDeadOrGhost(cTar[i])
		and not HaveBuff(&amp;quot;player&amp;quot;,77762,0)
	and UnitIsPlayer(cTar[i])
		and not HaveBuff(cTar[i],33763,3)
	and not HaveBuff(cTar[i],iSpell(),1)
	and UnitCanAttack(&amp;quot;player&amp;quot;,cTar[i]) 
	then
	purgemeter = select(15, UnitBuff(cTar[i],GetSpellInfo(11426),nil))
	if purgemeter &amp;gt; 20000 then
	PQR_CustomTarget = cTar[i]
	return true
	end
	end
	end
	
	if UnitExists(cTar[i]) then
	if  LineOfSight(cTar[i])
and GCDCheck(370)
	and ecTar[i].Range &amp;lt; 30
	and not HaveBuff(cTar[i],iDMG(),1)
	and (HaveBuff(cTar[i],{17},2))
		and not HaveBuff(cTar[i],33763,3)
	and not UnitIsDeadOrGhost(cTar[i])
		and not HaveBuff(&amp;quot;player&amp;quot;,77762,0)
	and UnitIsPlayer(cTar[i])
	and not HaveBuff(cTar[i],iSpell(),1)
	and UnitCanAttack(&amp;quot;player&amp;quot;,cTar[i]) 
	then
	purgemeter = select(15, UnitBuff(cTar[i],GetSpellInfo(17),nil))
	if purgemeter &amp;gt; 20000 then
	PQR_CustomTarget = cTar[i]
	return true
	end
	end
	end
	
end
if LineOfSight(&amp;quot;target&amp;quot;)
and GCDCheck(370)
and inRange(&amp;quot;target&amp;quot;,370)

and not HaveBuff(&amp;quot;target&amp;quot;,iDMG(),1) then
for i = 1, 40 do
        local buff = { UnitBuff(&amp;quot;target&amp;quot;, i) }
        if buff[9] then
        PQR_CustomTarget = &amp;quot;target&amp;quot;
return true
                end
end
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Purge Target Enh</Name><Default>false</Default><SpellID>370</SpellID><Actions></Actions><Lua>purgemeter = 0
if UnitExists(cTar[1]) then
	if  LineOfSight(cTar[1])
and GCDCheck(370)
	and ecTar[1].Range &amp;lt; 30
	and not HaveBuff(cTar[1],iDMG(),1)
	and HaveBuff(cTar[1],{29166,139,132158,53271,12472,12043,44549,54428,6940,774,115151,
	10060,6346,16166,16188,117014,79206,48108,124682,1022,6940,1044,974,108978},1.5)
	and not UnitIsDeadOrGhost(cTar[1])
	and UnitIsPlayer(cTar[1])
		and not HaveBuff(cTar[1],33763,3)
	and not HaveBuff(cTar[1],iSpell(),1)
	and not HaveBuff(&amp;quot;player&amp;quot;,114049,0)
	and UnitCanAttack(&amp;quot;player&amp;quot;,cTar[1]) 
	then
	PQR_CustomTarget = cTar[1]
	return true
	end
	end
	
if UnitExists(cTar[1]) then
	if  LineOfSight(cTar[1])
and GCDCheck(370)
	and ecTar[1].Range &amp;lt; 30
	and not HaveBuff(cTar[1],iDMG(),1)
	and (HaveBuff(cTar[1],{11426},4))
	and not UnitIsDeadOrGhost(cTar[1])
	and UnitIsPlayer(cTar[1])
			and not HaveBuff(cTar[1],33763,3)
	and not HaveBuff(cTar[1],iSpell(),1)
		and not HaveBuff(&amp;quot;player&amp;quot;,114049,0)
	and UnitCanAttack(&amp;quot;player&amp;quot;,cTar[1]) 
	then
	purgemeter = select(15, UnitBuff(cTar[1],GetSpellInfo(11426),nil))
	if purgemeter &amp;gt; 20000 then
	PQR_CustomTarget = cTar[1]
	return true
	end
	end
	end
	
	if UnitExists(cTar[1]) then
	if  LineOfSight(cTar[1])
and GCDCheck(370)
	and ecTar[1].Range &amp;lt; 30
	and not HaveBuff(cTar[1],iDMG(),1)
	and (HaveBuff(cTar[1],{17},4))
	and not UnitIsDeadOrGhost(cTar[1])
	and UnitIsPlayer(cTar[1])
			and not HaveBuff(cTar[1],33763,3)
	and not HaveBuff(cTar[1],iSpell(),1)
		and not HaveBuff(&amp;quot;player&amp;quot;,114049,0)
	and UnitCanAttack(&amp;quot;player&amp;quot;,cTar[1]) 
	then
	purgemeter = select(15, UnitBuff(cTar[1],GetSpellInfo(17),nil))
	if purgemeter &amp;gt; 20000 then
	PQR_CustomTarget = cTar[1]
	return true
	end
	end
	end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Stormlash</Name><Default>false</Default><SpellID>120668</SpellID><Actions></Actions><Lua>if HaveBuff(&amp;quot;player&amp;quot;,114049)
then return true
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability></SHAMAN>