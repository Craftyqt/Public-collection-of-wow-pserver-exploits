<?xml version="1.0" encoding="utf-8" ?><DRUID><Ability><Name>-- Defines --</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>PlayerEnergy = UnitPower(&amp;quot;player&amp;quot;)

if LFGDungeonReadyPopup:IsVisible() or StaticPopup1:IsVisible() then 
AcceptProposal() 
end

local MangleStart, MangleDuration = GetSpellCooldown(33878)
MangleCooldownTimeLeft = (MangleStart + MangleDuration - GetTime())
if MangleCooldownTimeLeft &amp;lt; 0 then
	MangleCooldownTimeLeft = 0
end

local ThrashStart, ThrashDuration = GetSpellCooldown(77758)
ThrashCooldownTimeLeft = (ThrashStart + ThrashDuration - GetTime())
if ThrashCooldownTimeLeft &amp;lt; 0 then
	ThrashCooldownTimeLeft = 0
end

local FFstart, FFduration = GetSpellCooldown(770)
FFCooldownTimeLeft = (FFstart + FFduration - GetTime())
if FFCooldownTimeLeft &amp;lt; 0 then
	FFCooldownTimeLeft = 0
end

local WeakenedArmor, _, _, LocalWeakenedArmorStacks, _, _, WeakenedArmorEndTime = UnitDebuffID(&amp;quot;target&amp;quot;, 113746)
if not WeakenedArmor then
	WeakenedArmorStacks = 0
	WeakenedArmorTimeLeft = 0
end

local LacerateStart, LacerateDuration = GetSpellCooldown(33745)
LacerateCooldownTimeLeft = (LacerateStart + LacerateDuration - GetTime())
if LacerateCooldownTimeLeft &amp;lt; 0 then
	LacerateCooldownTimeLeft = 0
end

local SwipeStart, SwipeDuration = GetSpellCooldown(779)
SwipeCooldownTimeLeft = (SwipeStart + SwipeDuration - GetTime())
if SwipeCooldownTimeLeft &amp;lt; 0 then
	SwipeCooldownTimeLeft = 0
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>BEAR - Faerie Fire</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local hasTarget = UnitExists(&amp;quot;Target&amp;quot;)
local Enemy = UnitCanAttack(&amp;quot;Player&amp;quot;,&amp;quot;Target&amp;quot;)
local isDead = UnitIsDead(&amp;quot;Target&amp;quot;)

 if UnitBuffID(&amp;quot;player&amp;quot;,5487) and hasTarget and UnitAffectingCombat(&amp;quot;player&amp;quot;) and Enemy and not isDead then
	local waBuff = select(4,UnitDebuffID(&amp;quot;Target&amp;quot;,113746))
		
	if not waBuff or waBuff &amp;lt; 3 then
			SpellCancelQueuedSpell()
			CastSpellByName(tostring(GetSpellInfo(770)))
		end
	end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>BEAR - Frenzied Regen [100%]</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local myhealth = 100 * UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;)
local hasTier = select(4,UnitBuffID(&amp;quot;player&amp;quot;,138217))

--Prioritize Frenzied Regen only if T15 2pc Buff is at 8+ stacks and player is below 65% health
if hasTier then
 if UnitPower(&amp;quot;player&amp;quot;) &amp;gt; 59 and myhealth &amp;lt; 60 and hasTier &amp;gt;= 8 and UnitBuffID(&amp;quot;player&amp;quot;,5487) then
  CastSpellByName(tostring(GetSpellInfo(22842)))
  end
--If not T15 2pc Buff on player....
elseif not hasTier then
 if UnitPower(&amp;quot;player&amp;quot;) &amp;gt; 40 and myhealth &amp;lt; 85 and UnitBuffID(&amp;quot;player&amp;quot;,5487) then
  CastSpellByName(tostring(GetSpellInfo(22842)))
  end
  end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-- Master Healing Potion</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PlayerHP = 100 * UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;)

if PlayerHP &amp;lt; 25
and GetItemCount(76097,false,false) &amp;gt; 0 
and ( select(2, GetItemCooldown(76097)) == 0 ) then
    UseItemByName(76097)
    return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>BEAR - Lacerate</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if UnitAffectingCombat(&amp;quot;player&amp;quot;) and UnitBuffID(&amp;quot;player&amp;quot;,5487) and LacerateCooldownTimeLeft == 0 then
	CastSpellByName(tostring(GetSpellInfo(33745)))
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>BEAR - Mangle</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if UnitAffectingCombat(&amp;quot;player&amp;quot;) and UnitBuffID(&amp;quot;player&amp;quot;,5487) and MangleCooldownTimeLeft == 0 then
	SpellCancelQueuedSpell()
	CastSpellByName(tostring(GetSpellInfo(33878)))
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>BEAR - Maul</Name><Default>false</Default><SpellID>6807</SpellID><Actions></Actions><Lua>local MaulCD = GetSpellCooldown(6807)

if UnitAffectingCombat(&amp;quot;player&amp;quot;) and UnitBuffID(&amp;quot;player&amp;quot;,5487) and MaulCD == 0 then
	return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>BEAR - Swipe</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if UnitAffectingCombat(&amp;quot;player&amp;quot;) and SwipeCooldownTimeLeft == 0 and UnitBuffID(&amp;quot;player&amp;quot;,5487) then
	CastSpellByName(tostring(GetSpellInfo(779)))
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>BEAR - Renewal [TALENT: Renewal]</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PlayerHP = 100 * UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;)
local reknewalKnown = IsSpellKnown(108238)

if reknewalKnown then

if PlayerHP &amp;lt; 35
and ( select(2, GetSpellCooldown(108238)) == 0 ) then
    CastSpellByName(tostring(GetSpellInfo(108238)))
    return true
end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>BEAR - SD+FR [Experimental]</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local defenseability = 0
local myhealth = 100 * UnitHealth(&amp;quot;Player&amp;quot;) / UnitHealthMax(&amp;quot;Player&amp;quot;)

if UnitPower(&amp;quot;Player&amp;quot;) &amp;gt; 59
and myhealth &amp;lt; 40 then defenseability = 22842 end -- Frenzied regen check

if UnitPower(&amp;quot;Player&amp;quot;) &amp;gt; 59
and myhealth &amp;gt; 40 then defenseability = 62606 end -- Savage defense check

if defenseability == (22842 or 62606) then CastSpellByName(GetSpellInfo(defenseability),nil)  -- cancel ability or use if conditions are met
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>BEAR - Frenzied Regen [Xtra Rage+HC]</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local myhealth = 100 * UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;)

if UnitPower(&amp;quot;player&amp;quot;) &amp;gt; 80 and myhealth &amp;lt; 75 and UnitBuffID(&amp;quot;player&amp;quot;,132402) and UnitBuffID(&amp;quot;player&amp;quot;,5487) then
  CastSpellByName(tostring(GetSpellInfo(22842)))
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>BEAR - Savage Defense [Rctrl]</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if IsRightControlKeyDown() and UnitPower(&amp;quot;player&amp;quot;) &amp;gt; 59 and UnitBuffID(&amp;quot;player&amp;quot;,5487) and not UnitBuffID(&amp;quot;player&amp;quot;, 62606) then
 CastSpellByName(GetSpellInfo(62606),nil)
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>BEAR - Savage Defense [Xtra Rage]</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local sdKnown = IsSpellKnown(62606)

if sdKnown and UnitAffectingCombat(&amp;quot;player&amp;quot;) then
 
if UnitPower(&amp;quot;player&amp;quot;) &amp;gt; 90 and UnitBuffID(&amp;quot;player&amp;quot;,5487) then
 CastSpellByName(GetSpellInfo(62606),nil)
end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-- Healthstone</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PlayerHP = 100 * UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;)

if PlayerHP &amp;lt; 30
and GetItemCount(5512,false,false) &amp;gt; 0 
and ( select(2, GetItemCooldown(5512)) == 0 ) then
    UseItemByName(5512)
    return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-- Alchemist Rejuvenation [Alchemist Only]</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PlayerHP = 100 * UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;)

if PlayerHP &amp;lt; 25
and GetItemCount(76094,false,false) &amp;gt; 0 
and ( select(2, GetItemCooldown(76094)) == 0 ) then
    UseItemByName(76094)
    return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>BEAR - Rejuv [TALENT: Heart of the Wild]</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local hotwKnown = IsSpellKnown(108288)

if hotwKnown and UnitBuffID(&amp;quot;player&amp;quot;,5487) then

if UnitBuffID(&amp;quot;player&amp;quot;,108293) and not UnitBuffID(&amp;quot;player&amp;quot;, &amp;quot;774&amp;quot;) then 
 CastSpellByName(tostring(GetSpellInfo(774)))
 return true 
end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>BEAR - Enrage [On CD]</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local enKnown = IsSpellKnown(5229)

if enKnown and UnitAffectingCombat(&amp;quot;player&amp;quot;) and UnitBuffID(&amp;quot;player&amp;quot;,5487) then
  if PlayerEnergy &amp;lt; 80 and ( select(2, GetSpellCooldown(5229)) == 0 ) then
    CastSpellByName(GetSpellInfo(5229))
  end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>BEAR - Swipe [Filler]</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if UnitAffectingCombat(&amp;quot;player&amp;quot;) and UnitBuffID(&amp;quot;player&amp;quot;,132402) and UnitDebuffID(&amp;quot;target&amp;quot;,77758) then 
 if ThrashCooldownTimeLeft &amp;gt; 1 and FFCooldownTimeLeft &amp;gt; 1 and LacerateCooldownTimeLeft &amp;gt; 1 and UnitBuffID(&amp;quot;player&amp;quot;,5487) then
	CastSpellByName(tostring(GetSpellInfo(779)))
	end
 end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>BEAR - Cenarion Ward [TALENT]</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local myhealth = 100 * UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;)
local cwKnown = IsSpellKnown(102351)

if cwKnown then

if UnitBuffID(&amp;quot;player&amp;quot;, &amp;quot;5487&amp;quot;) then
 if myhealth &amp;lt; 95 and ( select(2, GetSpellCooldown(102351)) == 0 ) then
   CastSpellByName(GetSpellInfo(102351),nil)
   return true
end
end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>BEAR - Natures Vigil [FR&amp;gt;SD]</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if UnitBuffID(&amp;quot;player&amp;quot;, &amp;quot;5487&amp;quot;)) and ( select(2, GetSpellCooldown(124974)) == 0 ) and UnitBuffID(&amp;quot;player&amp;quot;,54810) then
   CastSpellByName(GetSpellInfo(124974),nil)
   return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>BEAR - Cenarion Ward [TALENT W/FR]</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local cwKnown = IsSpellKnown(102351)

if cwKnown then

if UnitBuffID(&amp;quot;player&amp;quot;,54810) and not UnitBuffID(&amp;quot;player&amp;quot;, &amp;quot;102352&amp;quot;)then 
 CastSpellByName(tostring(GetSpellInfo(102351)))
 return true 
end
end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>BEAR - Thrash</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if UnitAffectingCombat(&amp;quot;player&amp;quot;) then
 if ThrashCooldownTimeLeft == 0 and UnitBuffID(&amp;quot;player&amp;quot;,5487) then
	CastSpellByName(tostring(GetSpellInfo(77758)))
    end
 end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>BEAR - Might of Ursoc[&amp;lt;20%]</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PlayerHP = 100 * UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;)

if PlayerHP &amp;lt; 20 and ( select(2, GetSpellCooldown(106922)) == 0 ) then
  CastSpellByName(GetSpellInfo(106922),nil)
  return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>BEAR - Wrath [TALENT: Heart of the Wild]</Name><Default>false</Default><SpellID>0</SpellID><Actions>/use Berserking</Actions><Lua>local isMoving	= PQR_IsMoving()

if UnitBuffID(&amp;quot;player&amp;quot;,108293) and not isMoving then 
CastSpellByName(tostring(GetSpellInfo(5176))) 
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>BEAR - Cenarion Ward [FR]</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local myhealth = 100 * UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;)
local cwKnown = IsSpellKnown(102351)

if cwKnown then

if UnitBuffID(&amp;quot;player&amp;quot;, &amp;quot;5487&amp;quot;) and myhealth &amp;lt; 95  then
   CastSpellByName(GetSpellInfo(102351),nil)
   return true
end
end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-- Auto Target</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not UnitExists(&amp;quot;target&amp;quot;) then TargetNearestEnemy() end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-- Boss Events</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>--Implement PQR_resumeAttack.. this is used to prevent
--abilities lower in the rotation from being cast.
if PQR_resumeAttack == nil then
	PQR_resumeAttack = 0
elseif PQR_resumeAttack &amp;gt; GetTime() then
	return true
else
	PQR_resumeAttack = 0
end


--IMPORTANT: Change this if you have any cleaves that would do damage to a secondary target
--as part of your single target rotation. Better to be safe than sorry! 
--Used for : Spirit Kings
local cleaveClass = false
local isAOE = strmatch(strupper(PQR_RotationName), &amp;quot;AOE&amp;quot;) --checks if we are in AOE mode.

for i=1,4 do
	local bossCheck = &amp;quot;boss&amp;quot;..i
	if UnitExists(bossCheck) then
		local npcID = tonumber(UnitGUID(bossCheck):sub(6,10), 16)
		local bossCasting,_,_,_,_,castEnd = UnitCastingInfo(bossCheck)
		
		if npcID == 62511 or npcID == 62711 then --Amber-Shaper Un&amp;apos;sok or Amber Monstrosity
			local reshapeLife = UnitDebuffID(&amp;quot;vehicle&amp;quot;, 122370)
			local reshapeLife2 = UnitDebuffID(&amp;quot;player&amp;quot;, 122370)
			if reshapeLife or reshapeLife2 then
				local playerCasting = UnitCastingInfo(&amp;quot;vehicle&amp;quot;)
				local playerCasting2 = UnitCastingInfo(&amp;quot;player&amp;quot;)
				--grab spell names for abilities:
				local amberExplosion = GetSpellInfo(122402)
				
				--interrupt the target if casting amber explosion
				if bossCasting == amberExplosion then
					TargetUnit(bossCheck)
					--Press the 1st button (Amber Strike)
					RunMacroText(&amp;quot;/click OverrideActionBarButton1&amp;quot;)
				end
				
				--interrupt self if casting amber explosion
				if playerCasting == amberExplosion then
					--Press the 2nd button (Struggle for Control)
					RunMacroText(&amp;quot;/click OverrideActionBarButton2&amp;quot;)
				end
				
					--interrupt self if casting amber explosion
				if playerCasting2 == amberExplosion then
					--Press the 2nd button (Struggle for Control)
					RunMacroText(&amp;quot;/click OverrideActionBarButton2&amp;quot;)
				end
				
				return true --prevent the rotation from executing while reshaped

			end
			
		elseif npcID == 60709 then --Spirit Kings: Qiang. (Impervious Shield)
			--Stop all attacks until 0.2 seconds after cast time ends and until buff (Impervious Shield) is gone.
			
			--only continue checking if we are targetting the boss or have no target.
			if (not UnitExists(&amp;quot;target&amp;quot;)) or (UnitIsUnit(&amp;quot;target&amp;quot;, bossCheck)) or (cleaveClass or isAOE) then
				local impName = GetSpellInfo(117961)
				local impShieldBuff = UnitBuffID(bossCheck, 117961)
				
				if (bossCasting and bossCasting == impName) then
					StopAttack()
					SpellStopCasting()
					local delayAdd = (castEnd/1000) - GetTime() --the number of seconds remaining on the cast.
					PQR_resumeAttack = GetTime() + delayAdd + 0.2
					return true
				end
				
				if impShieldBuff then
					StopAttack()
					SpellStopCasting()
					return true
				end
			end
			
		elseif npcID == 60710 then --Spirit Kings: Subetai. (Sleight of Hand)
			--Stop all attacks when casting Sleight of Hand, and until 0.2 seconds after cast time ends.
			--Also stop attacks if not stunned.
			
			--only continue checking if we are targetting the boss or have no target.
			if (not UnitExists(&amp;quot;target&amp;quot;)) or (UnitIsUnit(&amp;quot;target&amp;quot;, bossCheck)) or (cleaveClass or isAOE) then
				local sleightName = GetSpellInfo(118162)
				local sleightBuff = UnitBuffID(bossCheck, 118162)
				--				  HoJ,   FoJ,  Kidney  
				local stunList = { 853, 105593, 408 }
				local isStunned = nil
				for _,v in ipairs(stunList) do
					local debuffCheck = UnitDebuffID(bossCheck, v)
					if debuffCheck then
						isStunned = true
					end
				end
				
				if (bossCasting and bossCasting == sleightName) then
					StopAttack()
					SpellStopCasting()
					local delayAdd = (castEnd/1000) - GetTime() --the number of seconds remaining on the cast.
					PQR_resumeAttack = GetTime() + delayAdd + 0.2
					return true
				end
				
				if sleightBuff and not isStunned then
					StopAttack()
					SpellStopCasting()
					return true
				end
			end

		elseif npcID == 60701 then --Spirit Kings: Zian. (Shield of Darkness)
			--Stop all attacks until 0.5 seconds after cast time ends and until buff (Shield of Darkness) is gone.
						
			if (not UnitExists(&amp;quot;target&amp;quot;)) or (UnitIsUnit(&amp;quot;target&amp;quot;, bossCheck)) or (cleaveClass or isAOE) then
				local sodName = GetSpellInfo(117697)
				local sodBuff = UnitBuffID(bossCheck, 117697)
				
				if (bossCasting and bossCasting == sodName) then
					StopAttack()
					SpellStopCasting()
					local delayAdd = (castEnd/1000) - GetTime() --the number of seconds remaining on the cast.
					PQR_resumeAttack = GetTime() + delayAdd + 0.5 --0.5 to account for lag... REALLY do not want to set this off.
					return true
				end
				
				if sodBuff then
					StopAttack()
					SpellStopCasting()
					return true
				end
			end
		end
	end
end

--click button to leave.
--Gara&amp;apos;jal isn&amp;apos;t a boss while in the Spirit Realm.
local returnSoul = select(7,UnitDebuffID(&amp;quot;player&amp;quot;,116161))
if returnSoul and returnSoul - GetTime() &amp;lt; 2 then 
	RunMacroText(&amp;quot;/click ExtraActionButton1&amp;quot;) 
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Bear Form Return</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>--local inWater = IsSwimming()-- IsSwimming Function is Broken 
local inCombat = UnitAffectingCombat(&amp;quot;player&amp;quot;)

if inCombat and not UnitBuffID(&amp;quot;Player&amp;quot;,768) and GetShapeshiftForm(&amp;quot;player&amp;quot;) ~= 1 and UnitChannelInfo(&amp;quot;player&amp;quot;) == nil then
CastShapeshiftForm(1)
elseif IsMounted() or UnitBuffID(&amp;quot;Player&amp;quot;,40120) or UnitBuffID(&amp;quot;Player&amp;quot;,783) or UnitBuffID(&amp;quot;Player&amp;quot;,768) or
UnitBuffID(&amp;quot;Player&amp;quot;,1066) then 
return false
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Mark of the Wild AutoBuff</Name><Default>false</Default><SpellID>1126</SpellID><Actions></Actions><Lua>if not UnitAffectingCombat(&amp;quot;player&amp;quot;) 
    and not IsMounted()
    and not UnitBuffID(&amp;quot;Player&amp;quot;,40120)
    and not UnitBuffID(&amp;quot;Player&amp;quot;,783)
    and not UnitBuffID(&amp;quot;player&amp;quot;,1126)
	and not UnitBuffID(&amp;quot;player&amp;quot;,20217)
	and not UnitBuffID(&amp;quot;player&amp;quot;,90363)
	and not UnitBuffID(&amp;quot;player&amp;quot;,115921)	then
	return true
end</Lua><RecastDelay>10000</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Rebirth (Mouseover)</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local isMoving = PQR_IsMoving()

if UnitExists(&amp;quot;mouseover&amp;quot;) and
   UnitIsDeadOrGhost(&amp;quot;mouseover&amp;quot;) and
   UnitCanCooperate(&amp;quot;player&amp;quot;, &amp;quot;mouseover&amp;quot;) and
   IsSpellInRange(&amp;quot;Rebirth&amp;quot;, &amp;quot;mouseover&amp;quot;) and 
   GetSpellCooldown(20484) == 0 and
   UnitChannelInfo(&amp;quot;player&amp;quot;) == nil and not
   isMoving 
then CastSpellByName(GetSpellInfo(20484))
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-- Stampeding Roar (RShft)</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if IsRightShiftKeyDown() and GetSpellCooldown(77764) == 0 then
 CastSpellByName(GetSpellInfo(77764),nil)
 return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-- Tranquility (LShft)</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if IsLeftShiftKeyDown() and GetSpellCooldown(740) == 0 then
 SpellCancelQueuedSpell()
 CastSpellByName(GetSpellInfo(740),nil)
 return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-- TESTshifter by Threat + RotationSwap</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if IsMounted() or UnitBuffID(&amp;quot;Player&amp;quot;,40120) or UnitBuffID(&amp;quot;Player&amp;quot;,783) then
return false
end

if UnitExists(&amp;quot;Target&amp;quot;) and UnitAffectingCombat(&amp;quot;Player&amp;quot;) then
 local isTanking = select(2,UnitDetailedThreatSituation(&amp;quot;player&amp;quot;, &amp;quot;target&amp;quot;))
 if (isTanking &amp;lt; 2 or nil and GetShapeshiftForm(&amp;quot;player&amp;quot;) ~= 3) or (not isTanking and GetShapeshiftForm(&amp;quot;player&amp;quot;) ~= 3) and UnitChannelInfo(&amp;quot;player&amp;quot;) == nil then
  CastShapeshiftForm(3)
 elseif (isTanking &amp;gt;= 2 and GetShapeshiftForm(&amp;quot;player&amp;quot;) ~= 1) and UnitChannelInfo(&amp;quot;player&amp;quot;) == nil then
  CastShapeshiftForm(1)
 end
 
 if (isTanking &amp;lt; 2 or nil and GetShapeshiftForm(&amp;quot;player&amp;quot;) ~= 3) or (not isTanking and GetShapeshiftForm(&amp;quot;player&amp;quot;) ~= 3) and UnitChannelInfo(&amp;quot;player&amp;quot;) == nil then
  PQR_SwapRotation(&amp;quot;KittyCleave (Firekitteh)&amp;quot;)
 elseif (isTanking &amp;gt;= 2 and GetShapeshiftForm(&amp;quot;player&amp;quot;) ~= 1) and UnitChannelInfo(&amp;quot;player&amp;quot;) == nil then
  if IsSpellKnown(62602) then
   PQR_SwapRotation(&amp;quot;[ThePerfectBear] 10/25M SD&amp;gt;FR ([5.2])&amp;quot;)
  else
   PQR_SwapRotation(&amp;quot;[ThePerfectBear] 10/25M FR&amp;gt;SD ([5.2])&amp;quot;)
 end
 end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-- Symbiosis Returns (Guardian)</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>-- Symbiosis Returns by Googlebee @ Ownedcore.com for PQR
-- Special thanks to my mentor, Firepong.
-- Support for ALL Classes for Spells granted to Guardian Druids.

local playerClass = select(3,UnitClass(&amp;quot;Player&amp;quot;))
local talentTree = GetSpecialization()
local hasSymb = select(15,UnitBuffID(&amp;quot;Player&amp;quot;,110309))
local umadBro = UnitThreatSituation(&amp;quot;player&amp;quot;, &amp;quot;target&amp;quot;)
--If Druid and Guardian Spec
if playerClass == 11 and talentTree == 3 and hasSymb then
--Guardian Druid Spell Id&amp;apos;s and Spell Names gained from other classes:
--(122285)-- From Deathknight (Bone Shield)
--(110600)-- From Hunter (Ice Trap)
--(110694)-- From Mage (Frost Armor)
--(110701)-- From Paladin (Consecration)
--(110717)-- From Priest (Fear Ward)
--(122289)-- From Rogue (Feint)
--(110803)-- From Shaman (Lightning Shield)
--(122290)-- From Warlock (Life Tap)
--(113002)-- From Warrior (Spell Reflect)
--(126449)-- From Monk (Elusive Brew)

-- Mouse Button 4 is the default button press for most of the abilities.
-- If there is not a mouse button assigned it is done automatically.
-- To change the mouse button number, simply edit the (4) to (?) &amp;lt;-- Whatever number u like.

 if hasSymb == 122285 and not UnitBuffID(&amp;quot;Player&amp;quot;,122285) and GetSpellCooldown(122285) == 0 and IsMouseButtonDown(4) then
 --PlaySoundFile(&amp;quot;Sound\\Creature\\LordMarrowgar\\IC_Marrowgar_WW01.wav&amp;quot;) 
 CastSpellByName(GetSpellInfo(122285)) -- Bone Shield
 elseif hasSymb == 110600 and GetSpellCooldown(110600) == 0 and IsMouseButtonDown(4) then
 CastSpellByName(GetSpellInfo(110600)) -- Ice Trap
 --PlaySoundFile(&amp;quot;Sound\\Creature\\Paletress\\AC_Paletress_WoundHeavy02.wav&amp;quot;)
 elseif hasSymb == 110694 and not UnitBuffID(&amp;quot;Player&amp;quot;,110694) then 
 CastSpellByName(GetSpellInfo(110694)) -- Frost Armor
 --PlaySoundFile(&amp;quot;Sound\\Creature\\LichKing\\IC_Lich King_FMAttack01.wav&amp;quot;)
 elseif hasSymb == 110701 and GetSpellCooldown(110701) == 0 and UnitExists(&amp;quot;target&amp;quot;) and
 UnitAffectingCombat(&amp;quot;player&amp;quot;) and IsSpellInRange(GetSpellInfo(33917),&amp;quot;target&amp;quot;) == 1 then
 CastSpellByName(GetSpellInfo(110701)) -- Consecration
 --PlaySoundFile(&amp;quot;Sound\\Creature\\Ashbringer\\ASH_SPEAK_12.Wav&amp;quot;)
 elseif hasSymb == 110717 and GetSpellCooldown(110717) == 0 and IsMouseButtonDown(4) then
 CastSpellByName(GetSpellInfo(110717)) -- Fear Ward
 --PlaySoundFile(&amp;quot;Sound\\Creature\\BabyMurloc\\BabyMurlocB.wav&amp;quot;)
 elseif hasSymb == 122289 and GetSpellCooldown(122289) == 0 and IsMouseButtonDown(4) then
 CastSpellByName(GetSpellInfo(122289)) -- Feint
 elseif hasSymb == 110803 and not UnitBuffID(&amp;quot;Player&amp;quot;,110803) then 
 CastSpellByName(GetSpellInfo(110803)) -- Lightning Shield
 elseif hasSymb == 122290 and GetSpellCooldown(122290) == 0 and IsMouseButtonDown(4) then
 CastSpellByName(GetSpellInfo(122290)) -- Life Tap
 --PlaySoundFile(&amp;quot;Sound\\Creature\\Kologarn\\UR_Kologarn_Slay02.ogg&amp;quot;)
 elseif hasSymb == 113002 and GetSpellCooldown(122290) == 0 and IsMouseButtonDown(4) then
 CastSpellByName(GetSpellInfo(113002)) -- Spell Reflect
 elseif hasSymb == 126453 and GetSpellCooldown(126453) == 0 and umadBro &amp;gt;= 2 then
 CastSpellByName(GetSpellInfo(126453)) -- Elusive Brew
 end
 end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>BEAR - Frenzied Regen [T15+]</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local myhealth = 100 * UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;)
local hasTier = select(4,UnitBuffID(&amp;quot;player&amp;quot;,138217))

--Prioritize Frenzied Regen only if T15 2pc Buff is at 8+ stacks and player is below 65% health
if UnitPower(&amp;quot;player&amp;quot;) &amp;gt; 59 and myhealth &amp;lt; 60  and hasTier &amp;gt;= 8 and UnitBuffID(&amp;quot;player&amp;quot;,5487) then
 CastSpellByName(tostring(GetSpellInfo(22842)))
--If not T15 2pc Buff on player, and if Savage Defense is on the target
elseif not UnitBuffID(&amp;quot;player&amp;quot;,138217) and UnitBuffID(&amp;quot;player&amp;quot;,132402) then
 if UnitPower(&amp;quot;player&amp;quot;) &amp;gt; 90 and myhealth &amp;lt; 80  and UnitBuffID(&amp;quot;player&amp;quot;,5487) then
 CastSpellByName(tostring(GetSpellInfo(22842)))
 end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>BEAR - Savage Defense [100%]</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local sdKnown = IsSpellKnown(62606)

if sdKnown and UnitAffectingCombat(&amp;quot;player&amp;quot;) then

if UnitPower(&amp;quot;player&amp;quot;) &amp;gt; 59 and not UnitBuffID(&amp;quot;player&amp;quot;, &amp;quot;62606&amp;quot;) and UnitBuffID(&amp;quot;player&amp;quot;,5487) then
 CastSpellByName(GetSpellInfo(62606),nil)
end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>BEAR - Frenzied Regen [Glyphed]</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local myhealth = 100 * UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;)

if UnitPower(&amp;quot;player&amp;quot;) &amp;gt; 59 and myhealth &amp;lt; 95 and UnitBuffID(&amp;quot;player&amp;quot;,5487) and not UnitBuffID(&amp;quot;player&amp;quot;,54810) then
 CastSpellByName(tostring(GetSpellInfo(22842)))
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>BEAR - Frenzied Regen [Rctrl]</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if IsRightControlKeyDown() and UnitPower(&amp;quot;player&amp;quot;) &amp;gt; 59 and UnitBuffID(&amp;quot;player&amp;quot;,5487) and not UnitBuffID(&amp;quot;player&amp;quot;, &amp;quot;124769&amp;quot;) then
 CastSpellByName(GetSpellInfo(22842),nil)
 return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>BEAR - Maul [Rctrl]</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local maulKnown = IsSpellKnown(6807)

if maulKnown then

if IsRightControlKeyDown() and UnitPower(&amp;quot;player&amp;quot;) &amp;gt; 29 and not UnitBuffID(&amp;quot;player&amp;quot;, &amp;quot;124769&amp;quot;) and UnitBuffID(&amp;quot;player&amp;quot;,5487) then
 CastSpellByName(GetSpellInfo(6807),nil)
 return true
end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-- Manual Shifter [Ralt]</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local ssForm = GetShapeshiftFormID(&amp;quot;Player&amp;quot;)
--Form 1 = Cat Form
--Form 5 = Bear Form

if not rightkeydown then rightkeydown = 0 end

if IsRightAltKeyDown() and GetTime() - rightkeydown &amp;gt; 1.5 and ssForm ~= 1 then
	CastShapeshiftForm(3)
end

if IsRightAltKeyDown() and GetTime() - rightkeydown &amp;gt; 1.5 and ssForm ~= 5 then
	CastShapeshiftForm(1)
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-- TEST Feng Tanks</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>--Implement PQR_resumeAttack.. this is used to prevent
--abilities lower in the rotation from being cast.
if PQR_resumeAttack == nil then
	PQR_resumeAttack = 0
elseif PQR_resumeAttack &amp;gt; GetTime() then
	return true
else
	PQR_resumeAttack = 0
end

for i=1,4 do
    local bossCheck = &amp;quot;boss&amp;quot;..tostring(i)
    if UnitExists(bossCheck) then
        local npcID = tonumber(UnitGUID(bossCheck):sub(6,10), 16)
        local bossCasting,_,_,_,_,castEnd = UnitCastingInfo(bossCheck)
        
        
        if npcID == 60009 then --Feng the Accursed
        
                --grab spell names for abilities:
                local lightningFistsNm = GetSpellInfo(116157)
                local lightningFistsHm = GetSpellInfo(116295)
                local epiCenter = GetSpellInfo(116018)    
                local focusStunnedNm = UnitDebuffID(&amp;quot;focus&amp;quot;, 116157)
                local focusStunnedHm = UnitDebuffID(&amp;quot;focus&amp;quot;, 116295)
                
                --intercept the spell if casting Lightning Fists (Normal Mode)
                if bossCasting and bossCasting == lightningFistsNm and focusStunnedNm then
                    TargetUnit(&amp;quot;focus&amp;quot;)
                    --Press the ExtraActionButton (Shroud of Reversal)
                    RunMacroText(&amp;quot;/click ExtraActionButton1&amp;quot;)
                end
                
                --intercept the spell if casting Lightning Fists (Heroic Mode)
                if bossCasting and bossCasting == lightningFistsHm and focusStunnedHm then
                    TargetUnit(&amp;quot;focus&amp;quot;)
                    --Press the ExtraActionButton (Shroud of Reversal)
                    RunMacroText(&amp;quot;/click ExtraActionButton1&amp;quot;)
                end            

                --intercept the spell if Flaming Spear on Focus and Redirect to Feng (All Modes)
                if UnitDebuffID(&amp;quot;focus&amp;quot;, 116942) then
                    TargetUnit(&amp;quot;focus&amp;quot;)
                    --Press the ExtraActionButton (Shroud of Reversal)
                    RunMacroText(&amp;quot;/click ExtraActionButton1&amp;quot;) then
                    --Target Boss and use (Flaming Spear)
                    TargetUnit(bossCheck)
                    RunMacroText(&amp;quot;/click ExtraActionButton1&amp;quot;)
                end           

                --intercept the spell if Arcane Shock on Focus and Redirect to Feng (All Modes)
                 if UnitDebuffID(&amp;quot;focus&amp;quot;, 131790) then
                    TargetUnit(&amp;quot;focus&amp;quot;)
                    --Press the ExtraActionButton (Shroud of Reversal)
                    RunMacroText(&amp;quot;/click ExtraActionButton1&amp;quot;) then
                    --Target Boss and use (Arcane Shock)
                    TargetUnit(bossCheck)
                    RunMacroText(&amp;quot;/click ExtraActionButton1&amp;quot;)
                end          

                --interrupt Feng if casting Epicenter
                if bossCasting == epiCenter then
                    TargetUnit(bossCheck)
                    --Press the ExtraActionButton to stun Feng (Lightning Fists)
                    RunMacroText(&amp;quot;/click ExtraActionButton1&amp;quot;)
                end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>CAT - QuikBurst</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if UnitBuffID(&amp;quot;Player&amp;quot;,768) and UnitAffectingCombat(&amp;quot;player&amp;quot;) then
RunMacroText(&amp;quot;/castsequence reset=target Faerie Fire, Rake, Thrash, Mangle, Mangle, Mangle, Rip, Rake, Thrash, Mangle, Mangle, Ferocious Bite&amp;quot;)
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>BEAR - Mighty Bash[Mouse 5]</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local mBash = IsSpellKnown(5211)
local isAggro = UnitThreatSituation(&amp;quot;player&amp;quot;, &amp;quot;target&amp;quot;)
local tLevel = UnitLevel(&amp;quot;target&amp;quot;)
local itsCasting = select(9,UnitCastingInfo(&amp;quot;target&amp;quot;))




    if mBash and GetSpellCooldown(5211) == 0 and UnitExists(&amp;quot;target&amp;quot;) then 
	  if IsSpellInRange(GetSpellInfo(5211),&amp;quot;target&amp;quot;) == 1 and UnitAffectingCombat(&amp;quot;player&amp;quot;) then 
	    if not tLevel == -1 and umadBro &amp;gt;= 2 then
	        SpellCancelQueuedSpell()
	        CastSpellByName(GetSpellInfo(5211),&amp;quot;target&amp;quot;) -- Mighty Bash (Auto if highest threat)
	        end
	      end
	    elseif mBash and IsMouseButtonDown(5) and UnitExists(&amp;quot;target&amp;quot;) then
		SpellCancelQueuedSpell()
		CastSpellByName(GetSpellInfo(5211)) -- Mighty Bash (Mouse Button 5 Manual)
	  end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-- Ursol&amp;apos;s Vortex [Lctrl]</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if IsUsableSpell(102793)
and select(2,GetSpellCooldown(102793)) &amp;lt; 2
and IsLeftControlKeyDown()
then
CastSpellByName(GetSpellInfo(102793))
if SpellIsTargeting() then CameraOrSelectOrMoveStart() CameraOrSelectOrMoveStop() end
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability></DRUID>