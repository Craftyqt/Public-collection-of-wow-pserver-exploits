Kuukuu_CustomT = { } 

function MobScan()

	local totalmembers = GetNumGroupMembers()
	local match = 0
	local inCombat = UnitAffectingCombat("player")

	if IsInRaid() then 
		group = "raid"
	elseif IsInGroup() then 
		group = "party" 
	end
	---------------------------------------------------
	-- Adding GUIDS to Custom Table--
	---------------------------------------------------

        --party checking code, found it was too slow at filling table to work with larger groups

--	if totalmembers > 0 then
--		for i=1,totalmembers do
--			partytarget = (group..tostring(i).."target")
--			guid = UnitGUID(partytarget)
--			-- Loop table
--			for i=1,#Kuukuu_CustomT do				
-- 				if Kuukuu_CustomT[i].GUID == guid then
--					match = 1
--		    		end
--	   		end 
--			if (match == 0 and IsSpellInRange(GetSpellInfo(78),partytarget)==1 and UnitCanAttack ("player",partytarget)) then
--				table.insert(Kuukuu_CustomT, {GUID = (guid)})
--			end
--	  	end
--	 else

                -- player target checking and adding to table
 
	 	partytarget = "target"
		guid =UnitGUID(partytarget)
		for i=1,#Kuukuu_CustomT do				
			if Kuukuu_CustomT[i].GUID == guid then
				match = 1
	    		end
   		end 
		if (match == 0 and IsSpellInRange(GetSpellInfo(78),partytarget)==1 and UnitCanAttack ("player",partytarget)) then
			table.insert(Kuukuu_CustomT, {GUID = (guid)})
		end	

	-- end
	---------------------------------------------------------
	--Removing GUIDS from Custom Table--
	---------------------------------------------------------

        --remove if out of range, removing mob from table if it is no longer being targetted so not helpful.

--	for i=1, #Kuukuu_CustomT do
--		if IsSpellInRange(GetSpellInfo(78),partytarget)==0 or IsSpellInRange(GetSpellInfo(78),partytarget)== nil then
--				table.remove(Kuukuu_CustomT, i)
--		end
--	end

        --clear table once out of combat

	if not inCombat and #Kuukuu_CustomT ~= 0 then
		for i = 1, #Kuukuu_CustomT do
		Kuukuu_CustomT[i] = nil
		end
	end	  
    
    --remove mobs that have died
	
    guidRemove = CreateFrame('Frame')
    guidRemove:RegisterEvent("COMBAT_LOG_EVENT_UNFILTERED")
    function guidRemove_OnEvent(self, event, ...)
        local type, _, sourceGUID, sourceNAME, _, _, destGUID, destNAME = select(2, ...)
        if (event=="COMBAT_LOG_EVENT_UNFILTERED") then
            if (type=="UNIT_DIED") then
            	guid = select(8, ...)
                for i = 1, #Kuukuu_CustomT do
                	if Kuukuu_CustomT[i] and Kuukuu_CustomT[i].GUID and Kuukuu_CustomT[i].GUID == guid then
                		table.remove(Kuukuu_CustomT, i)
                	end
            	end
       		end
 		end
 	end
    
    guidRemove:SetScript("OnEvent", guidRemove_OnEvent)

    -- make sure not returning a nil value

	if #Kuukuu_CustomT == nil then
		numberintable = 0
	else 
		numberintable = #Kuukuu_CustomT
	end
	
	return numberintable
	
end

-- GUID Finder (Special thanks to Nova Team for this one)
Nova_GUID = nil
function Nova_GUID(unit)
	if UnitExists(unit) then
		if UnitIsPlayer(unit) then
			targetGUID = UnitGUID(unit)
		else
			targetGUID = tonumber((UnitGUID(unit)):sub(-12, -9), 16)
		end
	end
		
	return targetGUID
end

--Cooldown Check
OnCooldown = nil
function OnCooldown(spell)
	if IsPlayerSpell(spell) == true then
		local start, duration = GetSpellCooldown(spell)
		if ( start > 0 and duration > 1.5 ) then
			return true
		elseif GetSpellCooldown(spell) == 0 then
			return false
		end
	elseif IsPlayerSpell(spell) == nil then
		return false
	end
end

--Spell Cooldown remaining check
CooldownRemains = nil
function CooldownRemains(spell)
	local start, duration, enable = GetSpellCooldown(spell)
	if ( start > 0 and duration > 1.5 ) then
		return start + duration - GetTime()
	else
		return false
	end
end

--Buff Count Check
BuffCount = nil
function BuffCount(spell)
	if UnitBuffID("player", spell) ~= nil then
		return select(4, UnitBuffID("player", spell))
	else
		return false
	end
end

--Buff Handler
HasBuff = nil
function HasBuff(spell, target)
	if target ~= nil
	 and UnitBuffID(target, spell) ~= nil then
		return true
	elseif target ~= nil
	 and UnitBuffID(target, spell) == nil then
		return false
	elseif target == nil
	 and UnitBuffID("player", spell) ~= nil then
		return true
	else
		return false
	end
end

--Buff Timer
BuffTime = nil
function BuffTime(spell, target)
  if target ~= nil
    and UnitBuffID(target, spell) ~= nil then
    return select(7, UnitBuffID(target, spell)) - GetTime()
  elseif target == nil
    and UnitBuffID("player", spell) ~= nil then
    return select(7, UnitBuffID("player", spell)) - GetTime()
  else
    return false
  end
end

--Debuff Timer
DebuffTime = nil
function DebuffTime(spell, target, origin)
  if target ~= nil and origin ~= nil and UnitDebuffID(target, spell, origin) ~= nil then
    return select(7, UnitDebuffID(target, spell, origin)) - GetTime()
  elseif target ~= nil and origin == nil and UnitDebuffID(target, spell) ~= nil then
    return select(7, UnitDebuffID(target, spell)) - GetTime()
  elseif target == nil and origin == nil and UnitDebuffID("player", spell) ~= nil then
    return select(7, UnitDebuffID("player", spell)) - GetTime()
  else
    return false
  end
end

--Range Check and Cast if can
Cast = nil
function Cast(spell, target)
--	if IsPlayerSpell(spell) == true
--	 if GetSpellCooldown(spell) == 0 then
		if target ~= nil
		 and IsSpellInRange(GetSpellInfo(spell), target) == 0 then
			return false
		elseif target ~= nil
		 and IsSpellInRange(GetSpellInfo(spell), target) == 1 then
			CastSpellByName(GetSpellInfo(spell), target)
			return true
		elseif target == nil then
			CastSpellByName(GetSpellInfo(spell))
			return true
		else
			return false
		end
--	end
end

--Globals
energy = nil
function energy(target)
  if UnitExists(target) ~= nil then
    return UnitPower(target)
  end
end

energypercent = nil
function energypercent(target)
  if UnitExists(target) ~= nil then
    return UnitPower(target) / UnitPowerMax(target) * 100
  end
end

HP = nil
function HP(target)
	if UnitExists(target) then
		return UnitHealth(target) / UnitHealthMax(target) * 100
	end
end

rage = nil
function rage(target)
	if UnitExists(target) then
		return UnitPower(target)
	end
end

--Enrage buffs to Shiv
ENRAGES = {
	--Save for a later day
	}
	
--------------------------------------------------
---------------SPECIAL UNIT TABLE-----------------
--------------------------------------------------
PQ_BossUnits = {
	-- Cataclysm Dungeons --
	-- Abyssal Maw: Throne of the Tides
	40586,		-- Lady Naz'jar
	40765,		-- Commander Ulthok
	40825,		-- Erunak Stonespeaker
	40788,		-- Mindbender Ghur'sha
	42172,		-- Ozumat
	-- Blackrock Caverns
	39665,		-- Rom'ogg Bonecrusher
	39679,		-- Corla, Herald of Twilight
	39698,		-- Karsh Steelbender
	39700,		-- Beauty
	39705,		-- Ascendant Lord Obsidius
	-- The Stonecore
	43438,		-- Corborus
	43214,		-- Slabhide
	42188,		-- Ozruk
	42333,		-- High Priestess Azil
	-- The Vortex Pinnacle
	43878,		-- Grand Vizier Ertan
	43873,		-- Altairus
	43875,		-- Asaad
	-- Grim Batol
	39625,		-- General Umbriss
	40177,		-- Forgemaster Throngus
	40319,		-- Drahga Shadowburner
	40484,		-- Erudax
	-- Halls of Origination
	39425,		-- Temple Guardian Anhuur
	39428,		-- Earthrager Ptah
	39788,		-- Anraphet
	39587,		-- Isiset
	39731,		-- Ammunae
	39732,		-- Setesh
	39378,		-- Rajh
	-- Lost City of the Tol'vir
	44577,		-- General Husam
	43612,		-- High Prophet Barim
	43614,		-- Lockmaw
	49045,		-- Augh
	44819,		-- Siamat
	-- Zul'Aman
	23574,		-- Akil'zon
	23576,		-- Nalorakk
	23578,		-- Jan'alai
	23577,		-- Halazzi
	24239,		-- Hex Lord Malacrass
	23863,		-- Daakara
	-- Zul'Gurub
	52155,		-- High Priest Venoxis
	52151,		-- Bloodlord Mandokir
	52271,		-- Edge of Madness
	52059,		-- High Priestess Kilnara
	52053,		-- Zanzil
	52148,		-- Jin'do the Godbreaker
	-- End Time
	54431,		-- Echo of Baine
	54445,		-- Echo of Jaina
	54123,		-- Echo of Sylvanas
	54544,		-- Echo of Tyrande
	54432,		-- Murozond
	-- Hour of Twilight
	54590,		-- Arcurion
	54968,		-- Asira Dawnslayer
	54938,		-- Archbishop Benedictus
	-- Well of Eternity
	55085,		-- Peroth'arn
	54853,		-- Queen Azshara
	54969,		-- Mannoroth
	55419,		-- Captain Varo'then
	
	-- Mists of Pandaria Dungeons --
	-- Scarlet Halls
	59303,		-- Houndmaster Braun
	58632,		-- Armsmaster Harlan
	59150,		-- Flameweaver Koegler
	-- Scarlet Monastery
	59789,		-- Thalnos the Soulrender
	59223,		-- Brother Korloff
	3977,		-- High Inquisitor Whitemane
	60040,		-- Commander Durand
	-- Scholomance
	58633,		-- Instructor Chillheart
	59184,		-- Jandice Barov
	59153,		-- Rattlegore
	58722,		-- Lilian Voss
	58791,		-- Lilian's Soul
	59080,		-- Darkmaster Gandling
	-- Stormstout Brewery
	56637,		-- Ook-Ook
	56717,		-- Hoptallus
	59479,		-- Yan-Zhu the Uncasked
	-- Tempe of the Jade Serpent
	56448,		-- Wise Mari
	56843,		-- Lorewalker Stonestep
	59051,		-- Strife
	59726,		-- Peril
	58826,		-- Zao Sunseeker
	56732,		-- Liu Flameheart
	56762,		-- Yu'lon
	56439,		-- Sha of Doubt
	-- Mogu'shan Palace
	61444,		-- Ming the Cunning
	61442,		-- Kuai the Brute
	61445,		-- Haiyan the Unstoppable
	61243,		-- Gekkan
	61398,		-- Xin the Weaponmaster
	-- Shado-Pan Monastery
	56747,		-- Gu Cloudstrike
	56541,		-- Master Snowdrift
	56719,		-- Sha of Violence
	56884,		-- Taran Zhu
	-- Gate of the Setting Sun
	56906,		-- Saboteur Kip'tilak
	56589,		-- Striker Ga'dok
	56636,		-- Commander Ri'mok
	56877,		-- Raigonn
	-- Siege of Niuzao Temple
	61567,		-- Vizier Jin'bak
	61634,		-- Commander Vo'jak
	61485,		-- General Pa'valak
	62205,		-- Wing Leader Ner'onok

	-- Training Dummies --
	46647,		-- Level 85 Training Dummy
	67127		-- Level 90 Training Dummy
}

SpecialUnit = nil
function SpecialUnit()
	local PQ_BossUnits = PQ_BossUnits
	
	if UnitExists("target") then
		local npcID = tonumber(UnitGUID("target"):sub(6,10), 16)
		
		-- Use Cooldowns on Opposing Faction members
		--if UnitIsPlayer("target") then
		--	if UnitFactionGroup("player") ~= UnitFactionGroup("target") then return true end
		--end
		
		-- Dungeons & Raids
		if UnitLevel("target") == -1 then return true else
			for i=1,#PQ_BossUnits do
				if PQ_BossUnits[i] == npcID then return true end
			end
			return false
		end
	else return false end
end


-- Special Aggro Conditions
PQ_Aggro = {
	60410, 	-- Elegon
	63053	-- Garalon's Leg
}

--------------------------------------------------	
-------------------ROGUE TABLE--------------------
--------------------------------------------------
if select(2, UnitClass("player")) == "ROGUE" then
print("|cffFFBE69Loading |cffffff00Rogue|cffFFBE69 Tables ...|cffffffff")
	--Spell List
	ADRENALINERUSH	=	13750
	ANTICIPATION	=	114015
	AMBUSH			=	8676
	BLADEFLURRY		=	13877
	BLIND			=	2094
	CHEAPSHOT		=	1833
	CLOAK			=	31224
	COMBATREADINESS	=	74001
	CRIMSONTEMPEST	=	121411
	DEADLYTHROW		=	26679
	DISMANTLE		=	51722
	DISPATCH		=	111240
	DISTRACT		=	1725
	ENVENOM			=	32645
	EVASION			=	5277
	EVISCERATE		=	2098
	EXPOSEARMOR		=	8647
	FANOFKNIVES		=	51723
	FEINT			=	1966
	GARROTE			=	703
	GOUGE			=	1776
	KICK			=	1766
	KIDNEYSHOT		=	408
	KILLINGSPREE	=	51690
	MUTILATE		=	1329
	PICKLOCK		=	1804
	PICKPOCKET		=	921
	DEADLYPOISON	=	2823
	WOUND			=	8679
	CRIPPLING		=	3408
	MINDNUMBING		=	5761
	LEECHING		=	108211
	PREPARATION		=	14185
	RECUPERATE		=	73651
	REDIRECT		=	73981
	REVEALINGSTRIKE	=	84617
	RUPTURE			=	1943
	SAP				=	6770
	SHADOWBLADES	=	121471
	SHADOWWALK		=	114842
	SHADOWFOCUS		=	108209
	SHIV			=	5938
	SHROUD			=	114018
	SINISTERSTRIKE	=	1752
	SLICEANDDICE	=	5171
	SMOKEBOMB		=	76577
	SPRINT			=	2983
	STEALTH			=	1784
	SUBTERFUGE		=	108208
	THROW			=	121733
	TOTT			=	57934
	VANISH			=	1856
	VENDETTA		=	79140

	--Buffs
	BANDITSGUILE	=	84654
	BLINDSIDE		=	121153
	ANTICIPATIONCT	=	115189
	DEEPINSIGHT		=	84747
	MODERATEINSIGHT	=	84746
	SHALLOWINSIGHT	=	84745
  
  	CDDECIDER = nil
  	if GetSpecialization() == 2 then
  		CDDECIDER	=	1752
	elseif GetSpecialization() == 1 then
		CDDECIDER	=	1329
	end
	
	--Range Check for Cooldowns/Trinkets
	CastCD = nil
	function CastCD(spell)
		if IsPlayerSpell(spell) == true then
		 	if IsSpellInRange(GetSpellInfo(CDDECIDER), "target") == 1
		 	 and GetSpellCooldown(GetSpellInfo(spell)) == 0 then
		 		CastSpellByName(GetSpellInfo(spell))
		 		return true
		 	end
		end
	end

	UseItem = nil
	function UseItem(slot)
		local _, Cooldown, Ready = GetInventoryItemCooldown("player", slot)
		if Cooldown == 0 and Ready == 1
		 and UnitChannelInfo("player") == nil
		 and UnitAffectingCombat("player") ~= nil
		 and IsSpellInRange(GetSpellInfo(CDDECIDER), "target") == 1 then
		 	UseInventoryItem(slot)
		 	return true
		end
	end
--------------------------------------------------	
------------------WARRIOR TABLE-------------------
--------------------------------------------------
elseif select(2, UnitClass("player")) == "WARRIOR" then
print("|cffFFBE69Loading |cff8C7853Warrior|cffFFBE69 Tables ...|cffffffff")

	--TEIR 6 TALENTS
	AVATAR				=	107574
	BLOODBATH			=	12292
	STORMBOLT			=	107570
	--TEIR 5 TALENTS
	MASSSPELLREFLECTION	=	114028
	SAFEGUARD			=	114029
	VIGILANCE			=	114030
	--TEIR 4 TALENTS
	BLADESTORM			=	46924
	SHOCKWAVE			=	46968
	DRAGONROAR			=	118000
	--TEIR 3 TALENTS
	STAGGERINGSHOUT		=	107566
	PIERCINGHOWL		=	12323
	DISRUPTINGSHOUT		=	102060
	--TEIR 2 TALENTS
	ENRAGEDREGENERATION	=	55694
	IMPENDINGVICTORY	=	103840
	
	--SPELL LIST
	BATTLESHOUT			=	6673
	BATTLESTANCE		=	2457
	BERSERKERRAGE		=	18499
	BERSERKERSTANCE		=	2458
	BLOODTHIRST			=	23881
	CHARGE				=	100
	CLEAVE				=	845
	COLOSSUSSMASH		=	86346
	COMMANDINGSHOUT		=	469
	DEADLYCALM			=	85730
	DEFENSIVESTANCE		=	71
	DIEBYTHESWORD		=	118038
	DISARM				=	676
	EXECUTE				=	5308
	HAMSTRING			=	1715
	HEROICLEAP			=	6544
	HEROICSTRIKE		=	78
	HEROICTHROW			=	57755
	INTIMIDATINGSHOUT	=	5246
	PUMMEL				=	6552
	RAGINGBLOW			=	85288
	RALLYINGCRY			=	97462
	RECKLESSNESS		=	1719
	SHATTERINGTHROW		=	64382
	SHIELDWALL			=	871
	SPELLREFLECTION		=	23920
	SUNDERARMOR			=	7386
	TAUNT				=	355
	THROW				=	122475
	THUNDERCLAP			=	6343
	VICTORYRUSH			=	34428
	WHIRLWIND			=	1680
	WILDSTRIKE			=	100130
	SKULLBANNER			=	114207
	
	--BUFFS
	BLOODSURGE			=	46916
	ENRAGE				=	12880
	RAGINGBLOWPROC		=	131116
	WHIRLWINDSTACK 		=	85739
	
	CastCD = nil
	function CastCD(spell)
		if IsPlayerSpell(spell) == true then
		 	if IsSpellInRange(GetSpellInfo(78), "target") == 1 then
		 		CastSpellByName(GetSpellInfo(spell))
		 		return true
		 	end
		end
	end
	
	UseItem = nil
	function UseItem(slot)
		local _, Cooldown, Ready = GetInventoryItemCooldown("player", slot)
		if Cooldown == 0 and Ready == 1
		 and UnitChannelInfo("player") == nil
		 and UnitAffectingCombat("player") ~= nil
		 and IsSpellInRange(GetSpellInfo(78), "target") == 1 then
		 	UseInventoryItem(slot)
		 	return true
		end
	end
--------------------------------------------------	
--------------------MAGE TABLE--------------------
--------------------------------------------------
elseif select(2, UnitClass("player")) == "MAGE" then
print("|cffFFBE69Loading |cff00EEEEMage|cffFFBE69 Tables ...|cffffffff")

	--Tier 1
	POM					=	12043
	BLAZINGSPEED		=	108843
	ICEFLOES			=	108839
	--Tier 2
	TEMPORALSHIELD		=	115610
	FLAMEGLOW			=	140468	--Passive
	ICEBARRIER			=	11426
	--Tier 3
	RINGOFFROST			=	113724
	ICEWARD				=	111264
	FROSTJAW			=	102051
	--Tier 4
	GREATERINVIS		=	110959
	CAUTERIZE			=	86949
	COLDSNAP			=	11958
	--Tier 5
	NETHERTEMPTEST		=	114923
	LIVINGBOMB			=	44457
	FROSTBOMB			=	112948
	--Tier 6
	INVOCATION			=	114003
	RUNEOFPOWER			=	116011
	INCANTERSWARD		=	1463
	
	--Spell List
	ALTERTIME			=	108978
	ARCANEBRILLIANCE	=	1459
	ARCANEEXPLOSION		=	1449
	BLINK				=	1953
	BLIZZARD			=	10
	CONEOFCOLD			=	120
	MANAGEM				=	759
	REFRESHMENT			=	42955
	REFRESHTABLE		=	43987
	COUNTERSPELL		=	2139
	DEEPFREEZE			=	44572
	EVOCATION			=	12051
	FIREBLAST			=	2136
	FLAMESTRIKE			=	2120
	FROSTARMOR			=	7302
	FROSTNOVA			=	122
	FROSTBOLT			=	116
	FROSTFIREBOLT		=	44614
	FROZENORB			=	84714
	ICEBLOCK			=	45438
	ICELANCE			=	30455
	ICYVEINS			=	12472
	INVISIBILITY		=	66
	MAGEARMOR			=	6117
	MIRRORIMAGE			=	55342
	MOLTENARMOR			=	30482
	POLYMORPH			=	118
	REMOVECURSE			=	475
	SLOWFALL			=	130
	SPELLSTEAL			=	30449
	SUMMONELE			=	31687
	TIMEWARP			=	80353
	
	
	--Pet
	FREEZE				=	33395
	
	--Passives
	--BRAINFREEZE			=	44549
	BURNINGSOUL			=	84254
	CAUTERIZE			=	86949
	FINGERSOFFROST		=	112965
	
	--Buffs
	ROPBUFF				=	116014
	ALTERTIMEBUFF		=	110909
	ICYVEINSBUFF		=	131078
	FOFBUFF				=	44544
	BRAINFREEZE			=	57761
	
	CastCD = nil
	function CastCD(spell)
		if IsPlayerSpell(spell) == true then
		 	if IsSpellInRange(GetSpellInfo(44614), "target") == 1 then
		 		CastSpellByName(GetSpellInfo(spell))
		 		return true
		 	end
		end
	end
	
	UseItem = nil
	function UseItem(slot)
		local _, Cooldown, Ready = GetInventoryItemCooldown("player", slot)
		if Cooldown == 0 and Ready == 1
		 and UnitChannelInfo("player") == nil
		 and UnitAffectingCombat("player") ~= nil
		 and IsSpellInRange(GetSpellInfo(44614), "target") == 1 then
		 	UseInventoryItem(slot)
		 	return true
		end
	end
end