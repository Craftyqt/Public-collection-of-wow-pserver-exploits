if UnitAffectingCombat("player") then

  -- Arcane Torrent (Blood Elf)
  if IsSpellKnown(28730) and GetSpellCooldown(28730) == 0 
  and 100 * UnitPower("player") / UnitPowerMax("player") < 80 
  then CastSpellByID(28730) return true end

  -- Berserking (Troll)
  if IsSpellKnown(26297) and GetSpellCooldown(26297) == 0 
  then CastSpellByID(26297) return true end

  -- Blood Fury (Orc)
  if IsSpellKnown(20572) and GetSpellCooldown(20572) == 0 
  then CastSpellByID(20572) return true end

  -- Stomp (Tauren) 
  if IsSpellKnown(20549) and GetSpellCooldown(20549) == 0 
  and select(9,UnitCastingInfo("target")) == false and CheckInteractDistance("target", 3) and not PQR_IsMoving(1) 
  then CastSpellByID(20549) return true end

  -- Will of the Forsaken (Undead)
  if not GotFear then
    function GotFear(t) 
      local debuff = { 10326, 8122, 2094, 5782, 5484, 6358, 5246 }
      for i=1, #debuff do if UnitDebuffID(t,debuff[i]) then return true end end
    end
  end
  if IsSpellKnown(7744) and GetSpellCooldown(7744) == 0 and GotFear("player") 
  then CastSpellByID(7744) return true end

  -- Rocket Barrage (Goblin)
  if IsSpellKnown(69041) and GetSpellCooldown(69041) == 0 
  and IsSpellInRange(GetSpellInfo(69041),"target") == 1 and UnitCanAttack("player","target") 
  then CastSpellByID(69041) return true end

  -- Gift of the Naaru (Draenei)
  if IsSpellKnown(59543) and GetSpellCooldown(59543) == 0 
  and 100 * UnitHealth("player") / UnitHealthMax("player") < 30 
  then CastSpellByID(59543,"player") return true end

  -- Stoneform (Dwarf)
  if not GotPoison then
    function GotPoison(t)
      local i, debuff = 1, select(5,UnitDebuff(t, 1)) 
      while debuff do
        if debuff == "Poison" or debuff == "Disease" then return true end
        i = i + 1 debuff = select(5,UnitDebuff(t, i)) 
      end
    end
  end
  if IsSpellKnown(20594) and GetSpellCooldown(20594) == 0 and GotPoison("player") 
  then CastSpellByID(20594) return true end

  -- Escape Artist (Gnome)
  if not CantMove then
    function CantMove(t) 
      local debuff = { 122, 53754, 1715, 12323, 3775, 339, 48483, 8056, 2974, 45524 }
      for i=1, #debuff do if UnitDebuffID(t,debuff[i]) then return true end end
    end
  end
  if IsSpellKnown(20589) and GetSpellCooldown(20589) == 0 and CantMove("player") 
  then CastSpellByID(20589) return true end

  -- Every Man for Himself (Human)
  if not LostControl then
    function LostControl(t) 
      local debuff = { 122, 10326, 8122, 2094, 5782, 5484, 6358, 5246, 408 }
      for i=1, #debuff do if UnitDebuffID(t,debuff[i]) then return true end end
    end
  end
  if IsSpellKnown(59752) and GetSpellCooldown(59752) == 0 and LostControl("player") 
  then CastSpellByID(59752) return true end

end