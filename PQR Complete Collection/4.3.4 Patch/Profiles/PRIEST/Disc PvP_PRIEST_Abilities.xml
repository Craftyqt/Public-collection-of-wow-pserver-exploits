<?xml version="1.0" encoding="utf-8" ?><PRIEST><Ability><Name>-- Init --</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>-- PQInterface is an absolute requirement from now on.
if not IsAddOnLoaded(&amp;quot;PQInterface&amp;quot;) then
	PQR_WriteToChat(&amp;quot;|cffDC143CPQInterface is required to run this profile!|cffffffff&amp;quot;, &amp;quot;Warning&amp;quot;)
	PQR_WriteToChat(&amp;quot;|cffDC143CThe profile has been stopped.|cffffffff&amp;quot;, &amp;quot;Warning&amp;quot;)
	PQR_StopRotation()
end

-- Load LUA data files.
if PQR_RotationStarted then
 PQR_RotationStarted = false
	 -- Load required data files
	 if PQR_LoadLua ~= nil then
		  if PQR_LoadLua(&amp;quot;PQR_PriestPvP_Data.lua&amp;quot;) == false then
		   PQR_WriteToChat(&amp;quot;|cffb73737You&amp;apos;re missing PQR_PriestPvP_Data.lua - Make sure it&amp;apos;s in your Data folder! The Rotation has been halted.|cffffffff&amp;quot;, &amp;quot;Error&amp;quot;)
		   PQR_StopRotation()
		   return true
		  end 
		  if PQR_LoadLua(&amp;quot;PQR_PQI.lua&amp;quot;) == false then
		   PQR_WriteToChat(&amp;quot;|cffb73737You&amp;apos;re missing PQR_PQI.lua - It&amp;apos;s required to run the profile! The Rotation has been halted.|cffffffff&amp;quot;, &amp;quot;Error&amp;quot;)
		   PQR_StopRotation()
		   return true
		  end
	 end
end


HealEngine() 


PauseKey				= PQI:IsHotkeys(PQI_CpoworksDiscPvPConfigSettings_PauseRotation_key)
BarrierKey				= PQI:IsHotkeys(PQI_CpoworksDiscPvPConfigSettings_Barrier_key)	
GripKey					= PQI:IsHotkeys(PQI_CpoworksDiscPvPConfigSettings_LifeGrip_key)
MDKey					= PQI:IsHotkeys(PQI_CpoworksDiscPvPConfigSettings_MassDispel_key) 
FlagPickUpKey			= PQI:IsHotkeys(PQI_CpoworksDiscPvPConfigSettings_FlagPickupKey_key) 

if not PQI_CpoworksDiscPvPConfigSettings_DPSKey_enable then 
	DPSKey				= IsMouseButtonDown(3)
else 
 	DPSKey				= PQI:IsHotkeys(PQI_CpoworksDiscPvPConfigSettings_DPSKey_key)
end
if not PQI_CpoworksDiscPvPConfigSettings_FearKey_enable then 
	FearKey				= IsMouseButtonDown(4)
else 
 	FearKey				= PQI:IsHotkeys(PQI_CpoworksDiscPvPConfigSettings_FearKey_key)
end
if not PQI_CpoworksDiscPvPConfigSettings_PsyfiendKey_enable then 
	PsyfiendKey			= IsMouseButtonDown(5)
else 
 	PsyfiendKey			= PQI:IsHotkeys(PQI_CpoworksDiscPvPConfigSettings_PsyfiendKey_key)
end

GripTraps				= PQI_CpoworksDiscPvPConfigSettings_GripTraps_enable
OffenciveDispells		= PQI_CpoworksDiscPvPConfigSettings_UseOffenciveDispels_enable
DefenciveDispells		= PQI_CpoworksDiscPvPConfigSettings_UseDefenciveDispels_enable
SWDInstants				= PQI_CpoworksDiscPvPConfigSettings_SWDInstants_enable
AutoFearWard			= PQI_CpoworksDiscPvPConfigSettings_AutoFearWard_enable
AutoPainSup				= PQI_CpoworksDiscPvPConfigSettings_AutoPainSup_enable
UseBattleMaster			= PQI_CpoworksDiscPvPConfigSettings_Battlemasters_enable

BattlemasterHP			= PQI_CpoworksDiscPvPConfigSettings_Battlemasters_value
PainSupHP				= PQI_CpoworksDiscPvPConfigSettings_PainSup_value
HealthstoneHP			= PQI_CpoworksDiscPvPConfigSettings_Healthstone_value
DesperatePrayerHP		= PQI_CpoworksDiscPvPConfigSettings_DesperatePrayer_value
PowerWordShieldHP		= PQI_CpoworksDiscPvPHealSettings_PowerwordShield_value
PrayerofMendingHP		= PQI_CpoworksDiscPvPHealSettings_PrayerofMending_value
RenewHP					= PQI_CpoworksDiscPvPHealSettings_Renew_value
HealHP					= PQI_CpoworksDiscPvPHealSettings_Heal_value
FlashHealHP				= PQI_CpoworksDiscPvPHealSettings_FlashHeal_value
GreaterHealHP			= PQI_CpoworksDiscPvPHealSettings_GreaterHeal_value
ArchangelHP				= PQI_CpoworksDiscPvPHealSettings_Archangel_value
PenanceHP				= PQI_CpoworksDiscPvPHealSettings_Penance_value
BindingHealHP			= PQI_CpoworksDiscPvPHealSettings_BindingHeal_value

SafeToShift				= 90


if not PQI_CpoworksDiscPvPConfigSettings_PauseRotation_enable then 
	PauseKey	= false
end

if not PQI_CpoworksDiscPvPConfigSettings_Barrier_enable then 
	BarrierKey	= false
end

if not PQI_CpoworksDiscPvPConfigSettings_LifeGrip_enable then 
	GripKey	= false
end

if not PQI_CpoworksDiscPvPConfigSettings_MassDispel_enable then 
	MDKey	= false
end

if not PQI_CpoworksDiscPvPConfigSettings_FlagPickupKey_enable then 
	FlagPickUpKey	= false
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>JukeBox</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not JukeBoxHero then
	JukeBoxHero = CreateFrame(&amp;quot;FRAME&amp;quot;, nil, UIParent)
	JukeBoxHero:Hide()
end

function JukeBoxHero_OnEvent(self, event, ...)
	local type, _, sourceGUID, sourceNAME, _, _, destGUID, destNAME = select(2, ...)
	if event == &amp;quot;COMBAT_LOG_EVENT_UNFILTERED&amp;quot; then
		if type == &amp;quot;SPELL_CAST_SUCCESS&amp;quot; then
			if destGUID == UnitGUID(&amp;quot;player&amp;quot;)
			and not HaveBuff(&amp;quot;player&amp;quot;,104773,0) then
				local spellId = select(12, ...)
				local listId = {
					6552, --Pummel
					1766, --Kick
					47528, --Mind Freeze
					47476, --Strangulate
					96231, --Rebuke
					57994, --Wind Shear
					2139, --Counterspell
					19647, --Spell Lock
					80965, --Skull Bash
				}
				for i = 1, #listId do
					if listId[i] == spellId then
						SpellStopCasting()
						PQR_DelayRotation(.5)
						return true
					end
				end
			end
		end
	end
end

JukeBoxHero:SetScript(&amp;quot;OnEvent&amp;quot;, JukeBoxHero_OnEvent)
JukeBoxHero:RegisterEvent(&amp;quot;COMBAT_LOG_EVENT_UNFILTERED&amp;quot;)</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>SWDExecute</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>for i=1, #cTar do
	cTarHP =  100 * UnitHealth(cTar[i]) / UnitHealthMax(cTar[i])
	
	if UnitExists(cTar[i])
	and UnitCanAttack(&amp;quot;player&amp;quot;, cTar[i]) ~= nil
	and not LineOfSight(cTar[i])
	and cTarHP &amp;lt; 20 then
		_castSpell(32379, cTar[i])
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Flash Heal</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not PQI_CpoworksDiscPvPHealSettings_FlashHeal_enable then return false end


if PQR_SpellAvailable(2061) then
	if members[1].HP &amp;lt; FlashHealHP 
	and not LineOfSight(members[1].Unit)
	and not PQR_IsMoving(.5)  then
	  	_castSpell(2061, members[1].Unit)
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>InnerFocus</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>for i = 1, #members do
	if PQR_SpellAvailable(89485) 
	and members[1].HP &amp;lt; 50 then
  		_castSpell(89485) 
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>FearWard</Name><Default>false</Default><SpellID>6346</SpellID><Actions></Actions><Lua>if AutoFearWard
and not UnitBuffID(&amp;quot;player&amp;quot;,6346) then
return true
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>HolyFire</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if PQR_SpellAvailable(14914) 
and DPSKey
and UnitExists(&amp;quot;target&amp;quot;)
and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) ~= nil
and not LineOfSight(&amp;quot;target&amp;quot;) then
	_castSpell(14914, &amp;quot;target&amp;quot;) 
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>InnerFire</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not UnitBuffID(&amp;quot;player&amp;quot;,588) 
and PQR_SpellAvailable(588) then
	CastSpellByName(tostring(GetSpellInfo(588)))	 
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Offencive Dispells Buffs</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not OffenciveDispells then return false end

local PlayerHP = 100 * UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;)

local PlayerMana = 100 * UnitPower(&amp;quot;player&amp;quot;) / UnitPowerMax(&amp;quot;player&amp;quot;)

local purgeThis2 = {

79105,   -- Fort

79061,   -- Mark

79063,   -- Kings

79012,  -- Might

79107, -- shadow prot

79058, --Brilliance

11426,   -- Ice Barrier

17    -- Power Word: Shield

}

if PQR_SpellAvailable(527) 
and members[1].HP &amp;gt; 70
and PlayerMana &amp;gt; 70 then
	for i = 1, #cTar do
		if UnitExists(cTar[i]) then
			for j = 1, #purgeThis2 do
				if UnitBuffID(cTar[i], purgeThis2[j]) ~= nil
				and UnitCanAttack(&amp;quot;player&amp;quot;,cTar[i]) ~= nil
				and not LineOfSight(cTar[i]) then
					_castSpell(527, cTar[i])
				end
			end
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>SHEEPSWD</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local InterruptSpells = {	 
						118,		-- Polymorph
						61305,		-- Polymorph: Black Cat
						28272,		-- Polymorph: Pig
						61721,		-- Polymorph: Rabbit
						61780,		-- Polymorph: Turkey
						28271,		-- Polymorph: Turtle
						20066, 		-- Repantance
						}

if PQR_SpellAvailable(129176) then
	for i=1, #cTar do
		if UnitExists(cTar[i]) then
		local spellName, _, _, _, _, endCast, _, _, canInterrupt = UnitCastingInfo(cTar[i])
			for _, v in ipairs(InterruptSpells) do
				if GetSpellInfo(v) == spellName and canInterrupt == false then
					if ((endCast/1000) - GetTime()) &amp;lt; 0.3  then
						SpellStopCasting()
						SpellStopCasting()
						SpellStopCasting()
						CastSpellByName(GetSpellInfo(32379),cTar[i])
					end
				end
			end
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Penance</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not PQI_CpoworksDiscPvPHealSettings_Penance_enable then return false end

if PQR_SpellAvailable(47540) then
	if members[1].HP &amp;lt; PenanceHP
	and not LineOfSight(members[1].Unit) 
	and not PQR_IsMoving(.5) 
	then
		_castSpell(47540, members[1].Unit)
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>PenanceDMG</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if PQR_SpellAvailable(47540) 
and DPSKey
and UnitExists(&amp;quot;target&amp;quot;)
and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) ~= nil
and not LineOfSight(&amp;quot;target&amp;quot;)  then
	_castSpell(47540, &amp;quot;target&amp;quot;) 
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>PowerWordFortitude</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not UnitBuffID(&amp;quot;player&amp;quot;,79105) --Power Word: Fortitude
and not UnitBuffID(&amp;quot;player&amp;quot;,469) --Commanding Shout
and not UnitChannelInfo(&amp;quot;player&amp;quot;)
and not UnitAffectingCombat(&amp;quot;player&amp;quot;)
and not UnitCastingInfo(&amp;quot;player&amp;quot;) then
	_castSpell(21562)
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>PowerWordShield</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not PQI_CpoworksDiscPvPHealSettings_PowerwordShield_enable then return false end


if PQR_SpellAvailable(17) then
	for i=1, #members do
		if members[i].HP &amp;lt; PowerWordShieldHP
		and not HaveDebuff(members[i].Unit,6788)
		and not UnitBuffID(members[i].Unit,17)
		and not LineOfSight(members[i].Unit) then
		  _castSpell(17, members[i].Unit) 
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>PrayerOfMending</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not PQI_CpoworksDiscPvPHealSettings_PrayerofMending_enable then return false end

if PQR_SpellAvailable(33076) then
	for i=1, #members do
		if members[i].HP &amp;lt; PrayerofMendingHP 
		and not LineOfSight(members[i].Unit) then
		 	_castSpell(33076, members[i].Unit)
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>ShadowProtection</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not UnitBuffID(&amp;quot;player&amp;quot;,79107) --Shadow prot
and not UnitChannelInfo(&amp;quot;player&amp;quot;)
and not UnitAffectingCombat(&amp;quot;player&amp;quot;)
and not UnitCastingInfo(&amp;quot;player&amp;quot;) then
	_castSpell(27683)
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>ShackleUndead</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if UnitExists(&amp;quot;mouseover&amp;quot;) 
and members[1].HP &amp;gt; 70
and UnitCreatureType(&amp;quot;mouseover&amp;quot;) == &amp;quot;Undead&amp;quot;
and not UnitDebuffID(&amp;quot;mouseover&amp;quot;,9484) 
and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;mouseover&amp;quot;) then
	CastSpellByName(GetSpellInfo(9484),&amp;quot;mouseover&amp;quot;)
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>SWP</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if PQR_SpellAvailable(589) 
and DPSKey
and UnitExists(&amp;quot;target&amp;quot;)
and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) ~= nil
and PQR_IsOutOfSight(&amp;quot;target&amp;quot;, 0.1) == false  
and not UnitDebuffID(&amp;quot;target&amp;quot;, 589, &amp;quot;player&amp;quot;) then
	_castSpell(589, &amp;quot;target&amp;quot;) 
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Smite</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if PQR_SpellAvailable(585) 
and DPSKey
and UnitExists(&amp;quot;target&amp;quot;)
and UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) ~= nil
and PQR_IsOutOfSight(&amp;quot;target&amp;quot;, 0.1) == false  then
	_castSpell(585, &amp;quot;target&amp;quot;) 
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>PainSup</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if PQR_SpellAvailable(33206)
and AutoPainSup then
	for i = 1, #members do
		if members[i].HP &amp;lt; PainSupHP 
		and not LineOfSight(members[i].Unit) 
		and not UnitBuffID(members[i].Unit, 45438) --Block
		and not UnitBuffID(members[i].Unit, 642) --Bubble
		and not UnitBuffID(members[i].Unit, 19263) --Deterrence
		and not UnitDebuffID(members[i].Unit, 33786) --Clone 
		then 
	    	_castSpell(33206, members[i].Unit)
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Fear</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if FearKey then
	--SpellStopCasting()
	_castSpell(8122)
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Healthstone</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not PQI_CpoworksDiscPvPConfigSettings_Healthstone_enable then return false end

local PlayerHP = 100 * UnitHealth(&amp;quot;Player&amp;quot;) / UnitHealthMax(&amp;quot;Player&amp;quot;)
local HealstoneCD = select(2,GetItemCooldown(5512))

if PlayerHP &amp;lt; HealthstoneHP then
	if HealstoneCD == 0 and GetItemCount(5512) &amp;gt; 0  then
    	UseItemByName(select(1,GetItemInfo(5512)), &amp;quot;player&amp;quot;)
		return true
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Archangel</Name><Default>false</Default><SpellID>81700</SpellID><Actions></Actions><Lua>if not PQI_CpoworksDiscPvPHealSettings_Archangel_enable then return false end

if PQR_SpellAvailable(81700) then
	for i=1, #members do
	if members[1].HP &amp;lt; ArchangelHP then
		if UnitBuffID(&amp;quot;player&amp;quot;, 81661) 
		and select(4, UnitBuffID(&amp;quot;player&amp;quot;, 81661)) &amp;gt;= 5 then
			return true
		end
	end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Dispell Important CC</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not DefenciveDispells then return false end

for i=1,#members do 
    if dispellableCC(members[i].Unit) 
    and not LineOfSight(members[i].Unit)
    and not UnitDebuffID(members[i].Unit, 30108) 
    and not UnitDebuffID(members[i].Unit, 34914) then 
  		_castSpell(527,members[i].Unit)
  	end
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Heal</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not PQI_CpoworksDiscPvPHealSettings_Heal_enable then return false end

if PQR_SpellAvailable(2050) then
	if members[1].HP &amp;lt; HealHP 
	and not LineOfSight(members[1].Unit)
	and not PQR_IsMoving(.5) then
	 	_castSpell(2050, members[1].Unit)
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Greater Heal</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not PQI_CpoworksDiscPvPHealSettings_GreaterHeal_enable then return false end

if PQR_SpellAvailable(2060) then
	if members[1].HP &amp;lt; GreaterHealHP 
	and not LineOfSight(members[1].Unit)
	and not PQR_IsMoving(.5) then
  		_castSpell(2060, members[1].Unit)
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Offencive Dispells</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not OffenciveDispells then return false end

local PlayerHP = 100 * UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;)

local PlayerMana = 100 * UnitPower(&amp;quot;player&amp;quot;) / UnitPowerMax(&amp;quot;player&amp;quot;)

local purgeThis2 = {

1044,   -- Hand of Freedom

6940,   -- Hand of Sacrifice

69369,   -- Predatory Swiftness

12472,  -- Icy Veins

1022,   -- Hand of Protection

17    -- Power Word: Shield

}

if PQR_SpellAvailable(527) 
and members[1].HP &amp;gt; 50 then
	for i = 1, #cTar do
		if UnitExists(cTar[i]) then
			for j = 1, #purgeThis2 do
				if UnitBuffID(cTar[i], purgeThis2[j]) ~= nil
				and UnitCanAttack(&amp;quot;player&amp;quot;,cTar[i]) ~= nil
				and not LineOfSight(cTar[i]) then
					_castSpell(527, cTar[i])
				end
			end
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Mass Dispell</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if MDKey then
	if IsSpellKnown(32375) then
		CastSpellByName(GetSpellInfo(32375))
		if SpellIsTargeting() then CameraOrSelectOrMoveStart() CameraOrSelectOrMoveStop() end  
		return true 
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>------test</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>return true</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Barrier</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if BarrierKey then
	if IsSpellKnown(62618) then
		CastSpellByName(GetSpellInfo(62618))
		if SpellIsTargeting() then CameraOrSelectOrMoveStart() CameraOrSelectOrMoveStop() end  
		return true 
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Renew</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not PQI_CpoworksDiscPvPHealSettings_Renew_enable then return false end


if PQR_SpellAvailable(139) then
	for i=1, #members do
		if members[i].HP &amp;lt; RenewHP 
		and not UnitBuffID(members[i].Unit, 139)
		and not LineOfSight(members[i].Unit) then
		 	_castSpell(139, members[i].Unit)
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Life Grip</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if LifegripKey then
	_castSpell(73325, &amp;quot;target&amp;quot;)
end
if GripTraps
and PQR_SpellAvailable(73325) then
	for i = 1, #members do
		if UnitName(members[i].Unit) ~= UnitName(&amp;quot;player&amp;quot;)
		and UnitDebuffID(members[i].Unit, 19503) then
			SpellStopCasting()
			_castSpell(73325, members[i].Unit)
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Flash Heal Inner Focus</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not PQI_CpoworksDiscPvPHealSettings_FlashHeal_enable then return false end

local InnerFocus = UnitBuffID(&amp;quot;player&amp;quot;, 96267)


if PQR_SpellAvailable(2061) then
	if members[1].HP &amp;lt; FlashHealHP 
	and InnerFocus 
	and not LineOfSight(members[1].Unit)
	and not PQR_IsMoving(.5) then
	 	_castSpell(2061, members[1].Unit)
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Penance Inner Focus</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not PQI_CpoworksDiscPvPHealSettings_Penance_enable then return false end

local InnerFocus = UnitBuffID(&amp;quot;player&amp;quot;, 96267)


if PQR_SpellAvailable(2061) then 
	if members[1].HP &amp;lt; PenanceHP
	and InnerFocus 
	and not LineOfSight(members[1].Unit)
	and not PQR_IsMoving(.5) then
		_castSpell(47540, members[1].Unit)
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Shadow Feind/Mind Bender</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>--ShadowFeind
if PQR_SpellAvailable(34433) 
and UnitExists(&amp;quot;Target&amp;quot;)
and DPSKey then
	_castSpell(34433)
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Anti Stealth</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>--RedRussian&amp;apos;s &amp;quot;Stealthers&amp;apos; Bane&amp;quot;

local rescan_period=2 --how often stealthed list is repopulated

local function IsStealthed(unit) --check if unit is stealthed
stealth,prowl,shadowmeld=1784,5215,58984 --list of detectable stealth buffs may be incomplete!
	if ( UnitBuffID(unit,stealth) or UnitBuffID(unit,prowl) or UnitBuffID(unit,shadowmeld) ) then return true
	else return false
	end
end

local function Breaker() --instant stealth breaker, class dependent
_, playerClass = UnitClass(&amp;quot;player&amp;quot;)
	if playerClass == &amp;quot;WARRIOR&amp;quot; then
		return 57755 --Heroic Throw
	elseif playerClass == &amp;quot;PALADIN&amp;quot; then
		if PQR_SpellAvailable(879) then
			return 879 --Exorcism
		else	
			return 20271 --Judgment
		end	
	elseif playerClass == &amp;quot;HUNTER&amp;quot; then
		return 3044 --Arcane shot
	elseif playerClass == &amp;quot;ROGUE&amp;quot; then
		if IsStealthed(&amp;apos;player&amp;apos;) then
			return 6770 --Sap
		else
			return 121733 --Throw
		end
	elseif playerClass == &amp;quot;PRIEST&amp;quot; then
		return 589 --Shadow Word: Pain
	elseif playerClass == &amp;quot;DEATHKNIGHT&amp;quot; then
		return 45524 --Chains of Ice
	elseif playerClass == &amp;quot;SHAMAN&amp;quot; then
		return 8056 --Frost Shock
	elseif playerClass == &amp;quot;MAGE&amp;quot; then
		return 30455 --Ice Lance
	elseif playerClass == &amp;quot;WARLOCK&amp;quot; then
		return 77799 --Fel Flame
	elseif playerClass == &amp;quot;MONK&amp;quot; then
		return 115546 --Taunt
	elseif playerClass == &amp;quot;DRUID&amp;quot; then
		if IsStealthed(&amp;apos;player&amp;apos;) then
			return 0 --do nothing
		else
			return 8921 --moonfire
		end
	else
		return 0 
	end
end

local breakername=GetSpellInfo(Breaker()) --localized breaker name for use with IsSpellInRange


------------------------BG/RBG--------------------------------
--get stealthed list
if not last_scan or GetTime()-last_scan&amp;gt;=rescan_period then --repopulate list every T seconds
last_scan=GetTime()
stealthed={} --depopulate stealthed list
currtarget=UnitName(&amp;apos;target&amp;apos;) --get current target&amp;apos;s name

	for j=1,GetNumBattlefieldScores() do --get player faction to make profile work in rbgs and arenas
	name1=GetBattlefieldScore(j) 
		if name1==UnitName(&amp;apos;player&amp;apos;) then 
		pfaction=select(6,GetBattlefieldScore(j))
		break
		end 
	end

	for i=1, GetNumBattlefieldScores() do 
	name, killingBlows, honorableKills, deaths, honorGained, faction, rank, race, class = GetBattlefieldScore(i)
	matched_name=name:match(&amp;apos;[^-]+&amp;apos;) --filter out &amp;quot;-Realm&amp;quot; part
		if (class==&amp;quot;DRUID&amp;quot; or class==&amp;quot;ROGUE&amp;quot;) and faction~=pfaction and not UnitChannelInfo(&amp;apos;player&amp;apos;) then --target change is fatal to channgeling
		TargetUnit(name)
			if UnitName(&amp;apos;target&amp;apos;)~=matched_name or ( UnitName(&amp;apos;target&amp;apos;)==matched_name and IsStealthed(&amp;apos;target&amp;apos;) ) then --targeting attemp was unsuccessful or stealthed target was caught during list repopulation
			stealthed[name]=1
			end
		end
		if currtarget and UnitName(&amp;apos;target&amp;apos;)~=currtarget then --return to previous target after targeting stealther
		TargetLastTarget() 
		elseif not currtarget then 
		ClearTarget() 
		end	
	end
end

--look for stealthed
if PQR_SpellAvailable(Breaker()) then --CD/GCD check to prevent excessive spam. NOTE: spell with ID 0 is never avalaible
oldtarget=UnitName(&amp;apos;target&amp;apos;) --get current target&amp;apos;s name
stealther_spotted=false
	for k,v in pairs(stealthed) do
		if not ( UnitCastingInfo(&amp;apos;player&amp;apos;) or UnitChannelInfo(&amp;apos;player&amp;apos;) ) and v==1 then --not on GCD &amp; not casting &amp; not channeling
		TargetUnit(k)
			if UnitName(&amp;apos;target&amp;apos;)==k:match(&amp;apos;[^-]+&amp;apos;) then --k is matched to be the same format with UnitName(&amp;apos;target&amp;apos;)
				if IsStealthed(&amp;apos;target&amp;apos;) and IsSpellInRange(breakername,&amp;apos;target&amp;apos;)==1 then --range check to prevent spam caused by stealth glitch
				CastSpellByID(Breaker(),&amp;apos;target&amp;apos;)
				stealther_spotted=true --flag fixing your target on spotted stealther
				else
				stealthed[k]=0	--exclude non-stealthed or too distant stealther from the list
				end
			end
		end
		if not stealther_spotted then	--return to previous target if no stealther was spotted, do nothing otherwise
			if oldtarget and UnitName(&amp;apos;target&amp;apos;)~=oldtarget then 
			TargetLastTarget() 
			elseif not oldtarget then 
			ClearTarget() 
			end
		end	
	end	
end
------------------------ARENA--------------------------------
for a=1,5 do
local arenatarget=&amp;apos;arena&amp;apos;..a
	if IsStealthed(arenatarget) then
	CastSpellByID(Breaker(),arenatarget)
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Flag Pickup</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if GetBattlefieldStatus(1)==&amp;apos;active&amp;apos; or GetBattlefieldStatus(2)==&amp;apos;active&amp;apos; then
InteractUnit(&amp;apos;Horde flag&amp;apos;)
InteractUnit(&amp;apos;Alliance flag&amp;apos;)
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>SWD Instants</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not SWDInstants then return false end

-- Create our frame and bind combat log events

if not SWDFrame then
	SWDFrame = CreateFrame(&amp;quot;FRAME&amp;quot;, nil, UIParent)	
	SWDFrame:Hide()
end
  
 -- Spell event table
  local spellIds = {
	-- Hunter
	[19503] = {GetSpellInfo(129176)},		-- Scatter 
	-- Paladin
	[20066] = {GetSpellInfo(129176)}, 		-- Repantance
	-- Rogue
	[2094]  = {GetSpellInfo(129176)},		-- Blind
	--Mage
	[18] = {GetSpellInfo(129176)},			-- Polymorph
	[61305] = {GetSpellInfo(129176)},		-- Polymorph: Black Cat
	[28272] = {GetSpellInfo(129176)},		-- Polymorph: Pig
	[61721] = {GetSpellInfo(129176)},		-- Polymorph: Rabbit
	[61780] = {GetSpellInfo(129176)},		-- Polymorph: Turkey
	[28271] = {GetSpellInfo(129176)},		-- Polymorph: Turtle	
}


function EventHandler(self, event, ...)
    local type, _, sourceGUID, sourceNAME, _, _, destGUID, destNAME = select(2, ...)
    if event == &amp;quot;COMBAT_LOG_EVENT_UNFILTERED&amp;quot; then
		if type == &amp;quot;SPELL_CAST_SUCCESS&amp;quot;
		and destGUID == UnitGUID(&amp;quot;player&amp;quot;) then
			local sid = select(12, ...)
			local sname = spellIds[sid]
			if sname ~= nil then
				SpellStopCasting()
				CastSpellByName(GetSpellInfo(32379), sourceNAME) 
				return
			end
	  	end
    end
end

SWDFrame:SetScript(&amp;quot;OnEvent&amp;quot;, EventHandler)
SWDFrame:RegisterEvent(&amp;quot;COMBAT_LOG_EVENT_UNFILTERED&amp;quot;)</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Binding Heal</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not PQI_CpoworksDiscPvPHealSettings_BindingHeal_enable then return false end

local myHp = 100 * UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;)


if PQR_SpellAvailable(32546) then
	for i=1, #members do
		--Shift other people
		if members[i].HP &amp;lt; BindingHealHP
		and UnitName(members[i].Unit) ~= UnitName(&amp;quot;player&amp;quot;)
		and myHp &amp;lt; BindingHealHP then
			_castSpell(32546, members[i].Unit)
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Battlemasters</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local myhp = UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;) * 100

if UseBattleMaster
and myhp &amp;lt; BattlemasterHP then 
	if GetInventoryItemCooldown(&amp;quot;player&amp;quot;,13) == 0 then 
		UseInventoryItem(13)
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>-- Pause --</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>--Pause
if PauseKey
or IsMounted() 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability></PRIEST>