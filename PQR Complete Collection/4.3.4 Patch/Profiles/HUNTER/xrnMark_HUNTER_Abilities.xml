<?xml version="1.0" encoding="utf-8" ?><HUNTER><Ability><Name>USE: Gloves</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local _,cd,havecd = GetInventoryItemCooldown(&amp;quot;player&amp;quot;,10)

if cd == 0 and havecd == 1  
and not UnitChannelInfo(&amp;quot;player&amp;quot;) 
then 
  UseInventoryItem(10) 
  return true
end</Lua><RecastDelay>500</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>USE: Trinket 1</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if GetInventoryItemCooldown(&amp;quot;player&amp;quot;,13) == 0 then UseInventoryItem(13) end</Lua><RecastDelay>500</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>USE: Trinket 2</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local _,cd,havecd = GetInventoryItemCooldown(&amp;quot;player&amp;quot;,14)

if cd == 0 and havecd == 1  
and not UnitChannelInfo(&amp;quot;player&amp;quot;) 
then 
  UseInventoryItem(14) 
  return true
end</Lua><RecastDelay>500</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>--- offensive spells ---</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if UnitIsDead(&amp;quot;target&amp;quot;) 
or ImmuneTarget(&amp;quot;target&amp;quot;) 
or not UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) 
or tonumber(UnitGUID(&amp;quot;target&amp;quot;):sub(5,5),16) == 4
or ( not UnitAffectingCombat(&amp;quot;target&amp;quot;) and not SpecialAggro(&amp;quot;target&amp;quot;) and not UnitIsPlayer(&amp;quot;target&amp;quot;) )
or UnitBuffID(&amp;quot;player&amp;quot;,5384) 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Trap Launcher</Name><Default>false</Default><SpellID>77769</SpellID><Actions></Actions><Lua>if IsLeftControlKeyDown() 
and GetCurrentKeyBoardFocus() == nil 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Mend Pet</Name><Default>false</Default><SpellID>136</SpellID><Actions></Actions><Lua>if UnitExists(&amp;quot;pet&amp;quot;) 
and not UnitIsDead(&amp;quot;pet&amp;quot;) 
and 100 * UnitHealth(&amp;quot;pet&amp;quot;) / UnitHealthMax(&amp;quot;pet&amp;quot;) &amp;lt; 90 
and not UnitBuffID(&amp;quot;pet&amp;quot;,136) 
--and PQR_SpellAvailable(136) 
then return true end</Lua><RecastDelay>10000</RecastDelay><Target>Pet</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Misdirection</Name><Default>false</Default><SpellID>34477</SpellID><Actions></Actions><Lua>if not HaveTank then
  function HaveTank()
    local group = &amp;quot;party&amp;quot;
    local members = GetNumPartyMembers()
    if GetNumRaidMembers() &amp;gt; 0 then group = &amp;quot;raid&amp;quot; members = GetNumRaidMembers() end
    for i = 1, members, 1 do
      local member = group..tostring(i)
      if UnitGroupRolesAssigned(member) == &amp;quot;TANK&amp;quot; 
      and not UnitIsDeadOrGhost(member) 
      then return member end
    end
  end
end

if HaveTank() then PQR_CustomTarget = HaveTank() else PQR_CustomTarget = &amp;quot;pet&amp;quot; end

if UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) 
and not UnitIsDeadOrGhost(&amp;quot;target&amp;quot;) 
--and UnitHealth(&amp;quot;target&amp;quot;) &amp;gt; UnitHealthMax(&amp;quot;player&amp;quot;) 
--and not UnitAffectingCombat(&amp;quot;player&amp;quot;) 
and UnitThreatSituation(&amp;quot;player&amp;quot;) &amp;gt;= 2
then return true end</Lua><RecastDelay>1000</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Scatter Shot</Name><Default>false</Default><SpellID>19503</SpellID><Actions></Actions><Lua>if UnitExists(&amp;quot;mouseover&amp;quot;) 
and IsLeftShiftKeyDown() 
and not GetCurrentKeyBoardFocus() 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Mouseover</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Hunter&amp;apos;s Mark</Name><Default>false</Default><SpellID>1130</SpellID><Actions></Actions><Lua>if UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) 
and not UnitIsDead(&amp;quot;target&amp;quot;) 
and not UnitAffectingCombat(&amp;quot;player&amp;quot;) 
and UnitHealth(&amp;quot;target&amp;quot;) &amp;gt; UnitHealthMax(&amp;quot;player&amp;quot;) 
and not UnitDebuffID(&amp;quot;target&amp;quot;,1130) 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Assist Tank</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if GetNumPartyMembers() &amp;gt; 0 and UnitInRaid(&amp;quot;player&amp;quot;) == nil then

local heisthetank = nil

for i = 1, GetNumPartyMembers(), 1 do
  if UnitGroupRolesAssigned(&amp;quot;party&amp;quot;..tostring(i)) == &amp;quot;TANK&amp;quot; then heisthetank = &amp;quot;party&amp;quot;..tostring(i) end
end

if heisthetank and UnitExists(&amp;quot;target&amp;quot;) == nil 
and UnitAffectingCombat(heisthetank) 
and UnitAffectingCombat(heisthetank..&amp;quot;target&amp;quot;) 
and UnitIsDead(heisthetank..&amp;quot;target&amp;quot;) == nil
and UnitCanAttack(&amp;quot;player&amp;quot;,heisthetank..&amp;quot;target&amp;quot;)
then TargetUnit(heisthetank..&amp;quot;target&amp;quot;) end

end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Tranquilizing Shot</Name><Default>false</Default><SpellID>19801</SpellID><Actions></Actions><Lua>if not DontDispel then
  function DontDispel(t)
    local buff = { 99646 } 
    for _,v in ipairs(buff) do if UnitBuffID(t,v) then return true end end
  end
end

if not DontDispel(&amp;quot;target&amp;quot;) then
  local i = 1
  local buff,_,_,_,bufftype = UnitBuff(&amp;quot;target&amp;quot;, i)
  while buff do
    if ( bufftype == &amp;quot;Magic&amp;quot; or buff == &amp;quot;Enrage&amp;quot; ) then return true end
    i = i + 1;
    buff,_,_,_,bufftype = UnitBuff(&amp;quot;target&amp;quot;, i)
  end
end</Lua><RecastDelay>500</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Kill Shot</Name><Default>false</Default><SpellID>53351</SpellID><Actions></Actions><Lua>if PQR_SpellAvailable(53351) then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Serpent Sting</Name><Default>false</Default><SpellID>1978</SpellID><Actions></Actions><Lua>if not UnitDebuffID(&amp;quot;target&amp;quot;, 1978, &amp;quot;PLAYER&amp;quot;) 
and not AboutToDie(&amp;quot;target&amp;quot;) 
and not canAOE 
then return true end</Lua><RecastDelay>500</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Raptor Strike</Name><Default>false</Default><SpellID>2973</SpellID><Actions></Actions><Lua>if IsSpellInRange(tostring(GetSpellInfo(56641))) == 0 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Rapid Fire</Name><Default>false</Default><SpellID>3045</SpellID><Actions></Actions><Lua>if not UnitBuffID(&amp;quot;player&amp;quot;, &amp;quot;3045&amp;quot;) 
and select(7,GetSpellInfo(19434)) &amp;gt; 1800 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Readiness</Name><Default>false</Default><SpellID>23989</SpellID><Actions></Actions><Lua>if select(2,GetSpellCooldown(3045)) &amp;gt; 10 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Steady Shot</Name><Default>false</Default><SpellID>56641</SpellID><Actions></Actions><Lua>if UnitPower(&amp;quot;player&amp;quot;) &amp;lt; 40 then reloadphase = true end
if UnitPower(&amp;quot;player&amp;quot;) &amp;gt; 60 then reloadphase = false end

if reloadphase then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Aimed Shot</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if UnitBuffID(&amp;quot;player&amp;quot;, &amp;quot;82926&amp;quot;) then
  CastSpellByName(tostring(GetSpellInfo(82928)))
  return true
end

if not PQR_IsMoving(1) 
and not canAOE
and ( select(7,GetSpellInfo(19434)) &amp;lt; 1700 or 100 * UnitHealth(&amp;quot;target&amp;quot;) / UnitHealthMax(&amp;quot;target&amp;quot;) &amp;gt;= 90 ) 
and UnitCastingInfo(&amp;quot;player&amp;quot;) ~= GetSpellInfo(19434)
then 
  CastSpellByName(tostring(GetSpellInfo(19434)))
  return true 
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Chimera Shot</Name><Default>false</Default><SpellID>53209</SpellID><Actions></Actions><Lua>return true</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Arcane Shot</Name><Default>false</Default><SpellID>3044</SpellID><Actions></Actions><Lua>return true</Lua><RecastDelay>500</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Multi-Shot</Name><Default>false</Default><SpellID>2643</SpellID><Actions></Actions><Lua>if canAOE 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>--- initialize ---</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not PQR_LoadLua(&amp;quot;PQR_xrn.lua&amp;quot;) then
  PQR_WriteToChat(&amp;quot;PQR_xrn.lua is missing. Rotation has been stopped.&amp;quot;, &amp;quot;Error&amp;quot;)
  PQR_StopRotation()
  return true
end

CastClick() 
HealEngine() 
ModSwitch(&amp;quot;\124cFFD4D4D4Single target&amp;quot;,&amp;quot;\124cFF3BB0FFArea of Effect&amp;quot;) 

if IsLeftAltKeyDown() 
or IsMounted()
or SpellIsTargeting()
or UnitBuffID(&amp;quot;player&amp;quot;,80169)
or UnitBuffID(&amp;quot;player&amp;quot;,87959)
or UnitChannelInfo(&amp;quot;player&amp;quot;) 
or UnitIsDeadOrGhost(&amp;quot;player&amp;quot;) 
or UnitIsDeadOrGhost(&amp;quot;target&amp;quot;) 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>--- special events ---</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>-- Avoid sudden death on Ultraxion
local fadingtime = select(7,UnitDebuffID(&amp;quot;player&amp;quot;,110070))
if fadingtime and fadingtime - GetTime() &amp;lt; 1.5 then RunMacroText(&amp;quot;/click ExtraActionButton1&amp;quot;) end 

-- Avoid Hour of Twilight on Ultraxion, Delete next 3 lines if you are working as tank
local channelSpell, _, _, _, _, endTime = UnitCastingInfo(&amp;quot;boss1&amp;quot;)
if channelSpell == GetSpellInfo(109417) and endTime/1000 - GetTime() &amp;lt; 1.1 
then RunMacroText(&amp;quot;/click ExtraActionButton1&amp;quot;) end 

-- Avoid sudden death on Madness 
local tentacledeath = select(7,UnitDebuffID(&amp;quot;player&amp;quot;,109597))
if tentacledeath and tentacledeath - GetTime() &amp;lt; 1 then RunMacroText(&amp;quot;/click ExtraActionButton1&amp;quot;) end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>True</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Aspects</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not UnitBuffID(&amp;quot;player&amp;quot;, 13165) 
and not PQR_IsMoving(1) 
then CastSpellByID(13165) end

if not UnitBuffID(&amp;quot;player&amp;quot;, 82661) 
and PQR_IsMoving(1) 
and UnitPower(&amp;quot;player&amp;quot;) &amp;lt; 40
and UnitAffectingCombat(&amp;quot;player&amp;quot;)
then CastSpellByID(82661) end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability></HUNTER>