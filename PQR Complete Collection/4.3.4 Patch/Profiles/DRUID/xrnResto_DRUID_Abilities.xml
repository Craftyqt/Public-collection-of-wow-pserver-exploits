<?xml version="1.0" encoding="utf-8" ?><DRUID><Ability><Name>--- initialize ---</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not PQR_LoadLua(&amp;quot;PQR_xrn.lua&amp;quot;) then
  PQR_WriteToChat(&amp;quot;PQR_xrn.lua is missing. Rotation has been stopped.&amp;quot;, &amp;quot;Error&amp;quot;)
  PQR_StopRotation()
  return true
end

CastClick() 
HealEngine() 

-- Uncoment next line to show healing target on focus
-- if members[1].Unit then FocusUnit(members[1].Unit) end 

if IsLeftAltKeyDown() 
or IsMounted()
or SpellIsTargeting()
or UnitBuffID(&amp;quot;player&amp;quot;,80169)
or UnitBuffID(&amp;quot;player&amp;quot;,87959)
or UnitChannelInfo(&amp;quot;player&amp;quot;) 
or UnitIsDeadOrGhost(&amp;quot;player&amp;quot;) 
or UnitIsDeadOrGhost(&amp;quot;target&amp;quot;) 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>--- healing spells ---</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if PQR_RotationStarted then
  PQR_RotationStarted = false
  local spells = { 5487, 768, 783, 33891 }
  for i=1, #spells do PQR_AddToSpellDelayList(spells[i],0,1) end
end

if IsSpellKnown(84735) then return PQR_SwapRotation(&amp;quot;Feral Tank PvE [0/32/9] (xrnFera)&amp;quot;) end

local InCombat = false
for i=1, #members do if UnitAffectingCombat(members[i].Unit) then InCombat = true end end
if not InCombat and not IsLeftShiftKeyDown() 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Mark of the Wild</Name><Default>false</Default><SpellID>1126</SpellID><Actions></Actions><Lua>if not UnitAffectingCombat(&amp;quot;player&amp;quot;) then

  if not CheckMotw then
    function CheckMotw(t)
      local buff = { 1126, 20217, 90363 } 
      for i=1, #buff do if UnitBuffID(t,buff[i]) then return true end end
    end
  end

  for i=1,#members do 
    if not CheckMotw(members[i].Unit) and UnitInRange(members[i].Unit) and not UnitIsDeadOrGhost(members[i].Unit) 
    then return true end
  end

end</Lua><RecastDelay>10000</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Lifebloom</Name><Default>false</Default><SpellID>33763</SpellID><Actions></Actions><Lua>if not CheckLifebloom then
  function CheckLifebloom(t)
    local _,_,_,Lbcount,_,_,Lbtimer = UnitBuffID(t,33763,&amp;quot;PLAYER&amp;quot;) 
    return Lbcount, Lbtimer 
  end 
end 

local Lbonmembers, tree = false, UnitBuffID(&amp;quot;player&amp;quot;,33891)
for i = 1, #members do
  if CheckLifebloom(members[i].Unit) then Lbonmembers = true end
end

local castdone = false
for i = 1, #members do
  local Lbcount, Lbtimer = CheckLifebloom(members[i].Unit)
  if castdone then break end
  if ( UnitThreatSituation(members[i].Unit) == 3 or ( UnitGroupRolesAssigned(members[i].Unit) == &amp;quot;TANK&amp;quot; and not Lbonmembers ) or tree ) 
  and ( not Lbonmembers or ( Lbcount and not tree ) or ( not Lbcount and tree ) ) 
  and ( Lbcount ~= 3 or Lbtimer - GetTime() &amp;lt; 1 ) 
  then 
    PQR_CustomTarget = members[i].Unit 
    castdone = true 
    return true 
  end
end</Lua><RecastDelay>500</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Rejuvenation</Name><Default>false</Default><SpellID>774</SpellID><Actions></Actions><Lua>if ( members[1].HP &amp;lt; 50 
or ( members[1].HP &amp;lt; 99 and UnitThreatSituation(members[1].Unit) == 3 ) 
or ( members[1].HP &amp;lt; 90 and PQR_IsMoving(1) ) ) 
and not UnitBuffID(members[1].Unit,774,&amp;quot;PLAYER&amp;quot;) 
then
  PQR_CustomTarget = members[1].Unit
  return true
end</Lua><RecastDelay>500</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Swiftmend</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if ( UnitBuffID(members[1].Unit,774) or UnitBuffID(members[1].Unit,8936) ) 
and IsSpellKnown(18562) 
and select(2,GetSpellCooldown(18562)) &amp;lt; 2
then
  CastSpellByID(18562,members[1].Unit)
  return true
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Regrowth</Name><Default>false</Default><SpellID>8936</SpellID><Actions></Actions><Lua>if ( members[1].HP &amp;lt; 50 
or ( members[1].HP &amp;lt; 99 and UnitBuffID(&amp;quot;player&amp;quot;,16870) and not PQR_IsCastingSpell(8936) ) ) 
and not UnitBuffID(members[1].Unit,8936) 
and ( not PQR_IsMoving(1) or UnitBuffID(&amp;quot;player&amp;quot;,33891) )
then
  PQR_CustomTarget = members[1].Unit
  return true
end</Lua><RecastDelay>1500</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Nourish</Name><Default>false</Default><SpellID>50464</SpellID><Actions></Actions><Lua>if members[1].HP &amp;lt; 90 
and not PQR_IsMoving(1) 
then
  PQR_CustomTarget = members[1].Unit
  return true
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Wild Growth</Name><Default>false</Default><SpellID>48438</SpellID><Actions></Actions><Lua>if members[1].HP &amp;lt; 95
and group.low &amp;gt; 4 
then
  PQR_CustomTarget = members[1].Unit
  return true
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Healing Touch</Name><Default>false</Default><SpellID>5185</SpellID><Actions></Actions><Lua>if members[1].HP &amp;lt; 60 
and ( not PQR_IsMoving(1) or UnitBuffID(&amp;quot;player&amp;quot;,17116) )
then
  if IsUsableSpell(17116) then CastSpellByID(17116) end 
  PQR_CustomTarget = members[1].Unit
  return true
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Remove Corruption</Name><Default>false</Default><SpellID>2782</SpellID><Actions></Actions><Lua>if not CheckEffects then 
  function CheckEffects(t)
    for n=1,40 do 
      local buff,_,_,count,bufftype,duration = UnitDebuff(t, n)
      if buff then 
        if bufftype == &amp;quot;Magic&amp;quot; or bufftype == &amp;quot;Curse&amp;quot; then return true end 
      else
        break 
      end       
    end
  end
end

for i=1,#members do
  if not BadEffects(members[i].Unit) 
  and CheckEffects(members[i].Unit) 
  and select(5,GetTalentInfo(3,17)) == 1 
  then 
    PQR_CustomTarget = members[i].Unit
    return true 
  end
end</Lua><RecastDelay>500</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Berserking</Name><Default>false</Default><SpellID>26297</SpellID><Actions></Actions><Lua>if IsSpellKnown(26297) 
and group.low &amp;gt; 3 
and UnitAffectingCombat(&amp;quot;player&amp;quot;) 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Innervate</Name><Default>false</Default><SpellID>29166</SpellID><Actions></Actions><Lua>if 100 * UnitPower(&amp;quot;player&amp;quot;) / UnitPowerMax(&amp;quot;player&amp;quot;) &amp;lt; 70 
and UnitAffectingCombat(&amp;quot;player&amp;quot;) 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>--- special events ---</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>-- Avoid sudden death on Ultraxion
local fadingtime = select(7,UnitDebuffID(&amp;quot;player&amp;quot;,110070))
if fadingtime and fadingtime - GetTime() &amp;lt; 1.5 then RunMacroText(&amp;quot;/click ExtraActionButton1&amp;quot;) end 

-- Avoid Hour of Twilight on Ultraxion, Delete next 3 lines if you are working as tank
local channelSpell, _, _, _, _, endTime = UnitCastingInfo(&amp;quot;boss1&amp;quot;)
if channelSpell == GetSpellInfo(109417) and endTime/1000 - GetTime() &amp;lt; 1.1 
then RunMacroText(&amp;quot;/click ExtraActionButton1&amp;quot;) end 

-- Avoid sudden death on Madness 
local tentacledeath = select(7,UnitDebuffID(&amp;quot;player&amp;quot;,109597))
if tentacledeath and tentacledeath - GetTime() &amp;lt; 1 then RunMacroText(&amp;quot;/click ExtraActionButton1&amp;quot;) end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Nature&amp;apos;s Grasp</Name><Default>false</Default><SpellID>16689</SpellID><Actions></Actions><Lua>if UnitThreatSituation(&amp;quot;player&amp;quot;) == 3 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability></DRUID>