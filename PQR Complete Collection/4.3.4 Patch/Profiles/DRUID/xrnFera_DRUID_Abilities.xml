<?xml version="1.0" encoding="utf-8" ?><DRUID><Ability><Name>--- offensive spells ---</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if PQR_RotationStarted then
  PQR_RotationStarted = false
  local spells = { 5487, 768, 783 }
  for i=1, #spells do PQR_AddToSpellDelayList(spells[i],0,1) end
end

if IsSpellKnown(85101) then return PQR_SwapRotation(&amp;quot;Restoration PvE [8/0/33] (xrnResto)&amp;quot;) end

if UnitIsDead(&amp;quot;target&amp;quot;) 
or ImmuneTarget(&amp;quot;target&amp;quot;) 
or not UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) 
or tonumber(UnitGUID(&amp;quot;target&amp;quot;):sub(5,5),16) == 4
or ( not UnitAffectingCombat(&amp;quot;target&amp;quot;) and not SpecialAggro(&amp;quot;target&amp;quot;) and not UnitIsPlayer(&amp;quot;target&amp;quot;) )
or ( UnitGroupRolesAssigned(&amp;quot;targettarget&amp;quot;) == &amp;quot;TANK&amp;quot; and not UnitIsUnit(&amp;quot;player&amp;quot;,&amp;quot;targettarget&amp;quot;) and UnitBuffID(&amp;quot;player&amp;quot;,5487) and UnitThreatSituation(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) ~= 0 and not canAOE ) 
then return true end

StartAttack()</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>--- initialize ---</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not PQR_LoadLua(&amp;quot;PQR_xrn.lua&amp;quot;) then
  PQR_WriteToChat(&amp;quot;PQR_xrn.lua is missing. Rotation has been stopped.&amp;quot;, &amp;quot;Error&amp;quot;)
  PQR_StopRotation()
  return true
end

CastClick() 
HealEngine() 
ModSwitch(&amp;quot;\124cFFD4D4D4Single target&amp;quot;,&amp;quot;\124cFF3BB0FFArea of Effect&amp;quot;) 

if IsLeftAltKeyDown() 
or IsMounted()
or SpellIsTargeting()
or UnitBuffID(&amp;quot;player&amp;quot;,80169)
or UnitBuffID(&amp;quot;player&amp;quot;,87959)
or UnitChannelInfo(&amp;quot;player&amp;quot;) 
or UnitIsDeadOrGhost(&amp;quot;player&amp;quot;) 
or UnitIsDeadOrGhost(&amp;quot;target&amp;quot;) 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Mangle Bear</Name><Default>false</Default><SpellID>33878</SpellID><Actions></Actions><Lua>return true</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Maul</Name><Default>false</Default><SpellID>6807</SpellID><Actions></Actions><Lua>if UnitPower(&amp;quot;player&amp;quot;) &amp;gt;= 65
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Demoralizing Roar</Name><Default>false</Default><SpellID>99</SpellID><Actions></Actions><Lua>if UnitDebuffID(&amp;quot;target&amp;quot;, 33878, &amp;quot;PLAYER&amp;quot;) 
and not UnitDebuffID(&amp;quot;target&amp;quot;, 99, &amp;quot;PLAYER&amp;quot;) 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Enrage</Name><Default>false</Default><SpellID>5229</SpellID><Actions></Actions><Lua>if UnitPower(&amp;quot;player&amp;quot;) &amp;lt; 30
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Berserking</Name><Default>false</Default><SpellID>26297</SpellID><Actions></Actions><Lua>if IsSpellKnown(26297) 
and UnitPower(&amp;quot;player&amp;quot;) &amp;gt; 50
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Faerie Fire Feral</Name><Default>false</Default><SpellID>16857</SpellID><Actions></Actions><Lua>if not ArmorDebuff then
  function ArmorDebuff(t)
    local debuff = { 16857, 770, 7386, 8647, 50498, 35387 }
    for i=1, #debuff do if UnitDebuffID(t,debuff[i]) then return true end end
  end
end

if ( UnitBuffID(&amp;quot;player&amp;quot;,5487) and UnitPower(&amp;quot;player&amp;quot;) &amp;lt; 15 ) 
or ( not ArmorDebuff(&amp;quot;target&amp;quot;) and not canAOE ) 
or not CheckInteractDistance(&amp;quot;target&amp;quot;, 3) 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Mark of the Wild</Name><Default>false</Default><SpellID>1126</SpellID><Actions></Actions><Lua>if not UnitAffectingCombat(&amp;quot;player&amp;quot;) then

  if not CheckMotw then
    function CheckMotw(t)
      local buff = { 1126, 20217, 90363 } 
      for i=1, #buff do if UnitBuffID(t,buff[i]) then return true end end
    end
  end

  for i=1,#members do 
    if not CheckMotw(members[i].Unit) and UnitInRange(members[i].Unit) and not UnitIsDeadOrGhost(members[i].Unit) 
    then return true end
  end

end</Lua><RecastDelay>10000</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Pulverize</Name><Default>false</Default><SpellID>80313</SpellID><Actions></Actions><Lua>if select(4,UnitDebuffID(&amp;quot;target&amp;quot;,33745)) == 3
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Lacerate</Name><Default>false</Default><SpellID>33745</SpellID><Actions></Actions><Lua>return true</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Berserk</Name><Default>false</Default><SpellID>50334</SpellID><Actions></Actions><Lua>return true</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Thrash</Name><Default>false</Default><SpellID>77758</SpellID><Actions></Actions><Lua>if CheckInteractDistance(&amp;quot;target&amp;quot;, 3) 
and canAOE 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>--- special events ---</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>-- Avoid sudden death on Ultraxion
local fadingtime = select(7,UnitDebuffID(&amp;quot;player&amp;quot;,110070))
if fadingtime and fadingtime - GetTime() &amp;lt; 1.5 then RunMacroText(&amp;quot;/click ExtraActionButton1&amp;quot;) end 

-- Avoid Hour of Twilight on Ultraxion, Delete next 3 lines if you are working as tank
local channelSpell, _, _, _, _, endTime = UnitCastingInfo(&amp;quot;boss1&amp;quot;)
if channelSpell == GetSpellInfo(109417) and endTime/1000 - GetTime() &amp;lt; 1.1 
and not UnitBuffID(&amp;quot;player&amp;quot;,61336) and not UnitBuffID(&amp;quot;player&amp;quot;,22842) 
then RunMacroText(&amp;quot;/click ExtraActionButton1&amp;quot;) end 

-- Avoid sudden death on Madness 
local tentacledeath = select(7,UnitDebuffID(&amp;quot;player&amp;quot;,109597))
if tentacledeath and tentacledeath - GetTime() &amp;lt; 1 then RunMacroText(&amp;quot;/click ExtraActionButton1&amp;quot;) end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>USE: Trinket 1</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local _,trinketcd,trinkethasuse = GetInventoryItemCooldown(&amp;quot;player&amp;quot;,13)

if trinketcd == 0 and trinkethasuse == 1 and not UnitChannelInfo(&amp;quot;player&amp;quot;) 
then UseInventoryItem(13) return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>USE: Trinket 2</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local _,trinketcd,trinkethasuse = GetInventoryItemCooldown(&amp;quot;player&amp;quot;,14)

if trinketcd == 0 and trinkethasuse == 1 and not UnitChannelInfo(&amp;quot;player&amp;quot;) 
then UseInventoryItem(14) return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>USE: Gloves</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local _,trinketcd,trinkethasuse = GetInventoryItemCooldown(&amp;quot;player&amp;quot;,10)

if trinketcd == 0 and trinkethasuse == 1 and not UnitChannelInfo(&amp;quot;player&amp;quot;) 
then UseInventoryItem(10) return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Mangle Cat</Name><Default>false</Default><SpellID>33876</SpellID><Actions></Actions><Lua>if not BleedDebuff then
  function BleedDebuff(t)
    local debuff = { 29859, 35290, 57386, 50271, 16511, 33876 }
    for i=1, #debuff do if UnitDebuffID(t,debuff[i]) then return true end end
  end
end

if not BleedDebuff(&amp;quot;target&amp;quot;) 
or PQR_NotBehindTarget() 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Tiger&amp;apos;s Fury</Name><Default>false</Default><SpellID>5217</SpellID><Actions></Actions><Lua>return true</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Shred</Name><Default>false</Default><SpellID>5221</SpellID><Actions></Actions><Lua>if not PQR_NotBehindTarget() 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Rip</Name><Default>false</Default><SpellID>1079</SpellID><Actions></Actions><Lua>local debufftimer = select(7,UnitDebuffID(&amp;quot;target&amp;quot;,1079,&amp;quot;PLAYER&amp;quot;)) 

if ( not debufftimer or debufftimer - GetTime() &amp;lt; 2 ) 
and GetComboPoints(&amp;quot;player&amp;quot;, &amp;quot;target&amp;quot;) == 5 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Rake</Name><Default>false</Default><SpellID>1822</SpellID><Actions></Actions><Lua>if not UnitDebuffID(&amp;quot;target&amp;quot;,1822,&amp;quot;PLAYER&amp;quot;) 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Savage Roar</Name><Default>false</Default><SpellID>52610</SpellID><Actions></Actions><Lua>local bufftimer = select(7,UnitBuffID(&amp;quot;player&amp;quot;,52610)) 

if not bufftimer or bufftimer - GetTime() &amp;lt; 2 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Ferocious Bite</Name><Default>false</Default><SpellID>22568</SpellID><Actions></Actions><Lua>if GetComboPoints(&amp;quot;player&amp;quot;, &amp;quot;target&amp;quot;) == 5 
and UnitDebuffID(&amp;quot;target&amp;quot;,1079,&amp;quot;PLAYER&amp;quot;) 
and UnitBuffID(&amp;quot;player&amp;quot;,52610) 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Ravage!</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not UnitChannelInfo(&amp;quot;player&amp;quot;) 
and IsUsableSpell(81170) 
then CastSpellByName(GetSpellInfo(81170)) return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Swipe Bear</Name><Default>false</Default><SpellID>779</SpellID><Actions></Actions><Lua>if CheckInteractDistance(&amp;quot;target&amp;quot;, 3) 
and canAOE 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Swipe Cat</Name><Default>false</Default><SpellID>62078</SpellID><Actions></Actions><Lua>if CheckInteractDistance(&amp;quot;target&amp;quot;, 3) 
and canAOE 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability></DRUID>