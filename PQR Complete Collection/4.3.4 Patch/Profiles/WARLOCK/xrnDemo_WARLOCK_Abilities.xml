<?xml version="1.0" encoding="utf-8" ?><WARLOCK><Ability><Name>--- initialize ---</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not PQR_LoadLua(&amp;quot;PQR_xrn.lua&amp;quot;) then
  PQR_WriteToChat(&amp;quot;PQR_xrn.lua is missing. Rotation has been stopped.&amp;quot;, &amp;quot;Error&amp;quot;)
  PQR_StopRotation()
  return true
end

CastClick() 
HealEngine() 
AssistTank() 

if IsLeftAltKeyDown() 
or IsMounted()
or SpellIsTargeting()
or HaveBuff(&amp;quot;player&amp;quot;,{80169,87959}) 
or UnitChannelInfo(&amp;quot;player&amp;quot;) 
or UnitIsDeadOrGhost(&amp;quot;player&amp;quot;) 
or UnitIsDeadOrGhost(&amp;quot;target&amp;quot;) 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>--- offensive spells ---</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if UnitIsDead(&amp;quot;target&amp;quot;) 
or ImmuneTarget(&amp;quot;target&amp;quot;) 
or not UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) 
or tonumber(UnitGUID(&amp;quot;target&amp;quot;):sub(5,5),16) == 4
or ( not UnitAffectingCombat(&amp;quot;target&amp;quot;) and not SpecialAggro(&amp;quot;target&amp;quot;) and not UnitIsPlayer(&amp;quot;target&amp;quot;) )
or IsSpellInRange(tostring(GetSpellInfo(6353)),&amp;quot;target&amp;quot;) == 0 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Soul Fire</Name><Default>false</Default><SpellID>6353</SpellID><Actions></Actions><Lua>if HaveBuff(&amp;quot;player&amp;quot;, 63158,1) 
and not IsSpellOverlayed(686)
and not PQR_IsMoving(1) 
then return true end</Lua><RecastDelay>1000</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Corruption</Name><Default>false</Default><SpellID>172</SpellID><Actions></Actions><Lua>if not CheckCorruption then
  function CheckCorruption(t)
    if IsSpellInRange(tostring(GetSpellInfo(172)),t) == 1 
    and not HaveDebuff(&amp;quot;target&amp;quot;,172,2,&amp;quot;PLAYER&amp;quot;) 
    and not AboutToDie(&amp;quot;target&amp;quot;) 
    and UnitCanAttack(&amp;quot;player&amp;quot;,t) 
    and not UnitIsDeadOrGhost(t) 
    and not PQR_IsOutOfSight(t) 
    then return true end 
  end
end

if CheckCorruption(&amp;quot;target&amp;quot;) then 
  PQR_CustomTarget = &amp;quot;target&amp;quot;
  return true
elseif CheckCorruption(&amp;quot;focus&amp;quot;) then 
  PQR_CustomTarget = &amp;quot;focus&amp;quot;
  return true
end</Lua><RecastDelay>500</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Immolate</Name><Default>false</Default><SpellID>348</SpellID><Actions></Actions><Lua>if not HaveDebuff(&amp;quot;target&amp;quot;,348,3,&amp;quot;PLAYER&amp;quot;) 
and not PQR_IsMoving(1) 
then return true end</Lua><RecastDelay>500</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Conflagrate</Name><Default>false</Default><SpellID>17962</SpellID><Actions></Actions><Lua>return true</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Shadowburn</Name><Default>false</Default><SpellID>17877</SpellID><Actions></Actions><Lua>return true</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Bane of Agony</Name><Default>false</Default><SpellID>980</SpellID><Actions></Actions><Lua>if not HaveDebuff(&amp;quot;target&amp;quot;,{980,603},0,&amp;quot;PLAYER&amp;quot;) 
and not AboutToDie(&amp;quot;target&amp;quot;) 
then return true end</Lua><RecastDelay>500</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Shadow Bolt</Name><Default>false</Default><SpellID>686</SpellID><Actions></Actions><Lua>if not PQR_IsMoving(1) 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Demon Armor</Name><Default>false</Default><SpellID>687</SpellID><Actions></Actions><Lua>if not HaveBuff(&amp;quot;player&amp;quot;,687) 
then return true end</Lua><RecastDelay>500</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Curse of Elements</Name><Default>false</Default><SpellID>1490</SpellID><Actions></Actions><Lua>if not HaveDebuff(&amp;quot;target&amp;quot;,1490) 
and UnitHealth(&amp;quot;target&amp;quot;) &amp;gt; UnitHealthMax(&amp;quot;player&amp;quot;)*10 
then return true end</Lua><RecastDelay>500</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Bane of Doom</Name><Default>false</Default><SpellID>603</SpellID><Actions></Actions><Lua>if not HaveDebuff(&amp;quot;target&amp;quot;,603,0,&amp;quot;PLAYER&amp;quot;) 
and UnitHealth(&amp;quot;target&amp;quot;) &amp;gt; UnitHealthMax(&amp;quot;player&amp;quot;)*10 
then return true end</Lua><RecastDelay>500</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Fel Armor</Name><Default>false</Default><SpellID>28176</SpellID><Actions></Actions><Lua>if not HaveBuff(&amp;quot;player&amp;quot;,{687,28176}) 
then return true end</Lua><RecastDelay>500</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Incinerate</Name><Default>false</Default><SpellID>29722</SpellID><Actions></Actions><Lua>local MoltenCore = select(4,UnitBuffID(&amp;quot;player&amp;quot;,71165)) 
if MoltenCore and ( MoltenCore ~= 1 or not PQR_IsCastingSpell(29722) ) 
and not IsSpellOverlayed(686)
and not PQR_IsMoving(1) 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Life Tap</Name><Default>false</Default><SpellID>1454</SpellID><Actions></Actions><Lua>if not UnitAffectingCombat(&amp;quot;player&amp;quot;) 
and 100 * UnitPower(&amp;quot;player&amp;quot;) / UnitPowerMax(&amp;quot;player&amp;quot;) &amp;lt; 85 
and 100 * UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;) &amp;gt; 40 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Soulstone</Name><Default>false</Default><SpellID>693</SpellID><Actions></Actions><Lua>if GetItemCount(5232) == 0 
and not UnitAffectingCombat(&amp;quot;player&amp;quot;) 
and not PQR_IsMoving(1) 
then return true end</Lua><RecastDelay>500</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Metamorphosis</Name><Default>false</Default><SpellID>47241</SpellID><Actions></Actions><Lua>if CheckInteractDistance(&amp;quot;target&amp;quot;, 3) 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Immolation Aura</Name><Default>false</Default><SpellID>50589</SpellID><Actions></Actions><Lua>return true</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Hand of Gul&amp;apos;dan</Name><Default>false</Default><SpellID>71521</SpellID><Actions></Actions><Lua>if not PQR_IsMoving(1) 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Soul Link</Name><Default>false</Default><SpellID>19028</SpellID><Actions></Actions><Lua>local hasPetSpells, petType = HasPetSpells() 

if not UnitAffectingCombat(&amp;quot;player&amp;quot;) 
and not HaveBuff(&amp;quot;player&amp;quot;,19028) 
and hasPetSpells and petType == &amp;quot;DEMON&amp;quot; 
then return true end</Lua><RecastDelay>500</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Felguard Felstorm</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if HaveDebuff(&amp;quot;target&amp;quot;,86000) 
and GetSpellCooldown(89751) == 0 
then 
  local spell = GetSpellInfo(89751) 
  CastSpellByName(spell) 
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability></WARLOCK>