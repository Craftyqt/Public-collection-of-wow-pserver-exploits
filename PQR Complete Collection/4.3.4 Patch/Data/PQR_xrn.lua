function SpecialAggro(t)
  local mob
  if GetLocale() == "deDE" then
    mob = { "Trainingsattrappe", "Trainingsattrappe des Schlachtzuges", "Verzerrter Geist", "Brutwächter der Amani'shi", 
            "Hakkars Ketten", "Freigelegter Kopf von Magmaul", "Schlachtfeldverwüster", "Ozumat", 
            "Rechter Fuß", "Linker Fuß", "Eisiges Grab", "Auferstandener Ghul", "Manaleere", "Brennende Sehnen", 
            "Schwingententakel", "Armtentakel", "Zwielichtkampfdrache", "Goriona", "Eisgrab", 
            "Zwielichtpionier", "Schwächender Schreckenslord", "Blasiges Tentakel" } 
  elseif GetLocale() == "frFR" then
    mob = { "Mannequin d'entraînement", "Mannequin d'entraînement d'écumeur de raids", "Esprit tordu", "Perce-coque amani'shi", 
            "Chaînes d'Hakkar", "Tête exposée de Magmagueule", "Démolisseur de champ de bataille", "Ozumat", 
            "Pied droit", "Pied gauche", "Tombe glaciale", "Goule ressuscitée", "Vide de mana", "Tendons brûlants", 
            "Tentacule d’aile", "Tentacule de patte", "Drake d’assaut du Crépuscule", "Goriona", "Tombeau de glace", 
            "Sapeur du Crépuscule", "Seigneur de l’effroi débilitant", "Tentacule caustique" } 
  elseif GetLocale() == "esES" then
    mob = { "Muñeco de entrenamiento", "Muñeco de entrenamiento de asaltante", "Espíritu alterado", "Criador Amani'shi", 
            "Cadenas de Hakkar", "Cabeza de Faucemagma expuesta", "Demoledor del campo de batalla", "Ozumat", 
            "Pie derecho", "Pie izquierdo", "Tumba helada", "Necrófago resucitado", "Vacío de maná", "Tendones ardientes", 
            "Tentáculo del ala", "Tentáculo", "Draco de asalto Crepuscular", "Goriona", "Tumba de hielo", 
            "Zapador Crepuscular", "Señor del Terror debilitador", "Tentáculo virulento" } 
  elseif GetLocale() == "ruRU" then
    mob = { "Тренировочный манекен", "Тренировочный манекен рейдера", "Искаженный дух", "Смотритель кладки из племени Амани", 
            "Цепи Хаккара", "Голова Магмаря", "Боевой разрушитель", "Озумат", 
            "Правая нога", "Левая нога", "Ледяная гробница", "Восставший вурдалак", "Магическая воронка", "Горящие сухожилия", 
            "Крыло", "Громадное щупальце", "Сумеречный штурмовой дракон", "Гориона", "Ледяной склеп", 
            "Сумеречный сапер", "Повелитель ужаса - истощитель", "Раскаленное щупальце" } 
  else
    mob = { "Training Dummy", "Raider's Training Dummy", "Twisted Spirit", "Amani´shi Hatcher", 
            "Hakkar's Chains", "Exposed Head of Magmaw", "Battleground Demolisher", "Ozumat", 
            "Right Foot", "Left Foot", "Icy Tomb", "Risen Ghoul", "Mana Void", "Burning Tendons", 
            "Wing Tentacle", "Arm Tentacle", "Twilight Assault Drake", "Goriona", "Ice Tomb", 
            "Twilight Sapper", "Dreadlord Debilitator", "Blistering Tentacle" } 
  end
  for i=1, #mob do if UnitName(t) == mob[i] then return true end end
end

function HoldCooldown(cd)
  local l = 5
  local Deathwing = { "Todesschwinge", "Aile de mort", "Alamuerte", "Смертокрыл", "Deathwing" } 
  local Tendons = { "Brennende Sehnen", "Tendons brûlants", "Tendones ardientes", "Горящие сухожилия", "Burning Tendons" }
  local Zon = { "Kriegsherr Zon'ozz", "Seigneur de guerre Zon’ozz", "Señor de la guerra Zon'ozz", "Полководец Зон'озз", "Warlord Zon'ozz" }
  local Alysrazor = { "Alysrazar", "Alysrazor", "Alysrazor", "Алисразор", "Alysrazor" }
  if GetLocale() == "deDE" then l = 1 elseif GetLocale() == "frFR" then l = 2 elseif GetLocale() == "esES" then l = 3 elseif GetLocale() == "ruRU" then l = 4 end
  if GetMinimapZoneText() == Deathwing[l] and UnitName("target") ~= Tendons[l] and cd >= 1 then return true end
  if UnitName("target") == Zon[l] and not UnitDebuffID("target",104031) and cd >= 3 then return true end
  if UnitName("boss1") == Alysrazor[l] and not UnitDebuffID("boss1",99432) and cd >= 3 then return true end
end

function HaveBuff(UnitID,SpellID,TimeLeft,Filter) 
  if not TimeLeft then TimeLeft = 0 end
  if type(SpellID) == "number" then SpellID = { SpellID } end 
  for i=1,#SpellID do 
    local spell, rank = GetSpellInfo(SpellID[i])
    if spell then
      local buff = select(7,UnitBuff(UnitID,spell,rank,Filter)) 
      if buff and ( buff == 0 or buff - GetTime() > TimeLeft ) then return true end
    end
  end
end

function HaveDebuff(UnitID,SpellID,TimeLeft,Filter) 
  if not TimeLeft then TimeLeft = 0 end
  if type(SpellID) == "number" then SpellID = { SpellID } end 
  for i=1,#SpellID do 
    local spell, rank = GetSpellInfo(SpellID[i])
    if spell then
      local debuff = select(7,UnitDebuff(UnitID,spell,rank,Filter)) 
      if debuff and ( debuff == 0 or debuff - GetTime() > TimeLeft ) then return true end
    end
  end
end

function ImmuneTarget(t) 
  local buff = { 642, 45438, 31224, 23920, 33786, 19263, 97417, 97977, 102915, 100686, 105784, 74938 }
  for i=1, #buff do if UnitBuffID(t,buff[i]) then return true end end
end

function BadEffects(t)
  local buff  = { 96328, 96325, 96326, 86788, 30108, 101810 } 
  for i=1, #buff do if UnitDebuffID(t,buff[i]) then return true end end
end

function AboutToDie(t) 
  local pressure = 0
  for i=1,#members do
    if UnitGroupRolesAssigned(members[i].Unit) ~= "HEALER" and UnitIsUnit(t,members[i].Unit..t) 
    then pressure = pressure + 1 end
  end
  if UnitHealth(t) < UnitHealthMax("player")*pressure and UnitHealthMax(t) ~= 1 
  then return true end
end

function CalculateHP(t)
  incomingheals = UnitGetIncomingHeals(t) and UnitGetIncomingHeals(t) or 0
  return 100 * ( UnitHealth(t) + incomingheals ) / UnitHealthMax(t)
end

function CanHeal(t)
  if UnitInRange(t) and UnitCanCooperate("player",t) and not UnitIsEnemy("player",t) 
  and not UnitIsCharmed(t) and not UnitIsDeadOrGhost(t) and not PQR_IsOutOfSight(t) 
  then return true end 
end

function HealEngine()
  members, group = { { Unit = "player", HP = CalculateHP("player") } }, { low = 0, tanks = { } } 
  group.type = GetNumRaidMembers() > 0 and "raid" or "party" 
  group.number = group.type == "raid" and GetNumRaidMembers() or GetNumPartyMembers() 
  for i=1,group.number do if CanHeal(group.type..i) then 
    local unit, hp = group.type..i, CalculateHP(group.type..i) 
    table.insert( members,{ Unit = unit, HP = hp } ) 
    if hp < 90 then group.low = group.low + 1 end 
    if UnitGroupRolesAssigned(unit) == "TANK" then table.insert(group.tanks,unit) end 
  end end 
  if group.type == "raid" and #members > 1 then table.remove(members,1) end 
  table.sort(members, function(x,y) return x.HP < y.HP end)
  local customtarget = CanHeal("target") and "target" or CanHeal("mouseover") and GetMouseFocus() ~= WorldFrame and "mouseover" 
  if customtarget then table.sort(members, function(x) return UnitIsUnit(customtarget,x.Unit) end) end 
end

function ModSwitch(single,aoe)
  if IsRightControlKeyDown() and ( not rightkeydown or GetTime() - rightkeydown > 0.3 ) then
    rightkeydown = GetTime()
    if canAOE then canAOE = false xrn:message(single) else canAOE = true xrn:message(aoe) end
  end
end

function CastClick() 
  if MainMenuBar:IsShown() then 
    local mousefocus = GetMouseFocus() 
    if mousefocus and mousefocus.feedback_action and IsMouseButtonDown(1) 
    then SpellCancelQueuedSpell() PQR_DelayRotation(1) end
  end
end

function AssistTank() 
  local tank = group.tanks[1] 
  if tank and group.type == "party" 
  and not UnitExists("target") 
  and UnitAffectingCombat(tank) 
  and UnitAffectingCombat(tank.."target") 
  and UnitCanAttack("player",tank.."target")
  then TargetUnit(tank.."target") end
end

local function onUpdate(self,elapsed) 
  if self.time < GetTime() - 3 then
    if self:GetAlpha() == 0 then self:Hide() else self:SetAlpha(self:GetAlpha() - .05) end
  end
end

xrn = CreateFrame("Frame",nil,ChatFrame1) 
xrn:SetSize(ChatFrame1:GetWidth(),30)
xrn:Hide()
xrn:SetScript("OnUpdate",onUpdate)
xrn:SetPoint("TOP",0,0)
xrn.text = xrn:CreateFontString(nil,"OVERLAY","MovieSubtitleFont")
xrn.text:SetAllPoints()
xrn.texture = xrn:CreateTexture()
xrn.texture:SetAllPoints()
xrn.texture:SetTexture(0,0,0,.50) 
xrn.time = 0

function xrn:message(message) 
  self.text:SetText(message)
  self:SetAlpha(1)
  self.time = GetTime() 
  self:Show() 
end

if UnitLevel("player") ~= 85 then
  PQR_WriteToChat("\124cFFD12727WARNING: \124cFFFFFFFFLevel 85 is required to use this profile properly")
end

if GetLocale() ~= "enUS" and GetLocale() ~= "deDE" and GetLocale() ~= "frFR" and GetLocale() ~= "esES" and GetLocale() ~= "ruRU" 
then PQR_WriteToChat("\124cFFD12727WARNING: \124cFFFFFFFFenUS language pack is required to use this profile properly") end 

local colors = RAID_CLASS_COLORS[select(2,UnitClass("player"))] 
xrn:message("Sheuron "..string.format("|cff%02x%02x%02x", colors.r*255, colors.g*255, colors.b*255).."120430") 