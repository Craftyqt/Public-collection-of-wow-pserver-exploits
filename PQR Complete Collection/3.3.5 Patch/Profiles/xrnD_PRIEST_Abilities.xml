<?xml version="1.0" encoding="utf-8" ?><PRIEST><Ability><Name>--- defensive spells ---</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if IsLeftAltKeyDown()
or IsMounted()
or SpellIsTargeting()
or UnitBuffID(&amp;quot;player&amp;quot;,87959) 
or UnitChannelInfo(&amp;quot;player&amp;quot;) 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><LuaBefore></LuaBefore><LuaAfter></LuaAfter></Ability><Ability><Name>--- healing spells ---</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if UnitAffectingCombat(PQR_CustomTarget) == nil 
and IsLeftShiftKeyDown() == nil
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><LuaBefore></LuaBefore><LuaAfter></LuaAfter></Ability><Ability><Name>Power Word: Fortitude</Name><Default>false</Default><SpellID>21562</SpellID><Actions></Actions><Lua>if (missingfortitude or UnitBuffID(&amp;quot;player&amp;quot;, 79105) == nil)
and UnitAffectingCombat(&amp;quot;player&amp;quot;) == nil 
then return true end</Lua><RecastDelay>500</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><LuaBefore></LuaBefore><LuaAfter></LuaAfter></Ability><Ability><Name>Shadow Protection</Name><Default>false</Default><SpellID>27683</SpellID><Actions></Actions><Lua>if (missingshadow or UnitBuffID(&amp;quot;player&amp;quot;, 79107) == nil)
and UnitAffectingCombat(&amp;quot;player&amp;quot;) == nil 
then return true end</Lua><RecastDelay>500</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><LuaBefore></LuaBefore><LuaAfter></LuaAfter></Ability><Ability><Name>Renew</Name><Default>false</Default><SpellID>139</SpellID><Actions></Actions><Lua>if PQR_CustomTargetHP &amp;lt; 95 
and UnitBuffID(PQR_CustomTarget, 139,&amp;quot;PLAYER&amp;quot;) == nil 
then return true end</Lua><RecastDelay>500</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><LuaBefore></LuaBefore><LuaAfter></LuaAfter></Ability><Ability><Name>Power Word: Shield</Name><Default>false</Default><SpellID>17</SpellID><Actions></Actions><Lua>if UnitDebuffID(PQR_CustomTarget,6788) == nil 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><LuaBefore></LuaBefore><LuaAfter></LuaAfter></Ability><Ability><Name>Inner Will</Name><Default>false</Default><SpellID>73413</SpellID><Actions></Actions><Lua>if UnitBuffID(&amp;quot;player&amp;quot;, 588) == nil 
and UnitBuffID(&amp;quot;player&amp;quot;, 73413) == nil
then return true end</Lua><RecastDelay>500</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><LuaBefore></LuaBefore><LuaAfter></LuaAfter></Ability><Ability><Name>Autotarget LowHP</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if UnitExists(&amp;quot;target&amp;quot;) 
  and UnitIsDead(&amp;quot;target&amp;quot;) == nil 
  and UnitCanCooperate(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;)
  then PQR_CustomTarget = &amp;quot;target&amp;quot;
          PQR_CustomTargetHP = 100 * UnitHealth(&amp;quot;target&amp;quot;) / UnitHealthMax(&amp;quot;target&amp;quot;)
elseif UnitExists(&amp;quot;mouseover&amp;quot;) 
  and UnitIsDead(&amp;quot;mouseover&amp;quot;) == nil 
  and UnitCanCooperate(&amp;quot;player&amp;quot;,&amp;quot;mouseover&amp;quot;) 
  and GetMouseFocus() ~= WorldFrame 
  then PQR_CustomTarget = &amp;quot;mouseover&amp;quot;
          PQR_CustomTargetHP = 100 * UnitHealth(&amp;quot;mouseover&amp;quot;) / UnitHealthMax(&amp;quot;mouseover&amp;quot;)
else 

PQR_CustomTarget = &amp;quot;player&amp;quot;
PQR_CustomTargetHP = 100 * UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;)
local group = &amp;quot;party&amp;quot;
local members = GetNumPartyMembers()
lowhpmembers = 0
missingfortitude = nil
missingshadow = nil
havemending = nil
priodispel = nil

if GetNumRaidMembers() &amp;gt; 0 then
  group = &amp;quot;raid&amp;quot;
  members = GetNumRaidMembers()
end

for i = 1, members, 1 do
  local member = group..tostring(i)
  local incomingheal = 0
  if UnitGetIncomingHeals(member) then incomingheal = UnitGetIncomingHeals(member)  end
  local memberhp = 100 * ( UnitHealth(member) + incomingheal ) / UnitHealthMax(member)
  if UnitInRange(member) 
  and UnitIsCharmed(member) == nil
  and UnitIsDeadOrGhost(member) == nil 
  and PQR_IsOutOfSight(member) == false then

    local todispel = { 5782, 118, 1499, 6358, 605, 20066, 8122, 853, 5484, 71757, 104601 }
    for _,v in ipairs(todispel) do if UnitDebuffID(member,v) then priodispel = member end end

    local i = 1
    local havestamina = 0 
    local haveshadow = 0 
    local haveshield = 0
    local buff,_,_,_,_,_,_,caster = UnitBuff(member, i)
    while buff do
      local staminabuff = { 79105, 90364, 469, 6307 }
      for _,v in ipairs(staminabuff) do if buff == tostring(GetSpellInfo(v)) then havestamina = 1 end end
      if buff ==  tostring(GetSpellInfo(79107)) then haveshadow = 1 end 
      if buff ==  tostring(GetSpellInfo(17)) then haveshield = 1 end 
      if buff ==  tostring(GetSpellInfo(41635)) and caster == &amp;quot;player&amp;quot; then havemending = 1 end 
      i = i + 1;
      buff,_,_,_,_,_,_,caster = UnitBuff(member, i) 
    end

    if havestamina == 0 then missingfortitude = 1 end
    if haveshadow == 0 then missingshadow = 1 end
    if haveshield == 0 then memberhp = memberhp - 1 end
    if UnitGroupRolesAssigned(member) == &amp;quot;TANK&amp;quot; then memberhp = memberhp - 1 end
    if UnitThreatSituation(member) == 3 then memberhp = memberhp - 3 end
    if memberhp &amp;lt; 95 then lowhpmembers = lowhpmembers +1 end
    if memberhp &amp;lt; PQR_CustomTargetHP then
      PQR_CustomTarget = member
      PQR_CustomTargetHP = memberhp
    end

  end
end

if priodispel then PQR_CustomTarget = priodispel end

end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><LuaBefore></LuaBefore><LuaAfter></LuaAfter></Ability><Ability><Name>Shadowfiend</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if 100 * UnitPower(&amp;quot;player&amp;quot;) / UnitPowerMax(&amp;quot;player&amp;quot;) &amp;lt; 70 
and GetSpellCooldown(34433) == 0
and UnitIsEnemy(&amp;quot;player&amp;quot;,PQR_CustomTarget..&amp;quot;target&amp;quot;) 
and UnitChannelInfo(&amp;quot;player&amp;quot;) == nil 
then 
  CastSpellByID(34433,PQR_CustomTarget..&amp;quot;target&amp;quot;) 
  return true
end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><LuaBefore></LuaBefore><LuaAfter></LuaAfter></Ability><Ability><Name>Flash Heal</Name><Default>false</Default><SpellID>2061</SpellID><Actions></Actions><Lua>if ( PQR_CustomTargetHP &amp;lt; 85 or UnitBuffID(&amp;quot;player&amp;quot;,88688) ) 
and 100 * UnitPower(&amp;quot;player&amp;quot;) / UnitPowerMax(&amp;quot;player&amp;quot;) &amp;gt; 30 
and PQR_IsCastingSpell(2061) == false
and ( PQR_IsMoving(1) == false or UnitBuffID(&amp;quot;player&amp;quot;,88688) )
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><LuaBefore></LuaBefore><LuaAfter></LuaAfter></Ability><Ability><Name>Heal</Name><Default>false</Default><SpellID>2050</SpellID><Actions></Actions><Lua>if PQR_CustomTargetHP &amp;lt; 85
and PQR_IsMoving(1) == false
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><LuaBefore></LuaBefore><LuaAfter></LuaAfter></Ability><Ability><Name>Penance</Name><Default>false</Default><SpellID>47540</SpellID><Actions></Actions><Lua>if PQR_CustomTargetHP &amp;lt; 85 
and PQR_IsMoving(1) == false 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><LuaBefore></LuaBefore><LuaAfter></LuaAfter></Ability><Ability><Name>Mass Dispel</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if IsLeftControlKeyDown() 
and GetCurrentKeyBoardFocus() == nil 
and UnitChannelInfo(&amp;quot;player&amp;quot;) == nil 
then
  CastSpellByName(tostring(GetSpellInfo(32375)))
  if SpellIsTargeting() then CameraOrSelectOrMoveStart() CameraOrSelectOrMoveStop() end  
  return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><LuaBefore></LuaBefore><LuaAfter></LuaAfter></Ability><Ability><Name>Dispel Magic</Name><Default>false</Default><SpellID>527</SpellID><Actions></Actions><Lua>local i = 1
local baddispel = nil
local goodtodispel = nil

local dontdispel = { 96328, 96325, 96326, 92876, 92877, 92878, 86788, 30108 }
for _,v in ipairs(dontdispel) do if UnitDebuffID(PQR_CustomTarget,v) then baddispel = 1 end end

local i = 1
local buff,_,_,count,bufftype,duration = UnitDebuff(PQR_CustomTarget, i)
while buff do
  if bufftype == &amp;quot;Magic&amp;quot; 
  and duration &amp;gt; 6 
  and count ~= 1 
  and not baddispel 
  and UnitIsFriend(&amp;quot;player&amp;quot;,PQR_CustomTarget) 
  then return true end
  i = i + 1;
  buff,_,_,count,bufftype,duration = UnitDebuff(PQR_CustomTarget, i)
end</Lua><RecastDelay>500</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><LuaBefore></LuaBefore><LuaAfter></LuaAfter></Ability><Ability><Name>Pain Suppression</Name><Default>false</Default><SpellID>33206</SpellID><Actions></Actions><Lua>if PQR_CustomTargetHP &amp;lt; 40
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><LuaBefore></LuaBefore><LuaAfter></LuaAfter></Ability><Ability><Name>Desesperate Prayer</Name><Default>false</Default><SpellID>19236</SpellID><Actions></Actions><Lua>if PQR_CustomTargetHP &amp;lt; 20
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><LuaBefore></LuaBefore><LuaAfter></LuaAfter></Ability><Ability><Name>Inner Focus</Name><Default>false</Default><SpellID>89485</SpellID><Actions></Actions><Lua>if 100 * UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;) &amp;lt; 60 
and PQR_IsMoving(1) == false 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><LuaBefore></LuaBefore><LuaAfter></LuaAfter></Ability><Ability><Name>Prayer of Mending</Name><Default>false</Default><SpellID>33076</SpellID><Actions></Actions><Lua>if havemending == nil 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><LuaBefore></LuaBefore><LuaAfter></LuaAfter></Ability><Ability><Name>Binding Heal</Name><Default>false</Default><SpellID>32546</SpellID><Actions></Actions><Lua>if PQR_CustomTargetHP &amp;lt; 90 
and 100 * UnitHealth(&amp;quot;player&amp;quot;) / UnitHealthMax(&amp;quot;player&amp;quot;) &amp;lt; 90 
and UnitIsUnit(&amp;quot;player&amp;quot;, PQR_CustomTarget) == nil 
and PQR_IsCastingSpell(32546) == false
and PQR_IsMoving(1) == false 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Custom</Target><CancelChannel>False</CancelChannel><LuaBefore></LuaBefore><LuaAfter></LuaAfter></Ability><Ability><Name>Arcane Torrent</Name><Default>false</Default><SpellID>28730</SpellID><Actions></Actions><Lua>if IsSpellKnown(28730) 
and 100 * UnitPower(&amp;quot;player&amp;quot;) / UnitPowerMax(&amp;quot;player&amp;quot;) &amp;lt; 80
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><LuaBefore></LuaBefore><LuaAfter></LuaAfter></Ability><Ability><Name>--- offensive spells ---</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local buff = { 642, 45438, 31224, 23920, 33786, 19263, 97417, 97977, 102915, 100686, 105784 }
local mob = { &amp;quot;Training Dummy&amp;quot;, &amp;quot;Raider&amp;apos;s Training Dummy&amp;quot;, &amp;quot;Twisted Spirit&amp;quot;, &amp;quot;Amani´shi Hatcher&amp;quot;, &amp;quot;Hakkar&amp;apos;s Chains&amp;quot;, &amp;quot;Exposed Head of Magmaw&amp;quot;, &amp;quot;Battleground Demolisher&amp;quot;, &amp;quot;Ozumat&amp;quot;, &amp;quot;Right Foot&amp;quot;, &amp;quot;Left Foot&amp;quot;, &amp;quot;Icy Tomb&amp;quot;, &amp;quot;Risen Ghoul&amp;quot;, &amp;quot;Mana Void&amp;quot;, &amp;quot;Burning Tendons&amp;quot;, &amp;quot;Wing Tentacle&amp;quot;, &amp;quot;Arm Tentacle&amp;quot;, &amp;quot;Twilight Assault Drake&amp;quot;, &amp;quot;Goriona&amp;quot;, &amp;quot;Ice Tomb&amp;quot; }
local noaggromobs = nil
local immunity = nil

for i,v in ipairs(buff) do
  if UnitBuffID(&amp;quot;target&amp;quot;,v) then immunity = 1 end
end

for i,v in ipairs(mob) do
  if UnitName(&amp;quot;target&amp;quot;) == v then noaggromobs = 1 end
end

if UnitIsDead(&amp;quot;target&amp;quot;)
or immunity
or UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) == nil
or (UnitAffectingCombat(&amp;quot;target&amp;quot;) == nil and noaggromobs == nil and UnitIsPlayer(&amp;quot;target&amp;quot;) == nil)
or tonumber(UnitGUID(&amp;quot;target&amp;quot;):sub(5,5),16) == 4
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><LuaBefore></LuaBefore><LuaAfter></LuaAfter></Ability><Ability><Name>Holy Fire</Name><Default>false</Default><SpellID>14914</SpellID><Actions></Actions><Lua>return true</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><LuaBefore></LuaBefore><LuaAfter></LuaAfter></Ability><Ability><Name>Shadow Word: Death</Name><Default>false</Default><SpellID>32379</SpellID><Actions></Actions><Lua>if 100 * UnitHealth(&amp;quot;target&amp;quot;) / UnitHealthMax(&amp;quot;target&amp;quot;) &amp;lt; 25 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><LuaBefore></LuaBefore><LuaAfter></LuaAfter></Ability><Ability><Name>Smite</Name><Default>false</Default><SpellID>585</SpellID><Actions></Actions><Lua>return true</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><LuaBefore></LuaBefore><LuaAfter></LuaAfter></Ability><Ability><Name>Power Infusion</Name><Default>false</Default><SpellID>10060</SpellID><Actions></Actions><Lua>return true</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><LuaBefore></LuaBefore><LuaAfter></LuaAfter></Ability><Ability><Name>Mana Burn</Name><Default>false</Default><SpellID>8129</SpellID><Actions></Actions><Lua>if select(2,UnitPowerType(&amp;quot;target&amp;quot;)) == &amp;quot;MANA&amp;quot; 
and 100 * UnitHealth(&amp;quot;target&amp;quot;) / UnitHealthMax(&amp;quot;target&amp;quot;) &amp;gt; 25 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><LuaBefore></LuaBefore><LuaAfter></LuaAfter></Ability><Ability><Name>Dispel Magic Offensive</Name><Default>false</Default><SpellID>527</SpellID><Actions></Actions><Lua>buff = { 43242, 92965, 93631, 76634, 88186, 76307, 31884, 2825, 32182, 80353, 1719, 17, 96802, 6940, 11426 }
for i,v in ipairs(buff) do if UnitBuffID(&amp;quot;target&amp;quot;,v) then return true end end</Lua><RecastDelay>500</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><LuaBefore></LuaBefore><LuaAfter></LuaAfter></Ability><Ability><Name>Mind Control</Name><Default>false</Default><SpellID>605</SpellID><Actions></Actions><Lua>if IsLeftShiftKeyDown() 
and GetCurrentKeyBoardFocus() == nil 
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><LuaBefore></LuaBefore><LuaAfter></LuaAfter></Ability></PRIEST>