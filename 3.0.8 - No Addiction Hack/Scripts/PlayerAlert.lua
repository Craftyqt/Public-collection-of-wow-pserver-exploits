--Player Alert script 
--Written by Chaotic

Players = {};--"Player list"
PlayerParser = 0;--"Player counter"

--adds a player du our player list
function AddPlayer( object )
	PlayerParser = PlayerParser + 1;
	Players[PlayerParser] = object;--[1] = first element in array
end

--Remove a player from our player list, then lower our parser by 1 and shift every player object one place down
function RemovePlayer( object )
	for i = 1, PlayerParser, 1 do
		if Players[i] == object then
			PlayerParser = PlayerParser - 1;
			for e = i, PlayerParser, 1 do
				Players[e] = Players[(e+1)];
			end
			return 1;
		end
	end
	return 0;
end

--Check if the current object is already on our player list
function IsAlreadyAdded( object )
	for i = 1, PlayerParser, 1 do
		if Players[i] == object then
			return 1;
		end
	end
	return 0;
end


function PlayerExists()
	--If player count = 0 ... well, we dont need to check an empty list ;)
	if PlayerParser == 0 then
		return 0;
	end
	--update objectlist
	game.updateObjectList();
	EntryCount = game.getObjectListEntryCount();
	for i = 1, PlayerParser, 1 do--start with first player object in our list
		found = 0;
		for e = 0, EntryCount, 1 do--compare our current player object with any objectlistentry object
			if Players[i] == game.getObjectListEntry(e) then
				found = 1;
			end
		end
		if found == 0 then--if we couldnt find our object in the list -> remove it!
			RemovePlayer( Players[i] );
		end
	end
	return 1;
end


function CheckForPlayer()
	game.updateObjectList();
	EntryCount = game.getObjectListEntryCount();
	for i=0, EntryCount, 1 do
		ThisObject = game.getObjectListEntry(i);
		--Is valid object and is not myself and is not an npc/mob and is not already on our player list?
		if ThisObject ~= 0 and ThisObject ~= game.getMyselfObject() and game.getObjectAttributeInt(ThisObject,2) == 25 and IsAlreadyAdded(ThisObject) == 0 then
			AddPlayer( ThisObject );--To Prevent spamming
			--Warn: Name ( Level - Maximal Life)
			game.printChat( string.format('|cFFE22529Player found: %s (%i-%i)',game.getObjectName(ThisObject),game.getObjectAttributeInt(ThisObject,53),game.getObjectAttributeInt(ThisObject,31) ));
		end
	end
	
end

--This function will be called once every 1000 ms (one seconds) with "game.setTimerEvent();"
function PlayerAlert1000()
	PlayerExists();--Check if saved players are still in our area--
	CheckForPlayer();--Check if new players are in our area--
end


--This functions gets loaded when ".luaload xy" is called
function Load()
	game.printChat('|cFFFFFF00PlayerAlert loaded!');
  	game.setTimerEvent('PlayerAlert1000', 1000);
end





