-- CamTarget by lklka
-- Would've never gotten this to work without the help of Jadd
-- Code improved by zdennis

local CurrPl = ObjectManager.GetActivePlayer();
cookie = 0
function Load()
	local main = Frame.Create( "CamTarget", 190, 100 );
	local button = Button.Create( main, "Change CamTarget", 1, 1, 180, 80 );
	Event.RegisterFrameCallback( "ButtonClicked", button, "OnClick" );
end

function ButtonClicked()
local Target = ObjectManager.GetCurrentTarget();
	if ( cookie == 0 and Target)
	then
		cookie = 1
		CameraPtr = Memory.Read( Memory.GetModuleBase() + 0x00AD7A10, "int" );
		CameraPtr = Memory.Read( CameraPtr + 0x80D0, "int" );
		Memory.Write( CameraPtr + 0x78, Target:GetGUID(), "int64" );
	elseif ( cookie == 0 and not Target) then
		Plus.PrintChat( "You don't have a target!")
	elseif  cookie == 1 then
		cookie = 0
		CameraPtr = Memory.Read( Memory.GetModuleBase() + 0x00AD7A10, "int" );
		CameraPtr = Memory.Read( CameraPtr + 0x80D0, "int" );
		Memory.Write( CameraPtr + 0x78, CurrPl:GetGUID(), "int64" );
	end
end