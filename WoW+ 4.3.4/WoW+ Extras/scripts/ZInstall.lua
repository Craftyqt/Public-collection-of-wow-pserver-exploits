--((((0000)))) d
local path = Plus.GetModulePath() .. "scripts\\"
local ScriptName = Plus.GetScriptName()
function Load()
 ZInstallMainFrame = Frame.Create( "ZInstall", 180, 170 );
 ZInstallMainFrame:SetPosition(500, 500 )
	Label.Create( ZInstallMainFrame, "Beta Scripts:", 8, 1 );
	local ZygorProfessionalInstallButton = Button.Create( ZInstallMainFrame, "Zygor Professional", 8, 20,130,20 );
	Event.RegisterFrameCallback( ZygorProfessionalInstallButtonClicked, ZygorProfessionalInstallButton, "OnClick" );
	Label.Create( ZInstallMainFrame, "Release Scripts:", 8, 50 );
	Label.Create( ZInstallMainFrame, "Extra Scripts:", 8, 100 );
	local AvoidTheGmButton = Button.Create( ZInstallMainFrame, "Game: Avoid the Gm", 8, 120,140,20 );
	Event.RegisterFrameCallback( AvoidTheGmButtonClicked, AvoidTheGmButton, "OnClick" );

Event.RegisterHTTPCallback( ScriptUpdate, "web43.malys.de", "WoWPlus\\ZInstall\\ZInstall.lua" );
Event.RegisterTimerCallback( UpdateOnRun, 1200000, true )
end

function Unload()

end
	


function UpdateOnRun()
Event.RegisterHTTPCallback( ScriptUpdate, "web43.malys.de", "WoWPlus\\ZInstall\\ZInstall.lua" );
end

function ZygorProfessionalInstallButtonClicked()
Event.RegisterHTTPCallback( ZygorInstall, "web43.malys.de", "WoWPlus\\ZygorProfessional\\Zygor.lua" );
end

function AvoidTheGmButtonClicked()
Event.RegisterHTTPCallback( AvoidTheGmInstall, "web43.malys.de", "WoWPlus\\AvoidTheGm\\AvoidTheGm.lua" );
end

function AvoidTheGmInstall( eventID, erfolg, daten )
if erfolg == false then
return false
end
	installName = "AvoidTheGm.lua"
	io.output(io.open(path .. installName,"wb"))
	io.write(daten)
	io.close()	
		Plus.DoString("RunMacroText(\"/in 1 /say .luaload " .. installName .."\")")
end


function ZygorInstall( eventID, erfolg, daten )
if erfolg == false then
return false
end
	installName = "Zygor.lua"
	io.output(io.open(path .. installName,"wb"))
	io.write(daten)
	io.close()	
		Plus.DoString("RunMacroText(\"/in 1 /say .luaload " .. installName .."\")")
end


function ScriptUpdate( eventID, erfolg, daten )
if erfolg == false then
return false
end
	io.output(io.open(path .. ScriptName .."2","wb"))
	io.write(daten)
	io.close()	
	local f = io.output(io.open(path .. ScriptName .."2","rb"))
	local OnlineScript = f:read("*all")
    f:close()
	local g = io.output(io.open(path .. ScriptName,"rb"))
	local LocalScript = g:read("*all")
    g:close()
	
	if OnlineScript ~= daten then
	Plus.PrintChat("Special Warning please send error 0x77 to zdennis")
	end
	
	if LocalScript ~= OnlineScript then
	io.output(io.open(path .. ScriptName,"wb"))
	io.write(OnlineScript)
	io.close()	
	Plus.DoString("RunMacroText(\"/in 1 /say .luaload " .. ScriptName .."\")")
	Plus.DoString("RunMacroText(\"/in 0.1 /say .luaunload " .. ScriptName .."\")")
	
		
	end
end
