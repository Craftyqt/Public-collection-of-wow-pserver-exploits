local nJprDPVfTGvf = nil;

RegisterCVar("UnitNameOwn")
RegisterCVar("UnitNameNPC")
RegisterCVar("UnitNamePlayerGuild")
RegisterCVar("UnitNamePlayerPVPTitle")
RegisterCVar("UnitNamePlayer")
RegisterCVar("cameraSmoothStyle")


local CWghPhBMdixWja = 0;
local SRXslVuXiWKV = 0;

local QrqAWENrsq = 0;
local TQKhftRyHXUqfy = 0;

local lMWyoBGhf = 0;
local KCzJzzOlWCsK = 0;

local VoeikDJjKK = 0;
local ngDeseekFoHNo = 0;

local NTvwmGSMpJa = 1;
local OqpgXQyAMwu = 1;
local tKvgiXqNuf;
local wtnryWQBvAJA = UnitFactionGroup("player");
local plSound = 0;

local nayOudmtuTjAKlBO = nil;

if (oHdmtEmGRywEzVv == nil) then
	oHdmtEmGRywEzVv = 0;
	kKqJxNcHrsl = 0;
	AOsixUEACpUpb = 0;
	xcPUOeqyaotpdg = 0;
	AbDtJfWPayA = 0;
	ypPoCpmdzxHL = 0;
	sOTpJSdsQMpLJvT = 0;
	dImCensOnNW = 0;
	kMMbumoRMwDR = 0;
	vMlbMawHotwxjaUnitNameOwn = GetCVar("UnitNameOwn");
	vMlbMawHotwxjaUnitNameNPC = GetCVar("UnitNameNPC");
	vMlbMawHotwxjaUnitNamePlayerGuild = GetCVar("UnitNamePlayerGuild");
	vMlbMawHotwxjaUnitNamePlayerPVPTitle = GetCVar("UnitNamePlayerPVPTitle");
	vMlbMawHotwxjaUnitNamePlayer = GetCVar("UnitNamePlayer");
	vMlbMawHotwxjacameraSmoothStyle = GetCVar("cameraSmoothStyle");
end
function AQuBDPhvPCjtLWTc_OnLoad()

	this:RegisterEvent("VARIABLES_LOADED");
	this:RegisterEvent("CHAT_MSG_SAY");
	this:RegisterEvent("CHAT_MSG_WHISPER");
	this:RegisterEvent("PLAYER_DEAD");
	this:RegisterEvent("PLAYER_ALIVE");
	this:RegisterEvent("ZONE_CHANGED_NEW_AREA");
	this:RegisterEvent("BATTLEFIELDS_SHOW");
	this:RegisterEvent("GOSSIP_SHOW");
	this:RegisterEvent("UPDATE_BATTLEFIELD_STATUS");

	gnuBhUvBBlmST();
end


function vUWcQOudqSeLs(arg1)
	local _, _, PyAMSNjIIn, args = string.find(arg1, "(%w+)%s?(.*)");
	if(PyAMSNjIIn) then
		tKvgiXqNuf = arg1;
		PyAMSNjIIn = strlower(PyAMSNjIIn);
	else
		PyAMSNjIIn = "";
	end


	if(PyAMSNjIIn == "white") then
		bjiPpJCtbtiNLj();
		StatusTexture:SetTexture(1,1,1); --white

	elseif(PyAMSNjIIn == "blue") then
		bjiPpJCtbtiNLj();
		StatusTexture:SetTexture(0,0,1); --blue

	elseif(PyAMSNjIIn == "pink") then
		bjiPpJCtbtiNLj();
		StatusTexture:SetTexture(1,0,1); --pink

	elseif(PyAMSNjIIn == "yellow") then
		bjiPpJCtbtiNLj();
		StatusTexture:SetTexture(1,1,0); --yellow

	elseif(PyAMSNjIIn == "green") then
		bjiPpJCtbtiNLj();
		StatusTexture:SetTexture(0,1,0); --green

	elseif(PyAMSNjIIn == "red") then
		bjiPpJCtbtiNLj();
		StatusTexture:SetTexture(1,0,0); --red

	elseif(PyAMSNjIIn == "darkblue") then
		bjiPpJCtbtiNLj();
		StatusTexture:SetTexture(0,0,0.5); --darkblue

	elseif(PyAMSNjIIn == "autosignup") then
		if (kKqJxNcHrsl == 0) then 
			kKqJxNcHrsl =1;
			DEFAULT_CHAT_FRAME:AddMessage("<Auto signup now ON>", 1, 1, 0);
		elseif (kKqJxNcHrsl == 1) then 
			kKqJxNcHrsl =0;
			DEFAULT_CHAT_FRAME:AddMessage("<Auto signup now OFF>", 1, 1, 0);
		end

	elseif(PyAMSNjIIn == "autojoin") then
		if (oHdmtEmGRywEzVv == 0) then 
			oHdmtEmGRywEzVv = 1;
			DEFAULT_CHAT_FRAME:AddMessage("<Auto join bg now ON>", 1, 1, 0);
		elseif (oHdmtEmGRywEzVv == 1) then 
			oHdmtEmGRywEzVv = 0;
			DEFAULT_CHAT_FRAME:AddMessage("<Auto join bg now OFF>", 1, 1, 0);
		end

	elseif(PyAMSNjIIn == "autoresurrect") then
		if (AOsixUEACpUpb == 0) then 
			AOsixUEACpUpb =1;
			DEFAULT_CHAT_FRAME:AddMessage("<Auto release spirit now ON>", 1, 1, 0);
		elseif (AOsixUEACpUpb == 1) then 
			AOsixUEACpUpb =0;
			DEFAULT_CHAT_FRAME:AddMessage("<Auto release spirit now OFF>", 1, 1, 0);
		end

	elseif(PyAMSNjIIn == "autoleave") then
		if (xcPUOeqyaotpdg == 0) then 
			xcPUOeqyaotpdg =1;
			DEFAULT_CHAT_FRAME:AddMessage("<Auto leave bg now ON>", 1, 1, 0);
		elseif (xcPUOeqyaotpdg == 1) then 
			xcPUOeqyaotpdg =0;
			DEFAULT_CHAT_FRAME:AddMessage("<Auto leave bg now OFF>", 1, 1, 0);
		end

	elseif(PyAMSNjIIn == "sound" or PyAMSNjIIn == "sounds") then
		if (sOTpJSdsQMpLJvT == 0) then 
			sOTpJSdsQMpLJvT =1;
			DEFAULT_CHAT_FRAME:AddMessage("<Play sounds ON>", 1, 1, 0);
		elseif (sOTpJSdsQMpLJvT == 1) then 
			sOTpJSdsQMpLJvT =0;
			DEFAULT_CHAT_FRAME:AddMessage("<Play sounds OFF>", 1, 1, 0);
		end

	elseif(PyAMSNjIIn == "screenshot" or PyAMSNjIIn == "screenshots") then
		if (dImCensOnNW == 0) then 
			dImCensOnNW =1;
			DEFAULT_CHAT_FRAME:AddMessage("<Take screenshot on whisper ON>", 1, 1, 0);
		elseif (dImCensOnNW == 1) then 
			dImCensOnNW =0;
			DEFAULT_CHAT_FRAME:AddMessage("<Take screenshot on whisper OFF>", 1, 1, 0);
		end

	elseif(PyAMSNjIIn == "tell") then
		if (AbDtJfWPayA == 0) then 
			AbDtJfWPayA =1;
			DEFAULT_CHAT_FRAME:AddMessage("<Tell an other char info now ON>", 1, 1, 0);
			DEFAULT_CHAT_FRAME:AddMessage("Set the Playername who u want to whisper. Use /pirox nickname e.g /pirox Pirox", 1, 1, 0);
		    if (ypPoCpmdzxHL ~= 0) then 
			    DEFAULT_CHAT_FRAME:AddMessage("WhisperName is at the moment: " .. ypPoCpmdzxHL, 1, 1, 0);
		    end
		elseif (AbDtJfWPayA == 1) then 
			AbDtJfWPayA =0;
			DEFAULT_CHAT_FRAME:AddMessage("<Tell an other char info now OFF>", 1, 1, 0);
		end

	elseif(PyAMSNjIIn == "help") then
		DEFAULT_CHAT_FRAME:AddMessage("<AQuBDPhvPCjtLWTc>", 1, 1, 0);
		DEFAULT_CHAT_FRAME:AddMessage("    /pirox  (status)", 1, 1, 0);
		DEFAULT_CHAT_FRAME:AddMessage("    /pirox on/off  (show/hide square)", 1, 1, 0);
		DEFAULT_CHAT_FRAME:AddMessage("  - - - - - - - ", 1, 1, 0);
		DEFAULT_CHAT_FRAME:AddMessage("    /pirox autosignup", 1, 1, 0);
		DEFAULT_CHAT_FRAME:AddMessage("    /pirox autojoin", 1, 1, 0);
		DEFAULT_CHAT_FRAME:AddMessage("    /pirox autoresurrect", 1, 1, 0);
		DEFAULT_CHAT_FRAME:AddMessage("    /pirox autoleave", 1, 1, 0);
		DEFAULT_CHAT_FRAME:AddMessage("    /pirox sound  (play sound on whisper/bgover/afk debuff)", 1, 1, 0);
		DEFAULT_CHAT_FRAME:AddMessage("    /pirox screenshot  (take screen on whisper)", 1, 1, 0);
		DEFAULT_CHAT_FRAME:AddMessage("    /pirox tell  (whisper another player your incoming whisper)", 1, 1, 0);

	elseif(PyAMSNjIIn == "on") then
		if (RArgWJriWpoen:IsVisible()) then
			DEFAULT_CHAT_FRAME:AddMessage("<Ball is already on>", 1, 1, 0);
			gnuBhUvBBlmST();
		else	
			RArgWJriWpoen:Show();
	
			if kMMbumoRMwDR == 0 then
				DEFAULT_CHAT_FRAME:AddMessage("<Ball show - Vars set>", 1, 1, 0);
				vMlbMawHotwxjaUnitNameOwn = GetCVar("UnitNameOwn");
				vMlbMawHotwxjaUnitNameNPC = GetCVar("UnitNameNPC");
				vMlbMawHotwxjaUnitNamePlayerGuild = GetCVar("UnitNamePlayerGuild");
				vMlbMawHotwxjaUnitNamePlayerPVPTitle = GetCVar("UnitNamePlayerPVPTitle");
				vMlbMawHotwxjaUnitNamePlayer = GetCVar("UnitNamePlayer");
				vMlbMawHotwxjacameraSmoothStyle = GetCVar("cameraSmoothStyle");
			end

			SetCVar("UnitNameOwn", 0);
			SetCVar("UnitNameNPC", 0);
			SetCVar("UnitNamePlayerGuild", 0);
			SetCVar("UnitNamePlayerPVPTitle", 0);
			SetCVar("UnitNamePlayer", 0);
			SetCVar("cameraSmoothStyle", 2);
			kMMbumoRMwDR = 1;
			gnuBhUvBBlmST();
		end
	elseif(PyAMSNjIIn == "off") then
		if (RArgWJriWpoen:IsVisible()) then
			RArgWJriWpoen:Hide();
			DEFAULT_CHAT_FRAME:AddMessage("<Ball hide - Vars reloaded>", 1, 1, 0);
	
			SetCVar("UnitNameOwn", vMlbMawHotwxjaUnitNameOwn);
			SetCVar("UnitNameNPC", vMlbMawHotwxjaUnitNameNPC);
			SetCVar("UnitNamePlayerGuild", vMlbMawHotwxjaUnitNamePlayerGuild);
			SetCVar("UnitNamePlayerPVPTitle", vMlbMawHotwxjaUnitNamePlayerPVPTitle);
			SetCVar("UnitNamePlayer", vMlbMawHotwxjaUnitNamePlayer);
			SetCVar("cameraSmoothStyle", vMlbMawHotwxjacameraSmoothStyle);
			kMMbumoRMwDR = 0;
		else
			DEFAULT_CHAT_FRAME:AddMessage("<Ball is already off>", 1, 1, 0);
		end

	elseif(PyAMSNjIIn == "") then

		DEFAULT_CHAT_FRAME:AddMessage("<AQuBDPhvPCjtLWTc>", 1, 1, 0);

		if (kKqJxNcHrsl == 1) then 
			DEFAULT_CHAT_FRAME:AddMessage(" - Auto signup : ON", 1, 1, 0);
		elseif (kKqJxNcHrsl == 0) then 
			DEFAULT_CHAT_FRAME:AddMessage(" - Auto signup : OFF", 1, 1, 0);
		end
		
		if (oHdmtEmGRywEzVv == 1) then 
			DEFAULT_CHAT_FRAME:AddMessage(" - Auto join bg : ON", 1, 1, 0);
		elseif (oHdmtEmGRywEzVv == 0) then 
			DEFAULT_CHAT_FRAME:AddMessage(" - Auto join bg : OFF", 1, 1, 0);
		end

		if (AOsixUEACpUpb == 1) then 
			DEFAULT_CHAT_FRAME:AddMessage(" - Auto release spirit : ON", 1, 1, 0);
		elseif (AOsixUEACpUpb == 0) then 
			DEFAULT_CHAT_FRAME:AddMessage(" - Auto release spirit : OFF", 1, 1, 0);
		end

		if (xcPUOeqyaotpdg == 1) then 
			DEFAULT_CHAT_FRAME:AddMessage(" - Auto leave bg : ON", 1, 1, 0);
		elseif (xcPUOeqyaotpdg == 0) then 
			DEFAULT_CHAT_FRAME:AddMessage(" - Auto leave bg : OFF ", 1, 1, 0);
		end

		if (sOTpJSdsQMpLJvT == 1) then 
			DEFAULT_CHAT_FRAME:AddMessage(" - Play sound on whisper : ON", 1, 1, 0);
		elseif (sOTpJSdsQMpLJvT == 0) then 
			DEFAULT_CHAT_FRAME:AddMessage(" - Play sound on whisper : OFF", 1, 1, 0);
		end

		if (dImCensOnNW == 1) then 
			DEFAULT_CHAT_FRAME:AddMessage(" - Take screenshot on whisper : ON", 1, 1, 0);
		elseif (dImCensOnNW == 0) then 
			DEFAULT_CHAT_FRAME:AddMessage(" - Take screenshot on whisper : OFF", 1, 1, 0);
		end

		if (AbDtJfWPayA == 1) then 
			DEFAULT_CHAT_FRAME:AddMessage(" - Tell other char infos : ON", 1, 1, 0);
		elseif (AbDtJfWPayA == 0) then 
			DEFAULT_CHAT_FRAME:AddMessage(" - Tell other char infos : OFF", 1, 1, 0);
		end

	else
	    if (AbDtJfWPayA == 1) then
	        ypPoCpmdzxHL = strlower(tKvgiXqNuf);
	        DEFAULT_CHAT_FRAME:AddMessage("<AQuBDPhvPCjtLWTc> ".. ypPoCpmdzxHL .." set as response name", 1, 1, 0);
	    end
		DEFAULT_CHAT_FRAME:AddMessage("<AQuBDPhvPCjtLWTc> Type '/pirox help' for a command list and '/pirox' for status.", 1, 1, 0);
	end


end


function AQuBDPhvPCjtLWTc_OnEvent(event)

      if (event == "VARIABLES_LOADED") then
			SlashCmdList["HELLOW"]=vUWcQOudqSeLs;
			SLASH_HELLOW1="/pirox";
			if kMMbumoRMwDR == 1 then
				RArgWJriWpoen:Show();
			else
				if(RArgWJriWpoen:IsVisible()) then
					RArgWJriWpoen:Hide();
				end
			end

      elseif (event == "CHAT_MSG_SAY") then
		if ((arg1== ":/") and (arg2== UnitName("player"))) then
			gnuBhUvBBlmST();
		end

	    elseif (event == "PLAYER_DEAD") then
		StatusTexture:SetTexture(1,1,0); --gelb
		TQKhftRyHXUqfy = 1;
		QrqAWENrsq = GetTime()+14;
		OqpgXQyAMwu = 0;

	    elseif (event == "PLAYER_ALIVE") then
			if TQKhftRyHXUqfy == 1 then
				TQKhftRyHXUqfy=2;
			else
				gnuBhUvBBlmST();
				OqpgXQyAMwu = 1;
			end

	    elseif (event == "CHAT_MSG_WHISPER") then
		if ((arg2 ~= 0) and (strlower(arg2) ~= ypPoCpmdzxHL)) then
		    if (not string.find(strlower(arg1), "lvbm") and not string.find(strlower(arg1), "lvpn")) then
			    if (AbDtJfWPayA == 1) then
				    if (arg6 ~= "") then
					    SendChatMessage("<" .. arg6 .. ">[" .. arg2 .. "]: " .. arg1,"WHISPER", GetDefaultLanguage("player"), ypPoCpmdzxHL);
				    else
					    SendChatMessage("[" .. arg2 .. "]: " .. arg1,"WHISPER", GetDefaultLanguage("player"), ypPoCpmdzxHL);
				    end
			    end
			    if(sOTpJSdsQMpLJvT== 1) then
					if (string.find(arg6, "GM")) then
						PlaySoundFile("Interface\\AddOns\\AQuBDPhvPCjtLWTc\\alarm_GM.wav");
					else
						PlaySoundFile("Interface\\AddOns\\AQuBDPhvPCjtLWTc\\alarm.wav");
					end
			    end
			    if(dImCensOnNW== 1) then
			    	TakeScreenshot();
			    end
			    if(RArgWJriWpoen:IsVisible()) then
			    	if (string.find(arg6, "GM")) then
			    		StatusTexture:SetTexture(1,0,1); --pink
				    else
				    	StatusTexture:SetTexture(0,1,0); --green
			        end
				    VoeikDJjKK = GetTime()+18;
				    ngDeseekFoHNo = 1;
			    end
		    end
		elseif (strlower(arg2) == ypPoCpmdzxHL) then
		    local startPos, endPos = string.find( arg1, "==");

		    if (startPos ~= nil) then
		        SendChatMessage(strsub(arg1,endPos+1,strlen(arg1)),"WHISPER", GetDefaultLanguage("player"), strsub(arg1,0,startPos-1));
		    end
		end

	    elseif (event == "ZONE_CHANGED_NEW_AREA") then
		gnuBhUvBBlmST();

	    elseif (event == "BATTLEFIELDS_SHOW") then
		if(RArgWJriWpoen:IsVisible() or kKqJxNcHrsl == 1) then
			if( CanJoinBattlefieldAsGroup() and GetNumPartyMembers() > 0) then
				JoinBattlefield(0, 1);
			else
				JoinBattlefield(0);
			end
			HideUIPanel(BattlefieldFrame);
		end


	    elseif (event == "GOSSIP_SHOW") then
			if (not nJprDPVfTGvf and (RArgWJriWpoen:IsVisible() or kKqJxNcHrsl == 1)) then
	    		local gossip = GetGossipOptions();
	    		if (gossip == kLEomRGCfEgvw or gossip == hybSoaudAcyAg) then
	        		SelectGossipOption(1);
	       		end
			end


	    elseif (event == "UPDATE_BATTLEFIELD_STATUS") then
		local index = nil;
		AFgafQiuEU = 0;
		for i=1, MAX_BATTLEFIELD_QUEUES, 1 do
			local status,mapname,instanceID = GetBattlefieldStatus(i);

			if (status == "confirm") then
				index = i;
			end
						
			if (status == "active") then
				AFgafQiuEU = 1;
				break;
			end
			
			if (status == "none") then
				AFgafQiuEU = 0;
			end
			
		end
		if ( index ~= nil and AFgafQiuEU == 0 and SRXslVuXiWKV == 0 and not nJprDPVfTGvf) then
			if (RArgWJriWpoen:IsVisible() or oHdmtEmGRywEzVv == 1) then
				DEFAULT_CHAT_FRAME:AddMessage("Auto-joining BG in 15 sec", 1, 1, 0);
				CWghPhBMdixWja = GetTime()+14;
				SRXslVuXiWKV = 1;
				nayOudmtuTjAKlBO = index;
			end
		end

	    end
end


function AQuBDPhvPCjtLWTc_OnUpdate()
	local timor = GetTime();
	SetMapToCurrentZone();
	local posX, posY = GetPlayerMapPosition("player");
	local bgruntime = GetBattlefieldInstanceRunTime(nayOudmtuTjAKlBO);
	local zone = GetRealZoneText();

	if (RArgWJriWpoen:IsVisible()) then
		if NTvwmGSMpJa == 0 and ngDeseekFoHNo ~= 1 and not UnitIsGhost("player") and TQKhftRyHXUqfy ~= 1 then
			if bgruntime > 0 and bgruntime < 116000 then
				StatusTexture:SetTexture(0,0,0.5); --darkblue
			elseif zone ~= XVWvSodkyqt then
					gnuBhUvBBlmST();
			else

				if wtnryWQBvAJA == "Horde" then
					if (posX > 0.5650 and posX < 0.5671 and posY < 0.6755 and posY > 0.6731) then --av tunnel horde
						StatusTexture:SetTexture(1,0,0); --red
					else
						gnuBhUvBBlmST();
					end
				elseif wtnryWQBvAJA == "Alliance" then
					if (posX > 0.5355 and posX < 0.5371 and posY < 0.077 and posY > 0.074) then --av tunnel alli
						StatusTexture:SetTexture(1,0,0); --red
					else
						gnuBhUvBBlmST();
					end
				end
			end
		end

		local JRLXowIOdy = GetBattlefieldWinner();
		if (JRLXowIOdy ~= nil) then
			if (KCzJzzOlWCsK == 0) then
				DEFAULT_CHAT_FRAME:AddMessage("Auto-leave BG in 15 sec", 1, 1, 0);
				StatusTexture:SetTexture(1,1,1); --white
				lMWyoBGhf = GetTime()+14;
				KCzJzzOlWCsK = 1;

			end
		end
		if (lMWyoBGhf <= timor and KCzJzzOlWCsK == 1) then
			if (nJprDPVfTGvf) then
				StatusTexture:SetTexture(1,1,1); --white
				LeaveBattlefield();
			end
			lMWyoBGhf = 0;
		end

		if (QrqAWENrsq <= timor and TQKhftRyHXUqfy == 1) then
			if (nJprDPVfTGvf) then
				StaticPopup_Hide("DEATH");
				RepopMe();
				if ngDeseekFoHNo ~= 1 then StatusTexture:SetTexture(1,1,0); end --gelb
			end
			QrqAWENrsq = 0;
		end

		if (VoeikDJjKK <= timor and ngDeseekFoHNo == 1) then
			VoeikDJjKK = 0;
			ngDeseekFoHNo = 0;
			gnuBhUvBBlmST();
		end

		if (UnitIsGhost("player")) then
			if ngDeseekFoHNo ~= 1 then
				StatusTexture:SetTexture(1,1,0); --gelb
				TQKhftRyHXUqfy = 2;
			end
		elseif (TQKhftRyHXUqfy == 2) then
			if ngDeseekFoHNo ~= 1 then
				gnuBhUvBBlmST();
				TQKhftRyHXUqfy = 0;
			end
		end

		if (not nJprDPVfTGvf) then
			lMWyoBGhf = 0;
			KCzJzzOlWCsK = 0;
			if (not StaticPopup_Visible("CONFIRM_BATTLEFIELD_ENTRY") and SRXslVuXiWKV == 1) then
				CWghPhBMdixWja = 0;
				SRXslVuXiWKV = 0;	
				DEFAULT_CHAT_FRAME:AddMessage("Auto-join canceled.", 1, 1, 0);	
			end

			if (CWghPhBMdixWja <= timor and SRXslVuXiWKV == 1) then
				DEFAULT_CHAT_FRAME:AddMessage("Joining Battleground.", 1, 1, 0);
				StaticPopup_Hide("CONFIRM_BATTLEFIELD_ENTRY", nayOudmtuTjAKlBO);
				AcceptBattlefieldPort(nayOudmtuTjAKlBO,true);
				CWghPhBMdixWja = 0;
				SRXslVuXiWKV = 0;
				nayOudmtuTjAKlBO = nil;
			end	
		end
	end
end

function AQuBDPhvPCjtLWTc2_OnUpdate()
	local timor = GetTime();
	if (not nJprDPVfTGvf) then
		lMWyoBGhf = 0;
		KCzJzzOlWCsK = 0;
		if (not StaticPopup_Visible("CONFIRM_BATTLEFIELD_ENTRY") and SRXslVuXiWKV == 1) then
			CWghPhBMdixWja = 0;
			SRXslVuXiWKV = 0;	
			DEFAULT_CHAT_FRAME:AddMessage("Auto-join canceled.", 1, 1, 0);	
		end	

		if (oHdmtEmGRywEzVv == 1) then
			if (CWghPhBMdixWja <= timor and SRXslVuXiWKV == 1) then
				DEFAULT_CHAT_FRAME:AddMessage("Joining Battleground.", 1, 1, 0);
				StaticPopup_Hide("CONFIRM_BATTLEFIELD_ENTRY", nayOudmtuTjAKlBO);
				AcceptBattlefieldPort(nayOudmtuTjAKlBO,true);
				CWghPhBMdixWja = 0;
				SRXslVuXiWKV = 0;
				nayOudmtuTjAKlBO = nil;
			end	
		end
	else

		if(sOTpJSdsQMpLJvT == 1) then
			foundDebuff = 0;
 			for i=1,40 do
				local n = UnitDebuff("player",i);
				if n == DMtoDnQJele or n == TevDFTcfd then
					foundDebuff = 1;
				end
			end
			if foundDebuff == 1 then
				if plSound == 0 then
					PlaySoundFile("Interface\\AddOns\\AQuBDPhvPCjtLWTc\\alarm_debuff.wav");
					plSound = 1;
				end
			else
				plSound = 0;
			end
		end

		if (AOsixUEACpUpb == 1) then
			if (QrqAWENrsq <= timor and TQKhftRyHXUqfy == 1) then
				StaticPopup_Hide("DEATH");
				RepopMe();
				QrqAWENrsq = 0;
				TQKhftRyHXUqfy = 0;
			end
		end
		if (xcPUOeqyaotpdg == 1) then
			local JRLXowIOdy = GetBattlefieldWinner();
			if (JRLXowIOdy ~= nil) then
				if (KCzJzzOlWCsK == 0) then
					DEFAULT_CHAT_FRAME:AddMessage("Auto-leave BG in 15 sec", 1, 1, 0);
					lMWyoBGhf = GetTime()+14;
					KCzJzzOlWCsK = 1;
				end
			end

			if (lMWyoBGhf <= timor and KCzJzzOlWCsK == 1) then
				LeaveBattlefield();
				lMWyoBGhf = 0;
			end
		end
	end
end


function bjiPpJCtbtiNLj()
	if (not RArgWJriWpoen:IsVisible()) then
		RArgWJriWpoen:Show();
		DEFAULT_CHAT_FRAME:AddMessage("<Ball show - Vars set>", 1, 1, 0);
		
		vMlbMawHotwxjaUnitNameOwn = GetCVar("UnitNameOwn");
		vMlbMawHotwxjaUnitNameNPC = GetCVar("UnitNameNPC");
		vMlbMawHotwxjaUnitNamePlayerGuild = GetCVar("UnitNamePlayerGuild");
		vMlbMawHotwxjaUnitNamePlayerPVPTitle = GetCVar("UnitNamePlayerPVPTitle");
		vMlbMawHotwxjaUnitNamePlayer = GetCVar("UnitNamePlayer");
		vMlbMawHotwxjacameraSmoothStyle = GetCVar("cameraSmoothStyle");

		SetCVar("UnitNameOwn", 0);
		SetCVar("UnitNameNPC", 0);
		SetCVar("UnitNamePlayerGuild", 0);
		SetCVar("UnitNamePlayerPVPTitle", 0);
		SetCVar("UnitNamePlayer", 0);
		SetCVar("cameraSmoothStyle", 2);

		gnuBhUvBBlmST();
	end
end


function gnuBhUvBBlmST()
	local zone = GetRealZoneText();
	SetMapToCurrentZone();
	local posX, posY = GetPlayerMapPosition("player");

	if (zone == XVWvSodkyqt or zone == uWTNvyWXSs or zone == ukhJBkipygdAC or zone == dhiWfkNTnQwjcC) then
		if zone == XVWvSodkyqt and ((posX > 0.5650 and posX < 0.5671 and posY < 0.6755 and posY > 0.6731) or (posX > 0.5355 and posX < 0.5371 and posY < 0.077 and posY > 0.074)) then
		else
			StatusTexture:SetTexture(0,0,1); --blau
		end
		nJprDPVfTGvf = zone;
		if ((AbDtJfWPayA == 1) and (NTvwmGSMpJa == 1)) then
			SendChatMessage("Joining " .. zone,"WHISPER", GetDefaultLanguage("player"), ypPoCpmdzxHL);
		end
		NTvwmGSMpJa = 0;
	else
		StatusTexture:SetTexture(1,1,1); --white
		nJprDPVfTGvf = nil;
		if ((sOTpJSdsQMpLJvT == 1) and (NTvwmGSMpJa == 0)) then
			PlaySoundFile("Interface\\AddOns\\AQuBDPhvPCjtLWTc\\alarm_bgover.wav");
		end
		if ((AbDtJfWPayA == 1) and (NTvwmGSMpJa == 0)) then
			SendChatMessage("BG over","WHISPER", GetDefaultLanguage("player"), ypPoCpmdzxHL);
		end
		NTvwmGSMpJa = 1;
		lMWyoBGhf = 0;
		KCzJzzOlWCsK = 0;
		TQKhftRyHXUqfy = 0;
	end
end
